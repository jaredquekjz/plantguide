The medfate reference book
true

2024-04-10

\section*{Contents}
Preface ..... 9
How to use this book ..... 9
An collaborative project ..... 9
Funding ..... 11
Acknowledgements ..... 11
I Preliminaries ..... 13
1 Introduction ..... 15
1.1 Purpose ..... 15
1.2 Installation ..... 16
1.3 Main functions in medfate ..... 17
1.4 Main functions in medfateland ..... 20
2 Model inputs ..... 23
2.1 Input structures ..... 23
2.2 Latitude and topography ..... 25
2.3 Soil description ..... 25
2.4 Vegetation description ..... 29
2.5 Metereological input ..... 37
2.6 Simulation control ..... 39
II Basic water balance modelling ..... 41
3 Basic water balance model ..... 43
3.1 Design principles ..... 43
3.2 State variables ..... 44
3.3 Water balance ..... 44
3.4 Process scheduling ..... 46
3.5 Inputs and outputs ..... 47
3.6 Applications ..... 51
4 Leaf phenology and radiation extinction ..... 53
4.1 Leaf phenology ..... 53
4.2 Radiation extinction ..... 56
5 Forest hydrology ..... 59
5.1 Snow and rainfall ..... 59
5.2 Snow pack dynamics ..... 59
5.3 Rainfall interception loss ..... 60
5.4 Bare soil evaporation ..... 63
5.5 Transpiration of the herbaceous layer ..... 63
5.6 Infiltration ..... 64
5.7 Soil water flows ..... 66
6 Woody plant transpiration, photosynthesis and water status ..... 75
6.1 Plant transpiration and photosynthesis ..... 75
6.2 Plant drought stress and cavitation ..... 80
III Advanced water balance modelling ..... 83
7 Advanced water balance model ..... 85
7.1 About Sureau ..... 85
7.2 Design principles ..... 86
7.3 State variables ..... 87
7.4 Water and energy balances ..... 88
7.5 Process scheduling ..... 89
7.6 Inputs and outputs ..... 90
8 Sub-daily atmospheric temperature and radiation variation ..... 99
8.1 Above-canopy air temperature ..... 99
8.2 Incoming diffuse and direct short-wave radiation ..... 99
8.3 Incoming long-wave radiation ..... 99
9 Radiation transfer ..... 101
9.1 Short-wave radiation ..... 101
9.2 Long-wave radiation ..... 106
10 Plant hydraulics ..... 109
10.1 Hydraulic architecture ..... 109
10.2 Vulnerability curves ..... 110
10.3 Water content of plant tissues ..... 115
10.4 Sperry's sub-model of plant hydraulics ..... 119
10.5 Sureau's sub-model of plant hydraulics ..... 131
11 Leaf/canopy photosynthesis ..... 133
11.1 Leaf energy balance, gas exchange and photosynthesis ..... 133
11.2 Crown/canopy photosynthesis ..... 138
12 Stomatal regulation, transpiration and photosynthesis ..... 143
12.1 Stomatal regulation under Sperry's sub-model ..... 143
12.2 Stomatal regulation and transpiration under Sureau's sub-model ..... 147
12.3 Cohort-level transpiration and photosynthesis ..... 149
12.4 Cavitation and conduit refilling ..... 149
13 Closing energy balances ..... 151
13.1 Single-layer canopy ..... 151
13.2 Multi-layer canopy ..... 153
14 Day-level results ..... 157
14.1 Photosynthesis and transpiration ..... 157
14.2 Plant water potentials and relative water contents ..... 157
14.3 Plant drought stress ..... 158
IV Forest growth modelling ..... 159
15 Forest growth model ..... 161
15.1 Design principles ..... 161
15.2 State variables ..... 171
15.3 Mass and energy balances ..... 171
15.4 Process scheduling ..... 173
15.5 Inputs and outputs ..... 175
16 Carbon pools and components of the carbon balance ..... 183
16.1 Size of carbon pools ..... 183
16.2 Components of labile carbon balance ..... 185
17 Growth, senescence and mortality ..... 189
17.1 Growth ..... 189
17.2 Senescence ..... 192
17.3 Update of plant traits and allocation targets ..... 193
17.4 Plant mortality ..... 195
17.5 Fire severity ..... 202
17.6 Update of structural variables ..... 203
V Forest dynamics modelling ..... 205
18 Forest dynamics model ..... 207
18.1 Design principles ..... 207
18.2 State variables ..... 209
18.3 Process scheduling ..... 209
18.4 Inputs and outputs ..... 209
18.5 Process details ..... 212
VI Landscape/regional modelling ..... 215
19 Watershed hydrology ..... 217
19.1 Design principles ..... 217
19.2 State variables ..... 218
19.3 Water balance ..... 218
19.4 Process scheduling ..... 219
19.5 Inputs and outputs ..... 219
19.6 Process details ..... 221
20 Seed dispersal ..... 223
20.1 Design principles ..... 223
20.2 Process scheduling ..... 223
20.3 Process details ..... 225
VII Static modules ..... 227
21 Allometric models ..... 229
21.1 Input data ..... 229
21.2 Allometric relationships ..... 230
22 Post-simulation procedures ..... 233
22.1 Water use efficiency ..... 233
23 Wind extinction ..... 235
23.1 Wind speed at the top of the canopy ..... 235
23.2 Wind extinction profile ..... 235
24 Fuel characteristics and fire behaviour ..... 237
24.1 Overview ..... 237
24.2 Input data ..... 237
24.3 Fuel characteristics ..... 239
24.4 Surface fire behavior ..... 247
24.5 Crown fire behavior ..... 252
24.6 Fire potentials ..... 254
24.7 Unit conversion of outputs ..... 255
A Inbuilt parameter estimation ..... 257
A. 1 Introduction ..... 257
A. 2 Strict, scaled and imputable parameters ..... 257
A. 3 Imputation of missing values ..... 262
A. 4 Scaling size-related parameters ..... 278
B Symbols ..... 287
B. 1 Dimensions ..... 287
B. 2 Soils ..... 287
B. 3 Plant/leaf classification ..... 288
B. 4 Vegetation ..... 288
B. 5 Meteorology ..... 289
B. 6 Anatomy ..... 290
B. 7 Radiation ..... 291
B. 8 Water balance ..... 291
B. 9 Energy balance ..... 292
B. 10 Forest hydrology ..... 292
B. 11 Plant hydraulics ..... 293
B. 12 Photosynthesis ..... 294
B. 13 Plant water content ..... 295
B. 14 Stomatal regulation ..... 295
B. 15 Carbon pools ..... 295
B. 16 Carbon balance ..... 296
B. 17 Growth, senescence and mortality ..... 297

\section*{Preface}

This is a reference book for the models implemented in medfate and medfateland, two R packages that provide functions for the simulation of functioning and dynamics of Mediterranean forests and landscapes.

\section*{How to use this book}

This reference book is meant to help you understand the static and dynamic models included in packages medfate (ver. 4.1.0) and medfateland (ver. 2.2.0). Hands-on user guides to run simulation functions and static functions can be found as package vignettes within the packages. As any reference book, you are not expected to read the book linearly, but to jump to specific book sections whenever you have doubts about the design or implementation of certain processes or calculations.

The first part of the book presents the main functions of the package and describes the soil, vegetation and weather inputs that apply to all simulation models. After that, the book presents in detail each simulation model using a set of chapters. The first of those provides an overview of the model design and the remaining ones describe the details of formulations by groups of related processes. Process formulations that are common to more than one model are described only once, to avoid repeating material already presented, but links are provided whenever needed. Static models and their corresponding R functions are presented grouped at the end of the book, before the appendices, which include parameter estimation information and a list of all symbols for reference.

In this book we use objectname or variablename to refer to an R objects or a variable within data frames, and functionname() to refer to a package function. Whenever relevant, we indicate the correspondence between mathematical symbols, their units and the names used within the R package.

Our aim is to continuously update this reference book along with package developments, so that users have detailed and up-to-date information about the models at the time functions are run. Since the book evolves with the package, after any model application we recommend users to store a PDF version of the reference book to be sure it matches the version the package reported in their application report or article.

\section*{An collaborative project}

You should look at medfate, medfateland and associated $R$ packages as an ongoing research project for the development of forest ecosystem modelling tools. The models included in the package may contain bugs, and provide wrong predictions (all models are wrong, remember?). Package functions may evolve in the future, so that you may have to modify your scripts after package updates (hopefully not too often). Nevertheless, we feel the tool is mature enough to become useful for applications and that is why we made an effort to document it thoroughly.

The set of R packages are developed and maintained by the Ecosystem Modelling Facility unit at CREAF (in Spain), in close collaboration with researchers from URFM-INRAE (in France) and CTFC (in Spain):
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-010.jpg?height=476&width=987&top_left_y=243&top_left_x=569)

At the individual level, the R packages are the result of collaborative work between modelers and experts in different disciplines. The following is a list of researchers that have contributed to the project with ideas, data or code:
- Jordi Martínez-Vilalta (CREAF-UAB, Spain)
- Maurizio Mencuccini (CREAF-ICREA, Spain)
- Juli G. Pausas (CIDE-CSIC, Spain)
- Pilar Llorens (CSIC, Spain)
- Rafa Poyatos (CREAF, Spain)
- Lluís Brotons (CREAF-CSIC, Spain)
- Antoine Cabon (WSL, Switzerland)
- Roberto Molowny (EMF-CREAF, Spain)
- Victor Granda (EMF-CREAF, Spain)
- Adriana Tovar (EMF-CREAF, Spain)
- Alicia Forner (MNCN-CSIC, Spain)
- Lluís Coll (UdL, Spain)
- Pere Casals (CTFC, Spain)
- Mario Beltrán (CTFC, Spain)
- Jean-Marc Limousin (CEFE, France)
- Aitor Améztegui (UdL, Spain)
- Nicolas Martin-StPaul (INRAE, France)
- Hervé Cochard (INRAE, France)
- Julien Ruffault (INRAE, France)
- François Pimont (INRAE, France)
- Shengli Huang (USDA, USA)
- Enric Batllori (UB-CREAF, Spain)
- Santi Sabaté (UB-CREAF, Spain)
- Daniel Nadal-Sala (UB, Spain)
- Maria González Sanchis (UVA, Spain)
- Daniel Caviedes-Voullième (Forschungszentrum Julich, Germany)
- Mario Morales-Hernández (U Zaragoza, Spain)
- Mario Morales (UdZ, Spain)
- Raúl García Valdés (URJC, Spain)
- Josep M ${ }^{\text {a }}$ Espelta (CREAF, Spain)
- Francisco Lloret (CREAF, Spain)
- Teresa Valor (CTFC, Spain)

If your own expertise includes any of the processes that are modeled in the package and you feel that your expertise could be helpful to improve the package, you are more than welcome to contact us!

\section*{Funding}

I have been intensively working on medfate since 2013, when I obtained a Ramon $y$ Cajal research fellowship from the Spanish government (Reference: RYC-2012-11109; Amount: $308.600 €$ ). An investment on a longterm modelling project could not have started with this initial financial help and that of the following competitive research projects:
- Title: Forecasting of ecosystem services on forests: impacts and adaptation to extreme climate events (FORESTCAST). Financial Entity: Ministerio de Economia y Competitividad (CGL2014-59742-C2-2-R). Amount: 152.460 €. Duration from: $01 / 01 / 2015$ to: $31 / 12 / 2017$. PI: Lluís Brotons/Miquel De Cáceres.
- Title: Modeling plant water use and drought resistance strategies across scales (DRESS). Financial Entity: Ministerio de Economia y Competitividad (CGL2017-89149-C2-2-R). Amount: 93.170 €. Duration from: $01 / 01 / 2018$ to: $31 / 12 / 2021$. PI: Miquel De Cáceres.
- Title: Boosting process-based models to project forest dynamics and associated ecosystem services at stand-to-regional scales (BOMFORES). Financial Entity: Ministerio de Ciencia e Innovación (PID2021-126679OB-I00). Amount: 75.020 €. Duration from: $01 / 09 / 2022$ to: $31 / 08 / 2024$. PI: Miquel De Cáceres.

Besides this specific funding, this model developments could not have occurred without the institutional support of the Forest Science and Technology Center of Catalonia (CTFC), where I worked until March 2021, and Center for Ecological Research and Forestry Applications (CREAF), where I currently coordinate its Ecosystem Modelling Facility (EMF).

\section*{Acknowledgements}

The idea of an R package devoted to Mediterranean vegetation evolved after a previous attempt at modelling the dynamics of plant cohorts within a landscape model that tried to extend the MEDFIRE model. I made these initial efforts when I was still a post-doc at CTFC under the supervision of Lluís Brotons, to whom I am grateful for having greatly expanded my view of ecology and its applications. Undertaking this initial endeavor made us contact two excellent researchers in fire and drought ecology respectively, Juli G. Pausas (CIDE-CSIC, Spain) and Jordi Martínez-Vilalta (CREAF-UAB, Spain). While interacting with Juli was rewarding and fostered my interest in wildfires and fire ecology, Jordi had a profound influence on the project. Collaborating with him caused a slow but steady drift of my research interests towards the soil water balance, plant hydraulics and physiological responses to drought. His influence on my work was not so apparent when we published water balance model (and launched the R package) with the help of the forest hydrologist Pilar Llorens (CSIC, Spain) and other researchers (Rafa Poyatos, Lluís Coll and Pere Casals). However, it became undeniable when I started studying plant hydraulics, trying to understand and implement Sperry's model in the package. Jordi made me interact with people in his research group and introduced me to Maurizio Mencuccini, another great ecophysiologist with whom he had been working for a long time. I have to thank Maurizio and Jordi for encouraging me to continue working on this development project and overcome the difficulty that entails learning scientific disciplines quite far from my previous experience.

The development of the package has benefited from many colleagues who have provided me with ideas or have struggled to use the models within it. Asaf Karavani was among the first package users besides me. Together, we used the package to predict soil moisture dynamics in forest plots where mushroom production was being monitored. Antoine Cabon (CTFC, Spain) was also an early user of the package. I have enjoyed endless discussions with him about several processes and how to implement them. While he was the Ph.D. student and I one of his advisors, I felt we both learned together. Moreover, Antoine has contributed with some functions to the package (and I hope he will contribute more!). Another key person for the development of medfate was working with Victor Granda (Ecosystem Modelling Facility at CREAF,

Spain), whose great programming skills and profound knowledge about R technologies has encouraged me to embrace new programming habits and skills. I owe the idea of separating packages meteoland and medfate to Roberto Molowny (Ecosystem Modelling Facility at CREAF, Spain) an excellent modeller who has also contributed to the design of dispersal in medfateland. More recently, collaboration with another ecophysiologist, Nicolas Martin-StPaul (INRA, France), has stimulated improvements both in meteoland and medfate. In fact, Nicolas has became another key person in my research, with whom I share the interest for one of the interfaces between fire and drought, namely fuel moisture dynamics. Thanks to him and other colleagues (Julien Ruffault and François Pimont), since ver. 3.0 medfate includes an additional sub-model of plant hydraulics, based on SurEau-ECOS. Collaboration with Shengli Huang (Forest Service, US) on adapting the package for the US Forest Inventory and Analysis (FIA) program has expanded the horizons of its application. Collaboration with Josep Maria Espelta (CREAF) and Francisco Lloret (UABCREAF) has been key to the design of regeneration processes. The soil hydrology processes in the package, as well as recent coupling developments would be not possible without María Gonzalez Sanchís (UPV, Spain), Daniel Caviedes-Voullième (Forschungszentrum Jülich, Germany) and Mario Morales-Hernández (U. Zaragoza, Spain). The package have also benefited from the feed back of other users, such as Francesco d'Adamo (CREAF, Spain), Paula Martín (CTFC, Spain).

I would not like to finish the acknowledgements without thanking my former colleagues at CTFC (located in the small town of Solsona, Catalonia, Spain), for their collaboration and support. Particularly, Lluís Coll, Aitor Ameztegui and Pere Casals have been continuously supporting my efforts and finding new model applications. Moreover, they have contributed to the knowledge within the package with their expertise in forest dynamics, forest management, soils and fire issues. I also thank Mario Beltrán and Assu Gil for teaching me the basics of forest management.

Finally, I would like to thank José Manuel, who takes care of me and has to endure my endless talking about the package and its models, to my family for being there at difficult times, including my three nephews (Aran, Jan and Nil) that constantly remind me the joy of life.
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-012.jpg?height=291&width=242&top_left_y=1512&top_left_x=948)

\section*{Part I}

\section*{Preliminaries}

\section*{Chapter 1}

\section*{Introduction}

This chapter provides an overview of the purpose of developing the medfate an medfateland R packages, their main simulation functions and expected applications.

\subsection*{1.1 Purpose}

Being able to anticipate the impact of global change on forest function and dynamics is one of the major environmental challenges in contemporary societies. However, uncertainties in the mechanisms underpinning forest function and practical constraints in how to integrate available information still hinder the availability of robust and reliable predictive models. Despite the amount of knowledge accumulated about the function and dynamics of forest ecosystems and the plethora of observations and modelling tools already available, further efforts are necessary to achieve the challenge of integrating different global change drivers into simulation frameworks useful for research and applications.

\subsection*{1.1.1 Package medfate}

The R package medfate has been designed as a platform to simulate the function and dynamics of individual forest stands at temporal scales from days to years. Climate is the main environmental driver forcing model predictions, and the ecological, biophysical, hydrological and physiological processes surrounding these are fundamental for the simulation models included in the package. In particular, the package allows the simulation of daily energy, water and carbon balances within forest stands. It also allows simulating the growth, mortality and regeneration processes of a set of woody plant cohorts competing for light and water within a forest stand. Finally, additional package functions allow relating the amount of plant biomass and the water status of plant live and dead tissues to fuel characteristics and, hence, fire hazard.

The version of the reference manual that you are reading is intended to reflect version 4.1.0 of the package.

\subsection*{1.1.2 Package medfateland}

The R package medfateland has been designed to extend the capabilities of medfate to a spatial context, most usually at the landscape or regional level. It allows running the stand-level models available in medfate on a set of spatial units (normally points or cells) within a target area. The package allows coordinating the dynamics of multiple stands via the evaluation of demand-based management scenarios. Additionally, the package allows considering lateral water transfer processes of forested watersheds. Hence, medfateland can also be used as a tool for eco-hydrological applications.

The version of the reference manual that you are reading is intended to reflect version 2.2.0 of the package.

\subsection*{1.1.3 Companion packages}

Packages medfate and medfateland are more easily used in conjunction with two other packages, called meteoland and medfateutils. Package meteoland assists the estimation of weather variables over landscapes, whereas medfateutils provides multiple functions to assist the creation of inputs and the parameterization of simulation models. Together the four R packages conform a modelling framework designed to help simulating the function and dynamics of forest ecosystems, with a particular focus on drought impacts under Mediterranean conditions (Fig. 1.1).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-016.jpg?height=763&width=1153&top_left_y=628&top_left_x=485}
\captionsetup{labelformat=empty}
\caption{Figure 1.1: Set of packages conforming the medfate modelling framework}
\end{figure}

\subsection*{1.2 Installation}

\subsection*{1.2.1 Requirements}

Both medfate and medfateland have a user interface in R , but models have been coded in $\mathbf{C + +}$ language, and the resulting simulation functions are linked to $R$ via the $\mathbf{R c p p}$ package. This means that whenever installation is done from sources you will need a C++ compiler (i.e. Rtools in Windows). Note that compilers will always be a requirement when installing packages from GitHub.

\subsection*{1.2.2 Installing medfate}

Package medfate can be found at CRAN, where it is updated every few months. Hence, it can be installed as any other $R$ package using:
install.packages("medfate")

Users can also download and install the latest stable versions GitHub as follows (required package remotes should be installed/updated first):
remotes::install_github("emf-creaf/medfate")

Among other dependencies, installing medfate requires package meteoland, as it links to some of its C++ functions. Note that some package dependencies are only suggested, so that they are not automatically installed when installing medfate.

\subsection*{1.2.3 Installing medfateland}

Since both packages evolve together, installing medfateland normally requires an up-to-date version of medfate. The package medfateland is currently only available at GitHub, and can be installed using:
remotes::install_github("emf-creaf/medfateland")

Among other dependencies, installing medfateland requires packages medfate and meteoland, as it links to some of their C++ functions.

\subsection*{1.3 Main functions in medfate}

\subsection*{1.3.1 Dynamic simulation functions}

Dynamic simulation functions in medfate include three nested simulation levels (Fig. 1.2):
1. Forest water and energy balance can be studied for a given forest stand using function spwb() (soil-plant-water-balance). The same function is used to run three different models (Granier, Sperry or Sureau), that correspond to two levels of complexity (basic or advanced; see Fig. 1.2). The user should choose one model or another depending on the intended application and data availability. Water balance simulations include hydrological processes (rainfall interception, soil infiltration, percolation and evapotranspiration) and plant physiological processes related to transpiration (hydraulics, photosynthesis and stomatal regulation). Most processes are implemented at the daily scale, although some operate at subdaily time steps for advanced models. Function spwb() has a closely related function spwb_day() that allows focusing on sub-daily processes. Finally, one can simulate plant physiological processes only, while having soil moisture as a prescribed dynamic input like weather, using function pwb() (plant-water-balance).
2. Changes in primary (leaf area) and secondary (sapwood) growth are key to evaluate the influence of climatic conditions on plant and forest structure and function. Function growth() extends the previous models because it allows simulating carbon balance, tissue growth and mortality of a set of plant cohorts competing for light and water in a given forest stand. Analogously to the simulation of water balance, growth() has a closely related function growth_day() that allows focusing on sub-daily processes (i.e. carbon balance).
3. Finally, function fordyn() complements growth and mortality processes with recruitment (from seeds) and resprouting, thus completing the minimum set of demographic processes needed to simulate Mediterranean forest dynamics. The function splits the period to be simulated by years and makes internal calls to growth() for the simulation of growth and mortality. fordyn() is suited to simulate the inter-annual variation in forest structure and composition, while accounting for the biophysical and physiological processes provided by the former models. In addition, in allows simulating human interventions (i.e. tree or shrub cuts) on forest stands.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-018.jpg?height=2020&width=1617&top_left_y=336&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 1.2: Nested relationships between medfate simulation functions and processes included in each model}
\end{figure}

\subsection*{1.3.2 Sub-model functions}

Many of the sub-models included in medfate are implemented as C++ functions and internally called by the simulation functions implementing top-level models. Most sub-models have, however, their corresponding R function to made them directly available to the user. This facilitates understanding the different sub-models and a more creative use of the package. However, most users will not normally use them in their simulation workflows. Sub-model functions are grouped by subject, which is included in the name of the function. The different sub-model functions are (by subject):

\begin{tabular}{|l|l|}
\hline Group & Description \\
\hline biophysics_* & Physics and biophysics \\
\hline carbon_* & Carbon balance \\
\hline fuel_* & Fuel properties \\
\hline fire_* & Fire behaviour and severity \\
\hline hydraulics_* & Plant hydraulics \\
\hline hydrology_* & Canopy and soil hydrology \\
\hline light_* & Light extinction and absortion \\
\hline moisture_* & Live tissue moisture \\
\hline pheno_* & Leaf phenology \\
\hline photo_* & Leaf photosynthesis \\
\hline root_* & Root distribution and conductance calculations \\
\hline soil_* & Soil hydraulics and thermodynamics \\
\hline transp_* & Stomatal regulation, transpiration and photosynthesis \\
\hline wind_* & Canopy turbulence \\
\hline
\end{tabular}

\subsection*{1.3.3 Static functions}

Package medfate includes a number of functions to examine static properties of plants conforming forest stands, summary functions at the stand level or vertical profiles of several physical properties:
- plant_*: Cohort-level information (species name, id, leaf area, height...).
- species_*: Cohort-level attributes aggregated by species (e.g. basal area).
- herb_*: Attributes of the herbaceous layer (e.g. fuel density or leaf area index).
- stand_*: Stand-level attributes (e.g. basal area).
- vprofile_*: Vertical profiles (light, wind, fuel density, leaf area density).

Vegetation functioning and dynamics have strong, but complex, effects on fire hazard. On one hand, growth and death of organs and individuals changes the amount of standing live and dead fuels, as well as downed dead fuels. On the other, day-to-day changes in soil and plant water content changes the physical properties of fuel, notably moisture content of live and dead fuels. Package medfate provides functions to estimate fuel properties and potential fire behaviour in forest stands. Specifically, fuel_FCCS() calculates fuel characteristics for a set of fuel strata; and a fire behaviour model is implemented in function fire_FCCS() to calculate the intensity of surface fire reaction and the rate of fire spread of surface fires assuming a steady-state fire. Fuel and fire behavior functions allow obtaining the following:
1. Fuel characteristics by stratum.
2. Surface fire behavior (i.e. reaction intensity, rate of spread, fireline intensity and flame length).
3. Crown fire behavior.
4. Fire potential ratings of surface fire behavior and crown fire behavior.

\subsection*{1.4 Main functions in medfateland}

Package medfateland allows simulating forest functioning and dynamics on sets forests stands distributed across space, with or without spatial processes (Fig. 1.3).

When spatial processes are omitted, the package offers a set of simulation functions that are analogous to those of package medfate but allow processing multiple forest stands sequentially or in parallel:
- Forest water and energy balance can be studied for a set of forest stands using functions spwb_spatial() or spwb_spatial_day().
- Growth and mortality of a set of plant cohorts competing for light and water can be simulated for a set of forest stands using functions growth_spatial() or growth_spatial_day().
- Forest dynamics arising from competition for light and water can be simulated for a set of forest stands using function fordyn_spatial().

The package offers a simulation function where the dynamics of forest stands are related by management decisions:
- Function fordyn_scenario() allows simulating fordyn() on forest stands, while applying a demandbased forest management scenario. Simulations with this function also include seed dispersal among forest stands.

Finally, there are three functions that are meant to simulate watersheds, including spatial processes:
- Functions spwb_land() and growth_land() include distributed hydrological models that allow simulating daily water balance or growth processes on the cells of a watershed while accounting for overland runoff, subsurface flow and groundwater flow between cells.
- Forest dynamics arising from competition for light and water can be simulated in a watershed using function fordyn_land(). Simulations with this function also include seed dispersal among grid cells.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-021.jpg?height=1584&width=1639&top_left_y=523&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 1.3: Overview of simulation functions in medfateland and the processes available for each of them. Colored squares below each simulation function indicate the processes included}
\end{figure}

\section*{Chapter 2}

\section*{Model inputs}

This chapter describes the inputs required by simulation models of medfate and medfateland packages. First, we describe the R structures required for the two packages. Then, we provide the details for four different kinds of inputs:
(1) Vegetation existing in the forest stand. This information should be available at a level of detail appropriate for the model design, which in our case includes not only species composition and/or structure, but also functional parameters of woody plants. Vegetation structure is considered static in spwb() calls, but becomes dynamic in calls to growth() or fordyn(). Hence, in these functions the input vegetation describes the starting point.
(2) Information on the physical structure of soil. Soil information is also required but, unlike vegetation, the soil physical structure is considered static.
(3) Climatic forcing. Daily weather series are always required, defining the temporal extent of the simulation and the temporal variation of environmental conditions in which physical and biological processes occur.
(4) Topographic information and geographic location. Topography and latitude are also required, because internal calculations of some physical variables require them.

The last section (2.6) describes additional input parameters that are used to specify global options of simulation functions.

Since preparing inputs for simulations can be daunting for most users, package medfateutils provides a set of utility functions aimed at facilitating the preparation of vegetation and soil inputs, whereas package meteoland provides functions to assess daily weather over landscapes.

\subsection*{2.1 Input structures}

\subsection*{2.1.1 Input structures in medfate}

Package medfate deals with simulations at stand level and, hence, the data structures defined in the package are meant to encapsulate information about a target forest stands and the properties of the soil where it grows:
- S3 class soil is a list that is initialized using soil physical properties, but the object includes also soil parameters and state variables. Soil objects are described in subsection 2.3.3.
- S3 class forest is a list of forest inventory data (i.e. mainly tree and shrub measurements, but can include herbaceous vegetation) corresponding to a single forest stand. Forest plot objects are described in subsection 2.4.4.
- S3 classes spwbInput and growthInput are lists containing all the vegetation parameters and state variables necessary to run water-balance simulations (function spwb() and alike) and forest growth simulations (function growth() and alike). Objects of classes spwbInput and growthInput are created using functions whose input includes a forest object and a soil object.

The figure below (Fig. 2.1) can be used to illustrate the workflow of soil/forest input creation for the main simulation functions in medfate. Note the different inputs in the case of fordyn().

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-024.jpg?height=478&width=1622&top_left_y=590&top_left_x=260}
\captionsetup{labelformat=empty}
\caption{Figure 2.1: Schematic workflow of input creation for simulation functions in medfate}
\end{figure}

\subsection*{2.1.2 Input structures in medfateland}

Spatial information for medfateland needs to be provided in sf objects (i.e. data frames with geometry, see package sf), whose actual columns required depend on the simulation function to be used, as described in the following table.

\begin{tabular}{|l|l|}
\hline Column & Use \\
\hline geom & Always required \\
\hline id & Required for *_spatial(), *_spatial_day() and fordyn_scenario() \\
\hline elevation & Always required \\
\hline slope & Always required \\
\hline land_cover_typend cover type: wildland, agriculture, rock, artificial or water & Required for *_land(), optional for *_spatial() and *_spatial_day() \\
\hline forest & Always required \\
\hline soil & Always required \\
\hline state & Optional to recover the final state of a previous simulation \\
\hline meteo & Optional \\
\hline crop_factor & Only required for agriculture land cover type \\
\hline management_arghmengsment arguments for each & Optional for fordyn_spatial() \\
\hline management_undanagement unit corresponding to each stand & Required for fordyn_scenario() \\
\hline represented_aAeæahæpresented by each stand, in hectares & Required for fordyn_scenario() \\
\hline
\end{tabular}

\begin{tabular}{|l|l|}
\hline Column & Use \\
\hline channel & Required for *_land() \\
\hline depth_to_bedrDakpth to bedrock (mm). & Required for *_land() \\
\hline bedrock_conduBteitvity (saturated) conductivity (in $\mathrm{m} \cdot$ day-1). & Required for *_land() \\
\hline bedrock_poros Bteylrock porosity ([0-1]). & Required for *_land() \\
\hline snowpack & Required for *_land() \\
\hline aquifer & Required for *_land() \\
\hline
\end{tabular}

\subsection*{2.2 Latitude and topography}

Topography has a relatively small direct influence in medfate simulations, because most topographic effects are assumed to be taken into account in the estimation of weather inputs. Nonetheless, elevation in meters is needed to estimate atmospheric pressure and air density (see 2.5), whereas aspect (in degrees from North) and slope (also in degrees) are needed in addition to latitude (also in degrees North) to estimate sunrise/sunset hours and potential radiation. Topographic variables should be readily accessible for users having access to a digital elevation model of the target area.

\subsection*{2.3 Soil description}

Soils are described in medfate using $S>1$ different soil layers ( $s \in\{1,2, \ldots, S\}$ ). Here the word soil refers to depths that plant rooting systems can reach (i.e., the critical zone), including cracks within the bedrock. The number and size of soil layers may correspond to changes in soil properties along depth, but also can be chosen to reflect differences in plant rooting depths. The physical properties of the soil are needed to estimate soil hydraulic properties and are considered static soil parameters in simulations. In contrast, soil moisture content, other variables that depend on moisture (e.g. soil water potential and soil conductivity) and soil temperature, if the soil energy balance is considered, are all soil state variables.

\subsection*{2.3.1 Soil physical properties}

Soil physical properties, such as texture (i.e. volume percent of sand, silt and clay), organic matter content, bulk density or rock fragment content, can differ between soil layers, and this has important consequences for soil water retention capacity and soil hydraulics. Specifying layers with an elevated rock fragment content (e.g. layers of weathered rock where soil particles are scarce) may be important in seasonally-arid climates like the Mediterranean, because plants often extend their roots into cracks existing in the parent rock to access water during summer (Ruffault et al. 2013).
For each soil layer $s$, the following physical parameters are needed:

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $d_{s}$ & mm & widths & Width of soil layer $s$ \\
\hline $P_{\text {clay }, s}$ & \% & clay & Percent volume of clay (within soil particles fraction) in layer $s$ \\
\hline $P_{\text {sand,s }}$ & \% & sand & Percent volume of sand (within soil particles fraction) in layer $s$ \\
\hline $O M_{s}$ & \% & om & Percentage of organic mater per dry weight (can be missing) in layer $s$ \\
\hline
\end{tabular}

\begin{tabular}{llll}
\hline Symbol & Units & R & Description \\
\hline$B D_{s}$ & $g \cdot \mathrm{~cm}^{-3}$ & bd & Bulk density in layer $s$ \\
$P_{\text {rocks }, s}$ & $\%$ & rfc & \begin{tabular}{l} 
Rock fragment content as percent volume (within whole soil) in \\
layer $s$
\end{tabular} \\
\hline
\end{tabular}

The percent volume of silt is $100 \%$ minus the percent volume of clay and sand. Whenever possible, soil physical properties should be measured in soil profiles conducted at the target forest plot (although soil profiles rarely reach rooting depths of deeply-rooted plants). Soil input data should be arranged in a data.frame with soil layers in rows and physical variables in columns (see function defaultSoilParams()). The following is an example with four soil layers:
```
soildf <- defaultSoilParams()
soildf

\begin{tabular}{lrrrrrr} 
\#\# & widths & clay & sand & om & bd & rfc \\
\#\# & 1 & 300 & 25 & 25 & NA & 1.5 \\
\#\# & 2 & 700 & 25 & 25 & NA & 1.5 \\
\#\# & 3 & 1000 & 25 & 25 & NA & 1.5 \\
\#\# & 4 & 2000 & 25 & 25 & NA & 1.5 \\
& & & 95
\end{tabular}
```


Package medfateutils includes a function soilgridsParams() to fetch soil information from SoilGrids.org, a global soil database currently providing soil data at 250 m scale. This can be helpful to users lacking local soil measurements, but the uncertainty of SoilGrids estimates can be high for some areas and soil properties, especially soil depth and rock fragment content.

The depth of a given soil layer $s\left(Z_{s}\right.$; in mm ) is defined as the sum of layer widths from the surface to the target layer:
\[
Z_{s}=\sum_{i=1}^{s} d_{s}
\]

And the overall soil depth ( $Z_{\text {soil }}$; in mm ) is the sum of widths across all soil layers. As the soil may include deep rocky layers, the value of $Z_{\text {soil }}$ may be larger than the soil depth reported in soil profiles.

\subsection*{2.3.2 Water retention curves}

The water retention curve of a soil is the relationship between volumetric soil moisture content ( $\theta$, in $m^{3} \cdot m^{-3}$ of soil, excluding rock fragments) and the corresponding soil water potential ( $\Psi$, in MPa), i.e. the amount of work that must be done per unit quantity of pure water in order to transport reversibly and isothermally an infinitesimal quantity of water from a reference pool. The shape of the water retention curve (also called the soil moisture characteristic curve) depends on physical properties (mainly texture and bulk density, but also organic matter content). Since soil layers usually differ in their physical properties they also normally have different water retention curves.

Two water retention curve models are available in medfate (fig. 2.2):
1. Saxton model: In this model, volumetric soil moisture $\theta(\Psi)$ corresponding to a given water potential $\Psi$ (in MPa ) below field capacity (i.e., $\Psi<\Psi_{f c}$ ) is calculated using:
\[
\theta(\Psi)=(\Psi / A)^{(1 / B)}
\]
where $A$ and $B$ depend on the texture and, if available, organic matter in the soil. If organic matter is available, $A$ and $B$ are calculated from $P_{\text {clay }}, P_{\text {sand }}$ and $O M$ following Saxton \& Rawls (2006). Otherwise, they are calculated from $P_{\text {clay }}$ and $P_{\text {sand }}$ as indicated in Saxton et al. (1986). Volumetric changes between field capacity and saturation (i.e., $\Psi_{f c} \leq \Psi<0$ ) are estimated using a linear function.
2. Van Genuchten model: The well known van Genuchten (1980) model is:
\[
\theta(\Psi)=\theta_{\text {res }}+\frac{\theta_{\text {sat }}-\theta_{\text {res }}}{\left[1+(\alpha \cdot \Psi)^{n}\right]^{1-1 / n}}
\]
where $\theta(\psi)$ is the water retention, $\theta_{\text {sat }}$ is the saturated water content, $\theta_{\text {res }}$ is the residual water content, $\alpha$ is related to the inverse of the air entry pressure, and $n$ is a measure of the pore-size distribution.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-027.jpg?height=860&width=990&top_left_y=599&top_left_x=566}
\captionsetup{labelformat=empty}
\caption{Figure 2.2: Water retention curves under the Saxton and Van Genuchten models, for the same physical attributes ( $25 \%$ sand, $25 \%$ clay, $50 \%$ silt and bulk density of $1.5 \mathrm{~g} \cdot \mathrm{~cm}^{-3}$ ). Parameters of the Van Genuchten curve have been estimated using pedotransfer functions given in Tóth et al. (2015).}
\end{figure}

Hydraulic conductivity governs the rate of water flow for a unit gradient in potential. It decreases sharply as soil becomes dry, and the relationship also depends on soil texture. The Saxton and Van Genuchten models also describe and parameterize the relationship between conductivity and soil water potential.

\subsection*{2.3.3 Soil initialization}

Soil initialization is needed to estimate hydrological parameters for each soil layer $s$ from its physical attributes. Soil initialization is done using function soil(), which returns an object of a S3 class with the same name (see 2.1.1). Simulation functions in medfate need an object of class soil to be run.

Function soil() adds the following information to the physical soil description:

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $P_{\text {macro }}$ & \% & macro Percentage of macroporosity corresponding to each soil layers \\
\hline $\gamma_{\text {soil }}$ & $m m \cdot d a y^{-1}$ & Gsoil The maximum daily evaporation rate from soil (see 5.4) \\
\hline $\theta_{\text {sat }}$ & $m^{3} \cdot m^{-3}$ & VG_thetaVolatmetric soil moisture at saturation for each soil layer \\
\hline $\theta_{\text {res }}$ & $m^{3} \cdot m^{-3}$ & VG_thetalreislual volumetric soil moisture for each soil layer \\
\hline $n$ & & VG_n Parameter $n$ of the Van Genuchten (1980) model for each soil layer \\
\hline $\alpha$ & $M P a^{-1}$ & VG_alphaParameter $\alpha$ of the Van Genuchten (1980) model for each soil layer \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $K_{\text {sat }}$ & mmol . $s^{-1} \cdot m^{-2}$. $M P a^{-1}$ & Ksat & Saturated soil conductivity for each soil layer \\
\hline
\end{tabular}

Macroporosity values are calculated using the equations given in Stolf et al. (2011), while $\gamma_{\text {soil }}$ is derived from texture. Parameters of the van Genuchten model for each layer are estimated from the physical description of the layer using one of two pedotransfer functions (see help for soil()):
1. Using the USDA texture classification and the average texture class parameters given by Carsel \& Parrish (1988).
2. Directly from the soil texture, organic matter and bulk density, using the pedotransfer functions in Tóth et al. (2015).

Parameter $\alpha$ of the Van Genuchten model is given in $M P a^{-1}$, but it can be transformed to $\mathrm{cm}^{-1}$ using the relationship:
\[
1 \mathrm{~cm}=0.00009804139432 \mathrm{MPa},
\]
which can also be applied to water potential units. Soil layer saturated conductivity ( $K_{\text {sat }}$ ) is estimated using Saxton \& Rawls (2006) or Saxton et al. (1986), depending on whether an estimate of organic mater is available. $K_{\text {sat }}$ is given in physiological units $\mathrm{mmol} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2} \cdot M \mathrm{~Pa}^{-1}$, but they can be transformed into $\mathrm{cm} \cdot d a y^{-1}$ using:
\[
1 \mathrm{~cm} \cdot d a y^{-1}=655.2934 \mathrm{mmol} \cdot \mathrm{~s}^{-1} \cdot \mathrm{~m}^{-2} \cdot M \mathrm{~Pa}^{-1}
\]

Besides defining soil parameters, function soil() also initializes soil state variables: soil moisture content, soil temperature (although set to a missing value) and water table depth. Users can edit the soil object manually (it is actually a list), for example to provide specific parameters of the Van Genuchten retention curve calibrated from soil measurements.

Saturated conductivity ( $K_{\text {sat }}$ ) is corrected for bulk density ( $B D$ ) of the soil layer, because compact soils have lower conductivity (Rahimi et al. 2011):
\[
K_{\text {sat }}=K_{\text {sat,ref }} \cdot\left(\frac{\rho_{s}-B D}{\rho_{s}-B D_{\text {ref }}}\right)^{3}
\]
where $K_{\text {sat,ref }}$ is the reference conductivity according to soil texture, $\rho_{s}=2.73 \mathrm{~g} \cdot \mathrm{~cm}^{-3}$ is density of soil particles, $B D_{\text {ref }}=1.2 \mathrm{~g} \cdot \mathrm{~cm}^{-3}$ is the reference bulk density.

\subsection*{2.3.4 Water content and depth to saturation}

The volume of water ( $V_{s}$ in $m m=l \cdot m^{-2}$ of ground area) in a soil layer $s$ is calculated from its water potential ( $\Psi_{s}$ ) and water retention curve using:
\[
V_{s}\left(\Psi_{s}\right)=d_{s} \cdot\left(\left(100-P_{\text {rocks }, s}\right) / 100\right) \cdot \theta_{s}\left(\Psi_{s}\right)
\]
where $d_{s}$ is the depth of the soil layer (in mm ) and $P_{\text {rocks }, s}$ is the percentage of rock fragments. The overall volume of water in the soil (accessible by roots) is simply the sum of water content over soil layers:
\[
V_{\text {soil }}=\sum_{s=1}^{S} V_{s}\left(\Psi_{s}\right)
\]

A number of fixed water volumes (and their corresponding moisture) are important to remember:
- Water holding capacity ( $V_{f c, s}$, in mm ) of the soil layer $s$ is defined as the volume of water at field capacity, i.e. at $\Psi_{f c}=-0.033 \mathrm{MPa}$, the amount of water held in the soil after gravitational water has drained away:
\[
V_{f c, s}=V_{s}(-0.033)=d_{s} \cdot\left(\left(100-P_{\text {rocks }, s}\right) / 100\right) \cdot \theta_{f c, s}
\]
where $\theta_{f c, s}=\theta_{s}(-0.033)$ is the corresponding moisture at field capacity.
- Water content at saturation ( $V_{\text {sat }, s}$, in mm ) is calculated anagolously, but replacing $\theta_{f c, s}$ by $\theta_{\text {sat,s }}=$ $\theta_{s}(0)$, the moisture at saturation, the amount of soil moisture when all easily drained spaces between soil particles (i.e. macropores) are also filled with water.
- Water content at wilting point ( $V_{w p, s}$, in mm ) is calculated replacing $\theta_{f c, s}$ by $\theta_{w p, s}=\theta_{s}(-1.5)$, the moisture at wilting point, i.e. at $\Psi_{f c}=-1.5 \mathrm{MPa}$, a conventional amount of soil moisture beyond which plants are assumed have problems extracting water and start to wilt. However, plants can often extract water from much drier soils.
- The amount of extractable water (in mm ) is the difference between water content at field capacity and the water content at a conventional minimum water potential, which can be set at wilting point or lower values (by default at -5 MPa in medfate).

The saturated water depth ( $Z_{\text {sat }}$, in mm ) is not defined (i.e. missing) when all soil layers are below field capacity. When some layers are between field capacity and saturation, depth of the saturated water is calculated as:
\[
Z_{s a t}=\sum_{s} d_{s} \cdot \min \left[1,\left(\theta_{s a t, s}-\theta\left(\Psi_{s}\right)\right) /\left(\theta_{s a t, s}-\theta_{f c, s}\right)\right]
\]

\subsection*{2.4 Vegetation description}

The representation of vegetation within a target forest stand is done in medfate primarily by means of cohorts of woody plants (i.e. trees and shrubs). A woody plant cohort represents a set of woody plants that belong to the same species (or functional group) and are more or less of the same size. For example, trees in a stand may be grouped by species and diameter class, whereas shrubs may be grouped by species and height. In practice however, plant cohorts are entities that are treated separately when modeling the forest stand. This representation in plant cohorts was chosen so that package functions can be easily applied to forest inventory data, for example from national forest surveys. The description of woody plant cohorts includes a measure of abundance of the cohort in the stand, which in the case of trees is density as stems per hectare and for shrubs is percent cover (shrubs are often multi-stemmed). The difference in measurement units for abundance is the main motivation for distinguishing between tree cohorts and shrub cohorts, rather than their size or growth form. Additionally, the description of vegetation in the forest stand may include the cover and mean height of a herbaceous layer. The presence or abundance of herbs is not always recorded in forest inventory surveys, but may be relevant vegetation component in open habitats like shrublands.

Note that one limitation of the representation of vegetation in medfate is that it is not spatially-explicit (i.e. plants cannot have explicit coordinates within forest stands) and hence spatial (horizontal) interactions between plant cannot be taken into account explicitly (but see 2.4.8).

\subsection*{2.4.1 Structural attributes of woody plant cohorts}

A woody plant cohort $i$ is either a tree cohort or a shrub cohort, and is defined using a set of structural attributes shown in the following table, where columns spwb, growth and fordyn indicate whether attributes are required by simulation functions $\operatorname{spwb}() / \mathrm{pwb}()$, growth() and fordyn(), respectively:

\begin{tabular}{llllll}
\hline Symbol & Units & $\mathrm{R} \quad$ Description & spwb & growth & fordyn \\
\hline$S P_{i}$ & \multirow{3}{*}{ SpeciesSpecies identity } & Y & Y & Y \\
$H_{i}$ & $c m$ & Height Average tree or shrub height & Y & Y & Y
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|l|}
\hline Symbol & Units & R & Description & spwb & growth & fordyn \\
\hline $C R_{i}$ & & CR & Crown ratio (i.e. ratio between crown length and plant height) & Y & Y & N \\
\hline $N_{i}$ & $i n d \mathrm{u} h a^{-1}$ & N & Density of tree individuals & N & Y & Y \\
\hline $D B H_{i}$ & cm & DBH & Tree diameter at breast height & N & Y & Y \\
\hline Cover $_{i}$ & \% & Cover & Shrub percent cover & N & Y & Y \\
\hline LAI ${ }_{i}^{\text {live }}$ & $m^{2} \cdot m^{-2}$ & \multicolumn{2}{|l|}{LAI_liv(@laximum) leaf area index} & Y & Y & N \\
\hline $L A I_{i}^{\text {dead }}$ & $m^{2} \cdot m^{-2}$ & \multicolumn{2}{|l|}{LAI_dealdead leaf area index} & Y & Y & N \\
\hline $L A I_{i}^{\phi}$ & $m^{2} \cdot m^{-2}$ & \multicolumn{2}{|l|}{LAI_expandeedt expanded leaf area index} & Y & Y & N \\
\hline $Z_{50, i}$ & mm & Z50 & Depth above which $50 \%$ of the fine root mass is located & Y & Y & Y \\
\hline $Z_{95, i}$ & mm & Z95 & Depth above which $95 \%$ of the fine root mass is located & Y & Y & Y \\
\hline
\end{tabular}

Height ( $H$ ) values refer to average height of individuals included in the cohort, and the same for crown ratio $(C R)$ and diameter at breast height $(D B H)$. While plant size (i.e. height or diameter) is relatively easy to tally, other measurements are not usually made in the field. Package medfate includes utility functions that provide estimates $C R$ and $L A I$ from forest inventory data (e.g. heights, DBH and density for measured trees), using allometric relationships calibrated for Catalonia, Spain (see chapter 21).

\section*{Leaf area index}

LAI variables refer to one-sided leaf area of plants per surface area of the stand. Leaves standing on branches of woody plants can be alive or dead. We will call total leaf area index of a woody plant cohort $i$ ( $L A I_{i}^{\text {all }}$ ) to the sum of its dead and live (and unfolded) leaf area:
\[
L A I_{i}^{a l l}=L A I_{i}^{\phi}+L A I_{i}^{d e a d}
\]

For simulations not involving growth, winter-deciduous phenology is a prognosed variable, and the current level of leaves unfolded may be lower than the maximum (live) amount of leaves. In simulations involving growth, both $L A I^{\phi}$ and $L A I^{\text {live }}$ can change, the former due to leaf phenology (unfolding is simulated explicitly and has carbon costs) and the latter due to leaf allocation limits during plant development.

\subsection*{2.4.2 Structural attributes of herbaceous vegetation}

The herbaceous layer of the stand is described collectively, without distinguishing among plant cohorts. Two attributes, cover and height, are required:

\begin{tabular}{lll}
\hline Symbol & Units & $\mathrm{R} \quad$ Description \\
\hline$H_{\text {herb }}$ & $c m$ & herbHeightverage height of herbaceous vegetation \\
Cover herb & $\%$ & herbCovelPercent cover of herbaceous vegetation \\
LAI $_{\text {herb }}$ & $m^{2} \cdot m^{-2}$ & LAI_herb Leaf area index of herbaceous vegetation \\
\hline
\end{tabular}

Leaf area index of herbaceous layer ( $L A I_{\text {herb }}$ ), is normally estimated from $H_{\text {herb }}$ and Cover $_{\text {herb }}$, but could be directly prescribed by the user. Rooting depth parameters are not needed for herbaceous vegetation, which is assumed to extract water from the topmost soil layer. Note that neither phenology or growth/senescence processes are modelled in the case of herbaceous vegetation.

\subsection*{2.4.3 Leaf area index of the forest stand}

If there are $c$ woody plant cohorts, the leaf area index corresponding to living leaves, unfolded leaves and dead leaves can be aggregated across cohorts using:
\[
\begin{aligned}
L A I_{\text {woody }}^{\text {live }} & =\sum_{i=1}^{c} L A I_{i}^{\text {live }} \\
L A I_{\text {woody }}^{\phi} & =\sum_{i=1}^{c} L A I_{i}^{\phi} \\
L A I_{\text {woody }}^{\text {dead }} & =\sum_{i=1}^{c} L A I_{i}^{\text {dead }}
\end{aligned}
\]

We can also estimate the overall leaf area index of woody plant cohorts ( $L A I_{\text {woody }}^{\text {all }}$ ):
\[
L A I_{\text {woody }}^{\text {all }}=\sum_{i=1}^{c} L A I_{i}^{\text {woody }}=L A I_{\text {woody }}^{\phi}+L A I_{\text {woody }}^{\text {dead }}
\]

Finally, we can also estimate the overall leaf area index of the whole stand ( $L A I_{\text {stand }}^{\text {all }}$ ), which also takes into account the herbaceous layer ( $L A I_{\text {herb }}$ ):
\[
L A I_{\text {stand }}^{\text {all }}=L A I_{\text {woody }}^{\text {all }}+L A I_{\text {herb }}=L A I_{\text {woody }}^{\phi}+L A I_{\text {woody }}^{\text {dead }}+L A I_{\text {herb }}
\]

\subsection*{2.4.4 Forest plot objects}

While the previous section described the structural forest variables required to run simulations in medfate, forest plot data input in the package is easier if one uses a format that follows closely forest inventory plot descriptions. In this format, each forest plot is represented in an object of class forest, a list that contains several elements. Here we use an example forest stand provided with the package:
```
data(exampleforest)
exampleforest
## $treeData
## Species N DBH Height Z50 Z95
## 1 Pinus halepensis 168 37.55 800 100 600
## 2 Quercus ilex 384 14.60 660 300 1000
##
## $shrubData
## Species Cover Height Z50 Z95
## 1 Quercus coccifera 3.75 80 200 1000
##
## $herbCover
## [1] 10
##
## $herbHeight
## [1] 20
```

```
##
## $seedBank
## [1] Species Percent
## <0 rows> (or 0-length row.names)
##
## attr(,"class")
## [1] "forest" "list"
```


The most important items of forest are the two data frames describing woody vegetation, treeData (for trees) and shrubData for shrubs, but the herbaceous layer can also be described using herbCover and herbHeight. With the aim to help users in the task of constructing forest objects, package medfateutils includes functions to map user data in into tables treeData and shrubData.
forest objects are a convenient format to start calculations with medfate, because there are many static functions that take forest objects as input. For example, a summary.forest() function provides the basal area, density, cover and leaf area index of the forest stand, and its different components:
```
summary(exampleforest, SpParamsMED)
## Tree BA (m2/ha): 25.0333016 adult trees: 25.0333016 saplings: 0
## Density (ind/ha) adult trees: 552 saplings: 0 shrubs (estimated): 749.4923076
## Cover (%) adult trees: 100 saplings: 0 shrubs: 3.75 herbs: 10
## LAI (m2/m2) total: 1.7585845 adult trees: 1.5543216 saplings: 0 shrubs: 0.030626 herbs: 0.173636
## Fuel loading (kg/m2) total: 0.5588728 adult trees: 0.5255004 saplings: 0 shrubs: 0.0140795 herbs
## PAR ground (%): NA SWR ground (%): NA
```


\subsection*{2.4.5 Single-cohort forests}

Although medfate has been designed to perform simulations on multi-cohort forests, it can also handle simulations where vegetation is described using a single cohort. Functions tree2forest() and shrub2forest() allow defining single-cohort forests from attributes. For example a holm oak (Quercus ilex) forest of $4-\mathrm{m}$ height and having a leaf area index of $2 m^{2} \cdot m^{-2}$ can be defined using:
```
oak_forest <-tree2forest("Quercus ilex", Height= 400, LAI = 2)
```


The function will return a forest object where most attributes are empty:
```
oak_forest
## $treeData
## Species DBH Height N Z50 Z95 LAI
## 1 Quercus ilex NA 400 NA NA NA 2
##
## $shrubData
## [1] Species Height Cover Z50 Z95
## <0 rows> (or 0-length row.names)
##
## $herbCover
## [1] NA
##
## $herbHeight
## [1] NA
```

```
##
## $seedBank
## [1] Species Percent
## <0 rows> (or 0-length row.names)
##
## attr(,"class")
## [1] "forest" "list"
```


Nevertheless, the object is well defined, for example we can summarize it using:
```
summary(oak_forest, SpParamsMED)
## Tree BA (m2/ha): 0 adult trees: 0 saplings: 0
## Density (ind/ha) adult trees: 0 saplings: 0 shrubs (estimated): 0
## Cover (%) adult trees: 0 saplings: 0 shrubs: 0 herbs: 0
## LAI (m2/m2) total: 2 adult trees: 0 saplings: 0 shrubs: 0 herbs: 0
## Fuel loading (kg/m2) total: 0.5698237 adult trees: 0 saplings: 0 shrubs: 0 herbs: 0
## PAR ground (%): NA SWR ground (%): NA
```


Since density and diameter have not been provided, simulations in this case will be restricted to function $\operatorname{spwb}() / \mathrm{pwb}()$. Moreover, note that when defining single-cohort forests all possible interactions with functionally distinct plants are neglected.

\subsection*{2.4.6 Vertical leaf distribution}

The vegetation input structures allow the package to determine the vertical distribution of leaves in the stand. The leaf area of any woody plant cohort is assumed to be distributed vertically following a truncated Gaussian function whose standardized values -1.5 and 1.5 correspond to crown base height ( $H_{\text {crown }, i}$; in cm) and total plant height ( $H_{i}$ ), respectively. Crown base height is defined as the height corresponding to the first living branch. It is calculated from the crown ratio of the cohort ( $C R_{i}$; a proportion between 0 and 1 ), which in turn can be estimated as explained in (21.11).

Simulation models in medfate divide the vertical dimension into vertical layers (by default are 100 cm width, but see control parameter verticalLayerSize). Let us define $L A I_{i, j}^{a l l}=L A I_{i, j}^{\phi}+L A I_{i, j}^{d e a d}$ as the leaf area index of cohort $i$ in layer $j$ including both functional leaves and dead leaves standing on branches. The truncated Gaussian distribution defines the $L A I_{i, j}^{\phi}$ and $L A I_{i, j}^{\text {dead }}$ for all plant cohorts and vertical layers.

Dividing the leaf area of a given layer by its width, one obtains the leaf area density ( $L A D$ in $m^{2} \cdot m^{-3}$ ). Figure 2.3 illustrates the leaf area density profile (see function vprofile_leafAreaDensity()) corresponding to the forest stand described in the example forest object that we showed above.

The leaf area density profile determines the light extinction rates through the forest canopy. The same truncated Gaussian distribution is used to distribute leaf and small branch biomass along the vertical dimension.

When present, we can include herbaceous vegetation (i.e. $L A I_{\text {herb }}$ ) in the leaf area density profile. Its vertical distribution is also assumed to follow a truncated Gaussian function:

\subsection*{2.4.7 Vertical root distribution}

Roots can be distinguished functionally into two different organs: coarse roots are responsible for mechanical support and transport of water and nutrients towards the stem, whereas fine roots are responsible for absorbing water and nutrients.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-034.jpg?height=817&width=1641&top_left_y=327&top_left_x=241}
\captionsetup{labelformat=empty}
\caption{Figure 2.3: Leaf area density distribution of woody vegetation in a forest stand. The left panel shows the distribution for each plant cohort separately, whereas the right panel shows the overall density distribution.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-034.jpg?height=806&width=1643&top_left_y=1455&top_left_x=241}
\captionsetup{labelformat=empty}
\caption{Figure 2.4: Leaf area density distribution in a forest stand, including the herbaceous layer. The left panel shows the distribution for each plant cohort separately, whereas the right panel shows the overall density distribution.}
\end{figure}

Analogously to the aboveground vegetation parameters, inputs describing depths corresponding to $50 \%$ and $95 \%$ of fine roots ( $Z_{50, i}$ and $Z_{95, i}$ ) are used to completely specify the distribution of roots across soil layers. The root system of each plant cohort $i$ is described using $F R P_{i, s}$, the proportion of fine roots (with respect to the whole plant) in each soil layer $s . F R P_{i, s}$ values are normally defined using the linear dose response model (Schenk \& Jackson 2002; Collins \& Bras 2007):
\[
\begin{aligned}
F R P_{i, s} & =Y_{i}\left(Z_{s}\right)-Y_{i}\left(Z_{s-1}\right) \\
Y_{i}(z) & =\frac{1}{1+\left(z / Z_{50, i}\right)^{c_{i}}}
\end{aligned}
\]
where $Y_{i}(z)$ is the cumulative fraction of fine root mass located between surface and depth $z ; Z_{50, i}$ is the depth (in mm) above which $50 \%$ of the root mass is located; and $c_{i}$ is a shape parameter related to $Z_{50, i}$ and $Z_{95, i}$ as $c_{i}=2.94 / \ln \left(Z_{50, i} / Z_{95, i}\right)$.

The linear dose response model is quite flexible with respect to fine root distribution (see function root_ldrDistribution()). The following figure shows the fine root distribution profile of the same cohorts as in fig. 2.3 (see vprofile_rootDistribution()):

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-035.jpg?height=971&width=1207&top_left_y=967&top_left_x=458}
\captionsetup{labelformat=empty}
\caption{Figure 2.5: Examples of root density profile according to the linear dose response model.}
\end{figure}

The actual input to simulation functions $\operatorname{spwb}()$, growth() and alike, describes fine root distribution using the matrix of $F R P_{i, s}$ values - not $Z_{50, i}$ and $Z_{95, i}$-, which means that the proportions of fine roots can be modified manually or be defined by another model. In fact, medfate also allows calculating $F R P_{i, s}$ values assuming a conic distribution of fine roots (see root_conicDistribution()).

\subsection*{2.4.8 Water pools and root horizontal distribution}

By default, models in medfate assume that soil moisture under all plant cohorts is the same (i.e. water sources corresponding to vertical soil layers are shared among cohorts). Therefore, it neglects spatial variation in soil moisture, against moisture variation patterns observed in mixed stands (Schume et al. 2004). However,
variations in soil moisture beneath plant cohorts (and, implicitly, horizontal variation of soil moisture) can also be simulated if required by the user (see parameter rhizosphereOverlap in 2.6). This involves considering that a given plant cohort will perform water uptake from the water pool surrounding its roots, whereas it may not have access to the water beneath other plants. However, there can exist some degree of horizontal overlap between water pools exploited by different plants.

Considering water pools involves partitioning the stand area into fractions corresponding to the abundance of each plant cohort. More specifically, the model defines as many water pools as plant cohorts, with proportions defined by their LAI values:
\[
f_{\text {pool }, i}=\frac{L A I_{i}^{\text {live }}}{L A I_{\text {stand }}^{\text {live }}}
\]

Models assume that the rhizosphere of each plant cohort occupies its own water pool but may extend into the water pools under other plant cohorts. In other words, the root systems of different cohorts may overlap horizontally. Moreover, the horizontal overlap of root systems will vary across soil layers. A given plant cohort $i$ will have its roots in layer $s$ partitioned among different water pools. We thus need to define $f r_{i, s, j}$, the (horizontal) proportion of fine roots of cohort $i$ in layer $s$ of the water pool $j$, with the restriction that:
\[
\sum_{j} f r_{i, s, j}=1 \forall i, s
\]

A simplifying assumption is to force a complete independence of water pools, which is equal to say that $f r_{i, s, j}=1$ for $i=j$ and $f r_{i, s, j}=0$ when $i \neq j$ (this is the simplification adopted when using rhizosphereOverlap $=$ "none"). In the general case of partial overlap (rhizosphereOverlap $=$ "partial"), it is important to realize that proper estimation of $f r_{i, s, j}$ is challenging when we do not have explicit plant coordinates, root lateral widths, etc. At this point, let us assume we have a reasonable estimate of $V o l_{i}$, the soil volume explored by coarse roots of an individual of cohort $i$. Assuming that the proportion of fine roots in each layer is proportional to the proportion of total soil volume explored by coarse roots that corresponds to the same layer we have that $V o l_{i, s}$, the soil volume explored by coarse roots in layer $s$ is:
\[
\operatorname{Vol}_{i, s}=F R P_{i, s} \cdot \operatorname{Vol}_{i}
\]

In medfate, coarse roots are represented by axial and radial components. The length of axial component of a given layer ( $L_{\text {axial }, i, s}$ ) is simply equivalent to its bottom depth, whereas the radial component ( $L_{\text {radial }, i, s}$ ) is unknown. However, we can assume that the soil volume explored by coarse roots corresponds to a cylinder:
\[
\operatorname{Vol}_{i, s}=\pi \cdot L_{\text {radial }, i, s}^{2} \cdot L_{\text {axial }, i, s}
\]
and substituting the soil volume $V o l_{i, s}$ in the equation above we can isolate $L_{\text {radial, } i, s}$ (see function root_coarseRootLengthsFromVolume()). Once we have the radial component we can estimate the area $\left(m^{2}\right)$ covered by coarse roots of an individual of the cohort in a given layer $s$ :
\[
\text { Area }_{i, s}=\pi \cdot L_{\text {radial }, i, s}^{2}
\]

We can then compare $A r e a_{i, s}$ to the area of the water pool for an individual of cohort $i$, which in $m^{2}$ is:
\[
\text { AreaPool }_{i}=10000 \cdot f_{\text {pool }, i} / N_{i}
\]

If Area $_{i, s} \leq$ AreaPool $_{i}$, then the roots of the individual do not exceed the area of the pool, in other words $f r_{i, s, i}=1$ and $f r_{i, s, j}=0$ for all $j \neq i$. If Area $_{i, s}>$ AreaPool $_{i}$ then the excess should be counted as overlap with the other pools. Assuming that plants are randomly distributed (i.e. no clumping) the probability of finding the pool of a cohort is equal to the proportion of its water pool (see function root_horizontalProportions()). All these calculations were done assuming Vol $_{i}$ were known. Estimation of $V o l_{i}$ depends on the complexity of the water balance model and is explained in A.4.6.

\subsection*{2.4.9 Functional traits and vegetation initialization}

Besides the physical representation of vegetation, forest ecosystem models require information regarding plant functional traits, because this influences the outcome of physical, physiological and hydrological processes. In the following chapters, we will indicate for each simulated process its required plant functional parameters. A description of all parameters is provided in data frame SpParamsDefinition included in the package.

Normally, functional traits are described at the species level because infra-specific parameters are hard to get. Even at the species level, many functional (e.g. physiological) traits are hard to obtain, so in medfate we provide a default species parameter table for woody species found in Spain, with many of them occurring elsewhere in the Mediterranean Basin (SpParamsMED). User can modify this data frame to account for intraspecific trait variation (see function modifySpParams()).

The package provides functions forest2spwbInput() and forest2growthInput() that prepare the forest vegetation input for simulation functions spwb() and growth(), respectively (see 2.1.1). This initialization mostly consists in compiling the necessary functional traits from the species parameter table, following the $S P_{i}$ attribute of woody plant cohorts. Some new model parameters are estimated from the initial ones, while taking into account the structural attributes of cohorts (an example of these derived quantities is stem conductance, which estimated from stem xylem conductivity, Huber value and plant height). Users can take the output of these initialization functions and replace parameter values for specific plant cohorts (see function modifyCohortParams()).

\subsection*{2.4.10 Update of structural variables during simulations}

Vegetation characteristics stay constant during simulations using functions spwb() or pwb(), although the actual (unfolded) leaf area and dead leaf area may vary depending on leaf phenology.

In contrast, growth simulation requires updating the structure of vegetation, i.e. plant heights, tree diameters, tree density and shrub cover. Function growth() can modify any of the vegetation attributes. Finally, function fordyn() modifies not only structural variables of the initial cohorts but also involves the removal of dead (or cut) woody cohorts and recruitment of new woody cohorts during simulations.

\subsection*{2.5 Metereological input}

Weather input data must include variables calculated at the daily scale. Weather data should be arranged in a data frame with days in rows and variables in columns.

Since it allows producing data frames with appropriate variable units and row/column names, we recommend meteorological input to be generated using package meteoland (De Cáceres et al. 2018), but other sources are possible.

\subsection*{2.5.1 Date format}

Dates are needed in medfate to estimate parameters like solar declination or the day of the year (DOY). Dates can be specified in the input data frame either:
- As data frame row names (in string format year-month-day)
- As Date elements in a column called "dates".

\subsection*{2.5.2 Required weather variables}

Some weather variables must be present always in the input data frame, whereas others are optional, meaning that the package can estimate them if missing. The following table indicates the symbols, units, definitions and the variable name in $R$ of input weather variables that are always required:

\begin{tabular}{|l|l|l|l|l|}
\hline Symbol & Units & R param & Description & Optional \\
\hline $T_{\text {min }}$ & ${ }^{\circ} \mathrm{C}$ & & MinTemperaturdinimum temperature & No \\
\hline $T_{\text {max }}$ & ${ }^{\circ} \mathrm{C}$ & & MaxTemperaturdaximum temperature & No \\
\hline $R H_{\text {min }}$ & \% & & MinRelativeHuklídiinym relative humidity & No \\
\hline $R H_{\text {max }}$ & \% & & MaxRelativeHuklidiumyam relative humidity & No \\
\hline $P$ & $L \cdot m^{-2}=$ mm & & PrecipitationPrecipitation (either rainfall or snow). & No \\
\hline Rad & $M J \cdot m^{-2}$ & Radiation & Solar radiation after accounting for clouds & No \\
\hline
\end{tabular}

\subsection*{2.5.3 Optional weather variables}

The following table lists the same attributes for input weather variables that are optional:

\begin{tabular}{|l|l|l|l|l|}
\hline Symbol & Units & R param & Description & Optional \\
\hline $u$ & $m \cdot s^{-1}$ & WindSpeed & Wind speed & Yes \\
\hline $R_{\text {int }}$ & $m m \cdot h^{-1}$ & & RainfallIntenkainyfall intensity & Yes \\
\hline $C_{\text {atm }}$ & ppm & CO2 & Atmospheric (above-canopy) $C O_{2}$ concentration & Yes \\
\hline $P_{\text {atm }}$ & kPa & Patm & Surface atmospheric pressure & Yes \\
\hline $P_{\text {fire }}$ & [0-1] & & FireProbabilityobability of wildfire occurrence & Yes \\
\hline
\end{tabular}

Missing wind speed ( $u$ ) and $C O_{2}$ values will be replaced by defaults defined in control parameters. As an alternative to providing daily atmospheric $C O_{2}$ concentration values, simulation functions allow the user to provide $C O_{2}$ concentration values in annual time steps using a separate vector.

When missing, atmospheric pressure ( $P_{\text {atm }}$ ) is also derived from elevation using an utility function available in meteoland.

Missing rainfall intensity ( $R_{i n t}$ ) values will be estimated from the current month using function hydrology_rainfallIntensity() and the seasonality of rainfall intensity given in control parameters (see defaultRainfallIntensityPerMonth in 3.5.3).

\subsection*{2.5.4 Derived weather variables}

While the weather variables listed in the tables above are provided as inputs, medfate derives other atmospheric variables from them, using also topographic information (see utility functions of the meteoland reference manual):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $\rho_{\text {air }}$ & $\mathrm{kg} \cdot \mathrm{m}^{-3}$ & & Air density \\
\hline $e_{\text {atm }}$ & $k P a$ & & Atmospheric water vapor pressure \\
\hline $T_{\text {mean }}$ & ${ }^{\circ} \mathrm{C}$ & \multicolumn{2}{|l|}{MeanTemperatureMean daily temperature} \\
\hline PET & $L \cdot m^{-2}=$ mm & PET & Potential evapotranspiration, calculated using Penman's (1948) equation \\
\hline
\end{tabular}

\subsection*{2.6 Simulation control}

Simulation control parameters are a list of global parameter values, initialized using function defaultControl(), that the user can modify to change the general behavior of simulation functions. Here is the set of global control parameters currently accepted in medfate:
names(defaultControl())
```
## [1] "fillMissingRootParams" "fillMissingSpParams" "fillMissingWithGenusPar
## [4] "verbose" "subdailyResults" "standResults"
## [7] "soilResults" "plantResults" "leafResults"
## [10] "temperatureResults" "fireHazardResults" "fireHazardStandardWind"
## [13] "fireHazardStandardDFMC" "transpirationMode" "soilFunctions"
## [16] "ndailysteps" "max_nsubsteps_soil" "defaultWindSpeed"
## [19] "defaultCO2" "defaultRainfallIntensityPerMonth" "snowpack"
## [22] "leafPhenology" "bareSoilEvaporation" "unlimitedSoilWater"
## [25] "interceptionMode" "infiltrationMode" "soilDomains"
## [28] "rhizosphereOverlap" "unfoldingDD" "verticalLayerSize"
## [31] "windMeasurementHeight" "segmentedXylemVulnerability" "stemCavitationRecovery"
## [34] "leafCavitationRecovery" "hydraulicRedistributionFraction" "nsubsteps_canopy"
## [37] "taper" "multiLayerBalance" "sapFluidityVariation"
## [40] "TPhase_gmin" "Q10_1_gmin" "Q10_2_gmin"
## [43] "rootRadialConductance" "averageFracRhizosphereResistance" "thermalCapacityLAI"
## [46] "boundaryLayerSize" "cavitationRecoveryMaximumRate" "sunlitShade"
## [49] "numericParams" "leafCavitationEffects" "stemCavitationEffects"
## [52] "stomatalSubmodel" "plantCapacitance" "cavitationFlux"
## [55] "soilDisconnection" "leafCuticularTranspiration" "stemCuticularTranspirat
## [58] "C_SApoInit" "C_LApoInit" "k_SSym"
## [61] "fractionLeafSymplasm" "gs_NightFrac" "JarvisPAR"
## [64] "fTRBToLeaf" "gCrown0" "subdailyCarbonBalance"
## [67] "allowDessication" "allowStarvation" "sinkLimitation"
## [70] "shrubDynamics" "herbDynamics" "allocationStrategy"
## [73] "phloemConductanceFactor" "nonSugarConcentration" "equilibriumOsmoticConce
## [76] "minimumRelativeStarchForGrowth" "constructionCosts" "senescenceRates"
## [79] "maximumRelativeGrowthRates" "mortalityMode" "mortalityBaselineRate"
## [82] "mortalityRelativeSugarThreshold" "mortalityRWCThreshold" "recrTreeDBH"
## [85] "recrTreeDensity"
## [88] "allowSeedBankDynamics"
## [91] "recruitmentMode"
## [94] "minimumShrubCohortCover"
## [97] "seedProductionTreeHeight"
## [100] "minTempRecr"
## [103] "recrTreeHeight"
## [106] "recrTreeZ50"
```

\#\# [109] "recrShrubZ95"

Control parameters are employed when initializing vegetation inputs and state variables using functions forest2spwbInput() and forest2growthInput(), since they are needed also to make decisions at the point of initialization. Control parameters are also stored in the result of these functions, so the user does not need to specify again control parameters when calling simulation functions such as spwb() or growth(). Function fordyn() is different than the other simulation functions, because the list control parameters is directly passed to the function (see 2.1.1).

Even if the list of control parameters is long, not all control parameters are relevant to all simulation functions (this will be indicated in the following chapters), and most of them should not be altered from their default values. However, there are a set of parameters that are worth learning:
- verbose [=TRUE]: Whether extra console output is desired during simulations.
- transpirationMode [="Granier"] is an important control parameter, because it allows the user to switch between the basic (i.e. "Granier") and advanced (i.e., either "Sperry" or "Sureau") water balance models, corresponding to chapters 3 and 7, respectively.
- rhizosphereOverlap [="total"] is also a relevant parameter, since changing its default value allows considering that plants extract soil water from partially or totally unrelated water pools, as explained in 2.4.8.

Some parameters are only relevant for parameter estimation at the stage of initialization:
- fillMissingRootParams [= TRUE]: Boolean flag to indicate that initialization functions should provide estimates for Z50 and Z95 if these are lacking in the forest data. Note that if fillMissingRootParams is set to FALSE then simulations may fail if the user does not provide values for Z50 and Z95 in tree or shrub data.
- fillMissingSpParams [=TRUE]: Boolean flag to indicate that initialization functions should provide estimates for functional parameters if these are lacking in the species parameter table SpParams. Note that if fillMissingSpParams is set to FALSE then simulations may fail if the user does not provide values for required parameters.
- fillMissingWithGenusParams [=TRUE]: Boolean flag to indicate that initializing functions should provide estimates from genus value, if species-level values are missing in the species parameter table SpParams but genus-level ones are not.

\section*{Part II}

\section*{Basic water balance modelling}

\section*{Chapter 3}

\section*{Basic water balance model}

This chapter provides an overview of the basic soil and plant water balance model included in medfate. The model allows simulating vertical water fluxes in a forest stand, and performs soil and plant water balance on a daily step basis for the period corresponding to input weather data.

The model is run using function spwb(), for a set of days, or function spwb_day(), for a single day. Alternatively, one can use function pwb() to evaluate plant transpiration and drought stress resulting from given weather and soil moisture dynamics. The basic water balance model corresponds to the control variable transpirationMode = "Granier".

The description of the model presented here conforms to a large extent to the description given in De Cáceres et al. (2015), but includes several modifications that have been implemented since the publication of this scientific article. The information provided in this chapter should be enough to understand what the model does and when it can be useful, but the reading the following ones should provide a more detailed understanding on how the different processes are formulated.

\subsection*{3.1 Design principles}

The water balance model considers only the vertical spatial dimension of the stand and not the horizontal distribution of plants within it. In other words, the model is not spatially explicit (i.e., plants do not have horizontal coordinates nor interact for space explicitly). Woody vegetation in the stand is divided into groups, here referred to as plant cohorts of different species, height and leaf area index ( $L A I$ ). Height and LAI values determine competition for light. LAI values also drive competition for soil water, along with fine root distribution. The model can also consider a layer herbaceous vegetation, which also has a height value and $L A I$, but where plant cohorts are not distinguished and with fine roots confined to the topmost layer.

The soil water balance initially followed mostly the design principles of SIERRA (Mouillot et al. 2001; Ruffault et al. 2013, 2014) and BILJOU (Granier et al. 1999, 2007), although nowadays it has evolved substantially. Hydrological processes include rainfall interception loss (Gash et al. 1995; Liu 2001), plant transpiration, evaporation from bare soil (Ritchie 1972), snow melt, infiltration into the soil matrix (Green \& Ampt 1911; Boughton 1989) and vertical water movement within the soil, the latter following MACRO (Jarvis et al. 1991; Larsbo et al. 2005), a dual-permeability model where total porosity is partitioned into two separate flow regions (matrix and macropores), each with its own degree of saturation, conductivity and flow rate. Potential evapo-transpiration ( $P E T$ ) determines maximum herbaceous and maximum canopy transpiration ( $T r_{\text {max }}$ ) using an empirical relationship between the $L A I$ of the stand and the ratio $T r_{\text {max }} / P E T$ (Granier et al. 1999). Actual plant transpiration is estimated using a function that depends not only on $T r_{\text {max }}$ but also on current soil moisture levels, cohort-specific drought resistance, fine root distribution and the degree of shading of the target plant cohort. When soil water deficit progresses, transpiration rates are
consequently reduced, but minimum transpiration rates of woody vegetation are not zero, because of the role of cuticular transpiration and imperfectly closed stomata (Duursma et al. 2018). Woody plant water status (i.e. plant water potential and, hence, plant water content) follows variations of soil moisture in the soil layers where fine roots are located.

By default, the model assumes that soil moisture under all plant cohorts is the same (i.e. water sources corresponding to vertical soil layers are shared among cohorts). However, 3D variations in soil moisture beneath plant cohorts can be simulated in spatially-explicit forest ecosystem models (Manoli et al. 2017; Rötzer et al. 2017). The water balance model does not simulate horizontal spatial processes explicitly, but allows considering more or less independent water pools for plant cohorts. If partial or completely independent water pools are considered, hydrological processes are replicated for the fraction of soil corresponding to each woody cohort. Transpiration of each plant cohort depends on the soil moisture beneath itself and, depending on the degree of rhizosphere overlap, on the soil moisture beneath other plant cohorts.

\subsection*{3.2 State variables}

The following are state variables in the model under all simulations:
- Cumulative degree days (a) to budburst, (b) to complete unfolding or (c) to senescence ( $S_{\text {eco, } d}, S_{\text {unf, } d}$ or $S_{\text {sen, } d}$; all in ${ }^{\circ} C$ ), are tracked by the model to determine leaf phenological status (see 4.1).
- Soil moisture content dynamics on each layer $s$ are tracked daily using $W_{s}=\theta_{s}(\Psi) / \theta_{f c, s}$, the proportion of soil moisture in relation to field capacity, where moisture at field capacity, $\theta_{f c, s}$, is assumed to correspond to $\Psi_{f c}=-0.033 \mathrm{MPa}$. Note that $W_{s}$ values larger than one are possible if the soil is between field capacity and saturation (which can happen if deep drainage is not allowed).
- Plant water potential ( $\Psi_{\text {plant }, i}$ ) of each plant cohort $i$ are also tracked daily and follows the soil water potential of layers (or water pools) where fine roots are located.

Additional state variables depend on the activation of specific control flags:
- If snow accumulation/melting is considered, the model tracks $S_{\text {snow }}$, the snow water equivalent (in $\mathrm{mm})$ of the snow pack storage over the surface.
- If stem cavitation is not completely reversible, the model tracks $P L C_{\text {stem }, i}$ and $P L C_{\text {leaf }, i}$, the proportion of conductivity lost the stem and leaves, respectively, of plants of cohort $i$.
- If the degree of rhizosphere overlap between plant cohorts is not total (i.e. if rhizosphereOverlap = "none" or rhizosphereOverlap = "partial"), the model also tracks $W_{i, s}$, the proportion of soil moisture in relation to field capacity for layer $s$ within the areal fraction of the stand covered by the woody cohort $i$.

\subsection*{3.3 Water balance}

Water balance is performed for both the snow pack and the soil (fig. 3.1). Precipitation ( $P$ ) is considered be snow precipitation ( $P s$ ) or rainfall ( $P r$ ), depending on temperature. Thus, we have:
\[
P=P r+P s
\]

The water balance of the snow pack ( $\Delta S_{\text {snow }}$ in mm of snow water equivalents) is simply defined as:
\[
\Delta S_{\text {snow }}=P s-S m
\]
where $P s$ is precipitation as snowfall and $S m$ is snow melt. Interception on canopy surfaces is only modelled for liquid precipitation, which leads to a partioning of $\operatorname{Pr}$ into interception loss (In; i.e. water evaporated
after being intercepted by the canopy surfaces) and net rainfall ( $P r_{n e t}$; the sum of throughfall and stem flow):
\[
P r=P r_{n e t}+I n
\]

Several water sources can contribute to soil infiltration, namely net rainfall ( $P r_{n e t}$ ), surface runon from nearby locations (Ro, if provided) and snowmelt ( $S m$ ). Given that not all water that reaches the soil surface actually infiltrates, the amount of water entering the first soil layer via infiltration ( $I f$ ) is:
\[
I f=P r_{n e t}+S m+R o-I e
\]
where $I e$ is the infiltration excess that may occur. Other water inputs into the soil can come via capillarity rise (Cr) from the water table (if present) or via lateral interflow from nearby locations ( $L w$; if provided, assumed positive in the direction of entering the local soil). There are multiple ways water can leave the soil. Regarding purely physical processes we have the evaporation from soil surface ( $E s$ ), saturation excess ( $S e$ ) and deep drainage ( $D d$ ). Fluxes mediated by plants are the transpiration made by herbaceous plants ( $T r_{\text {herb }}$ ) and the transpiration made by woody plants ( $T r_{\text {woody }}$ ).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-045.jpg?height=1050&width=1639&top_left_y=870&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 3.1: Schematic representation of soil and snow pack water balance components. Subsurface lateral source/sinks and surface runon are omitted for simplicity. Green and blue boxes represent outflows corresponding to green and blue water respectively.}
\end{figure}

Taking all input and output terms, daily variations in soil water content ( $\Delta V_{\text {soil }}$ in mm ) are then summarized as:
\[
\Delta V_{\text {soil }}=(I f+L w+C r)-\left(D d+S e+E s+T r_{\text {herb }}+T r_{\text {woody }}\right)
\]

The water leaving the soil via surface runoff ( $R u$ ) is defined as the sum of infiltration excess ( $I e$ ) and saturation excess (Se):
\[
R u=I e+S e
\]

If we consider soil and snow pack altogether, the water balance of the whole forest becomes:
\[
\Delta V_{\text {soil }}+\Delta S_{\text {snow }}=(P+R o+L w+C r)-\left(D d+R u+I n+E s+T r_{\text {herb }}+T r_{\text {woody }}\right)
\]

Among inputs, precipitation ( $P$ ) will the most relevant inflow on most instances. The liquid water fluxes contributing to blue water outflow (i.e. entering river networks or leading to ground water) are runoff ( $R u$ ) and deep drainage ( $D d$ ). Water vapor fluxes ( $E s, T r_{\text {woody }}, T r_{\text {herb }}, I n$ ) contribute to total evapotranspiration, or green water (i.e. water vapor returning to the atmosphere). These are represented in Fig. 3.1 using blue/green boxes.

While the above describes the default water balance equations, variations can occur depending on specific control flags:
a. If snow dynamics are considered [snowpack], evaporation from bare soil cannot occur if there is a snow pack over the soil (i.e., if $S_{\text {snow }}>0$ then $E s=0$ ).
b. If plant water pools are considered [rhizosphereOverlap], the soil water balance equation applies not only to the soil of the overall stand but also to the soil beneath each woody plant cohort. The fraction of stand area corresponding to the water pool of each cohort is used to keep the water balance at the two scales aligned. Moreover, the water balances of soils beneath the different plant cohort are more or less correlated depending on the degree of rhizosphere overlap.
c. If soil flows are simulated using a dual-permeability domain [soilDomains] there are water balance equations for the soil matrix and the macropore domain. Moreover, it affects the infiltration amounts (and hence runoff), in the latter including infiltration via macropores.

\subsection*{3.4 Process scheduling}

For every day to be simulated, the model performs the following steps:
1. Update leaf area values according to the phenology of species and recalculate radiation extinction (sections 4.1 and 4.2).
2. Determine rainfall interception loss (In) and net rainfall ( $P r_{n e t}$ ) (section 5.3). The amount of water reaching the soil surface from the rainfall event is the sum of net rainfall ( $P r_{n e t}$ ) and surface runon (Ro), if given. If snow dynamics are included, increase snow pack from snow precipitation ( $P s$ ) and decrease it following snow melt ( $S m$ ) (section 5.2).
3. Determine bare soil evaporation ( $E s$ ), if snow is not present (section 5.4), and herbaceous transpiration ( $T r_{\text {herb }}$; section 5.5).
4. Determine woody plant transpiration ( $T r_{\text {woody }}$ ), including hydraulic redistribution, and photosynthesis (chapter 6). Update plant water potential ( $\Psi_{\text {plant }}$ ) and plant drought stress for each plant cohort.
5. Determine rainfall infiltration (section 5.6) and vertical water movement within the soil (section 5.7), while considering soil layer source/sinks from snow melt, bare soil evaporation and herbaceous transpiration and woody plant extraction/redistribution. This updates soil moisture and returns infiltration (If), runoff ( $R u$ ) and deep drainage ( $D d$ ).
6. If fire hazard calculations are requested, estimate live and dead fuel moisture and potential fire behaviour (chapter 24).

The set of steps corresponds to simulations if plant water pools are not considered, so that only the water balance of the overall soil matters. If plant water pools are considered, steps 1,2 and 6 are the same, because they apply to the whole forest stand. However, steps 3 is performed for each water pool separately because it depends on antecedent soil moisture. Step 4 also involves defining woody plant water uptake from different plant water pools depending on the proportion of fine roots of each woody cohort in each pool (see 6.1.5). Step 5 is also performed on the soil corresponding to each pool, and the resulting infiltration, runoff and drainage estimates are averaged at the stand level. Finally, the soil moisture of the overall soil is estimated by averaging the soil moisture of water pools.

\subsection*{3.5 Inputs and outputs}

\subsection*{3.5.1 Soil, vegetation and meteorology}

\section*{Soil}

Soil input requirements are fully described in section 2.3.

\section*{Vegetation}

Vegetation input requirements are fully described in section 2.4. Trees and shrubs do not need to be characterized with different variables in soil water balance calculations, since both kinds of woody cohorts have a LAI value. In most cases, users only need to estimate the leaf area index corresponding to live leaves, i.e. $L A I^{\text {live }}$, because normally at the starting point all leaves are expanded (i.e. $L A I^{\phi}=L A I^{\text {live }}$ ) and one can assume no dead leaves in the canopy (i.e., $L A I^{\text {dead }}=0$ ). Vegetation characteristics stay constant during simulations using function spwb(), although the actual expanded leaf area ( $L A I^{\phi}$ ) and dead leaf area ( $L A I^{\text {dead }}$ ) may vary is the species is winter deciduous.

\section*{Meteorology}

The minimum weather variables required to run the model are min/max temperatures ( $T_{\text {min }}$ and $T_{\text {max }}$ ), min/max relative humidity ( $R H_{\text {min }}$ and $R H_{\text {max }}$ ), precipitation ( $P$ ) and solar radiation ( $R a d$ ). Wind speed $(u)$ is also needed, but the user may use missing values if not available (a default value will be used in this case). Wind speed is assumed to have been measured at a specific height above the canopy (by default at 2 $\mathrm{m})$. Atmospheric $C O_{2}$ concentration ( $C_{a t m}$ ) may also be specified, but if missing a default constant value is assumed, which is taken from the control parameters. Definitions and units of these variables were given in section 2.5.

\subsection*{3.5.2 Vegetation functional parameters}

The following sets of functional parameters should be supplied for each woody plant cohort. In practice, they are normally estimated from the species-specific parameter table and imputation of missing values (see A). Functional attributes are filled for each cohort $i$ by function forest2spwbInput() from species identity (i.e. $S P_{i}$ ). However, different parameters can be specified for different cohorts of the same species if desired (see section 2.4.9).
A first set of functional parameters refers to leaf phenology (paramsPhenology):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline \multicolumn{2}{|c|}{LD} & \multicolumn{2}{|l|}{Phenologyelayptphenology type (oneflush-evergreen, progressive-evergreen, winter-deciduous, winter-semideciduous)} \\
\hline & years & \multicolumn{2}{|l|}{LeafDurationage duration of leaves (in years).} \\
\hline $t_{0, \text { eco }}$ & days & t0gdd & Date to start the accumulation of degree days. \\
\hline $S_{\text {eco }}^{*}$ & ${ }^{\circ} \mathrm{C}$ & Sgdd & Degree days corresponding to leaf budburst (see section 4.1.2). \\
\hline $T_{\text {eco }}$ & ${ }^{\circ} \mathrm{C}$ & Tbgdd & Base temperature for the calculation of degree days to leaf budburst (see section 4.1.2). \\
\hline $S_{\text {sen }}^{*}$ & ${ }^{\circ} \mathrm{C}$ & Ssen & Degree days corresponding to leaf senescence (see section 4.1.3). \\
\hline $P h_{\text {sen }}$ & hours & Phsen & Photoperiod corresponding to start counting senescence degree-days (see section 4.1.3). \\
\hline $T_{\text {sen }}$ & ${ }^{\circ} \mathrm{C}$ & Tbsen & Base temperature for the calculation of degree days to leaf senescence (see section 4.1.3). \\
\hline $x_{\text {sen }}$ & \{0,1,2\} & xsen & Discrete values, to allow for any absent/proportional/more than proportional effects of temperature on senescence (see section 4.1.3). \\
\hline $y_{\text {sen }}$ & \{0,1,2\} & ysen & Discrete values, to allow for any absent/proportional/more than proportional effects of photoperiod on senescence (see section 4.1.3). \\
\hline
\end{tabular}

A second set of parameters relate to light extinction and water interception (paramsInterception):

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & Description \\
\hline $k_{P A R}$ & kPAR & PAR extinction coefficient (see section 4.2). \\
\hline $s_{\text {water }}$ & $m m \mathrm{H}_{2} \mathrm{O}$ ů $L A \mathrm{~g}^{-1}$ & Crown water storage capacity (i.e. depth of water that can be retained by leaves and branches) per LAI unit (see section 5.3). \\
\hline
\end{tabular}

A third set includes parameters related to plant anatomic and morphological attributes (paramsAnatomy):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $1 / H_{v}$ & $m^{2} \cdot m^{-2}$ & Al2As & Ratio of leaf area to sapwood area \\
\hline RLR & $m^{2} \cdot m^{-2}$ & Ar2Al & Fine root area to leaf area ratio \\
\hline SLA & $m^{2} \cdot k g^{-1}$ & SLA & Specific leaf area \\
\hline $\rho_{\text {leaf }}$ & $g \cdot \mathrm{~cm}^{-3}$ & LeafDensity & Leaf tissue density \\
\hline $\rho_{\text {wood }}$ & $g \cdot \mathrm{~cm}^{-3}$ & WoodDensity & Wood tissue density \\
\hline $\rho_{\text {fineroot }}$ & $g \cdot \mathrm{~cm}^{-3}$ & FineRootDensit & tyine root tissue density \\
\hline $S R L$ & $\mathrm{cm} \cdot g^{-1}$ & SRL & Specific root length \\
\hline RLD & $\mathrm{cm} \cdot \mathrm{cm}^{-3}$ & RLD & Fine root length density (i.e. density of root length per soil volume) \\
\hline $r_{6.35}$ & & r635 & Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm \\
\hline
\end{tabular}

A fourth set of parameters are related to transpiration and photosynthesis (paramsTranspiration):

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $g_{\text {swmin }}$ & $\mathrm{mol} \mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ & Gwmin Minimum stomatal conductance to water vapour \\
\hline $T_{\text {max }, L A I}$ & & Tmax_LA正mpirical coefficient relating LAI with the ratio of maximum transpiration over potential evapotranspiration (see section 6.1.1). \\
\hline $T_{\text {max }, \text { sqLAI }}$ & & Tmax_LAIIsiqpirical coefficient relating squared LAI with the ratio of maximum transpiration over potential evapotranspiration (see section 6.1.1). \\
\hline $\Psi_{\text {extract }}$ & $M P a$ & Psi_Extralat water potential at which plant transpiration is $50 \%$ of its maximum (see section 6.1.2). \\
\hline $c_{\text {extract }}$ & & Exp_Extraatameter of the Weibull function regulating transpiration reduction (see section 6.1.2). \\
\hline $c_{\text {leaf }}, d_{\text {leaf }}$ & (unitless), & VCleaf_d,arameters of the vulnerability curve for leaf xylem \\
\hline $c_{\text {stem }}, d_{\text {stem }}$ & (unitless), & VCstem_d,arameters of the vulnerability curve for stem xylem \\
\hline $W U E_{\max }$ & $g C \cdot m m^{-1}$ & WUE Water use efficiency at VPD = 1kPa and without light or CO2 \\
\hline $W U E_{P A R}$ & & WUE_par Coefficient describing the progressive decay of WUE with lower light levels (see section 6.1.6). \\
\hline $W U E_{C O 2}$ & & WUE_co2 Coefficient for WUE dependency on atmospheric CO2 concentration 6.1.6). \\
\hline $W U E_{V P D}$ & & WUE_vpd Coefficient for WUE dependency on vapor pressure deficit 6.1.6). \\
\hline
\end{tabular}

A fifth (final) set of parameters are related to water storage and water relations in plant tissues (paramsWaterStorage):

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $L F M C_{\text {max }}$ & \% & maxFMC Maximum live fuel moisture content, corresponding to fine fuels (< 6.35 mm twigs and leaves). \\
\hline $\epsilon_{\text {leaf }}$ & MPa & LeafEPS Modulus of elasticity of leaves \\
\hline $\epsilon_{\text {stem }}$ & MPa & StemEPS Modulus of elasticity of symplastic xylem tissue \\
\hline $\pi_{0, \text { leaf }}$ & MPa & LeafPIO Osmotic potential at full turgor of leaves \\
\hline $\pi_{0, \text { stem }}$ & MPa & StemPI0 Osmotic potential at full turgor of symplastic xylem tissue \\
\hline $f_{\text {apo,leaf }}$ & [0-1] & LeafAF Apoplastic fraction in leaf tissues \\
\hline $f_{\text {apo }, \text { stem }}$ & [0-1] & StemAF Apoplastic fraction in stem tissues \\
\hline $V_{\text {leaf }}$ & $l \cdot m^{-2}$ & Vleaf Leaf water capacity per leaf area unit \\
\hline $V_{\text {sapwood }}$ & $l \cdot m^{-2}$ & Vsapwoodapwood water capacity per leaf area unit \\
\hline
\end{tabular}

\subsection*{3.5.3 Control parameters}

Control parameters modulate the overall behaviour of water balance simulations (see section 2.6). Most importantly, transpirationMode defines the transpiration model, which in turn defines the complexity of the water balance model. If transpirationMode $=$ "Granier" (the default value) then the basic water balance model is used.

The other relevant control parameters for the basic water balance model are:
- soilFunctions [="SX"]: Soil water retention curve and conductivity functions, either 'SX' (for Saxton) or 'VG' (for Van Genuchten).
- ndailysteps [=24]: Number of steps into which each day is divided for determination of soil water balance ( 24 equals 1 -hour intervals).
- max_nsubsteps_soil [= 300]: Maximum number of substeps for soil water balance solving.
- defaultWindSpeed [= 2.5]: Default value for wind speed (in $m \cdot s^{-1}$ ) when this is missing (only used for leaf fall, see section 4.1).
- defaultCO2 [=386]: Default atmospheric (abovecanopy) $C O_{2}$ concentration (in micromol $C O_{2} \cdot \mathrm{~mol}^{-1}$ $=\mathrm{ppm})$. This value will be used whenever $C O_{2}$ concentration is not specified in the weather input.
- defaultRainfallIntensityPerMonth $[=c(1.5,1.5,1.5,1.5,1.5,1.5,5.6,5.6,5.6$, $5.6,5.6,1.5)]$ : A vector of twelve values indicating the rainfall intensity ( $\mathrm{mm} / \mathrm{h}$ ) per month. By default synoptic storms ( $1.5 \mathrm{~mm} / \mathrm{h}$ ) are assumed between December and June, and convective storms ( $5.6 \mathrm{~mm} / \mathrm{h}$ ) are assumed between July and November (Miralles et al. 2010).
- snowpack [= TRUE]: Whether dynamics of snow pack are included (see section 5.2).
- leafPhenology [ = TRUE]: Whether leaf phenology is simulated (see section 4.1). If FALSE then all species are assumed to be evergreen.
- bareSoilEvaporation [= TRUE]: Whether evaporation from the soil surface is simulated (see section 5.4).
- unlimitedSoilWater [=FALSE]: Boolean flag to indicate the simulation of plant transpiration assuming that soil water is always at field capacity.
- unfoldingDD [= 300]: Degree-days for complete leaf unfolding after budburst has occurred ( $S_{u n f}^{*}$; see section 4.1.2).
- interceptionMode [= "Gash1995"]: Infiltration model, either "Gash1995" or "Liu2001"; see section 5.3.
- infiltrationMode [= "GreenAmpt1911"]: Infiltration model, either "GreenAmpt1911" or "Boughton1989"; see section 5.6.
- soilDomains [= "single"]: Either "single" (for single domain) or "dual" (for dual-permeability) (see section 5.7).
- fireHazardResults [= FALSE]: Boolean flag to force calculation of daily fire hazard.
- rhizosphereOverlap [="total]: A string indicating the degree of rhizosphere spatial overlap between plant cohorts:
- "none" - no overlap (independent water pools).
- "partial" - partial overlap determined by coarse root volume.
- "total" - total overlap (plants extract from common soil pools).
- verticalLayerSize [= 100]: Size of vertical layers (in cm) for the calculation of light extinction (see section 2.4.6).
- windMeasurementHeight [ = 200]: Height (in cm) over the canopy corresponding to wind measurements.
- stemCavitationRecovery/leafCavitationRecovery [= "rate"]: A string indicating how to model recovery of xylem conductance (see section 12.4). Allowed values are:
- "none" - no recovery.
- "annual" - complete recovery every first day of the year.
- "total" - instantaneous complete recovery.
- "rate" - following a rate of new leaf or sapwood formation.

\subsection*{3.5.4 Model output}

Functions $\operatorname{spwb}()$ and $\operatorname{pwb}()$ return a list of a class with the same name. The first four elements of this list (i.e., latitude, topography, weather and spwbInput) are simply copies of model inputs. The next element is spwbOutput, which contains the state of the input object at the end of the simulation (this can be used to perform further simulations starting with current values of state variables). The next five elements correspond to water balance flows, soil state variables, stand-level variables, plant-level and fire hazard results:

\begin{tabular}{|l|l|}
\hline Element & Description \\
\hline WaterBalance & Climatic input and water balance flows of eq.(3.5) (i.e. net precipitation, infiltration, runoff, transpiration...). All of them in $m m=l \cdot m^{-2}$. \\
\hline Soil & Soil variables for each soil layer: Moisture relative to field capacity ( $W_{s}$ ), water potential ( $\Psi_{s}$ ) and volumetric water content ( $V_{s}$ ). Only returned if soilResults $=$ TRUE. \\
\hline Stand & Stand-level variables, such as $L A I_{\text {stand }}^{\phi}, L A I_{\text {stand }}^{\text {dead }}$, the water retention capacity of the canopy ( $S_{\text {canopy }}$ ) or the fraction of light reaching the ground ( $L_{\text {ground }}^{\text {PAR }}$ and $L_{\text {ground }}^{\text {SWR }}$ ). Only returned if standResults $=$ TRUE. \\
\hline Plants & Variables defined at the level of woody plant cohort, such as expanded leaf area ( $L A I_{i}^{p h i}$ ), transpiration, photosynthesis, water potential, etc. Only returned if plantResults $=$ TRUE. \\
\hline FireHazard & Fire hazard variables (fuel moisture, rate of spread, fire potentials, etc). Only returned if fireHazardResults = TRUE. \\
\hline
\end{tabular}

Elements WaterBalance, Soil, Stand and FireHazard are data frames with dates in rows and variables in columns, whereas Plants is itself a list with several data frames, with dates in rows and woody plant cohorts in columns:

\begin{tabular}{|l|l|l|l|}
\hline Element & Symbol & Units & Description \\
\hline LAI & $L A I^{\phi}$ & $m^{2} \cdot m^{-2}$ & Leaf area index (expanded). \\
\hline LAIlive & LAI ${ }^{\text {live }}$ & $m^{2} \cdot m^{-2}$ & Leaf area index (live). \\
\hline AbsorbedSWRFrafętion & & [0-1] & Fraction of shortwave radiation absorbed. \\
\hline Transpiration $T r$ & & mm & Transpiration per unit ground area. \\
\hline \multicolumn{2}{|l|}{GrossPhotosynthesis} & $g C \cdot m^{-2}$ & Gross photosynthesis per unit ground area. \\
\hline PlantPsi & $\Psi_{\text {plant }}$ & $M P a$ & Plant water potential. \\
\hline LeafPLC & $P L C_{\text {leaf }}$ & [0-1] & Degree of leaf embolisation. \\
\hline StemPLC & $P L C_{\text {stem }}$ & [0-1] & Degree of stem embolisation. \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Element & Symbol & Units & Description \\
\hline PlantWaterBalance & & mm & Internal daily plant water balance (balance of soil extraction and transpiration). \\
\hline LeafRWC & $R W C_{\text {leaf }}$ & \% & Mean leaf relative water content. \\
\hline StemRWC & $R W C_{\text {stem }}$ & \% & Mean stem relative water content. \\
\hline LFMC & $L F M C$ & \% & Live fuel moisture content (as percent of dry weight), corresponding to fine fuels ( $<6.35 \mathrm{~mm}$ twigs and leaves). \\
\hline PlantStress & $D D S$ & [0-1] & Drought stress level suffered by each plant cohort (relative whole-plant transpiration). \\
\hline
\end{tabular}

The output of simulations can be inspected using plot, shinyplot and summary functions specific to spwb objects (examples are given in the corresponding package vignette).

As it simulates water balance for only one day, function spwb_day() returns a much more reduced output. This function is most useful with advanced water balance modelling (chapter 7).

\subsection*{3.6 Applications}

The basic water balance model is easier to parameterize and is faster the advanced water balance model. These features make it appropriate for applications that do not seek a high predictive capacity of water status at the plant level, but require robust estimates of water fluxes at the stand, landscape or regional levels. In our opinion the basic water balance model may be useful for the following applications:
1. To monitor or forecast temporal variation in transpiration fluxes and soil water content in particular stands or in multiple stands across a landscape or region.
2. Monitor or forecast temporal variation of plant drought stress in particular stands or in multiple stands across a landscape or region (for example to anticipate mortality events).

For example, Karavani et al. (2018) employed the water balance to provide sound estimates of soil moisture dynamics to predict mushroom production in a network forest stands. The model is particularly interesting to test the relationship between forest structure/composition and the water balance at the stand level or the drought stress suffered by plants, as done in Ameztegui et al. (2017). See also another application in Rolo \& Moreno (2019).

\section*{Chapter 4}

\section*{Leaf phenology and radiation extinction}

Leaf phenology determines seasonal variations in the surface area of leaves, hence influencing the energy and water exchange between plants and the atmosphere. Radiation extinction is an important process to consider in a model where plants have different heights.

\subsection*{4.1 Leaf phenology}

\subsection*{4.1.1 Phenological types and leaf expanded area}

Plant species can have either progressive evergreen, one-flush evergreen, winter-deciduous, winter semideciduous or drought-deciduous leaf phenology (see Fig. 4.1). Progressive evergreen plants are assumed to shed old leaves at the same time as new leaves appear, so that the leaf area remains constant throughout the year. One-flush evergreen plants concentrate leaf unfolding and leaf senescence during similar periods, so that leaf area is also approximately constant year-round. In winter-deciduous plants, leaf shedding and leaf bud formation occurs in autumn. Buds remain under dormancy until spring, when budburst and unfolding occurs. The difference between semi-deciduous and deciduous plants is that the former retain dead leaves in the plant until next season unfolding period, so that leaf fall is retarded. Finally, drought-deciduous plants behave like progressive-evergreen plants except that they can shed their leaves in response to drought.

Evergreen plants thus maintain constant leaf area over the year, whereas in deciduous plants leaf-expanded status is updated daily, represented by $\phi_{i}$, the fraction of maximum leaf area:
\[
L A I_{i}^{\phi}=L A I_{i}^{\text {live }} \cdot \phi_{i}
\]
whereas for evergreen species $L A I_{i}^{\phi}=L A I_{i}^{\text {live }}$ (or equivalently $\phi_{i}=1$ at all times).
The general structure of process based phenological models explained in Chuine et al. (2013). These models aim determine, for a given phenological phase $n$ (endodormancy, ecodormancy, maturation, etc), the day of its finalisation $d_{n}$, such that the following equation holds:
\[
S_{n, d}=\sum_{d_{n-1}}^{d_{n}} R_{n, d}=S_{n}^{*}
\]
where $S_{n, d}$ is the state of development on day $d$ in phase $n$, and $d_{n-1}$ is the end of the previous phase. $R_{n, d}$ is the rate of development during phase $n$ on day $d$, which depends on environmental variables (temperature, photoperiod,...) and $S_{n}^{*}$ is the critical threshold to achieve the change of phase.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-054.jpg?height=1543&width=1288&top_left_y=566&top_left_x=436}
\captionsetup{labelformat=empty}
\caption{Figure 4.1: Schematic representation of leaf phenology types}
\end{figure}

In the water balance model leaf area index ( $L A I$ ) values of winter (semi-)deciduous plants are adjusted for leaf phenology following a leaf development model in spring and a leaf senescence model in autumn. Function pheno_updateLeaves() updates the status of expanded leaves and dead leaves in a simulation object.

\subsection*{4.1.2 Bud burst and leaf unfolding}

Transition from ecodormancy to bud burst is estimated using a very simple one-phase ecodormancy model (also called the spring warming model) implemented in function pheno_leafDevelopmentStatus(). Given a base temperature ( $T_{e c o}$, in ${ }^{\circ} \mathrm{C}$ ), the rate of development during the ecodormancy phase ( $R_{e c o}$, in ${ }^{\circ} \mathrm{C}$ ) is zero for those days where mean temperature $T_{\text {mean }}$ is below $T_{\text {eco }}$ and $T_{\text {mean }}-T_{\text {eco }}$ ) for those days where temperatures become warmer than this threshold:
\[
R_{e c o, d}\left(T_{d}\right)= \begin{cases}0 & T_{d} \leq T_{e c o} \\ T_{d}-T_{e c o} & T_{d}>T_{e c o}\end{cases}
\]

Degree accumulation starts after the year date surpasses parameter $t_{0, \text { eco }}$. If $D O Y>t_{0, \text { eco }}$, daily $R_{\text {eco, } d}$ values are added to the cumulative sum $S_{\text {eco, } d}$ and budburst occurs when $S_{\text {eco, } d}>S_{\text {eco }}^{*}$. Both $T_{\text {eco }}$ and $S_{\text {eco }}^{*}$ are plant-specific parameters in spwbInput.

After budburst, we model progressive leaf unfolding in a similar manner, by accumulating degree days using the same definition as for $R_{e c o, d}$ :
\[
R_{u n f, d}=R_{e c o, d}
\]
and then defining an unfolding development status $S_{u n f, d}=\sum_{d, e c o}^{d} R_{u n f, d}$, which we use to determine $\phi_{i, d}$, the degree of leaf expansion of cohort $i$ at day $d$ :
\[
\phi_{i, d}=S_{u n f, d} / S_{u n f}^{*}
\]
until $S_{u n f, d} \geq S_{u n f}^{*}$ and the unfolding process ends, where $S_{u n f}^{*}$ is a simulation control parameter unfoldingDD.

\subsection*{4.1.3 Leaf senescence}

Leaf senescence follows the models developed by Delpierre et al. (2009). The daily rate of development of senescence $R_{\text {sen, } d}$ is defined on the basis of daily photoperiod ( $P h_{d}$, in hours) and temperature ( $T_{d}$, in ${ }^{\circ} \mathrm{C}$ ):
\[
R_{s e n, d}\left(P h_{d}, T_{d}\right)= \begin{cases}0 & T_{d} \geq T_{s e n} \text { or } P h_{d}>P h_{s e n} \\ \left(T_{d}-T_{s e n}\right)^{x_{s e n}} \cdot\left(P h_{d} / P h_{s e n}\right)^{y_{s e n}} & T_{d}<T_{s e n} \text { and } P h_{d}<P h_{s e n}\end{cases}
\]
where $P h_{\text {sen }}$ is the maximum photoperiod to start counting the senescence; $x_{\text {sen }}$ and $y_{\text {sen }}$ are exponents regulating the importance of temperature and photoperiod on leaf senescence. The state of development of senescence $S_{\text {sen }, d}$ is defined
\[
S_{s e n, d}=\sum R_{s e n, d}
\]
and when $S_{\text {sen, } d} \geq S_{\text {sen }}^{*}$ then expanded leaves are assumed to suddenly die. This model is implemented in function pheno_leafSenescenceStatus() and returns $\phi_{i, d}=1$ for all days until $S_{\text {sen, } d} \geq S_{\text {sen }}^{*}$ when it returns $\phi_{i, d}=0$. Parameters $T_{\text {sen }}, P h_{\text {sen }}$ and $S_{\text {sen }}^{*}$ are plant-specific parameters in spwbInput.

\subsection*{4.1.4 Leaf abscission}

The drop of $\phi_{i}$ causes live expanded leaves to become dead leaves. To avoid a sudden decrease of leaf area, dead leaves are kept in the canopy and they are reduced daily using a negative exponential function of wind speed:
\[
L A I_{i}^{\text {dead }}=L A I_{i}^{\text {dead }} \cdot e^{-u / 10}
\]
where $u$ is wind speed in ( $m \cdot s^{-1}$ ).

\subsection*{4.2 Radiation extinction}

The proportion of photosynthetically active radiation (PAR) and short-wave radiation (SWR; 400-3000 nm) decreases through the canopy following the Beer-Lambert's light extinction equation. $L_{\text {herb }}^{P A R}$, the proportion of PAR that reaches the herbaceous layer, is calculated as:
\[
L_{\text {herb }}^{P A R}=e^{-\sum_{i=1}^{c} k_{P A R, i} \cdot L A I_{i}^{a l l}}
\]
where $k_{P A R, i}$ is the PAR extinction coefficient of woody plant cohort $i$. If we add the extinction caused by the herbaceous layer, we have that $L_{\text {ground }}^{P A R}$, the proportion of PAR that reaches the ground, is calculated as:
\[
L_{\text {ground }}^{\text {PAR }}=L_{\text {herb }}^{\text {PAR }} e^{-0.5 \cdot L A I_{\text {herb }}}
\]

Where herbaceous vegetation is assumed to have a fixed extinction coefficient.
We can also define $L_{i}^{P A R}$ as the proportion of PAR available for a given plant cohort $i$, which we associate to the PAR available at a height corresponding to half of the cohort's crown. This height will include some self-shading of the target cohort.

The proportion of short-wave radiation (SWR) energy absorbed by each plant cohort needs to be calculated to divide the transpiration of the stand among cohorts (chapter 6), and the radiation absorbed by the soil is needed to calculate soil evaporation (section 5.4). Foliage absorbs a higher proportion of PAR than SWR; thus, the extinction coefficient is higher for PAR than for SWR. However, values for the ratio of extinction coefficients are rather constant. Following Friend et al. (1997) it is assumed that the extinction coefficient for PAR is 1.35 times larger than that for SWR (i.e. $k_{S W R, i}=k_{P A R, i} / 1.35$ ). Figure 4.2 shows the PAR and SWR extinction profiles (see functions vprofile_PARExtinction() and vprofile_SWRExtinction()) corresponding to the leaf area density distribution of Fig. 2.4.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-056.jpg?height=820&width=1652&top_left_y=1330&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 4.2: Light extinction in a forest stand. Note the sharper decrease of PAR (left panel) in comparison to SWR (right panel)}
\end{figure}

To calculate radiation absorption, where the vertical dimension of the plot is divided into layers (as explained in 2.4.6), and the SWR absorbed is calculated for each plant cohort in each layer. Let $l$ be the number of vertical layers. The fraction of radiation incident on layer $j$ that is absorbed in the same layer is:
\[
f_{j}=1-e^{-\sum_{i=1}^{c} k_{S W R, i} \cdot L A I_{i, j}^{a l l}}
\]
where $L A I_{i, j}^{\text {all }}$ is the leaf area index of cohort $i$ in layer $j$. Hence, the fraction transmitted is ( $1-f_{j}$ ). The fraction of radiation incident on layer $j$ that is absorbed by expanded leaves of plant cohort $i$ in that layer ( $f_{i j}$ ) is calculated from the relative contribution of these leaves to the total absorption in the layer:
\[
f_{i j}=f_{j} \cdot \frac{k_{S W R, i} \cdot L A I_{i, j}^{\phi}}{\sum_{h=1}^{c} k_{S W R, h} \cdot L A I_{h, j}^{a l l}}
\]

The fraction of canopy radiation absorbed by a plant cohort $i$ across all layers is found by adding the fraction absorbed in each layer:
\[
f_{i}=\sum_{j=1}^{l} f_{i j} \cdot \prod_{h>j}^{l}\left(1-f_{h}\right)
\]
where for each layer the fraction of the radiation incident in the canopy that reaches the layer is found by multiplying the transmitted fractions across the layers above it. For example, the fraction of SWR absorbed by each of the three cohorts of the example in Fig. 2.3 would be (see function light_cohortAbsorbedSWRFraction()):
$\begin{array}{rrrr}\text { \#\# } & \text { T1_148 } & \text { T2_168 } & \text { S1_165 } \\ \text { \#\# } & 0.247978703 & 0.204200474 & 0.006792845\end{array}$

\section*{Chapter 5}

\section*{Forest hydrology}

Forest hydrological processes are key for soil and plant water balances. This chapter details the design and implementation of most of the vertical hydrological processes included in package medfate. These processes determine the value of the water flows mentioned in eq. (3.5). The only process that is not described here is woody plant transpiration ( $T r_{w}$ ), as it will be covered in detail in chapter 6 .

Although each process can be simulated in specific sub-model functions, function hydrology_verticalInputs() allows simulating soil water input processes altogether, including canopy water interception, snow accumulation/melt, soil infiltration and percolation.

\subsection*{5.1 Snow and rainfall}

Precipitation ( $P$ ) is considered be snow precipitation ( $P s$ ) when $T_{\text {mean }}<0$, and is considered rainfall ( $P r$ ) otherwise. Thus, we have:
\[
P=P r+P s
\]

Interception of snow by the canopy is neglected, and all snow is assumed to accumulate in a single storage compartment $S_{\text {snow }}$ over the soil (i.e. canopy snow storage capacity is neglected). Rainfall interception is described in section 5.3.

\subsection*{5.2 Snow pack dynamics}

A very simple snow submodel is used for snow pack dynamics (accumulation and melt), taken from Kergoat (1998). When mean air temperature is above 0 Celsius ( $T_{\text {mean }}>0$ ), a simple energy budget relates snow melt, $S m(\mathrm{~mm})$, to air temperature and soil-level radiation (see function hydrology_snowMelt()):
\[
S m=\frac{R a d \cdot L_{\text {ground }}^{S W R} \cdot\left(1-\alpha_{\text {ice }}\right)+\tau_{\text {day }} \cdot T_{\text {mean }} \cdot \rho_{\text {air }} \cdot C_{p} / r_{s}}{\lambda_{\text {ice }}}
\]
where $\operatorname{Rad}$ is solar radiation $\left(M J \cdot m^{-2}\right), L_{\text {ground }}^{\text {SWR }}$ is the fraction of (short-wave) radiation reaching the ground, $\alpha_{i c e}=0.9$ is the albedo of snow, $\tau_{d a y}=86400$ is the day duration in seconds, $\rho_{a i r}$ is the air density ( $\mathrm{kg} \cdot \mathrm{m}^{-3}$ ), depending on temperature and elevation (see utility functions of the meteoland reference manual), $C_{p}=1013.86 \cdot 10^{-6} M J \cdot \mathrm{~kg}^{-1} \cdot C^{-1}$ is the specific heat capacity of the air and $r_{s}=100 \mathrm{~s} \cdot \mathrm{~m}^{-1}$ is the snow aerodynamic resistance and $\lambda_{\text {ice }}=0.33355 M J \cdot k g^{-1}$ is the (latent) heat of fusion of snow.

\subsection*{5.3 Rainfall interception loss}

As mentioned above, interception loss is only modelled for liquid precipitation (i.e. snow interception is not modelled). Rainfall interception loss, In, is estimated using either the Gash et al. (1995) or Liu (2001) models.

\subsection*{5.3.1 Gash (1995) model}

In the Gash et al. (1995) analytical interception model for sparse canopies, rain is assumed to fall in a single event during the day. First, the amount of rainfall needed to saturate the canopy is calculated:
\[
P_{G}=-\frac{S_{\text {canopy }} / C_{\text {canopy }}}{E R_{\text {ratio }}} \cdot \ln \left(1-E R_{\text {ratio }}\right)
\]
where $S_{\text {canopy }}$ is the canopy water storage capacity (in mm ) - i.e. the minimum amount of water needed to saturate the canopy -, $C_{\text {canopy }}$ is the canopy cover and $E R_{\text {ratio }}$ is the ratio of evaporation rate to rainfall intensity during the rainfall event ( $R_{i n t}$; in $\mathrm{mm} \cdot \mathrm{h}^{-1}$ ). Although interception models are normally applied to single-canopy stands, we apply the sparse Gash model to the whole stand (including shrubs and the herbaceous layer). Moreover, in our implementation stem interception is lumped with crown interception, so that $S_{\text {canopy }}$ represents both.

Following Watanabe \& Mizutani (1996) we estimate $S_{\text {canopy }}$, the canopy water storage capacity, from adjusted LAI values:
\[
S_{\text {canopy }}=L A I_{\text {herb }}+\sum_{i} s_{\text {water }, i} \cdot L A I_{i}^{\phi}
\]
where $s_{\text {water }, i}$ is the depth of water that can be retained by leaves, branches and stems of cohort $i$ per unit of leaf area index ( $m m \cdot L A I^{-1}$ ). To estimate the stand cover, $C_{\text {canopy }}$, we use the complement of the percentage of PAR that reaches the ground, i.e. $C_{\text {canopy }}=1-L_{\text {ground }}^{\text {PAR }}$ (Deguchi et al. 2006).

The amount of water evaporated from interception ( $I n$, in mm ), is calculated as:
\[
\begin{array}{r}
\text { In }=C_{\text {canopy }} \cdot P_{G}+C_{\text {canopy }} \cdot E R_{\text {ratio }} \cdot\left(\operatorname{Pr}-P_{G}\right) \text { if } \operatorname{Pr}>P_{G} \\
\text { In }=C_{\text {canopy }} \cdot \operatorname{Pr} \text { if } \operatorname{Pr} \leq P_{G}
\end{array}
\]
where $P r$ is the daily gross rainfall (in mm ). Net rainfall ( $P r_{n e t}$, also in mm ) includes throughfall and stemflow, and is calculated as the difference between gross rainfall and interception loss. Fig. 5.1 below shows examples of relative throughfall (including stemflow), calculated according to the Gash et al (1995) interception model, under different situations (see function hydrology_rainInterception()).

\subsection*{5.3.2 Liu (2001) model}

In the single-storm form of the Liu (2001) model is similar to the Gash et al. (1995) model in terms of its inputs. Rainfall interception during a single storm can be predicted by gross rainfall amount $P_{G}$, the ratio of evaporation rate to rainfall rate during the rainfall event, $E R_{\text {ratio }}$, canopy gap fraction ( $C_{\text {canopy }}$ ) and storage capacity ( $S_{\text {canopy }}$ ):
\[
I n=S_{\text {canopy }} \cdot\left[1.0-\exp \left(-P_{G} \cdot\left(\frac{C_{\text {canopy }}}{S_{\text {canopy }}}\right)\right)\right] \cdot\left(1.0-\left(E R / C_{\text {canopy }}\right)\right)+\left(E R \cdot P_{G}\right)
\]

Fig. 5.2 below shows examples of relative throughfall (including stemflow), calculated according to the Liu et al (2001) interception model, under different situations (see function hydrology_rainInterception()).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-061.jpg?height=1622&width=1668&top_left_y=479&top_left_x=227}
\captionsetup{labelformat=empty}
\caption{Figure 5.1: Examples of canopy interception with different $S_{\text {canopy }}$ (canopy water storage capacity), $E R_{\text {ratio }}$ (ratio between evaporation and rainfall rates) and $p$ (throughfall coefficient; $p=1-C_{\text {canopy }}$ ), using the Gash (1995) model.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-062.jpg?height=1619&width=1665&top_left_y=479&top_left_x=227}
\captionsetup{labelformat=empty}
\caption{Figure 5.2: Examples of canopy interception with different $S_{\text {canopy }}$ (canopy water storage capacity), $E R_{\text {ratio }}$ (ratio between evaporation and rainfall rates) and $p$ (throughfall coefficient; $p=1-C_{\text {canopy }}$ ), using the Liu (2001) model.}
\end{figure}

\subsection*{5.4 Bare soil evaporation}

Evaporation from the soil surface is the last component of the soil water balance to be calculated before calculating plant transpiration. Bare soil evaporation cannot happen if there is snow over the soil surface (i.e., if $S_{\text {snow }}>0$ ).

Potential evaporation from the soil ( $P E_{s o i l}$; in $m m \cdot d a y^{-1}$ ) is defined as the product between $P E T$ and $L_{\text {ground }}^{S W R}$, the proportion of SWR absorbed by the ground:
\[
P E_{\text {soil }}=P E T \cdot L_{\text {ground }}^{S W R}
\]

Actual evaporation from the soil surface is modeled as in Mouillot et al. (2001), who in turn followed Ritchie (1972). First, the model determines $t_{\text {soil }}$, the time needed to evaporate the current water deficit (difference between field capacity and current moisture) in the surface soil layer:
\[
t_{\text {soil }}=\left\{\frac{V_{f c, 1} \cdot\left(1-W_{1}\right)}{\gamma_{\text {soil }}}\right\}
\]
where $V_{f c, 1}$ is the water retention capacity of layer $1, W_{1}$ is the proportion of moisture in relation to field capacity of layer 1 and $\gamma_{\text {soil }}$ is the maximum daily evaporation ( $m m \cdot d a y^{-1}$ ). The calculated time is used to determine the 'supplied' evaporation, $S E_{\text {soil }}$ :
\[
S E_{\text {soil }}=\gamma_{\text {soil }} \cdot\left(\sqrt{t_{\text {soil }}+1}-\sqrt{1}\right)
\]

The amount of water actually evaporated from the soil, $E s$, is then calculated as the minimum between supply, $S E_{\text {soil }}$, and demand (Federer 1982), i.e. $P E_{\text {soil }}$ (see function hydrology_soilEvaporationAmount):
\[
E s=\min \left(P E_{\text {soil }}, S E_{\text {soil }}\right)
\]

Figure 5.3 shows the cumulative evaporation from soils for different values of maximum evaporation rate.

\subsection*{5.5 Transpiration of the herbaceous layer}

Transpiration of herbaceous layer is modelled analogously to the transpiration of woody plants. First, potential evapotranspiration from the herbaceous layer ( $P E T_{h e r b}$; in $m m \cdot d a y^{-1}$ ) is defined as the product between $P E T$ and $L_{\text {herb }}^{S W R}$, the proportion of SWR reaching the herbaceous layer:
\[
P E T_{\text {herb }}=P E T \cdot L_{\text {herb }}^{S W R}
\]

Thus, the more dense the woody plant canopy, the lower herbaceous transpiration will be. Maximum herbaceous transpiration $T r_{\text {herb }, \text { max }}$ depends on both $P E T_{\text {herb }}$ and the amount of transpiring surface, i.e. $L A I_{\text {herb }}$. To estimate $T r_{\max }$ the model uses the empirical equation of Granier et al. (1999), as in section 6.1.1:
\[
\frac{T r_{h e r b, \max }}{P E T}=-0.006 \cdot\left(L A I_{h e r b}\right)^{2}+0.134 \cdot L A I_{h e r b}
\]

Finally, actual herbaceous transpiration for a given soil layer $s$ ( Tr $_{\text {herb }, s}$ ) is reduced according to the soil water potential ( $\Psi_{s}$ ), assuming that transpiration reduction follows Weibull function with fixed coefficients:
\[
T r_{h e r b, s}=F R P_{h e r b, s} \cdot T r_{h e r b, \max } \cdot \exp \left\{\ln (0.5) \cdot\left[\frac{\Psi_{i}}{-1.5}\right]^{2}\right\}
\]
where $F R P_{\text {herb }, s}$ is the proportion of fine roots in layer $s$, defined using $Z_{50}=50 \mathrm{~mm}$ and $Z_{95}=500 \mathrm{~mm}$ (see 2.4.7).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-064.jpg?height=960&width=1188&top_left_y=241&top_left_x=466}
\captionsetup{labelformat=empty}
\caption{Figure 5.3: Cumulative bare soil evaporation for different values of maximum evaporation rate ( $\gamma_{\text {soil }}$ ). Topsoil layer ( $0-30 \mathrm{~cm}$ ) is initialized at field capacity $\left(V_{1}=50 \mathrm{~mm}\right) . P E_{\text {soil }}$ was assumed not to be limiting.}
\end{figure}

\subsection*{5.6 Infiltration}

The amount of rainfall event water that reaches the soil is the sum of net rainfall ( $P r_{n e t}$ ) and runon ( $R o$, in mm ), if any. The amount of rainfall event water infiltrating into the soil matrix ( $I f$ ) is estimated using either the Boughton (1989) or the Green \& Ampt (1911) models.

\subsection*{5.6.1 Boughton (1989) model}

Surface runoff $R u$ can be estimated using the USDA SCS curve number method, following Boughton (1989):
\[
R u=\frac{\left(P r_{n e t}+R o-0.2 \cdot V_{f c, s o i l}\right)^{2}}{\left(P r_{n e t}+R o-0.8 \cdot V_{f c, s o i l}\right)}
\]
where $V_{f c, s o i l}$ (in mm) is the overall soil water retention capacity. The Boughton (1989) model is available in function hydrology_infiltrationBoughton() and examples of its behavior are given in the figure below.

\subsection*{5.6.2 Green-Ampt (1911) model}

The description of the Green \& Ampt (1911) model has been adapted from chapter 9 of Bonan (2019). The Green-Ampt equation uses the concept of a horizontal wetting front at some distance $L_{w}$ into the soil. The soil above $L_{w}$ is saturated (i.e. $\theta_{\text {sat }}$ ), whreas soil below the wetting front has a uniform content $\theta_{\text {dry }}$ corresponding to conditions prior to the rainfall event. Darcy's law provides the flux of water $i_{c}$ infiltrating into the soil from the surface to the wetting front at depth $z=-L_{w}$ :
\[
i_{c}=K_{s a t}\left[\frac{\left|\Psi_{w}\right|}{L_{w}}+1\right]
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-065.jpg?height=823&width=1673&top_left_y=224&top_left_x=222}
\captionsetup{labelformat=empty}
\caption{Figure 5.4: Examples of infiltration/runoff calculation using the Boughton (1989) model for different values of net rainfall and overall retention capacity, $V_{\text {soil }}$, calculated from different soil depths (topsoil+subsoil) and assuming that soil texture is $15 \%$ clay and $25 \%$ sand. Rock fragment content was $25 \%$ and $40 \%$ for the topsoil and subsoil, respectively.}
\end{figure}
where $\Psi_{w}$ is the matric potential at the wetting front. The total cumulative infiltrated water $I_{c}$ at time $t$ is the time integral of $i_{c}$, and is also equal to the $L_{w}$ multiplied by the change in water, i.e. $\Delta \theta=\theta_{\text {sat }}-\theta_{\text {dry }}$ :
\[
I_{c}=\Delta \theta L_{w}
\]

The infiltration rate can also be expressed as the time derivative of $I_{c}$, i.e.:
\[
i_{c}=\frac{d I_{c}}{d t}=\Delta \theta \frac{d L_{w}}{d t}
\]

Combining the two equations for $i_{c}$ we obtain:
\[
\Delta \theta \frac{d L_{w}}{d t}=K_{\text {sat }}\left[\frac{\left|\Psi_{w}\right|}{L_{w}}+1\right]
\]
and substituting $I_{c} / \Delta \theta$ for $L_{w}$ gives:
\[
\frac{d I_{c}}{d t}=K_{s a t}\left[\frac{\left|\Psi_{w}\right| \Delta \theta}{I_{c}}+1\right]
\]

By rearranging terms and integrating we obtain an expression for $I_{c}(t)$ :
\[
I_{c}(t)=K_{s a t} t+\left|\Psi_{w}\right| \Delta \theta \ln \left[1+\frac{I_{c}(t)}{\left|\Psi_{w}\right| \Delta \theta}\right]
\]

This equation defines the cumulative infiltration to time $t$ as a function of $K_{s a t}, \Psi_{w}, \theta_{s a t}$ and $\theta_{d r y}$. Because $I_{c}$ appears on both sides of the equation, it must be found using numerical root-finding (the Newton-Raphson method in our case). To estimate $\Psi_{w}$ the following equation is used:
\[
\Psi_{w}=\left(\frac{2 b+3}{2 b+6}\right) \Psi_{s a t}
\]

Parameter $\theta_{d r y}$ is the volumetric content of the topmost soil layer (antecendent soil conditions), and parameters $\theta_{\text {sat }}, \Psi_{\text {sat }}, K_{\text {sat }}$ and $b$ are estimated using Campbell's water retention curves from the texture of the topmost layer. The infiltration time $t$ (in $h$ ) is estimated from the sum of net rainfall ( $P r_{\text {net }}$ ) and runon ( $R o$ ) (both in $m m$ ) using rainfall intensity of the rainfall event ( $R_{i n t}$; in $m m / h$ ). The Green \& Ampt (1911) model is available in function hydrology_infiltrationGreenAmpt() and examples of its behavior are given in the figure below.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-066.jpg?height=808&width=1662&top_left_y=523&top_left_x=230}
\captionsetup{labelformat=empty}
\caption{Figure 5.5: Examples of infiltration using the Green-Ampt (1911) model for different values of net rainfall. The left panel shows the infiltration for different soil textural types, assuming a $\theta_{d r y}=0.3$. The right panel shows the infiltration for different values of $\theta_{d r y}$, assuming a silt loam soil. In both cases rainfall intensity is assumed $R_{\text {int }}=6 \mathrm{~mm} / \mathrm{h}$.}
\end{figure}

\subsection*{5.7 Soil water flows}

\subsection*{5.7.1 Design of soil water flows}

In this chapter we describe water movement into, out of, and within the soil. The water input to the soil is the sum of net rainfall ( $P r_{n e t}$, i.e. rainfall minus interception), snow melt ( $S m$ ) and (if simulations are done in a spatially-explicit context) runon from an adjacent location (Ro). Water movement can be performed using either the common single domain model (soilDomains = "single") or the dual permeability model (soilDomains = "dual"), which follows with some modifications the MACRO model (Jarvis et al. 1991; Larsbo et al. 2005).

In the single-domain model (panel A in Fig. 5.6), the water coming from rainfall events - i.e. sum of net rainfall ( $P r_{n e t}$ ) and run-on ( $R o$ ) - is divided between infiltration into the soil ( $I f$ ) and runoff ( $R u$ ), following the models explained in 5.6. Rainfall infiltrating into the soil is divided among soil layers, in a crude attempt to emulate the effect of preferential flows (but without accounting for the increase in infiltration caused by macropores). The amount of water reaching each soil layer is modelled using an extinction function that depends on macroporosity (see function hydrology_infiltrationRepartition). In contrast to water from rainfall events, water from snow melt ( $S m$ ) is assumed to infiltrate slowly and completely into the first layer. Water flows within the soil according to the Richards equation, assuming an homogenous porous media and where fluxes are driven by both gravitational and matric potentials. Root water uptake/redistribution is taken into account as source/sinks from/to the soil layers along with bare soil evaporation. Water leaving
the bottom layer (as well as departures from the water balance) is assumed to drain beyond the soil limits (i.e. deep drainage $(D d)$ ). Saturation excess in the topmost layer leads to an increase in runoff ( $R u$ ) and a corresponding decrease in infiltration ( $I f$ ).
In the dual-permeability model (panel B in Fig. 5.6), total porosity is partitioned into two separate flow regions (matrix and macropores), each with its own degree of saturation, conductivity and flow rate. The water coming from rainfall events - i.e. sum of net rainfall ( $P r_{n e t}$ ) and run-on ( $R o$ ) - is divided between infiltration into the soil matrix ( $I f$; following models in 5.6) and water infiltrating into the macropore domain. Water from snow melt ( Sm ) is assumed to infiltrate slowly and completely into the soil matrix. Fluxes within the soil matrix follow the Richards equation and is driven by both gravity and matric potentials, as in the single-domain model. In contrast, fluxes in the macropore region are gravity-driven only. Saturation of micropores of a given soil matrix layer leads to a water source into the corresponding macropore layer, whereas water uptake by the soil matrix via capillarity from the corresponding macropore layer follows a diffusion equation. Root water uptake/redistribution is taken into account as source/sinks in the soil matrix along with bare soil evaporation. Deep drainage ( $D d$ ) can occur from both the soil matrix or the macropore domain. Finally, saturation excess in the macropore domain leads to accumulation of water in the above layer and, eventually, to surface runoff ( $R u$ ).

\section*{A) SINGLE DOMAIN}
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-067.jpg?height=677&width=485&top_left_y=1090&top_left_x=284)

\section*{B) DUAL-PERMEABILITY}
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-067.jpg?height=703&width=1049&top_left_y=1092&top_left_x=786)

Figure 5.6: Schematic representation of the (A) single domain and (B) dual-permeability models of flows into, out of and within the soil. Symbols are defined in the main text.

Function hydrology_soilWaterBalance() performs infiltration and vertical water movement flows, given a soil, net rainfall, snowmelt and source/sink vector for each layer. Source/sink terms are defined as follows for the first layer ( $i=1$ ):
\[
S_{1}=-E s-T r_{h e r b, 1}-E x_{w o o d y, 1}
\]
and for $1<i \leq N$ :
\[
S_{i}=-\operatorname{Tr}_{\text {herb }, i}-E x_{\text {woody }, i}
\]
where $E s$ is bare soil evaporation, $T r_{\text {herb }, i}$ is herbaceous uptake from layer $i$ and $E x_{\text {woody }}$ is woody plant uptake/redistribution from/to layer $i$. All right-hand terms are converted from $\mathrm{mm} / \mathrm{day}$ to instantaneous rates $(m / s)$ for proper units in $S$. By default, 24 time steps of 1 hour are used for vertical water simulation of each day, but the time step is modified if required to close the water balance of the matrix or macropore domains. Function hydrology_soilWaterBalance() updates soil moisture and returns daily fluxes corresponding to infiltration, runoff and deep drainage.

The following sections detail the formulation and numerical solving of soil flows, both under the single-domain and the dual-permeability models.

\subsection*{5.7.2 Darcian flow and Richards equation}

Water flows in the soil from high to low potential as described by Darcy's law. In the soil matrix, the total potential is used, i.e. the sum of the matric potential ( $\Psi_{s}$, here expressed in $m$, see 2.3.3) and vertical depth $z$ (also in $m$ ). The vertical depth $z$ is taken as positive in the upward direction, so that $z=0$ is the ground surface. In the vertical dimension the flux $Q$, i.e. rate of water movement (in $m s^{-1}$ ), according to Darcy's law is:
\[
Q=-K(\theta) \cdot \frac{\delta(\Psi+z)}{\delta z}=-K(\theta) \cdot \frac{\delta \Psi}{\delta z}-K(\theta)
\]
where $K(\theta)$ is the hydraulic conductivity (in $m s^{-1}$ ) that describes the ease with which water can move through the porous media space, and depends on soil moisture ( $\theta$ ). In the macropore domain, only the vertical depth (i.e. gravity potential) is considered, which leads to a unit gradient, and hence the flux $Q$ is simply:
\[
Q=-K_{m a}\left(\theta_{m a}\right)
\]
where $K_{m a}$ is the macropore hydraulic conductivity (in $m s^{-1}$ ), depending on the macropore water content $\theta_{m a}$ (in $m^{3} \cdot m^{-3}$ ).

Consider a volume of soil with horizontal area $\Delta x \Delta y$, thickness $\Delta z$ and with non-rock proportion $\lambda=$ $1-P_{\text {rocks }}$. The mass flux entering the parcel from above is $\rho_{w} Q_{\text {in }} \Delta x \Delta y$ and the flux out of it is $\rho_{w} Q_{\text {out }} \Delta x \Delta y$. Conservation requires that the difference between fluxes and source/sinks equals the rate of change in water storage. The mass of water in the soil volume is $\rho_{w} \theta \Delta x \Delta y \Delta z \lambda$ so the change in water over a time interval $\Delta t$ is:
\[
\rho_{w} \frac{\Delta \theta}{\Delta t} \Delta x \Delta y \Delta z \lambda=-\rho_{w}\left(Q_{\text {in }}-Q_{\text {out }}\right) \Delta x \Delta y
\]
and gives the continuity equation:
\[
\frac{\Delta \theta}{\Delta t} \lambda=-\frac{\left(Q_{\text {in }}-Q_{\text {out }}\right)}{\Delta z}
\]
which expressed in the notation of calculus is:
\[
\frac{\delta \theta}{\delta t} \lambda=-\frac{\delta Q}{\delta z}
\]

Substituting Darcy's law for $Q$, and accounting for (lateral) sources/sinks $S$, gives the Richards equation:
\[
\frac{\delta \theta}{\delta t} \lambda=\frac{\delta}{\delta z}\left[K(\theta) \frac{\delta \Psi}{\delta z}+K(\theta)\right] \pm S=K(\theta) \frac{\delta^{2} \Psi}{\delta^{2} z}+\frac{\delta K}{\delta z} \frac{\delta \Psi}{\delta z} \frac{\delta K}{\delta z} \pm S
\]

The former is known as the mixed-form Richards equation, because it includes $\theta$ on the left hand and the vertical gradient in matric potential $\Psi$ on the right hand. The head-based or $\Psi$-based form expresses the left hand term using $\Psi$ as dependent variable:
\[
C(\Psi) \frac{\delta \Psi}{\delta t} \lambda=K(\Psi) \frac{\delta^{2} \Psi}{\delta^{2} z}+\frac{\delta K}{\delta z} \frac{\delta \Psi}{\delta z}+\frac{\delta K}{\delta z} \pm S
\]
where $C(\Psi)=\delta \theta / \delta \Psi$ is known as the specific moisture capacity, in $m^{-1}$. In the macropore domain, the use of the former equation is problematic; a major reason being the lack of information concerning the
relationship between $\Psi$ and $\theta$ close to saturation. If we assume capillarity to be negligible in the macropore domain, then $\delta \Psi / \delta z=0$ and the corresponding governing equation becomes:
\[
\frac{\delta \theta_{m a}}{\delta t} \lambda=\frac{\delta K_{m a}}{\delta z} \pm S
\]
where $\theta_{m a}$ and $K_{m a}$ are the soil moisture and soil conductivity, respectively, in the macropore domain.

\subsection*{5.7.3 Hydraulic properties in the single-domain model}

In single-domain simulations, the Van Genuchten (1980) model is used to represent the water retention curve (see section 2.3.2):
\[
\theta(\Psi)=\theta_{r e s}+\frac{\theta_{s a t}-\theta_{r e s}}{\left[1+|\alpha \cdot \Psi|^{n}\right]^{m}}
\]
where $m=1-1 / n$ is a shape parameter. It can be re-arranged into:
\[
S_{e}=\frac{\theta(\Psi)-\theta_{\text {res }}}{\theta_{\text {sat }}-\theta_{\text {res }}}=\left(1+|\alpha \cdot \Psi|^{n}\right)^{-m}
\]
where $S_{e}$ is the degree of saturation. The specific moisture capacity, $C(\Psi)$, is the derivative $\delta \theta / \delta \Psi$, i.e.:
\[
C(\Psi)=\alpha \cdot m \cdot n \cdot\left(\theta_{\text {sat }}-\theta_{\text {res }}\right) \cdot \frac{|\alpha \cdot \Psi|^{n-1}}{\left(1+|\alpha \cdot \Psi|^{n}\right)^{m+1}}
\]

The hydraulic conductivity $K(\Psi)$ for a given water potential $\Psi$ is determined in the Van Genuchten model as a function of $S_{e}$ using:
\[
K(\Psi)=K_{s a t} \cdot S_{e}^{l} \cdot\left[1-\left(1-S_{e}^{1 / m}\right)^{m}\right]^{2}
\]
where $K_{\text {sat }}$ is the saturated hydraulic conductivity and $l=0.5$ is the tortuosity factor.

\subsection*{5.7.4 Hydraulic properties in the dual-permeability model}

In MACRO (Jarvis et al. 1991; Larsbo et al. 2005), a "cut and join" approach is used to define the hydraulic functions. A water potential $\Psi_{b}=-0.1 \mathrm{~m}=-0.98 \mathrm{kPa}$ partitions the total porosity into matrix pores and macropores, while the corresponding water content, $\theta_{b}$ and hydraulic conductivity $K_{b}$ represent the saturated state of the soil matrix.

\section*{Matrix domain}

Soil water retention in the matrix is calculated using a modified form of Van Genuchten's (1980) equation:
\[
S_{m i}=\frac{\theta_{m i}(\Psi)-\theta_{\text {res }}}{\theta_{\text {sat }}^{\text {fict }}-\theta_{\text {res }}}=\left(1+|\alpha \cdot \Psi|^{n}\right)^{-m}
\]
where $\theta_{\text {sat }}^{\text {fict }}=\theta_{\text {sat }}-P_{\text {macro }}$ is a fictious saturated content obtained subtracting the proportion of macropores. $\theta_{b}$ is estimated as $\theta_{m i}\left(\Psi_{b}\right)$, whereas $K_{b}$ is estimated with van Genuchten's $K$ equation but using $S_{m i}\left(\Psi_{b}\right)$ instead of $S_{e}$. The capacitance in the matrix domain ( $C_{m i}$ ) is estimated using the same equation as the single domain model, but replacing $\theta_{\text {sat }}$ by $\theta_{\text {sat }}^{\text {fict }}$. Finally, the following form is used to describe the unsaturated hydraulic conductivity function in the matrix, using $K_{b}$ as the matching point:
\[
K_{m i}=K_{b} \cdot\left(\frac{S_{m i}}{S_{m i}\left(\Psi_{b}\right)}\right)^{l} \cdot\left[\frac{1-\left(1-S_{m i}^{1 / m}\right)^{m}}{1-\left(1-S_{m i}\left(\Psi_{b}\right)^{1 / m}\right)^{m}}\right]^{2}
\]
where $l=0.5$ is the tortuosity factor. For water potentials less negative that $\Psi_{b}$ the hydraulic conductivity is set to $K_{b}$.

\section*{Macropore domain}

In the macropore domain, the water potential is not defined and flow equations are expressed in $\theta$-based form. The degree of saturation in the macropores ( $S_{m a}$ ) is related to soil moisture in the macropores ( $\theta_{m a}$ ) via:
\[
S_{m a}=\frac{\theta_{m a}}{e_{m a}}
\]
where $e_{m a}=\theta_{s a t}-\theta_{b}$. The hydraulic conductivity function in the macropores ( $K_{m a}$ ) is given as a simple power law of the degree of saturation:
\[
K_{m a}=\left(K_{s a t}-K_{b}\right) \cdot S_{m a}^{n_{m a}}
\]
where $n_{m a}=2.23$ is a kinematic exponent reflecting macropore size distribution and tortuosity. Unlike in MACRO (Jarvis et al. 1991), the fact that macroporosity and macropore maximum hydraulic conductivity may not be constant but vary due to swelling and shrinkage is not taken into account.

\section*{Lateral flows}

In the beginning, or at any given step, if $\theta_{m i}>\theta_{b}$, the excess of water is transferred from the matrix to the macropore domain, i.e. it will be used as a source to increase $\theta_{m a}$. However, the macropores have a finite storage capacity for water, $C_{m a}$, equal to:
\[
C_{m a}=\left(1-S_{m a}\right) \cdot\left(\theta_{s a t}-\theta_{b}\right)
\]

Hence, the flow to the macropore domain is limited by $C_{m a}$. The reverse flow, i.e the water uptake by the unsaturated matrix is treated as a first-order approximation to a diffusion equation, assuming a rectangularslab geometry for the aggregates:
\[
U_{w}=\left(\frac{G_{w} \cdot D_{w} \cdot \gamma_{w}}{d^{2}}\right) \cdot\left(\theta_{b}-\theta_{m i}\right)
\]
where $d$ (in $m$ ) is an effective diffusion path length, $D_{w}$ (in $m^{2} s^{-1}$ ) is an effective water diffusivity that depends on $S_{m a}, G_{w}=3$ is a geometry factor and $\gamma_{w}=0.1$ is a scaling factor. See details in (Larsbo et al. 2005). Water uptake by the unsaturated matrix is treated as a source for the matrix domain and as a sink for the macropore domain.

\subsection*{5.7.5 Finite approximation to flows in the soil matrix}

Water movement in the soil matrix was taken from chapter 8 of Bonan (2019), and much of the present text has been summarized and adapted from this source, with modifications for the exchange with macropore moisture. The finite difference approximation for the Richards equation represents the soil as a network of $N$ discrete nodal points that vary in space and time. The network is presented in Fig. 5.7.
For reasons of numerical stability, Richards equation is solved using an implicit time discretization win which the spatial derivatives $\delta K / \delta z, \delta \Psi / \delta z$ and $\delta^{2} \Psi / \delta^{2} z$ are written numerically using a central difference approximation at time $n+1$, and the time derivative uses a backward difference approximation at $n+1$.

Soil layer $i$ has a thickness $\Delta z_{i}$. Water content $\theta_{i}$, matric potential $\Psi_{i}$ and hydraulic conductivity $K_{i}$ are defined at the center of the layer at depth $z_{i}$ and are uniform over the layer. Here $K_{i}$ values have been corrected by $\lambda_{i}$, to account for the fact that the amount of stones in the soil reduce the conductivity,

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-071.jpg?height=887&width=1218&top_left_y=894&top_left_x=439}
\captionsetup{labelformat=empty}
\caption{Figure 5.7: Schematic representation of network of soil nodes}
\end{figure}
which is expressed per soil area unit (so, in fact, all terms in the mass balance equations are multiplied by $\lambda_{i}$, except the source/sinks). Water inputs/outputs from other processes (i.e. infiltration, snow melt, bare soil evaporation, herbaceous transpiration and woody plant uptake/redistribution) are represented as a source/sink term $S_{i}$ for each node $i$. If simulations are done in the dual-permeability model, $S_{i}$ can include positive or negative terms due to saturation excess flow into the macropore domain or capillary imbibition from the macropore domain.

For a given intermediate layer $1<i<N$, the outward flux $Q_{i}$ between layers $i$ and $i+1$ is defined using:
\[
Q_{i}=-\frac{K_{i+1 / 2}}{\Delta z_{i+1 / 2}}\left(\Psi_{i}-\Psi_{i+1}\right)-K_{i+1 / 2}
\]
where $z_{i+1 / 2}=z_{i}-z_{i+1}$ and $K_{i+1 / 2}=0.5\left(K_{i}+K_{i+1}\right)$ replaces the vertically varying hydraulic conductivity within the two layers with an effective conductivity for an equivalent homogeneous medium. The inward flux $Q_{i-1}$ between layers $i-1$ and $i$ is defined similarly:
\[
Q_{i-1}=-\frac{K_{i-1 / 2}}{\Delta z_{i-1 / 2}}\left(\Psi_{i-1}-\Psi_{i}\right)-K_{i-1 / 2}
\]
where $z_{i-1 / 2}=z_{i-1}-z_{i}$ and $K_{i-1 / 2}=0.5\left(K_{i-1}+K_{i}\right)$. If we apply the fluxes to the water balance equation, with fluxes and capacitance expressed for time $n+1$, and considering the $S_{i}$ source/sink term (in $m s^{-1}$ ), we obtain the following $\Psi$-based form:
\[
\frac{\Delta z_{i}}{\Delta t} C_{i}^{n+1}\left(\Psi_{i}^{n+1}-\Psi_{i}^{n}\right) \lambda_{i}=\frac{K_{i-1 / 2}^{n+1}}{\Delta z_{i-1 / 2}}\left(\Psi_{i-1}^{n+1}-\Psi_{i}^{n+1}\right)-\frac{K_{i+1 / 2}^{n+1}}{\Delta z_{i+1 / 2}}\left(\Psi_{i}^{n+1}-\Psi_{i+1}^{n+1}\right)+K_{i-1 / 2}^{n+1}-K_{i+1 / 2}^{n+1}+S_{i}^{n+1}
\]

For the first layer ( $i=1$ ) the boundary condition is defined so that there is no inward flux (but a source/sink term is added), which yields the following $\Psi$-based form:
\[
\frac{\Delta z_{1}}{\Delta t} C_{1}^{n+1}\left(\Psi_{1}^{n+1}-\Psi_{1}^{n}\right) \lambda_{1}=-\frac{K_{1+1 / 2}^{n+1}}{\Delta z_{1+1 / 2}}\left(\Psi_{1}^{n+1}-\Psi_{2}^{n+1}\right)-K_{1+1 / 2}^{n+1}+S_{1}^{n+1}
\]

Finally, for the last layer ( $i=N$ ) a free drainage condition is specified as boundary condition, where $Q_{N}=K_{N}$, which yields the following $\Psi$-based form:
\[
\frac{\Delta z_{N}}{\Delta t} C_{N}^{n+1}\left(\Psi_{N}^{n+1}-\Psi_{N}^{n}\right) \lambda_{N}=\frac{K_{N-1 / 2}^{n+1}}{\Delta z_{N-1 / 2}}\left(\Psi_{N-1}^{n+1}-\Psi_{N}^{n+1}\right)+K_{N-1 / 2}^{n+1}-K_{N}^{n+1}+S_{N}^{n+1}
\]

Alternatively, if a water table depth is supplied and is equal or shallower than soil depth, the model can simulate capillarity rise by changing the lower boundary condition to that of a constant saturated layer (i.e. $\Psi_{N+1}=0$ ).
\[
\frac{\Delta z_{i}}{\Delta t} C_{N}^{n+1}\left(\Psi_{N}^{n+1}-\Psi_{N}^{n}\right) \lambda_{i}=\frac{K_{N-1 / 2}^{n+1}}{\Delta z_{N-1 / 2}}\left(\Psi_{N-1}^{n+1}-\Psi_{N}^{n+1}\right)-\frac{K_{N+1 / 2}^{n+1}}{\Delta z_{N+1 / 2}}\left(\Psi_{N}^{n+1}-0\right)+K_{N-1 / 2}^{n+1}-K_{N+1 / 2}^{n+1}+S_{N}^{n+1}
\]
where $K_{N+1 / 2}=0.5\left(K_{N}+K_{s a t}\right)$.
The numerical form of the $\Psi$-based Richards equation for a soil with $N$ layers is a tridiagonal system of $N$ equations with $N$ unknown values $\Psi$ at time $n+1$. An additional complexity is that $\Psi$ at $n+1$ also appears through $K$ and $C$. The solution requires linearizing with respect to $\Psi$ through various methods. Here the
predictor-corrector method is employed, a two-step solution that solves the equation twice (Haverkamp et al. 1977). The predictor step uses explicit linearization to solve for $\Psi$ over one-half of a full time step ( $\Delta t / 2$ ) at time $n+1 / 2$ with $K$ and $C$ from time $n$. The resulting values for $\Psi$ are used to evaluate $K$ and $C$ at $n+1 / 2$. The corrector step uses these to obtain $\Psi$ over the full time step ( $\Delta t$ ) at $n+1$. An implicit solution is used for the predictor step and the Crank-Nicolson method is used for the corrector step.

\subsection*{5.7.6 Finite approximation to flows in the macropore domain}

An implicit solution is used to discretize the local water balance in the macropores of a layer $i$, using:
\[
\frac{\theta_{m a, i}^{n+1}-\theta_{m a, i}^{n}}{\Delta t} \cdot \lambda_{i}=\frac{K_{m a, i-1}^{n+1}-K_{m a, i}^{n+1}}{\Delta z_{i}}+S_{i}^{n+1}
\]
since $\theta_{m a}$ is related to $S_{m a}$, we can re-express the previous equation into:
\[
S_{m a, i}^{n+1}=S_{m a, i}^{n}+\frac{\Delta t}{\lambda_{i} \cdot e_{m a, i}} \cdot\left(\frac{K_{m a, i-1}^{n+1}-K_{m a, i}^{n+1}}{\Delta z_{i}}+S_{i}^{n+1}\right)
\]

In this equation, $K_{m a, i-1}^{n+1}$ represents the conductivity of the layer above for the time step $n+1$, whereas the $K_{m a, i}^{n+1}$ is the conductivity of the current layer for the same time step, hence depending on $S_{m a, i}^{n+1}$. The local water balance is solved for each layer, in turn, from the soil surface downward, assuming a zero flow from the surface $K_{m a, 0}^{n+1}=0$ (infiltration into macropores is given by $S_{1}^{n+1}$ ). Then for any given layer $i, K_{m a, i-1}^{n+1}$ is already defined and a solution for $S_{m a, i}^{n+1}$ can be found using a bisection method (i.e. internal halving). After solving for all layers, if the capacity of macropores is exceeded in any given layer, the excess is added to the macropore storage of the layer above. Excess of the topmost layer results in runoff via saturation excess.

\section*{Chapter 6}

\section*{Woody plant transpiration, photosynthesis and water status}

This chapter describes how daily woody plant transpiration ( $T r_{\text {woody }}$ ) is modelled in the basic water balance model, completing the flows needed to evaluate eq. (3.5). The model uses the approach of BILJOU (Granier et al. 1999) to estimate woody maximum transpiration, and then divides this value among the contribution of plant cohorts and estimate actual transpiration depending on soil moisture and cohort functional parameters, which determine plant drought. The chapter also describes how is daily photosynthesis estimated, a process that in this model does not influence transpiration but is necessary for growth calculations (chapter 15).

\subsection*{6.1 Plant transpiration and photosynthesis}

\subsection*{6.1.1 Maximum transpiration}

Potential evapotranspiration ( $P E T$, in mm ) is assumed to represent open water evaporation potential. Maximum canopy transpiration $T r_{\text {woody, max }}$ depends on both $P E T$ and the amount of transpirating surface, i.e. the current cumulative $L A I$ of the woody vegetation, $L A I_{\text {woody }}^{\phi}$. To estimate $T r_{\text {woody, max }}$ the model uses the empirical equation of Granier et al. (1999), where $T r_{\text {woody, } \max } / P E T$ is a function of $L A I_{\text {woody }}^{\phi}$ :
\[
\frac{T r_{w o o d y, \max }}{P E T}=-0.006 \cdot\left(L A I_{w o o d y}^{\phi}\right)^{2}+0.134 \cdot L A I_{w o o d y}^{\phi}+0.036
\]

This equation has already been adopted for Mediterranean biomes (Fyllas \& Troumbis 2009; Ruffault et al. 2013).

Since medfate's ver. 2.1, empirical coefficients can be species-specific and Granier et al. (1999) empirical equation has been generalized to:
\[
\frac{T r_{w o o d y, \max }}{P E T}=T_{m a x, L A I} \cdot L A I_{w o o d y}^{\phi}+T_{m a x, s q L A I} \cdot\left(L A I_{w o o d y}^{\phi}\right)^{2}
\]
where $T_{\text {max }, L A I}$ and $T_{\text {max }, \text { sqLAI }}$ are species-specific parameters (if missing, they are given default values 0.134 and -0.006, respectively).

The maximum transpiration for a given plant cohort $i$ is calculated using the portion of $T r_{\text {max }}$ defined by $f_{i}$ the fraction of total absorbed SWR that is due to cohort $i$ (see section 4.2):
\[
T r_{\max , i}=T r_{w o o d y, \max } \cdot \frac{f_{i}^{0.75}}{\sum_{j} f_{j}^{0.75}}
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-076.jpg?height=968&width=968&top_left_y=241&top_left_x=577}
\captionsetup{labelformat=empty}
\caption{Figure 6.1: Empirical relationship between $T r_{\text {woody }, \max } / P E T$ and $L A I_{\text {woody }}^{\phi}$}
\end{figure}

Before ver 2.5.0 $T r_{\text {max }, i}$ was linearly related to $f_{i}$, but an exponent 0.75 is now used to decrease ad hoc the proportion of transpiration corresponding to cohorts absorbing high SWR fractions with respect to those absorbing low amounts of SWR, which has been found to better match the transpiration predicted using the advanced transpiration model. Note that the actual amount of radiation energy absorbed by plants is much more difficult to determine, involving diffuse and direct radiation, as well as net long-wave radiation (see chapter 9).

\subsection*{6.1.2 Actual plant transpiration and plant water potential}

Actual plant transpiration depends on soil moisture and is calculated for each plant cohort and each soil layer separately. $T r_{i, s}$ (in mm ) represents the transpiration made by cohort $i$ from layer $s$. Actual plant transpiration from a given layer is regulated by soil moisture and the resistance to water flow through the plant. For each plant cohort $i$ and soil layer $s$, the model first estimates the a whole-plant relative water transpiration, $K_{i, s}$, which varies between 0 and 1 depending on $\Psi_{\text {extract }, i}$, the potential at which transpiration is $50 \%$ of maximum, and $\Psi_{s}$, the water potential in layer $s$. This relationship is modelled using a Weibull function (see function hydraulics_psi2K()):
\[
K_{i, s}=K_{i}\left(\Psi_{s}\right)=\exp \left\{\ln (0.5) \cdot\left[\frac{\Psi_{s}}{\Psi_{\text {extract }, i}}\right]^{c_{\text {extract }, i}}\right\}
\]
where $c_{\text {extract }, i}$ is an exponent that modulates the steepness of the decrease in relative conductance when soil potential becomes negative and $\ln (0.5)$ is used to ensure that $K_{i}\left(\Psi_{\text {extract }, i}\right)=0.5$ (Fig. 6.2).

If cavitation has occurred in previous steps then the capacity of the plant to transport water is impaired. Hence $K_{i, s}$ from eq. (6.4) cannot be larger than the one-complement of the degree of conductance loss in the stem $\left(P L C_{\text {stem }, i}\right)$, so that:
\[
K_{i, s}^{P L C}=\min \left\{K_{i, s}, 1.0-P L C_{\text {stem }, i}\right\}
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-077.jpg?height=987&width=977&top_left_y=230&top_left_x=571}
\captionsetup{labelformat=empty}
\caption{Figure 6.2: Whole-plant relative water conductance functions for different water potential values ( $c_{\text {extract }}=3$ in all cases)}
\end{figure}
where $P L C_{\text {stem }, i}$ is the proportion of stem conductance lost for cohort $i$ (see 6.2.2).
Until ver 2.5.0, actual transpiration of plant cohort $i$ from a given soil layer $s, T r_{i, s}$, was defined as the product of (Mouillot et al. 2001): the maximum transpiration of the plant cohort ( $\operatorname{Tr}_{\max , i}$ ), the relative whole-plant transpiration ( $K_{i, s}^{P L C}$ ) corresponding to the species and water potential in layer $s$, and the proportion of plant fine roots in layer $s, F R P_{i, s}$ :
\[
T r_{i, s}=T r_{\max , i} \cdot K_{i, s}^{P L C} \cdot F R P_{i, s}
\]

Since ver 2.5.0, this equation has been slightly modified and is now:
\[
T r_{i, s}=T r_{\max , i} \cdot K_{i, s}^{P L C} \cdot \frac{K_{u n s a t, s}^{0.5} \cdot F R P_{i, s}}{\sum_{r} K_{u n s a t, r}^{0.5} \cdot F R P_{i, r}}
\]
where $K_{\text {unsat, } s}$ is the unsaturated soil conductivity of layer $s$. This modification was introduced to allow the plant to increase the amount of water drawn from layers with higher levels of moisture in seasons where the usual water pools are depleted. This formulation decreases the differences in soil moisture between soil layers, which in the advanced model is achieved thanks to hydraulic redistribution process.

The total amount of water transpired by woody cohort $i, T r_{i}(\mathrm{in} \mathrm{mm})$ is the sum of $T r_{i, s}$ values over all soil layers:
\[
T r_{i}=\sum_{s} T r_{i, s}
\]

Analogously, the total amount of water transpired by woody plants, $T r_{\text {woody }}$ (in mm ), is the sum of $T r_{i}$ values over all plant cohorts:
\[
T r_{w o o d y}=\sum_{i} T r_{i}=\sum_{s} \sum_{i} T r_{i, s}
\]

Assuming no water limitations (i.e. $K_{i, s}=1$ ), we have that $T r_{\text {woody }}=T r_{\text {woody }, \max }$ and $T r_{i}=T r_{\max , i}$. Cohort transpiration and stand transpiration will be lower than maximum values if soil water potential in any layer is negative enough to cause a significant reduction in whole-plant conductance. At the plant level, the transpiration of a given plant cohort will be lower than that of others if:
a. The cohort is under the shade (it reduces $f_{i}$ and hence $T r_{\max , i}$ )
b. The cohort has a lower amount of leaf area (it reduces $f_{i}$ and hence $T r_{\max , i}$ )
c. The soil layers exploited by the cohort have more negative water potentials (it reduces $K_{i, s}$ and $K_{i, s}^{P L C}$ ).

\subsection*{6.1.3 Plant water potential}

The basic water balance model does not allow estimating a water potential drop from soil to the leaf. Moreover, in a multilayered soil it is difficult to know what would be the water potential of the plant. Despite these limitations, a gross surrogate of 'plant' water potential ( $\Psi_{\text {plant }, i}$; in MPa) may be obtained averaging whole-plant relative conductance values across soil layers and inverting the whole-plant relative transpiration function:
\[
\Psi_{\text {plant }, i}=K_{i}^{-1}\left(\sum_{s} K_{i, s} \cdot F R P_{i, s}\right)
\]
where $K_{i}^{-1}$ is the inverse of the relative whole-plant transpiration eq. (6.4). The plant water potential is used to determine plant stress levels and cavitation, as explained in 6.2.1 and 6.2.2.

Importantly, changes in $\Psi_{\text {plant }, i}$ induce changes in plant water content (see section 10.3), which may induce a release of water in the transpiration stream or an absorption of water from it, which leads to the cohort transpiration, $T r_{i}$, being different from its water extraction from the soil, $E x_{i}$.

\subsection*{6.1.4 Minimum transpiration}

The description of actual transpiration in the previous section incorporates the assumption that plants can regulate water losses up to zero transpiration, neglecting water leaks through the leaf cuticule and/or incomplete stomatal closure (Duursma et al. 2018). To avoid this assumption we can estimate minimum transpiration for a given plant cohort, $T r_{\min , i}$ (in mm), and prevent $T r_{i}<T r_{\min , i}$.
Minimum transpiration flow per leaf area $E_{\min }$ in $\mathrm{mol} H_{2} O \cdot s^{-1} \cdot m^{-2}$ ) can be calculated if we know (1) the minimum leaf conductance to water vapor ( $g_{s w, \min }$; in $\mathrm{mol} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2}$ ); (2) the leaf vapor pressure deficit $\left(V P D_{\text {leaf }}\right.$; in $\left.k P a\right)$; and (3) atmospheric pressure ( $P_{a t m}$; also in $k P a$ ):
\[
E_{\min }=g_{s w, \min } \cdot \frac{V P D_{l e a f}}{P_{a t m}}
\]

In turn, the vapor pressure deficit in the leaf $\left(V P D_{\text {leaf }}\right)$ is calculated as:
\[
V P D_{l e a f}=e_{l e a f}-e_{a i r}
\]

Where $e_{\text {air }}$ is the water vapor pressure of the air surrounding the leaf (but beyond the leaf boundary layer) and $e_{\text {leaf }}$ is the vapor pressure inside the leaf. While $e_{\text {air }}$ can be derived from the weather input, $e_{\text {leaf }}$ should be calculated from leaf temperature ( $T_{\text {leaf }}$ ) and leaf water potential ( $\Psi_{\text {leaf }}$ ):
\[
e_{\text {leaf }}\left(T_{\text {leaf }}, \Psi_{\text {leaf }}\right)=e_{\text {sat }}\left(T_{\text {leaf }}\right) \cdot \exp \left\{\frac{2.17 \cdot \Psi_{\text {leaf }}}{T_{\text {leaf }}+273.15}\right\}
\]
where $e_{\text {sat }}(T)$ is a function giving the saturated vapor pressure for temperature $T$ (see utility functions of the meteoland reference manual). Given the simplicity of the basic water balance model, here we make the assumption that $\Psi_{\text {leaf }}=\Psi_{\text {plant }}$ (from the previous time step). Furthermore, we assume that leaf
temperature is coupled with the temperature of the surrounding air. Given the non-linearity of $e_{\text {leaf }}$ we average the wapor pressure values provided by $e_{\text {leaf }}\left(T_{\min }, \Psi_{\text {plant }}\right)$ and $e_{\text {leaf }}\left(T_{\max }, \Psi_{\text {plant }}\right)$.
Once the leaf level $E_{\text {min }}$ is known for a give cohort $i$, we can scale this instantaneous rate to daily transpiration (in mm ) at the cohort level using:
\[
\operatorname{Tr}_{\min , i}=E_{\min , i} \cdot 24 \cdot 3600 \cdot L A I_{i}^{\phi} \cdot 0.018
\]

\subsection*{6.1.5 Transpiration with water pools}

Considering water pools (i.e. setting rhizosphereOverlap $=$ "partial" or rhizosphereOverlap $=$ "total" in the control parameters) involves partitioning the stand area into fractions corresponding to the abundance of each plant cohort. More specifically, the model defines as many plant water pools as plant cohorts, with proportions defined by their LAI values. For example, the fraction corresponding to plant cohort $j$ would be:
\[
f_{\text {pool }, j}=\frac{L A I_{j}^{\text {live }}}{L A I_{\text {stand }}^{\text {live }}}
\]

Overall soil moisture is then related to moisture of plant water pools by the following equation, that is fulfilled for each soil layer $s$ :
\[
W_{s}=\sum_{j} f_{p o o l, j} \cdot W_{j, s}
\]
where $W_{j, s}$ is the soil moisture (relative to field capacity) of layer $s$ in the water pool of cohort $j$, i.e. under the area of the stand attributed to cohort $j$.
When transpiration occurs and water pools are considered, the model assumes that the rhizosphere of each plant cohort occupies its own water pool, but may enter into the water pools under other plant cohorts if the overlap is partial. In other words, the root systems of different cohorts may overlap horizontally. A given plant cohort $i$ will have its roots in layer $s$ partitioned among different water pools. Let us assume that we know $f r_{i, s, j}$, the (horizontal) proportion of fine roots of cohort $i$ in layer $s$ of the water pool $j$ (see section 2.4.8). These proportions sum one when summed across water pools:
\[
\sum_{j} f r_{i, s, j}=1 \forall i, s
\]

The proportion of fine roots in a given water pool, with respect to the whole root system, will then be equal to:
\[
F R P_{i, s, j}=f r_{i, s, j} \cdot F R P_{i, s}
\]

Estimating transpiration with water pools is analogous to estimating transpiration without them, but replacing the role of $F R P_{i, s}$ by $F R P_{i, s, j}$, and $K_{i, s}$ by $K_{i, s, j}$, in eq. (6.7), which leads to the estimation of $T r_{i, s, j}$. Analogous replacements have to be made when estimating the plant water potential in eq. (6.10).
Finally, note that the amount of water extracted from the soil layer $s$ of given water pool $j$ (i.e. from $W_{j, s}$ ) will not be $T r_{i, s, j}$ (whose units are referred to the overall stand) but $T r_{i, s, j} / f_{p o o l, j}$.

\subsection*{6.1.6 Plant photosynthesis}

Because it is useful for growth, and for compatibility with the 'Sperry' transpiration mode (chapter 7), the water balance model using 'Granier' transpiration mode also calculates gross assimilated carbon. Gross photosynthesis for a given plant cohort $i$ (in $g C \cdot m^{-2}$ ) is estimated as a function of transpiration:
\[
A_{g, i}=T r_{i} \cdot W U E_{\max , i} \cdot\left(L_{i}^{P A R}\right)^{W U E_{P A R, i}} \cdot\left(1-e^{W U E_{C O 2, i} \cdot C_{a i r}}\right) \cdot V P D^{W U E_{V P D}}
\]
where $T r_{i}$ is the transpiration of plant cohort $i, W U E_{\max , i}$ is the maximum water use efficiency of the cohort (in $g C \cdot m m^{-1}$ ) - a species-specific parameter where WUE assumed to be estimated under conditions
of $V P D=1 k P a$, no atmospheric CO2 limitations and maximum light availability -; $L_{i}^{P A R}$ is the proportion of photosynthetically-active radiation available at the mid-crown of cohort $i$, according to the Beer-Lambert extinction model; $C_{\text {air }}$ is the atmospheric CO2 concentration (in ppm); $V P D$ is the vapor pressure deficit (in kPa ); $W U E_{C O 2, i}$ and $W U E_{V P D, i}$ are species-specific coefficients regulating the influence of CO2 concentration and VPD on WUE, respectively; and $W U E_{P A R, i}$ is a species-specific exponent indicating how relative WUE decreases with lower light levels.

Different effects are taken into account in the estimation of gross photosynthesis (eq. (6.19)). The dependency of photosynthesis on drought stress is represented in the $T r_{i}$ term, whereas the dependency on $C O_{2}$ concentration is given by the negative exponential term and the progressive reduction of photosynthesis under higher $V P D$ (assuming a reduction of stomatal conductance but the same water flow) is modelled using negative $W U E_{V P D, i}$ exponents. Finally, the reduction of photosynthesis due to low light availability (for cohorts in the understory) is represented by the reduction of relative WUE given by low values of $L_{i}^{P A R}$ :

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-080.jpg?height=809&width=1630&top_left_y=826&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 6.3: Relationship between the percentage of PAR available to a cohort and the water use efficiency (left) or the water use efficiency relative to the maximum value observed in the stand for the same species (right). WUE values were estimated using the advanced water balance model and a non-linear regression was fitted.}
\end{figure}

\subsection*{6.2 Plant drought stress and cavitation}

\subsection*{6.2.1 Daily drought stress}

Similarly to Mouillot et al. (2002), daily drought stress of a given plant cohort $i, D D S_{i}$, is defined as the one-complement of relative whole-plant transpiration (see eq. (6.4)) estimated from its plant water potential $\left(\Psi_{\text {plant }, i}\right)$ :
\[
D D S_{i}=\phi_{i} \cdot\left(1-K_{i}\left(\Psi_{\text {plant }, i}\right)\right)
\]

Leaf-phenological status is included to prevent winter deciduous plants from suffering drought stress during winter. Daily drought stress values can be later used to define other drought stress indices for larger temporal scales.

\subsection*{6.2.2 Cavitation and hydraulic recovery}

The water balance model is normally run assuming that although soil drought may reduce transpiration, embolized xylem conduits are automatically refilled when soil moisture recovers (in other words, cavitation is reversible and stemCavitationRecovery $=$ "total"). It is possible to simulate irreversible cavitation by setting stemCavitationRecovery $=$ "none", stemCavitationRecovery $=$ "rate" or stemCavitationRecovery = "annual" in the control parameters. Any of these options cause the model to keep track of the maximum value of cavitation so far experienced using the proportion of of lost conductance for leaves and the stem the plant cohort $i\left(P L C_{\text {leaf }, i}\right.$ and $\left.P L C_{\text {stem }, i}\right)$, which are modelled from $\Psi_{\text {plant }}$ using Weibull functions:
\[
\begin{aligned}
P L C_{\text {leaf }, i} & =\max \left\{P L C_{\text {leaf }, i}, 1-\exp \left\{\left[\frac{\Psi_{\text {plant }, i}}{d_{\text {leaf }}}\right]^{c_{\text {leaf }}}\right\}\right\} \\
P L C_{\text {stem }, i} & =\max \left\{P L C_{\text {stem }, i}, 1-\exp \left\{\left[\frac{\Psi_{\text {plant }, i}}{d_{\text {stem }}}\right]^{c_{\text {stem }}}\right\}\right\}
\end{aligned}
\]

For simulations of less than one year one can use stemCavitationRecovery $=$ "none" to keep track of the maximum cavitation. However, for simulations of several years, it is normally advisable to allow recovery. If stemCavitationRecovery $=$ "annual", $P L C_{\text {leaf }, i}$ and $P L C_{\text {stem }, i}$ values are set to zero at the beginning of each year, assuming that embolized plants overcome the conductance loss by creating new xylem tissue. Finally, if stemCavitationRecovery = "rate" the model simulates stem refilling at daily steps as a function of symplasmic water potential. First, a daily recovery rate ( $r_{\text {refill }}$; in $\mathrm{cm}^{2} \cdot \mathrm{~m}^{-2} \cdot d a y^{-1}$ ) is estimated as a function of $\Psi_{\text {plant }, i}$ :
\[
r_{\text {refill }}\left(\Psi_{\text {plant }, i}\right)=r_{\max , \text { refill }} \cdot \max \left\{0.0,\left(\Psi_{\text {plant }, i}+1.5\right) / 1.5\right\}
\]

Where $r_{\text {max }, \text { refill }}$ is the control parameter cavitationRecoveryMaximumRate indicating a maximum refill rate. The right part of the equation normalizes the water potential, so that $r_{\text {refill }}=r_{\text {refill, max }}$ if $\Psi_{\text {plant }, i}=0$ and $r_{\text {refill }}=0$ if $\Psi_{\text {plant }, i}<=-1.5 M P a$. The proportion of conductance lost in stems and leaves is then updated using:
\[
\begin{aligned}
P L C_{\text {leaf }, i} & =\max \left\{0.0, P L C_{\text {leaf }, i}-\left(r_{\text {refill }} / H_{v}\right)\right\} \\
P L C_{\text {stem }, i} & =\max \left\{0.0, P L C_{\text {stem }, i}-\left(r_{\text {refill }} / H_{v}\right)\right\}
\end{aligned}
\]
where $H_{v}$ is the Huber value (sapwood area to leaf area ratio) in units of $\mathrm{cm}^{2} \cdot \mathrm{~m}^{-2}$.

\section*{Part III}

Advanced water balance modelling

\section*{Chapter 7}

\section*{Advanced water balance model}

This chapter provides an overview of the advanced water and energy balance model available in medfate. It shares some characteristics with the basic water balance model described in previous chapters. Like the previous one, the model is run using function spwb(), for a set of days, or function spwb_day(), for a single day. Compared to the basic model, the advanced water balance model adds more detail in some processes (radiation transfer, plant hydraulics and photosynthesis) and incorporates other processes that were missing (canopy/soil energy balances and plant water balance). Importantly, two alternative approaches are possible regarding plant hydraulics and stomatal conductance sub-models:
- If transpirationMode $=$ "Sperry", the sub-models of plant hydraulics and stomatal conductance follow Sperry et al. (2017) and were described in detail in De Cáceres et al. (2021).
- If transpirationMode $=$ "Sureau", the sub-models of plant hydraulics and stomatal conductance follow SurEau-ECOS and were described in Ruffault et al. (2022).

The following model overview is structured as in chapter 3. Process formulations shared with the basic water balance model were presented in previous chapters and will not be repeated. The chapters following this one provide a detailed description of those sub-modules that are exclusive of the advanced model. Whenever necessary, we will detail the difference between the two sub-models of plant hydraulics and stomatal conductance corresponding to De Cáceres et al. (2021) and Ruffault et al. (2022). We recommend readers to familiarize themselves with basic water balance modelling processes before reading this and the subsequent chapters. In addition, users of this model should have a background on the processes implemented to fully understand and exploit model outputs. Since the scope of this book is focused on the model, interested readers should address relevant eco-physiological bibliography complement the material exposed here.

\subsection*{7.1 About Sureau}

SurEau is a comprehensive plant hydraulic model that already knows different versions. The first and most detailed version was developed in C by Hervé Cochard (Sureau.c, Cochard et al. (2021)), which follows a preliminary version coded in Excell and in R that has been used to understand the stomatal functioning of plants around the world (Martin-StPaul et al. 2017).
In Sureau.c, the plant is relatively well detailed (large roots, trunk, branches, leaves, buds and even flowers). The numerical resolution of the calculations is done according to an explicit scheme, where the elementary transfers of water between each compartment must be calculated at very small time-steps to avoid numerical instabilities known as the Courant-Friedrichs-Lewy condition (for a tree time step must be around 0.001s). This complexity is an advantage for exploring questions about the physiological functioning of the tree. However, the computational demand is also a limit for large-scale application of the model and for integration in dynamic vegetation or land surface models.

Researchers from INRAE-URFM (François Pimont, Julien Ruffault, Nicolas Martin-StPaul at Avignon) and INRAE-PIAF (Hervé Cochard, at Clermont-Ferrand) therefore joined forces to develop a new version, coded in $R$ native, where the numerical scheme for solving water transport calculations was improved (SurEau-Ecos, Ruffault et al. (2022)). They implemented two alternative resolution schemes (the so called semi-implicit and implicit) allowing to solves the water transport accounting for capacitance and cavitation at much larger time steps (of the order of 10 to 30 minutes). In this version the authors also used a tree simplified to only two organs: leaves and stems (and therefore four compartments with an apoplasm and a symplasm for each organ) to facilitate parameterization. This advance has been decisive for medfate because it made the model compatible in terms of plant structure and and computational demand. In medfate we refer to Sureau when this model is used for the computation of transpiration and plant water related processes.

\subsection*{7.2 Design principles}

The model performs soil/plant water balance and soil/canopy energy balance for a given forest stand and for the period corresponding to input weather data. Soil water balance is calculated on a daily step basis whereas energy balances and plant transpiration are determined at subdaily steps (typically 1 h steps). The model considers only the vertical spatial dimension of the stand, and not the horizontal distribution of plants within it. Still, the forest stand is divided into: (a) canopy vertical layers; (b) woody plant cohorts of different species and a herbaceous layer.

Hydrological processes are the same as in chapter 3. Thus, the model includes water interception loss (Gash et al. 1995; Liu 2001), plant transpiration, evaporation from soil (Ritchie 1972), transpiration of the herbaceous layer, infiltration into the soil matrix (Green \& Ampt 1911; Boughton 1989) and vertical water movement within the soil (Jarvis et al. 1991; Larsbo et al. 2005).

A great deal of the complexity of the advanced model concerns the estimation of woody plant transpiration and photosynthesis. The model simulates stomatal regulation of gas exchange separately for sunlit and shade leaves at sub-daily steps, involving detailed calculations of plant hydraulics, leaf energy balance and photosynthesis. Compared to the basic water balance model of chapter 3, the higher level of complexity of the advanced model allows a more precise estimation of carbon and water flows, as well as a more nuanced evaluation of plant water status.

To calculate radiation balance and incident PAR at the leaf level, the leaf area of each plant cohort is divided into vertical layers according to its crown limits. Photosynthesis and transpiration of sunlit and shade leaves are treated separately (De Pury \& Farquhar 1997). Given an input direct and diffuse short-wave irradiance at the top of the canopy, the amount of light absorbed by sunlit leaves, shade leaves and the soil follows the model of Anten \& Bastiaans (2016). The scheme for long-wave radiation transfer between the atmosphere, the different canopy layers and the soil follows the SHAW model (Flerchinger et al. 2009).

Energy balances are conducted at two levels: the canopy (or canopy layers) level and the leaf level. The model keeps track of temperature variation within the canopy (i.e. canopy energy balance) and in the uppermost soil surface (i.e. soil energy balance) as the result of energy exchanges between them and with the atmosphere. Heat conduction also occurs among soil layers. Energy balance can be performed assuming a single canopy layer, with soil and canopy energy balance equations being similar to those of Best et al. (2011) for JULES. Alternatively, energy balance can be conducted for each vertical layer following Bonan et al. (2014). In this case, the model allows considering within-canopy gradients in temperature, water vapor pressure, and $C O_{2}$ as well as the turbulent transport of heat, water vapor and $C O_{2}$ between canopy layers (Ma \& Liu 2019), determined using a canopy turbulence model by Katul et al. (2004).

The model also performs the energy balance at the leaf level to determine transpiration. At this scale, radiation inputs include shortwave radiation from the atmosphere absorbed by the leaf and the net balance of long-wave radiation. Leaf temperature is determined assuming that the temperature of the surrounding air is that of the canopy (or canopy layer). After determining stomatal regulation, the model up-scales the transpiration flux to the canopy (or canopy layer) scale and the corresponding latent heat is used to complete the calculation of the energy balance at the canopy (or canopy layer) level. Latent heat fluxes from
evaporation from the soil and evaporation of intercepted rainfall are also included in the canopy/soil energy balances.

Plant hydraulics and stomatal regulation follow different designs depending on the sub-model employed:
- If transpirationMode = "Sperry", plant hydraulics follows the steady-state approach of Sperry et al. (1998) model, and stomatal regulation follows the profit maximization approach of Sperry et al. (2017).
- If transpirationMode = "Sureau", plant water compartments are always included, and water flows follow Darcy's law, as described in Ruffault et al. (2022). In this case, stomatal regulation follows a Jarvis-type model.

Like in the basic water model, the advanced model assumes by default that soil moisture under all plant cohorts is the same (i.e. water sources corresponding to vertical soil layers are shared among cohorts). However, variations in soil moisture beneath plant cohorts (and, implicitly, horizontal variation of soil moisture) can be simulated. In this case, hydrological processes are replicated for the fraction of soil corresponding to each cohort. Transpiration of each plant cohort depends on the soil moisture beneath itself and, depending on root overlap, on the soil moisture beneath other plant cohorts.

\subsection*{7.3 State variables}

The following are state variables in the model under all simulations:
- Cumulative degree days (a) to budburst, (b) to complete unfolding or (c) to senescence ( $S_{\text {eco, } d}, S_{u n f, d}$ or $S_{\text {sen }, d}$; all in ${ }^{\circ} C$ ), are tracked by the model to determine leaf phenological status (see 4.1).
- Daily soil moisture content dynamics on each layer $s$ are tracked using $W_{s}=\theta_{s}\left(\Psi_{s}\right) / \theta_{f c, s}$, the proportion of soil moisture in relation to field capacity, where moisture at field capacity, $\theta_{f c, s}$, is assumed to correspond to $\Psi_{f c}=-0.033 \mathrm{MPa}$. Note that $W_{s}$ values larger than one are possible if the soil is between field capacity and saturation (which can happen if deep drainage is not allowed).
- The air temperature within the canopy ( $T_{c a n} ;{ }^{\circ} \mathrm{C}$ ) and the temperature of each soil layer $s\left(T_{s o i l, s} ;{ }^{\circ} \mathrm{C}\right)$ are tracked for every subdaily step.

Additional state variables depend on the activation of specific control flags (see subsection 7.6.3):
- If transpirationMode $=$ "Sureau", the model also tracks $\Psi_{\text {apo }, \text { stem }, i}$, the water potential of the stem apoplastic compartment, as well as the water potential of stem and leaf symplastic compartments, $\Psi_{\text {symp }, \text { stem }, i}$ and $\Psi_{\text {symp }, \text { leaf }, i}$ respectively.
- If stem cavitation is not completely reversible, the model tracks $P L C_{\text {stem }, i}$ and $P L C_{\text {leaf }, i}$, the proportion of conductivity lost the stem and leaves, respectively, of plants of cohort $i$.
- If plant water pools are considered, the model also tracks $W_{i, s}$, the proportion of soil moisture in relation to field capacity for layer $s$ within the areal fraction of stand covered by cohort $i$.
- If multi-layer canopy energy balance is activated, the model tracks for each vertical layer $j \in\{1, l\}$ :
a. Air temperature, $T_{a i r, j}$
b. Water vapor pressure, $e_{a i r, j}$
c. $C O_{2}$ concentration, $C_{a i r, j}$.

\subsection*{7.4 Water and energy balances}

\subsection*{7.4.1 Water balance}

The water balance equations for the soil and snowpack of the advanced model are essentially the same as introduced in section 3.3, with some minor modifications. Although the advanced water balance model includes hydraulic redistribution, this does not change the total amount of water in the soil, so the water balance equation is is very similar to that of the basic water balance model (eq.(3.5)), but where woody plant water uptake ( $E x_{\text {woody }}$ ) is used instead of woody transpiration ( $T r_{\text {woody }}$ ).
\[
\Delta V_{\text {soil }}=(I f+L w+C r)-\left(D d+S e+E s+T r_{\text {herb }}+E x_{\text {woody }}\right)
\]
where all the other terms were defined in 3.3. Soil water extraction ( $E x_{\text {woody }}$ ) and plant transpiration ( $T r_{\text {woody }}$ ) will be equal if capacitance effects are not considered. Otherwise the amount of water stored in the woody plant tissues changes according to:
\[
\Delta V_{\text {plant }}=E x_{\text {woody }}-T r_{\text {woody }}
\]

Variations can occur depending on specific control flags, as explained in section 3.3. Unlike the basic water balance, in this model water balance components contributing to latent heat of vaporization (plant transpiration, evaporation from soil surface and rainfall intercepted by canopy surfaces) or latent heat of fusion (snow melt) are included in the energy balance equations of the canopy and soil, therefore coupling water and energy balances.

\subsection*{7.4.2 Single-layer canopy energy balance}

For the sake of performing energy balance, the canopy can be considered a single layer that exchanges energy with the soil and the atmosphere (Best et al. 2011). First, it absorbs shortwave radiation from the atmosphere ( $K_{a b s, c a n}$ ) and long-wave radiation resulting from net radiation balance ( $L_{n e t, c a n}$ ). Other energy fluxes considered are convective exchanges between the canopy and atmosphere ( $H_{\text {can,atm }}$ ) and between the canopy and the soil ( $H_{\text {can,soil }}$ ). Energy is absorbed from the canopy through latent heat of vaporization ( $L E_{\text {vap }, \text { can }}$ ) produced via transpiration ( $\operatorname{Tr}$ ) and evaporation of water intercepted by the canopy ( $I n$ ); or via latent heat of fusion due to snow melt ( $L E_{\text {fus,snow }}$ ). Combining all energy flows (all of them in $W \cdot m^{-2}$ ), the instantaneous energy balance equation for the canopy is:
\[
T C_{c a n} \cdot \frac{\delta T_{c a n}}{\delta t}=K_{a b s, c a n}+L_{n e t, c a n}-L E_{v a p, c a n}-L E_{f u s, s n o w}-H_{c a n, a t m}-H_{c a n, s o i l}
\]
where $T C_{c a n}$ is the canopy thermal capacitance (in $J \cdot m^{-2} \cdot K^{-1}$ ).

\subsection*{7.4.3 Multiple-layer canopy energy balance}

Alternatively, the model allows performing an energy balance for each vertical layer in the canopy, including its heat storage capacity (Ma \& Liu 2019). The energy balance equation for canopy layer $j$ is:
\[
T C_{j} \cdot \frac{\delta T_{a i r, j}}{\delta t}=K_{a b s, j}+L_{n e t, j}-L E_{v a p, j}+H_{j}
\]
where $K_{a b s, j}$ is the short-wave radiation absorbed by leaves in the layer, $L_{n e t, j}$ is the net long-wave radiation balance of the layer, $L E_{\text {vap }, j}$ is the latent heat flux and $H_{j}$ is the sensible heat flux, which includes heat coming from leaves or soil surfaces as well as turbulent heat transport from adjacent layers. Latent heat of fusion ( $L E_{\text {fus,snow }}$ ) needs to be subtracted from the bottom layer. Finally, $T C_{j}$ is the thermal capacitance (in $J \cdot m^{-2} \cdot K^{-1}$ ) of canopy layer $j$.

\subsection*{7.4.4 Soil energy balance}

Like the canopy, the uppermost soil layer absorbs short-wave radiation from the atmosphere ( $K_{a b s, s o i l}$ ) and has a net long-wave radiation balance ( $L_{\text {net,soil }}$ ). The uppermost soil layer also exchanges heat with the canopy ( $H_{\text {can,soil }}$ ) and releases energy in the form of latent heat of vaporisation due to evaporation from the soil surface ( $L E_{\text {vap }, \text { soil }}$ ). Finally, the soil layer exchanges thermal energy by conduction with the layer below ( $G_{1,2}$ ) The energy balance equation for the uppermost soil layer is:
\[
T C_{s o i l, 1} \cdot \frac{\delta T_{s o i l, 1}}{\delta t}=K_{a b s, s o i l}+L_{n e t, s o i l}+H_{c a n, s o i l}-L E_{v a p, s o i l}-G_{1,2}
\]
where $T C_{\text {soil, } 1}$ is the thermal capacitance of soil layer 1 (the uppermost layer).
Instantaneous soil temperature changes on each soil layer depend on the balance between upward and downward energy flows. The downward energy flow for the uppermost soil layer depends on its energy exchanges with the canopy and the atmosphere, as shown in eq. (7.5), whereas the remaining energy flows are generated by heat conduction and depend on the temperature gradients between soil layers. The energy balance for a soil layer $s>1$ is:
\[
T C_{s o i l, s} \cdot \frac{\delta T_{s o i l, s}}{\delta t}=G_{s-1, s}-G_{s, s+1}
\]
where $G_{s-1, s}$ is the energy inflow from layers above, $G_{s, s+1}$ is the energy outflow towards layers below and $T C_{\text {soil,s }}$ is the thermal capacitance of soil layer $s$ (in $J \cdot m^{-2} \cdot K^{-1}$ ).

Unlike Best et al. (2011), the model considers the snow pack and the uppermost soil layer as a single layer in terms of energy exchange, but treats this layer differently depending on whether snow is present or not. The snow pack absorbs shortwave radiation (section 5.2) and snow melt is included as latent heat in the energy balance, but the snow layer does not exchange long-wave radiation with the soil nor the atmosphere. $K_{a b s, s o i l}$ is set to zero when snow pack is present (because shortwave radiation is absorbed by snow), but the soil layer still exchanges long-wave radiation and convective energy with the canopy and the atmosphere. In addition, remember that bare soil evaporation does not occur when the snow pack is present (section 5.4).

\subsection*{7.5 Process scheduling}

For every day to be simulated, the model performs the following steps:
1. Update leaf area values according to the phenology of species and recalculate radiation extinction (sections 4.1 and 4.2).
2. Determine rainfall interception loss ( $I n$ ) and net rainfall ( $P r_{n e t}$ ) (section 5.3). The amount of water reaching the soil surface from the rainfall event is the sum of net rainfall ( $P r_{n e t}$ ) and surface runon (Ro), if given. If snow dynamics are included, increase snow pack from snow precipitation ( $P s$ ) and decrease it following snow melt $(S m)$ (section 5.2).
3. Determine bare soil evaporation ( $E s$ ), if snow is not present (section 5.4), and herbaceous transpiration ( $T r_{\text {herb }}$; section 5.5).
4. Determine sub-daily air temperature and direct/diffuse irradiance variations (chapter 8).
5. Determine the proportion of sunlit/shade leaves (section 9.1.2), the shortwave radiation absorbed by plant cohorts (sections 9.1.3 and the soil (section 9.1.4) at sub-daily steps.
6. If transpirationMode $=$ "Sperry", update the water supply function of each plant cohort, according to the hydraulic model and the current soil water potential (chapter 10).
7. Determine instantaneous plant cohort transpiration, photosynthesis rates and close soil/canopy energy balance at sub-daily steps (chapters 12 and 13). This involves the following actions for each sub-daily step:
a. Determine long-wave radiation exchange between soil, canopy layers and atmosphere (section 9.2).
b. If transpirationMode = "Sperry", for each woody cohort:
i. Calculate leaf energy balance and photosynthesis (for shade and sunlit leaves of each plant cohort) corresponding to each transpiration value of the supply function (section 11.1). If plant capacitance effects are considered this concerns the stem-to-leaf hydraulic supply function.
ii. Determine stomatal conductance, transpiration and photosynthesis on shade and sunlit leaves of each plant cohort according to Sperry's (2017) profit maximization strategy (section 12.1.2).
c. If transpirationMode = "Sureau", for each plant cohort repeat the following in small sub-steps (e.g. 10 min ):
i. Perform energy balance of sunlit and shade leaves (section 11.1), according to the current transpiration flow.
ii. Re-estimate leaf and stem cuticular transpiration.
iii. Re-estimate stomatal regulation, transpiration and photosynthesis for sunlit and shade leaves. iv. Update water potentials, flows and conductances across the hydraulic network.
d. Scale transpiration ( $T r_{\text {woody }}$ ) and net photosynthesis ( $A_{n}$ ) from sunlit/shade leaves to the plant cohort level (section 12.3).
e. Scale water extraction from soil layers ( $E x_{\text {woody }}$ ) to the woody plant cohort level.
f. Complete energy balance of the canopy and the soil, after translating plant transpiration, evaporation from bare soil, snow melt and interception loss to latent heat and calculating convective heat exchange for both the canopy and the soil. Alternatively, perform energy balance for individual canopy layers, while including turbulent heat exchange and turbulent transport of water vapor and $C O_{2}$ between layers (chapter 13).
8. Determine day-level photosynthesis and transpiration from instantaneous rates and update soil moisture (section 14.1). Determine drought stress for each woody plant cohort (section 14.3).
9. Determine rainfall infiltration (section 5.6) and vertical water movement within the soil, while considering soil layer source/sinks from infiltration, bare soil evaporation and herbaceous transpiration and woody plant extraction/redistribution (section 5.7). This updates soil moisture and lower boundary condition of water movement corresponds to deep drainage ( $D d$ ).
10. If fire hazard calculations are requested, estimate live and dead fuel moisture and potential fire behaviour (chapter 24).

Steps 1-3 are the same as described in the basic model, and steps 9-10 here correspond to steps 5-6 in the basic model. The set of steps corresponds to simulations if plant water pools are not considered, so that only the water balance of the overall soil matters. If plant water pools are considered, steps 1,2 and 10 are the same, because they apply to the whole forest stand (note that at present infiltration does not depend on antecedent conditions). However, steps 3 is performed for each water pool separately because it depends on antecedent soil moisture. Steps 6-8 also involve defining woody plant water uptake from different plant water pools depending on the proportion of fine roots of each woody cohort in each pool (see 6.1.5). Soil water flows from these three steps are then averaged at the stand level. After that, Step 9 is performed on the soil corresponding to each pool, and the resulting drainage estimates are also averaged. Finally, the soil moisture of the overall soil is estimated by averaging the soil moisture of water pools.

\subsection*{7.6 Inputs and outputs}

\subsection*{7.6.1 Soil, vegetation and meteorology}

\section*{Soil}

Soil input requirements are the same as for the basic water balance model and were fully described in section 2.3. Genuchten (1980) water retention curves are forced for this model, because rhizosphere conductance is modelled using van Genuchten hydraulic equations (see subsection 10.2).

\section*{Vegetation}

Vegetation input requirements were fully described in section 2.4. Trees and shrubs do not need to be characterized with different variables in soil water balance calculations, since both kinds of cohort have a $L A I$ value. In most cases, users only need to estimate the leaf area index corresponding to live leaves, i.e. $L A I^{\text {live }}$, because normally at the starting point all leaves are expanded (i.e. $L A I^{\phi}=L A I^{\text {live }}$ ) and one can assume no dead leaves in the canopy (i.e., $L A I^{\text {dead }}=0$ ). Vegetation characteristics stay constant during simulations using function $\operatorname{spwb}()$, although the actual expanded leaf area $\left(L A I^{\phi}\right)$ and dead leaf area may vary if the species is winter deciduous.

\section*{Meteorology}

The minimum weather variables required to run the model are $\min / \max$ temperatures ( $T_{\min }$ and $T_{\max }$ ), min/max relative humidity ( $R H_{\text {min }}$ and $R H_{\text {max }}$ ), precipitation ( $P$ ) and solar radiation ( $R a d$ ). Wind speed ( $u$ ) is also needed, but the user may use missing values if not available (a default value will be used in this case). Wind speed is assumed to have been measured at a specific height above the canopy (by default at 2 m ). Atmospheric $C O_{2}$ concentration ( $C_{a t m}$ ) may also be specified, but if missing a default constant value is assumed, which is taken from the control parameters. Definitions and units of these variables were given in section 2.5.

\subsection*{7.6.2 Vegetation functional parameters}

The advanced water balance model requires many functional parameters to be specified for plant cohorts. A first set of parameters refers to leaf phenology (paramsPhenology):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline \multirow[b]{2}{*}{LD} & & \multicolumn{2}{|l|}{Phenologyäfpehenology type (oneflush-evergreen, progressive-evergreen, winter-deciduous, winter-semideciduous)} \\
\hline & years & \multicolumn{2}{|l|}{LeafDurationge duration of leaves (in years).} \\
\hline $S_{\text {eco }}^{*}$ & ${ }^{\circ} \mathrm{C}$ & Sgdd & Degree days corresponding to leaf budburst (see section 4.1.2). \\
\hline $T_{\text {eco }}$ & ${ }^{\circ} \mathrm{C}$ & Tbgdd & Base temperature for the calculation of degree days to leaf budburst (see section 4.1.2). \\
\hline $S_{\text {sen }}^{*}$ & ${ }^{\circ} \mathrm{C}$ & Ssen & Degree days corresponding to leaf senescence (see section 4.1.3). \\
\hline & hours & & Photoperiod corresponding to start counting senescence degree-days (see section 4.1.3). \\
\hline $T_{\text {sen }}$ & ${ }^{\circ} \mathrm{C}$ & Tbsen & Base temperature for the calculation of degree days to leaf senescence (see section 4.1.3). \\
\hline
\end{tabular}

A second set of functional parameters relate to light extinction and water interception (paramsInterception):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $\lambda_{\text {leaf }}$ & degrees & & LeafAnglEhe (average) angle between the leaf plane and the horizontal plane (i.e. leaf zenith angle) \\
\hline $k_{P A R}$ & (unitless) & kPAR & Extinction coefficient for diffuse PAR \\
\hline $\alpha_{S W R}$ & [0-1] & & alphaSWBShort-wave radiation leaf absorbance coefficient \\
\hline $\gamma_{S W R}$ & [0-1] & gamma & \\
\hline $s_{\text {water }}$ & $m m \mathrm{H}_{2} \mathrm{O}$ ů $L A \mathrm{~g}^{-1}$ & & Crown water storage capacity (i.e. depth of water that can be retained by leaves and branches) per LAI unit \\
\hline
\end{tabular}

A third set includes parameters related to plant anatomic and morphological attributes (paramsAnatomy):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $H_{\text {med }}$ & cm & Hmed & Median plant height \\
\hline $1 / H_{v}$ & $m^{2} \cdot m^{-2}$ & Al2As & Ratio of leaf area to sapwood area \\
\hline $L W$ & cm & LeafWidth & Leaf width \\
\hline SLA & $m^{2} \cdot k g^{-1}$ & SLA & Specific leaf area \\
\hline $\rho_{\text {leaf }}$ & $g \cdot \mathrm{~cm}^{-3}$ & LeafDensity & Leaf tissue density \\
\hline $\rho_{\text {wood }}$ & $g \cdot \mathrm{~cm}^{-3}$ & WoodDensity & Wood tissue density \\
\hline $\rho_{\text {fineroot }}$ & $g \cdot \mathrm{~cm}^{-3}$ & & FineRootDensithine root tissue density \\
\hline $S R L$ & $\mathrm{cm} \cdot g^{-1}$ & SRL & Specific root length \\
\hline RLD & $\mathrm{cm} \cdot \mathrm{cm}^{-3}$ & RLD & Fine root length density (i.e. density of root length per soil volume) \\
\hline $r_{6.35}$ & & r635 & Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm \\
\hline
\end{tabular}

A fourth set of parameters are related to transpiration and photosynthesis (paramsTranspiration):

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $g_{\text {swmin }}$ & $\mathrm{mol} \mathrm{H}_{2} \mathrm{O} \cdot$ $s^{-1} \cdot m^{-2}$ & Gwmin & Minimum stomatal conductance to water vapour \\
\hline $g_{\text {swmax }}$ & mol $\mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ & Gwmax & Maximum stomatal conductance to water vapour \\
\hline $J_{\text {max,298 }}$ & umole . $m^{-2} \cdot s^{-1}$ & Jmax298 & Maximum rate of electron transport at 298 K \\
\hline $V_{\text {max }, 298}$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & Vmax298 & Rubisco's maximum carboxylation rate at 298 K \\
\hline $K_{\text {stem,max,ref }}$ & $\mathrm{kg} \cdot \mathrm{s}^{-1}$. $m^{-1}$. $M P a^{-1}$ & & Kmax_stemxylemMaximum stem sapwood reference conductivity per leaf area unit \\
\hline $K_{\text {root,max,ref }}$ & $\mathrm{kg} \cdot \mathrm{s}^{-1}$. $m^{-1}$. $M P a^{-1}$ & & Kmax_rootxylemMaximum root sapwood reference conductivity per leaf area unit \\
\hline $k_{\text {leaf,max }}$ & mmol . $s^{-1} \cdot m^{-2}$. & VCleaf_kmax & Maximum leaf conductance (per leaf area unit) \\
\hline $k_{\text {stem,max }}$ & mmol . $s^{-1} \cdot m^{-2}$. & VCstem_kmax & Maximum stem conductance (per leaf area unit) \\
\hline $k_{\text {root }, \text { max }, s}$ & $M P a^{-1}$ mmol . $s^{-1} \cdot m^{-2}$. $M P a^{-1}$ & VCroot_kmax & Maximum root conductance (per leaf area unit) for each soil layer \\
\hline $k_{\text {rhizo,max,s }}$ & mmol . $s^{-1} \cdot m^{-2}$. & VGrhizo_kmax & Maximum hydraulic conductance of the rhizosphere for each soil layer \\
\hline $c_{\text {leaf }}, d_{\text {leaf }}$ & $M P a^{-1}$ (unitless), MPa & VCleaf_c, VCleaf_d & Parameters of the vulnerability curve for leaves (Weibull) \\
\hline $\Psi_{50, \text { leaf }}$, slope $_{\text {leaf }}$ & MPa , $\% / \mathrm{MPa}$ & VCleaf_P50, VCleaf_slope & Parameters of the vulnerability curve for leaves (Sigmoid) \\
\hline $c_{\text {stem }}, d_{\text {stem }}$ & (unitless), MPa & VCstem_c, VCstem_d & Parameters of the vulnerability curve for stem xylem (Weibull) \\
\hline $\Psi_{50, \text { stem }}$, slope $_{\text {stem }}$ & MPa , $\% / \mathrm{MPa}$ & VCstem_P50, VCstem_slope & Parameters of the vulnerability curve for stem xylem (Sigmoid) \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $c_{\text {root }}, d_{\text {root }}$ & (unitless), MPa & VCroot_c, VCroot_d & Parameters of the vulnerability curve for root xylem (Weibull) \\
\hline slope $_{\text {root }}$ & MPa , & VCroot_P50, & Parameters of the vulnerability curve for root xylem (Sigmoid) \\
\hline $T_{g s, \text { optim }}$ & ${ }^{\circ} \mathrm{C}$ & Gs_Toptim & Temperature corresponding to maximal stomatal conductance (Sureau sub-model) \\
\hline $T_{g s, \text { sens }}$ & & Gs_Tsens & Stomatal sensitivity to temperature (Sureau sub-model) \\
\hline $\Psi_{50, g s}$ & MPa & Gs_P50 & Water potential causing $50 \%$ reduction in stomatal conductance (Sureau sub-model) \\
\hline slope $_{\text {gs }}$ & $\% / \mathrm{MPa}$ & Gs_slope & Rate of decrease in stomatal conductance at $\Psi_{50, g s}$ (Sureau sub-model) \\
\hline
\end{tabular}

It is important to mention that stem- and root-level hydraulic conductances (i.e. $k_{\text {stem, max }}$ and $k_{\text {root, max }}$ ) are not given as inputs by the user, but are the result from scaling tissue-level conductivity parameters (i.e. $K_{\text {stem, max,ref }}$ and $K_{\text {root, max,ref }}$ ) according to plant size (see A.4.1 and A.4.3 for details). Similarly, parameters of Weibull vulnerability curves are estimated from the input in form of $\Psi_{50}, \Psi_{12}$ and $\Psi_{88}$ available in SpParams. The slope of the Sigmoid vulnerability curves can also be estimated from the same values, or provided by the user directly as a column in SpParams.
A fifth (final) set of parameters are related to water storage and water relations in plant tissues (paramsWaterStorage):

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $L F M C_{\text {max }}$ & \% & maxFMC Maximum live fuel moisture content, corresponding to fine fuels (< 6.35 mm twigs and leaves). \\
\hline $\epsilon_{\text {leaf }}$ & MPa & LeafEPS Modulus of elasticity of leaves \\
\hline $\epsilon_{\text {stem }}$ & MPa & StemEPS Modulus of elasticity of symplastic xylem tissue \\
\hline $\pi_{0, \text { leaf }}$ & MPa & LeafPIO Osmotic potential at full turgor of leaves \\
\hline $\pi_{0, \text { stem }}$ & MPa & StemPIO Osmotic potential at full turgor of symplastic xylem tissue \\
\hline $f_{\text {apo,leaf }}$ & [0-1] & LeafAF Apoplastic fraction in leaf tissues \\
\hline $f_{\text {apo }, \text { stem }}$ & [0-1] & StemAF Apoplastic fraction in stem tissues \\
\hline $V_{\text {leaf }}$ & $l \cdot m^{-2}$ & Vleaf Leaf water capacity per leaf area unit \\
\hline $V_{\text {sapwood }}$ & $l \cdot m^{-2}$ & Vsapwoodapwood water capacity per leaf area unit \\
\hline
\end{tabular}

Vegetation functional attributes are normally filled for each cohort by function spwbInput() or forest2spwbInput() from species identity. However, different parameters can be specified for different cohorts of the same species if desired (see section 2.4.9).

\subsection*{7.6.3 Control parameters}

Control parameters modulate the overall behaviour of water balance simulations (see section 2.6). There are three key control parameters:
1. transpirationMode defines the transpiration model. If transpirationMode $=$ "Sperry" or transpirationMode = "Sureau" then the advanced water balance model is run with the corresponding plant hydraulics and stomatal regulation sub-models. In advanced water balance models, the water retention curve model is forced to be that of Van Genuchten, i.e. soilFunctions = "VG" (see section 2.3.2).
2. multiLayerBalance is a boolean flag to indicate that multi-layer energy balance is desired (by default multiLayerBalance $=$ FALSE).

Other relevant control parameters relevant for the advanced water balance model are:
- ndailysteps [= 24]: Number of steps into which each day is divided for determination of soil water balance, stomatal conductance, transpiration and photosynthesis ( 24 equals 1-hour intervals).
- nsubsteps_canopy [= 3600]: Defines the number of substeps for multi-layer energy balance calculations. By default, substeps are 1 sec if ndailysteps $=24$.
- soilDomains [= "single"]: Either "single" (for single domain) or "dual" (for dual-permeability) (see section 5.7).
- max_nsubsteps_soil [= 300]: Maximum number of substeps for soil water balance solving.
- defaultWindSpeed [= 2.5]: Default value for wind speed (in $m \cdot s^{-1}$ ) when this is missing (only used for leaf fall, see section 4.1).
- defaultCO2 [=386]: Default atmospheric (abovecanopy) $C O_{2}$ concentration (in micromol $C O_{2} \cdot \mathrm{~mol}^{-1}$ $=\mathrm{ppm})$. This value will be used whenever $C O_{2}$ concentration is not specified in the weather input.
- defaultRainfallIntensityPerMonth $[=c(1.5,1.5,1.5,1.5,1.5,1.5,5.6,5.6,5.6$, $5.6,5.6,1.5)]$ : A vector of twelve values indicating the rainfall intensity ( $\mathrm{mm} / \mathrm{h}$ ) per month. By default synoptic storms ( $1.5 \mathrm{~mm} / \mathrm{h}$ ) are assumed between December and June, and convective storms ( $5.6 \mathrm{~mm} / \mathrm{h}$ ) are assumed between July and November (Miralles et al. 2010).
- snowpack [= TRUE]: Whether dynamics of snow pack are included (see section 5.2).
- leafPhenology [= TRUE]: Whether leaf phenology is simulated for winter-deciduous species (see section 4.1). If FALSE then all species are assumed to be evergreen.
- bareSoilEvaporation [= TRUE]: Whether evaporation from the soil surface is simulated (see section 5.4).
- interceptionMode [= "Gash1995"]: Infiltration model, either "Gash1995" or "Liu2001"; see section 5.3.
- infiltrationMode [= "GreenAmpt1911"]: Infiltration model, either "GreenAmpt1911" or "Boughton1989"; see section 5.6.
- sapFluidityVariation [= TRUE]: Flag to indicate that temperature affects sap fluidity (see 10.2.3).
- windMeasurementHeight [= 200]: Distance (in cm) above the top of the canopy corresponding to the measurement of wind speed.
- boundaryLayerSize [= 2000]: Size of the canopy boundary layer (in cm). The boundary layer causes the model to define vertical layers above the top of the canopy. The parameter is only relevant when multi-layer canopy energy balance is performed.
- unlimitedSoilWater [=FALSE]: Boolean flag to indicate the simulation of plant transpiration assuming that soil water is always at field capacity.
- interceptionMode [= "Gash1995"]: Infiltration model, either "Gash1995" or "Liu2001".
- infiltrationMode [= "Green-Ampt"]: Infiltration model, either "Green-Ampt" or "Boughton".
- rhizosphereOverlap [="total]: A string indicating the degree of rhizosphere spatial overlap between plant cohorts:
- "none" - no overlap (independent water pools).
- "partial" - partial overlap determined by coarse root volume.
- "total" - total overlap (plants extract from common soil pools).
- thermalCapacityLAI [= 1000000]: Canopy thermal capacitance per LAI unit (see section 13.1.3).
- verticalLayerSize [= 100]: The size of vertical layers (in cm ) for leaf area distribution and light extinction calculations (see section 2.4.6).
- segmentedXylemVulnerability [=TRUE]: If FALSE leaf and root vulnerability curves will be equal to those of stem.
- leafCavitationRecovery / stemCavitationRecovery [= "rate"]: A string indicating how to model recovery of xylem conductance (see section 12.4). Allowed values are:
- "none" - no recovery.
- "annual" - complete recovery every first day of the year.
- "total" - instantaneous complete recovery.
- "rate" - following a rate of new leaf or sapwood formation.
- cavitationRecoveryMaximumRate [= 0.05]: Maximum rate of conductance recovery (see section 12.4).

A set of parameters is only relevant for transpirationMode = "Sperry":
- leafCavitationEffects / stemCavitationEffects [= FALSE/TRUE]: A flag indicating whether cavitation effects on conductance of leaves and stem are applied.
- numericParams: A list with parameters for numerical approximation routines:
- maxNsteps [= 400] - Maximum number of steps in supply function.
- ntrial [=200] - Number of iteration trials when finding root of equation system.
- psiTol [= 0.0001] - Tolerance value for water potential.
- ETol [= 0.0001] - Tolerance value for flow.
whereas another set is only relevant for transpirationMode = "Sureau":
- plantCapacitance [= TRUE]: Whether the effect of (symplasmic or apoplasmic) plant water compartments is considered in simulations.
- leafCuticularTranspiration [= TRUE]: Whether the effect of leaf cuticular transpiration is considered in simulations.
- stemCuticularTranspiration [= TRUE]: Whether the effect of stem cuticular transpiration is considered in simulations.
- C_SApoInit $[=2.0 \mathrm{e}-5]$ : Maximum capacitance of the stem apoplasm ( $\mathrm{mmol} \cdot \mathrm{m}-2$ ).
- C_LApoInit $[=1.0 \mathrm{e}-5]$ : Maximum capacitance of the leaf apoplasm ( $\mathrm{mmol} \cdot \mathrm{m}-2$ ).
- k_SSym [= 0.26]: Conductance from stem apoplasm to stem symplasm ( $\mathrm{mmol} \cdot \mathrm{s}-1 \cdot \mathrm{~m}-2$ ).
- k_LSym [= 2.0]: Conductance from leaf apoplasm to leaf symplasm ( $\mathrm{mmol} \cdot \mathrm{s}-1 \cdot \mathrm{~m}-2$ ).
- gs_NightFrac $[=0.05]$ : Stomatal conductance at night as fraction of maximum stomatal conductance ([0-1]).
- stomatalSubmodel [= "Baldocchi"]: Stomatal regulation sub-model, either "Jarvis" or "Baldocchi".
- JarvisPAR [= 0.003]: Parameter regulating the response of stomatal conductance to light (PAR) in the Jarvis model.
- gCrown0 [= 0.150]: Reference crown conductance ( $\mathrm{mol} \cdot \mathrm{s}-1 \cdot \mathrm{~m}-2$ ).
- fTRBToLeaf $[=0.8]$ : Fraction of surface of bark exposed to air per leaf area.

Finally, a number of control parameters are used to modify how hydraulic parameters are estimated when calling function spwbInput():
- taper [= TRUE]: Whether taper of xylem conduits is accounted for when estimating aboveground stem conductance from xylem conductivity.
- fracRootResistance [= 0.40]: Fraction of plant total resistance (leaf+stem+root) that corresponds to root system.
- averageFracRhizosphereResistance [= 0.15]: Fraction to total continuum (stem+root+rhizosphere) resistance that corresponds to rhizosphere (averaged across soil water potential values).

\subsection*{7.6.4 Model output}

\subsection*{7.6.4.1 Daily output}

Functions spwb() and pwb() with transpirationMode = "Sperry" or transpirationMode = "Sureau" return a list of a class with the same name. The first four elements of this list (i.e., latitude, topography, weather and spwbInput) are simply copies of model inputs. The next element is spwbOutput, which contains the state of the input object at the end of the simulation (this can be used to perform further simulations starting with current values of state variables). The remainng elements are:

\begin{tabular}{|l|l|}
\hline Element & Description \\
\hline WaterBalance & Climatic input and water balance flows (i.e. net precipitation, infiltration, runoff, transpiration...). All of them in $m m=l \cdot m^{-2}$. \\
\hline EnergyBalance & Energy balance components (instantaneous values) for the soil and the canopy \\
\hline Temperature & Minimum and maximum temperature values for topsoil, canopy and atmosphere. Only returned if temperatureResults = TRUE. \\
\hline Soil & Soil variables for each soil layer: Moisture relative to field capacity ( $W_{s}$ ), water potential ( $\Psi_{s}$ ) and volumetric water content ( $V_{s}$ ). Only returned if soilResults $=$ TRUE. \\
\hline Stand & Stand-level variables, such as $L A I_{\text {stand }}^{\phi}, L A I_{\text {stand }}^{\text {dead }}$, the water retention capacity of the canopy ( $S_{\text {canopy }}$ ) or the fraction of light reaching the ground ( $L_{\text {ground }}^{\text {PAR }}$ and $L_{\text {ground }}^{\text {SWR }}$ ). Only returned if standResults = TRUE. \\
\hline Plants & Plant-level variables, such as $L A I_{i}^{\text {phi }}$, plant transpiration, plant water potential, etc. Only returned if plantResults $=$ TRUE. \\
\hline SunlitLeaves & Leaf-level output variables for sunlit leaves. Only returned if leafResults $=$ TRUE. \\
\hline ShadeLeaves & Leaf-level output variables for shade leaves. Only returned if leafResults $=$ TRUE. \\
\hline FireHazard & Fire hazard variables (fuel moisture, rate of spread, fire potentials, etc). Only returned if fireHazardResults = TRUE. \\
\hline
\end{tabular}

Compared to the output of the basic water balance 3.5.4, new output elements are produced. Many results are given as sub-elements of Plants, each of them a data frame with dates in rows and plant cohorts in columns:

\begin{tabular}{|l|l|l|l|}
\hline Element & Symbol & Units & Description \\
\hline LAI & $L A I^{\phi}$ & $m^{2} \cdot m^{-2}$ & Leaf area index (expanded). \\
\hline LAIlive & LAI ${ }^{\text {live }}$ & $m^{2} \cdot m^{-2}$ & Leaf area index (live). \\
\hline AbsorbedSWR & & MJ & Shortwave radiation absorbed per ground area. \\
\hline AbsorbedLWR & & MJ & Longwave radiation absorbed per ground area. \\
\hline Transpiration $T r$ & & mm & Transpiration per ground area. \\
\hline GrossPhotosynthesis & & $g C \cdot m^{-2}$ & Gross photosynthesis per ground area. \\
\hline NetPhotosynthels,is & & $g C \cdot m^{-2}$ & Net photosynthesis per ground area. \\
\hline dEdP & $d E / d \Psi_{\text {leaf }}$ & mmol . $s^{-1} \cdot m^{-2}$. $M P a^{-1}$ & Derivative of the (aboveground) supply function. \\
\hline PlantWaterBal & ance & mm & Internal daily plant water balance (balance of soil extraction and transpiration). \\
\hline LeafPsiMin & $\Psi_{m d}$ & MPa & Minimum (midday) 'average leaf' water potential. \\
\hline LeafPsiMax & $\Psi_{p d}$ & MPa & Maximum (predawn) 'average leaf' water potential. \\
\hline StemPsi & $\Psi_{\text {stem }}$ & MPa & Minimum stem water potential. \\
\hline RootPsi & $\Psi_{\text {rootcrown }}$ & MPa & Minimum root-crown water potential. \\
\hline RhizoPsi & $\Psi_{\text {rootsurf }, s}$ & MPa & Minimum root surface water potential for each soil layer. \\
\hline LeafPLC & $P L C_{\text {leaf }}$ & MPa & Proportion of leaf conductance loss. \\
\hline StemPLC & $P L C_{\text {stem }}$ & MPa & Proportion of stem conductance loss. \\
\hline LeafRWC & $R W C_{\text {leaf }}$ & \% & Mean leaf relative water content. \\
\hline StemRWC & $R W C_{\text {stem }}$ & \% & Mean stem relative water content. \\
\hline LFMC & LFMC & \% & Live fuel moisture content (as percent of dry weight), corresponding to fine fuels ( $<6.35 \mathrm{~mm}$ twigs and leaves). \\
\hline PlantStress & DDS & [0-1] & Drought stress level suffered by each plant cohort (relative whole-plant conductance). \\
\hline
\end{tabular}

The following table describes the child elements of SunlitLeaves and ShadeLeaves, each of them a data frame with dates in rows and plant cohorts in columns:

\begin{tabular}{|l|l|l|l|}
\hline Element & Symbol & Units & Description \\
\hline LeafPsiMin & $\Psi_{m d, i}^{\text {sunlit }}$, $\Psi_{m d, i}^{s h a d e}$ & MPa & Minimum (midday) (sunlit or shade) leaf water potential. \\
\hline LeafPsiMax & $\Psi_{p d, i}^{\text {sunlit }}$, $\Psi_{p d, i}^{\text {shade }}$ & MPa & Maximum (predawn) (sunlit or shade) leaf water potential. \\
\hline TempMin & Tsunlit $T_{\text {leaf }, \min }^{\text {sunit }}$, $T_{\text {leaf,min }}^{\text {shade }}$ & ${ }^{\circ} \mathrm{C}$ & Minimum leaf temperature. \\
\hline TempMax & $T_{\text {leaf }, \max }^{\text {sunit }}$, $T_{\text {leaf,max }}^{\text {shade }}$ & ${ }^{\circ} \mathrm{C}$ & Maximum leaf temperature. \\
\hline GSWMin & $g_{w, i}^{\text {sunlit }}$, $g_{w, i}^{\text {shade }}$ & $\mathrm{mol} \cdot \mathrm{s}^{-1}$. $m^{-2}$ & Minimum stomatal conductance to water vapour. \\
\hline GSWMax & $g_{w, i}^{\text {sunlit }}$, $g_{w, i}^{\text {shade }}$ & $\mathrm{mol} \cdot \mathrm{s}^{-1}$. $m^{-2}$ & Maximum stomatal conductance to water vapour. \\
\hline
\end{tabular}

The output of simulations can be inspected using plot, shinyplot and summary functions specific to spwb objects (examples are given in the corresponding package vignette).

\subsection*{7.6.4.2 Sub-daily output}

Calling function spwb_day() with the advanced water balance model results in sub-daily results for the simulated date. When running the advanced water balance model with function spwb() one can request sub-daily results to be included with the function output. This is done via setting subdailyResults $=$ TRUE in the control parameter list. In that case, the output list of spwb() will include an element subdaily, whose sub-elements correspond to the results of spwb_day() for each date simulated. Refer to the documentation of functions spwb_day() and transp_transpirationSperry() or transp_transpirationSureau() for details of sub-daily output.

\section*{Chapter 8}

\section*{Sub-daily atmospheric temperature and radiation variation}

After estimating leaf phenology (chapter 4) and simulating the main hydrological processes (chapter 5), the advanced water balance model (chapter 7) starts simulating subdaily processes, which include energy balances and photosynthesis/transpiration. In order to properly simulate these processes it is important to consider sub-daily variations in temperature and radiation. Here we detail how sub-daily estimates of above-canopy air temperature and atmospheric incoming radiation are derived from daily input values.

\subsection*{8.1 Above-canopy air temperature}

Above-canopy air temperature ( $T_{a t m}$, in ${ }^{\circ} C$ ) diurnal variations are modeled assuming a sinusoidal pattern with $T_{a t m}=T_{\min }$ at sunrise and $T_{a t m}=\left(T_{\min }+T_{\max }\right) / 2$ at sunset. Air temperature varies linearly between sunset and sunrise (McMurtrie et al. 1990). Sunrise and sunset hours are determined from latitude and sun declination (see section 4.2 of the reference manual for package meteoland).

\subsection*{8.2 Incoming diffuse and direct short-wave radiation}

Daily global radiation ( $R a d$, in $M J \cdot m^{-2} \cdot d^{-1}$ ) is assumed to include both direct and diffuse short-wave radiation (SWR). Using latitude information and whether is a rainy day, this quantity is partitioned into instantaneous direct and diffuse SWR and PAR for different daily substeps. Values of instantaneous direct and diffuse SWR and PAR above the canopy ( $I_{\text {beam }}$ and $I_{d i f}$, in $W \cdot m^{-2}$ ) are calculated using the methods described in Spitters et al. (1986), which involve comparing daily global radiation with daily potential radiation. All these calculations are performed using routines in package meteoland (see details in section 4.6 of the reference manual for this package).

\subsection*{8.3 Incoming long-wave radiation}

Once the above-canopy air temperature for a given time step is known, instantaneous long-wave radiation (LWR) coming from the atmosphere ( $L_{\text {atm }}$, in $W \cdot m^{-2}$ ) can be calculated following Campbell \& Norman (1998):
\[
L_{a t m}=\epsilon_{a} \cdot \sigma \cdot\left(T_{a t m}+273.16\right)^{4.0}
\]
where $T_{a t m}$ is air temperature, $\sigma=5.67 \cdot 10^{-8.0} \mathrm{~W} \cdot K^{-4} \cdot \mathrm{~m}^{-2}$ is the Stephan-Boltzmann constant and $\epsilon_{a}$ is the emmissivity of the atmosphere, calculated using:
\[
\begin{aligned}
\epsilon_{a} & =(1-0.84 \cdot c) \cdot \epsilon_{a c}+0.84 \cdot c \\
\epsilon_{a c} & =1.72 \cdot\left(\frac{e_{a t m}}{T_{a t m}+273.16}\right)^{1 / 7}
\end{aligned}
\]
where $e_{\text {atm }}$ is the average daily water vapor pressure (in kPa ; see 2.5 ) and $c$ is the proportion of clouds ( $c=1$ in rainy days and $c=0$ otherwise).

\section*{Chapter 9}

\section*{Radiation transfer}

Radiation transfer is not the same throughout the day, but changes with solar hour. This is represented using $\beta$, the solar elevation angle (see section 4.3 of the reference manual for package meteoland).

In the previous chapter we detailed sub-daily variation in temperature, direct radiation and diffuse short-wave radiation. Here we deal with the absorption of diffuse and direct shortwave radiation through the canopy as well as the long-wave radiation balance for canopy layers and the soil layer. These are necessary to estimate the different components of the canopy and soil energy balances (see eqs. (7.3), (7.4) and (7.5)) as well as to determine leaf energy balance, transpiration and photosynthesis (chapters 11 and 12). Short-wave radiation transfer can be determined for all sub-daily steps once the variation of atmospheric inputs are known. In contrast, the long-wave radiation (LWR) balance for any surface depends on its temperature and therefore, net LWR for canopy and soil layers need to be determined at each sub-daily step after closing the energy balance of the previous step (see chapter 13).

The vertical distribution of leaves in the stand is a key element of radiation transfer. As explained in section 2.4.6, the canopy is divided into vertical layers (whose size is determined by the control parameter verticalLayerSize), and the expanded and dead leaf area index of each cohort within each layer is determined. Let $l$ be the number of canopy layers, $c$ the number of plant cohorts, and $L A I_{i, j}^{a l l}=L A I_{i, j}^{\phi}+L A I_{i, j}^{d e a d}$ be the leaf area index of cohort $i$ in layer $j$.

\subsection*{9.1 Short-wave radiation}

In section 8.2 we explained how the model estimates instantaneous and direct/diffuse SWR and PAR at the top of the canopy. Given an input direct and diffuse short-wave irradiance at the top of the canopy, the amount of light absorbed by sunlit leaves, shade leaves and the soil follows the model of Anten \& Bastiaans (2016), which we detail in the following subsections.

\subsection*{9.1.1 Direct and diffuse irradiance across the canopy}

The average irradiance reaching the top of each canopy layer $j$ is calculated separately for direct beam and diffuse radiation (the same equations are valid for SWR or PAR, but with different coefficients):
\[
\begin{aligned}
I_{\text {beam }, j} & =\left(1-\gamma_{i}\right) \cdot I_{\text {beam }} \cdot \exp \left[\sum_{h=j+1}^{l} \sum_{i}^{c}-k_{b, i} \cdot \alpha_{i}^{0.5} \cdot L A I_{i, h}^{a l l}\right] \\
I_{d i f, j} & =\left(1-\gamma_{i}\right) \cdot I_{d i f} \cdot \exp \left[\sum_{h=j+1}^{l} \sum_{i}^{c}-k_{d, i} \cdot \alpha_{i}^{0.5} \cdot L A I_{i, h}^{a l l}\right]
\end{aligned}
\]
where $I_{\text {beam }}$ and $I_{\text {dif }}$ are the direct and diffuse irradiance at the top of the canopy (in $W \cdot m^{-2}$ ), $\gamma_{i}$ is the leaf reflectance ( $\gamma_{S W R, i}$ is an input parameter, whereas $\gamma_{P A R, i}=0.8 \cdot \gamma_{S W R, i}$ ), $k_{b, i}$ is the extinction coefficient of cohort $i$ for direct light, $k_{d, i}$ is the extinction coefficient of cohort $i$ for diffuse light (i.e. $k_{P A R, i}$ or $k_{S W R, i}$ ) and $\alpha_{i}$ is the absorbance coefficient ( $\alpha_{S W R, i}$ is an input parameter, whereas $\alpha_{P A R, i}=\alpha_{S W R, i} \cdot 1.35$ ).
Plant leaves are not disposed horizontally but have an inclination (i.e. a leaf angle $\lambda_{\text {leaf }}$ ) which may change from one species to the other and determines radiation extinction along with solar elevation. The extinction coefficient for direct light, $k_{b}$, depends on the leaf angle ( $\lambda_{\text {leaf }}$ ) and the solar elevation angle ( $\beta$ ), as described in Sellers (1985). First $\lambda_{\text {leaf }}$ is used to determine $\chi_{\text {leaf }}$, a parameter describing the departure of leaf angle distribution from the spherical distribution (which assumes all angles as equally probable):
\[
\chi_{\text {leaf }}\left(\lambda_{\text {leaf }}\right)=2.0 \cdot \cos \left(\lambda_{\text {leaf }}\right)-1.0
\]
$\chi_{\text {leaf }}$ equals 0 for +1 for horizontal leaves (i.e. for $\lambda_{\text {leaf }}=0$ degrees), 0 for random leaves (i.e. for $\lambda_{\text {leaf }}=60$ degrees) and -1 for vertical leaves (i.e. for $\lambda_{\text {leaf }}=90$ degrees). $\chi_{\text {leaf }}$ and $\beta$ are then used to estimate $G_{b}$ the relative projected area of leaves in the direction of the solar beam:
\[
G_{b}\left(\lambda_{l e a f}, \beta\right)=\phi_{1}+\phi_{2} \cdot \sin (\beta) ;
\]
where $\phi_{1}=0.5-0.633 \cdot \chi_{\text {leaf }}-0.33 \cdot \chi_{\text {leaf }}^{2}$ and $\phi_{2}=0.877 \cdot\left(1-2 \cdot \phi_{1}\right)$ for $-0.4 \leq \chi_{\text {leaf }} \leq 0.6$. Finally, $k_{b}$ is estimated as:
\[
k_{b}=\frac{G_{b}\left(\lambda_{\text {leaf }}, \beta\right)}{\sin (\beta)}
\]

The calculations can be illustrated with function light_directionalExtinctionCoefficient():
```
solarElevation <- 40 # in degrees
meanLeafAngle <- 60 # in degrees
sdLeafAngle <- 20
## Parameters of the beta distribution
beta <- light_leafAngleBetaParameters(meanLeafAngle*(pi/180), sdLeafAngle*(pi/180))
beta
## p q
## 2.333333 1.166667
## Direct beam extinction coefficient for solar elevation
kb <- light_directionalExtinctionCoefficient(beta["p"], beta["q"], solarElevation*(pi/180))
kb
## [1] 0.7696812
```


\subsection*{9.1.2 Sunlit and shade leaves}

It is generally accepted that sunlit and shade leaves need to be treated separately for photosynthesis calculations (De Pury \& Farquhar 1997). This separation is necessary because photosynthesis of shade leaves has an essentially linear response to irradiance, while photosynthesis of leaves in sunflecks is often light saturated and independent of irradiance. The proportion of sunlit leaves, i.e. leaves in a canopy layer $j$ that the direct light beams (sunflecks) reach is:
\[
f_{S L, j}=\exp \left(\sum_{k>j}^{l} \sum_{i}^{c}-k_{b, i} \cdot L A I_{i, k}^{a l l}\right) \cdot \exp \left(\sum_{i}^{c}-k_{b, j} \cdot 0.5 \cdot L A I_{i, j}^{a l l}\right)
\]
where it is assumed that only half the leaf area of layer $j$ contributes self-shading. Note that since $k_{b}$ depends on the time of the day, also $f_{S L_{j}}$ may be different depending on the solar hour. From fraction $f_{S L, j}$ we can derive the (expanded) leaf area of each layer that is affected by direct light beams (i.e. the amount of sunlit and shade leaves):
\[
\begin{aligned}
L A I_{i, j}^{\text {sunlit }} & =f_{S L, j} \cdot L A I_{i, j}^{\phi} \\
L A I_{i, j}^{\text {shade }} & =\left(1-f_{S L, j}\right) \cdot L A I_{i, j}^{\phi}
\end{aligned}
\]

As an example we will consider a canopy of one species of $\mathrm{LAI}=2$, divided into ten layers with constant leaf density:
```
LAI = 2
nlayer = 10
LAIlayerlive = matrix(rep(LAI/nlayer,nlayer),nlayer,1)
LAIlayermax = matrix(rep(LAI/nlayer,nlayer),nlayer,1)
LAIlayerdead = matrix(0,nlayer,1)
```


We will also define the coefficients of diffuse extinction, leaf absorbance and leaf reflection for PAR and SWR:
```
alpha_PAR <- 0.9
alpha_SWR <- 0.7
gamma_PAR <- 0.04
gamma_SWR <- 0.05
clumping <- 0.75
```


These definitions, and that of direct extinction coefficient, lead to a percentage of the above-canopy irradiance reaching each layer (Anten \& Bastiaans 2016). Extinction of direct radiation also defines the proportion of leaves of each layer that are affected by sunflecks (i.e. the proportion of sunlit leaves). Both outcomes are illustrated in the figure below:

\subsection*{9.1.3 Short-wave radiation absorbed by canopy elements}

The amount of absorbed diffuse radiation per leaf area unit of cohort $i$ within a given canopy layer $j$ is calculated as:
\[
\Phi_{d i f, i, j}=I_{d i f, j} \cdot k_{d, i} \cdot \alpha_{i}^{0.5} \exp \left[\sum_{h}^{c}-k_{d, h} \cdot \alpha_{i}^{0.5} \cdot 0.5 \cdot L A I_{h, j}^{a l l}\right]
\]

The amount of absorbed scattered beam radiation per leaf area unit of cohort $i$ within a given canopy layer $j$ is calculated as:
\[
\begin{aligned}
\Phi_{s c a, i, j} & =I_{b, j} \cdot k_{b, j} \cdot(A-B) \\
A & =\alpha_{i}^{0.5} \cdot \exp \left(\sum_{h}^{c}-k_{b, i} \cdot \alpha_{i} \cdot 0.5 \cdot L A I_{h, i}^{a l l}\right) \\
B & =\frac{\alpha_{i}}{\left(1-\gamma_{i}\right)} \cdot \exp \left(\sum_{h}^{c}-k_{b, i} \cdot 0.5 \cdot L A I_{h, i}^{a l l}\right)
\end{aligned}
\]

Finally, the direct radiation absorbed by a unit of sunlit leaf area of cohort $i$ in a canopy layer $j$ does not depend on the position of the canopy layer and is:
\[
\Phi_{d i r, i, j}=I_{b e a m} \cdot \alpha_{i} \cdot k_{b, i}
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-104.jpg?height=822&width=1649&top_left_y=233&top_left_x=241}
\captionsetup{labelformat=empty}
\caption{Figure 9.1: The left panel shows irradiance per layer of diffuse and direct PAR and SWR assuming a LAI of 2 equally distributed among layers (see function light_layerIrradianceFraction()). The right panel shows the corresponding proportions of sunlit and shade leaves in each layer (see function light_layerSunlitFraction()).}
\end{figure}

Once these components are known, the amount of light absorbed by sunlit/shaded foliage of cohort $i$ in layer $j$ per leaf area unit ( $\Phi_{i, j}^{\text {sunlit }}$ and $\Phi_{i, j}^{\text {shade }}$, respectively) is:
\[
\begin{aligned}
\Phi_{i, j}^{\text {sunlit }} & =\Phi_{d i f, i, j}+\Phi_{s c a, i, j}+\Phi_{d i r, i, j} \\
\Phi_{i, j}^{\text {shade }} & =\Phi_{d i f, i, j}+\Phi_{s c a, i, j}
\end{aligned}
\]

Let us show how all this works in an example. Regarding incoming light, we assume the following direct and diffuse irradiance at the top of the canopy:
```
solarElevation = 0.67
SWR_direct = 1100
SWR_diffuse = 300
PAR_direct = 550
PAR_diffuse = 150
```


Solar elevation is the angle between the sun and the horizon (i.e. the complement of the zenith angle). Under these conditions, and for the same canopy used for fig. 9.1, the amount of PAR and SWR absorbed per unit of leaf area at each canopy layer is (Anten \& Bastiaans 2016):
```
ZF <- c(0.178, 0.514, 0.308) ##Standard overcast sky
Zangles <- c(15.0, 45.0, 75.0);
KDIFF <- matrix(NA, 3, 1);
for(k in 1:3){
    KDIFF[k,1] <- light_directionalExtinctionCoefficient(beta["p"], beta["q"], Zangles[k]*(pi/180.0));
}
KDIFF
## [,1]
```

```
## [1,] 1.9888914
## [2,] 0.6926432
## [3,] 0.4853480
```


\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-105.jpg?height=914&width=1639&top_left_y=458&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 9.2: PAR (left) and SWR (right) absorbed per unit of sunlit/shade leaf area at each canopy layer ( $I_{i, j}^{\text {sunlit }}$ and $I_{i, j}^{\text {shade }}$, respectively;see function light_cohortSunlitShadeAbsorbedRadiation()).}
\end{figure}

The SWR absorbed per ground area unit by sunlit and shade foliage of cohort $i$ in canopy layer $j$ is:
\[
\begin{aligned}
K_{a b s, i, j}^{s u n l i t} & =\Phi_{i, j}^{s u n l i t} \cdot L A I_{i, j}^{s u n l i t} \\
K_{a b s, i, j}^{s h a d e} & =\Phi_{i, j}^{s h a d e} \cdot L A I_{i, j}^{s h a d e}
\end{aligned}
\]

The previous quantities can be aggregated across cohorts or layers. The SWR absorbed per ground area unit by cohort $i$ ( $K_{a b s, i}$ ) is found using:
\[
K_{a b s, i}=\sum_{j}^{l} K_{a b s, i, j}^{s u n l i t}+K_{a b s, i, j}^{s h a d e}=K_{a b s, i}^{s u n l i t}+K_{a b s, i}^{s h a d e}
\]
where $K_{a b s, i}^{s u n l i t}$ and $K_{a b s, i}^{s h a d e}$ are the SWR absorbed per ground area unit by sunlit and shade foliage, respectively, of cohort $i$. Similarly, the SWR absorbed by canopy layer $j$ ( $K_{a b s, j}$ ) is found using:
\[
K_{a b s, j}=\sum_{i}^{c} K_{a b s, i, j}^{s u n l i t}+K_{a b s, i, j}^{s h a d e}
\]
and the SWR absorbed by the whole canopy ( $K_{a b s, c a}$ ) is:
\[
K_{a b s, c a}=\sum_{j}^{l} K_{a b s, j}=\sum_{i}^{c} K_{a b s, i}=\sum_{i}^{c} \sum_{j}^{l} K_{a b s, i, j}^{s u n l i t}+K_{a b s, i, j}^{s h a d e}
\]

\subsection*{9.1.4 Short-wave radiation absorbed by the soil}

The instantaneous shortwave radiation reaching the soil is calculated separately for direct beam and diffuse radiation:
\[
\begin{aligned}
I_{\text {beam }, \text { soil }} & =I_{\text {beam }} \cdot \exp \left[\sum_{h=j+1}^{l} \sum_{i}^{c}-k_{b, i} \cdot \alpha_{i}^{0.5} \cdot L A I_{i, h}^{a l l}\right] \\
I_{d i f, \text { soil }} & =I_{d i f} \cdot \exp \left[\sum_{h=j+1}^{l} \sum_{i}^{c}-k_{d, i} \cdot L A I_{i, h}^{a l l}\right]
\end{aligned}
\]
where $I_{\text {beam }}$ and $I_{\text {dif }}$ are the direct and diffuse irrradiance at the top of the canopy, $k_{b, i}$ is the extinction coefficient of cohort $i$ for direct light and $k_{d, i}$ is the extinction coefficient of cohort $i$ for diffuse SWR. From these, the SWR absorbed by the soil ( $K_{a b s, s o i l}$ ) is found by:
\[
K_{a b s, s o i l}=\left(1-\gamma_{S W R, s o i l}\right) \cdot\left(I_{b e a m, s o i l}+I_{d i f, s o i l}\right)
\]
where $\gamma_{S W R, \text { soil }}=0.10$ is the SWR reflectance ( $10 \%$ albedo) of the soil.

\subsection*{9.2 Long-wave radiation}

Long-wave radiation (LWR) transfer within the canopy is based on the SHAW model (Flerchinger et al. 2009).

\subsection*{9.2.1 Long-wave radiation balance by canopy layers}

Assume canopy layers are ordered from $j=1$ (in contact with the soil) to $j=l$ (in contact with the atmosphere above the boundary layer). The procedure first calculates downward LWR below each canopy layer, $L_{\text {down }, j}$, from $j=l$ to $j=1$. The downward LWR below layer $j$ is calculated as:
\[
L_{\text {down }, j}=\tau_{j} \cdot L_{\text {down }, j+1}+\left(1-\tau_{j}\right) \cdot \epsilon_{\text {can }} \cdot \sigma \cdot\left(T_{\text {air }, j}+273.16\right)^{4}
\]
where $L_{\text {down }, j+1}$ is the downward LWR of the layer above ( $L_{\text {atm }}$ in the case of $j=l$ ), $T_{\text {air }, j}$ is the air temperature of layer $j, \tau_{j}$ is the diffuse transmissivity of layer $j, \sigma=5.67 \cdot 10^{-8} W \cdot K^{-4} \cdot m^{-2}$ is the Stephan-Boltzmann constant and $\epsilon_{\text {can }}=0.97$ is the canopy emmissivity. Diffuse transmissivity values are defined by cohort $i$ and layer $j$ using:
\[
\tau_{i, j}=\exp \left(-k_{L W R} \cdot L A I_{i, j}^{a l l}\right)
\]
where $k_{L W R}=0.7815$ is the extinction coefficient for LWR. The transmissivity of layer $j$ is simply $\tau_{j}=$ $\sum_{i}^{c} \tau_{i, j}$. Once we know $L_{\text {down }, 1}$ we can calculate the upwards LWR from the soil ( $L_{u p, s}$ ) using:
\[
L_{u p, s o i l}=\left(1-\epsilon_{s o i l}\right) \cdot L_{d o w n, 1}+\epsilon_{s o i l} \cdot \sigma \cdot\left(T_{s o i l, 1}+273.16\right)^{4}
\]
where $T_{\text {soil }, 1}$ is the temperature of the topmost soil layer and $\epsilon_{\text {soil }}=0.97$ is the soil emmissivity. Now we calculate upward LWR from $j=1$ to $j=J$ :
\[
L_{u p, j}=\tau_{j} \cdot L_{u p, j-1}+\left(1-\tau_{j}\right) \cdot \epsilon_{c a n} \cdot \sigma \cdot\left(T_{a i r, j}+273.16\right)^{4}
\]
where $L_{u p, j-1}$ is the downward LWR of the layer below ( $L_{u p, \text { soil }}$ in the case of $j=1$ ). Once we have downward and upward LWR fluxes, we can estimate the net LWR absorbed within canopy layer $j$ using:
\[
L_{n e t, j}=\epsilon_{c a n} \cdot\left(1-\tau_{j}\right) \cdot\left(L_{d o w n, j}+L_{u p, j}-\sigma \cdot\left(T_{a i r, j}+273.16\right)^{4}\right)
\]

\subsection*{9.2.2 Net long-wave radiation of the whole canopy and the soil}

Net LWR can be aggregated at the scale of the whole canopy. The net LWR of the whole canopy ( $L_{\text {net }, \text { can }}$ ) is simply the sum across layers of net LWR:
\[
L_{n e t, c a n}=\sum_{j}^{l} L_{n e t, j}
\]
whereas the net LWR of the soil ( $L_{\text {net }, \text { soil }}$ ) is:
\[
L_{n e t, \text { soil }}=\epsilon_{\text {soil }} \cdot\left(L_{\text {down }, 1}-\sigma \cdot\left(T_{\text {soil }, 1}+273.16\right)^{4}\right)
\]

\subsection*{9.2.3 Long-wave radiation balance by plant cohorts}

The net LWR per leaf area unit absorbed within canopy layer $j$ can also be decomposed among plant cohorts. The net LWR of cohort $i$ in layer $j$ is found using the relative proportion of light absorbed by the cohort (i.e. the complement of its diffuse transmissivity):
\[
L_{n e t, i, j}=L_{n e t, j} \cdot \frac{1-\tau_{i, j}}{\sum_{h} 1-\tau_{h, j}}
\]
from which we can estimate $L_{\text {net }, i}^{\text {sunlit }}$ and $L_{\text {net }, i}^{\text {shade }}$, the average net LWR per leaf area unit for sunlit and shade leaves of cohort $i$, respectively:
\[
L_{\text {net }, i}^{\text {sunlit }}=\frac{\sum_{j}^{l} L_{\text {net }, i, j} \cdot L A I_{i, j}^{\text {sunlit }}}{\sum_{j}^{l} L A I_{i, j}^{\text {sunlit }}} L_{\text {net }, i}^{\text {shade }}=\frac{\sum_{j}^{l} L_{\text {net }, i, j} \cdot L A I_{i, j}^{\text {shade }}}{\sum_{j}^{l} L A I_{i, j}^{\text {shade }}}
\]

\section*{Chapter 10}

\section*{Plant hydraulics}

We devote this chapter to describe the background necessary to understand how plant hydraulics is implemented in the advanced water balance model of medfate. Section 10.1 introduces the hydraulic networks from which to choose, depending on the sub-model of plant hydraulics employed (i.e. either transpirationMode = "Sperry" or transpirationMode = "Sureau"). After that, in sections 10.2 and 10.3 we present the building blocks of models of plant hydraulics, i.e. how to represent in a model the water content of plant tissues and the water flow through vascular elements. In section 10.4 we describe in detail the plant hydraulic sub-model presented in De Cáceres et al. (2021) (without water compartments), and in 10.5 we describe the sub-model of plant hydraulics that was presented in Ruffault et al. (2022) and was added to medfate.

\subsection*{10.1 Hydraulic architecture}

The hydraulic architecture of a model describes the set of water compartments and resistances to water flow that are explicitly considered, often implying a simplification and discretization of real plant hydraulic pathways. The advanced water balance model of medfate implements different hydraulic architectures depending on the transpiration sub-model:
- If transpirationMode $=$ "Sperry", the hydraulic network is described using ( $S \times 2+1+1$ ) resistance elements, with soil being represented in $S$ different soil layers. For each soil layer there is a rhizosphere element in series with a root xylem element. The $S$ soil layers are in parallel up to the root crown. From there there is one stem xylem segment and a final leaf xylem segment in series (Fig. 10.1). When considered (via control parameter stemCavitationEffects), stem cavitation affects the resistance between the root crown ( $\Psi_{\text {rootcrown }}$ ) and the stem ( $\Psi_{\text {stem }}$ ). Similarly, when considered (via control parameter leafCavitationEffects) leaf cavitation affects the resistance between the stem ( $\Psi_{\text {stem }}$ ) and the leaf ( $\Psi_{\text {leaf }}$ )
- If transpirationMode = "Sureau", the soil-plant system in SurEau-ECOS (Ruffault et al. 2022) is discretized into three soil layers and two plant compartments (Fig. 10.2): a leaf and a stem. Each of the two plant organs contains an apoplasm and a symplasm. The stem apoplasm and symplasm include water volumes of all non-leaf compartments, i.e., trunk, root and branches. Symplasmic capacitances (i.e. $C_{\text {LSym }}$ and $C_{\text {SSym }}$ ) mostly buffer water fluxes during well-watered conditions, whereas apoplasm capacitances (i.e. $C_{L A p o}$ and $C_{S A p o}$ ) come into play when cavitation occurs. Water can leaf the plant via three flows, through stomata ( $E_{\text {stom }}$ ), leaf cuticules ( $E_{\text {cuti,leaf }}$ ) and stem cuticules ( $E_{\text {cuti,stem }}$ ). The architecture is completed with nodes for the fine root surface of each soil layer ( $\Psi_{\text {rootsurf }}$ ) and for

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-110.jpg?height=725&width=885&top_left_y=368&top_left_x=509}
\captionsetup{labelformat=empty}
\caption{Figure 10.1: Schematic representation of hydraulics in a whole-plant network}
\end{figure}
the root crown ( $\Psi_{\text {rootcrown }}$ ), but these elements do not correspond to water compartments. Stem cavitation affects the conductances of the pathways between root surfaces ( $\Psi_{\text {rootsurf }}$ ) and the root crown $\left(\Psi_{\text {rootcrown }}\right)$, as well as the conductance between the root crown and the stem apoplasm ( $\Psi_{\text {stem,apo }}$ ). Leaf cavitation affects the conductance between the stem apoplasm ( $\Psi_{\text {stem,apo }}$ ) and the leaf apoplasms $\left(\Psi_{\text {leaf }, \text { apo }}\right)$.

The two architectures share as common elements the nodes corresponding to bulk soil ( $\Psi_{\text {soil }}$ ) and root surface ( $\Psi_{\text {rootsurf }}$ ) for each soil layer, as well as the water potential at the root crown ( $\Psi_{\text {rootcrown }}$ ). Since the architecture of transpirationModel = "Sperry" considers plant xylem elements only, the stem water potential ( $\Psi_{\text {stem }}$ ) can be considered analogous to the apoplasmic stem water potential of Sureau-ECOS ( $\Psi_{\text {stem,apo }}$ ). Similarly its leaf water potential ( $\Psi_{\text {leaf }}$ ) can be considered equivalent to the apoplasmic stem water potential of Sureau-ECOS ( $\Psi_{\text {leaf }, \text { apo }}$ ). Symplasmic compartments of Sureau-ECOS do not have equivalents in the Sperry architecture, but the water potential of symplasmic compartments can be assumed to be equal to those of their corresponding apoplasmic compartments. Important differences between the two architectures include the additional consideration of (i) plant capacitance effects, (ii) cavitation flows and (iii) cuticular transpiration flows that are only available in Sureau-ECOS (Fig. 10.1). The two models also differ in how stomatal regulation, water flows and water potentials are solved. These differences are described in the following sub-sections as well as in chapter 12.

\subsection*{10.2 Vulnerability curves}

Vulnerability curves form the basis of hydraulic calculations. Let us use $k$ to denote hydraulic conductance, i.e. instantaneous flow rate per leaf surface unit and per pressure drop (in $\mathrm{mmol} \cdot s^{-1} \cdot m^{-2} \cdot M P a^{-1}$ ). Each element of the hydraulic network has a vulnerability curve $k(\Psi)$ that starts at maximum hydraulic conductance ( $k_{\text {max }}=k(0)$ ) and declines as water pressure ( $\Psi$ ) becomes more negative.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-111.jpg?height=1137&width=1321&top_left_y=742&top_left_x=401}
\captionsetup{labelformat=empty}
\caption{Figure 10.2: Schematic representation of hydraulics in a network with water storage compartments according to the design of SurEau-ECOS}
\end{figure}

\subsection*{10.2.1 Xylem vulnerability curves}

Xylem vulnerability curves are modelled using different functions, depending on the transpiration sub-model.

\subsection*{10.2.1.1 Weibull vulnerability curves}

When transpirationMode = "Sperry", xylem tissues are assigned a two-parameter Weibull function as the vulnerability curve $k(\Psi)$ :
\[
k(\Psi)=k_{\max } \cdot e^{-\left((\Psi / d)^{c}\right)}
\]
where $k_{\text {max }}$ is the maximum hydraulic conductance, and $c$ and $d$ are species-specific and tissue-specific parameters. Note that parameter $d$ is the water potential (in MPa ) at which $k(\Psi) / k_{\max }=e^{-1}=0.367$, i.e. the water potential at which hydraulic conductance is $36.7 \%$ of its maximum value. Parameter $c$ controls the shape of the vulnerability curve (exponential shape with no threshold has $c \leq 1$; and sigmoidal shape with threshold occurs when $c>1$ ).
The concept of vulnerability curve can be used to specify the relationship between pressure and conductance in any portion of the flow path. For example, we define the following parameter values for a stem xylem ( $k_{\text {stem,max }}$ and parameters $c_{\text {stem }}$ and $d_{\text {stem }}$ of the vulnerability curve):
```
kstemmax = 5.0 # mmol }\cdot\textrm{m}-2\cdot\textrm{s}-1\cdotMPa-
stemc = 3
stemd = -3.0 # MPa
```


For root xylem ( $k_{\text {root }, \text { max }}$ ), we may assume a higher conductance (i.e. higher efficiency) but also higher vulnerability to cavitation (defined by parameters $c_{\text {root }}$ and $d_{\text {root }}$ ):
```
krootmax = 6.6 # mmol }\cdot\textrm{m}-2\cdot\textrm{s}-1\cdotMPa-
rootc = 2
rootd = -2.5 #MPa
```


For leaf xylem $k_{\text {leaf }}(\Psi)$, we may specify higher conductance than in stems but also higher vulnerability:
```
kleafmax = 10
leafc = 2
leafd = -2
```


With these parameter values, the vulnerability curves for root, stem and leaf are (see hydraulics_xylemConductance() and hydraulics_vulnerabilityCurvePlot()):

The dash-dot line between 0 and $\Psi_{\text {cav }}=-2.5 \mathrm{MPa}$ indicates the modification of the stem xylem vulnerability curve when cavitation has occurred (i.e., previous embolism limits the maximum conductance value), as indicated in Sperry et al. (2017). The corresponding proportion of stem conductance loss ( $P L C_{\text {stem }}$ ) can be found using the stem vulnerability curve. Similarly, $P L C_{\text {leaf }}$ can limit conductance in leaves. Although root xylem are more vulnerable to the formation of emboli for a given potential, it is generally accepted that the less negative potentials of root xylem compared to the stem lead to cavitation occurring more often in the stem. The constrain created by cavitation has an effect on the calculation of the flow rates and derived quantities (see below).

\subsection*{10.2.1.2 Sigmoid vulnerability curves}

When transpirationMode = "Sureau", xylem tissues are assigned a two-parameter sigmoid function as the vulnerability curve $k(\Psi)$ :
\[
k(\Psi)=\frac{k_{\max }}{1+e^{(\text {slope } / 25) \cdot\left(\Psi-\Psi_{50}\right)}}
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-113.jpg?height=1229&width=1229&top_left_y=696&top_left_x=447}
\captionsetup{labelformat=empty}
\caption{Figure 10.3: Example vulnerability curves corresponding to the parameters defined above for stem, root and leaf segments.}
\end{figure}
where $\Psi_{50}$ is the water potential corresponding to $50 \%$ of conductance, and slope is the slope of the curve in percent at that point. The two parameters need to be specified for each plant segment under consideration, analogously to the Weibull functions.

\subsection*{10.2.2 Rhizosphere vulnerability curve}

The rhizosphere conductance function $k_{\text {rhizo }}(\Psi)$ is modelled as a van Genuchten function (Genuchten 1980) (this choice is the reason why the water retention curve also needs to be modelled with van Genuchten):
\[
\begin{aligned}
k_{\text {rhizo }}(\Psi) & =k_{\text {rhizo, } \max } \cdot v^{(n-1) /(2 \cdot n)} \cdot\left((1-v)^{(n-1) / n}-1\right)^{2} \\
v & =\left[(\alpha \Psi)^{n}+1\right]^{-1}
\end{aligned}
\]
where $k_{\text {rhizo, max }}$ is the maximum rhizosphere conductance, and $n$ and $\alpha$ are texture-specific parameters (Carsel \& Parrish 1988; Leij et al. 1996). These are automatically set by function soil() when initializing soil objects (see section 2.3.3), but we can use function soil_vanGenuchtenParamsCarsel() to derive them from texture types:
```
textures = c("Sandy loam","Silt loam", "Clay")
#Textural parameters
#Sandy clay loam
p1 = soil_vanGenuchtenParamsCarsel(textures[1])
p1

\begin{tabular}{lrrrrr} 
\#\# & alpha & n & theta_res & theta_sat & Ks \\
\#\# & 764.983 & 1.890 & 0.065 & 0.410 & 69513.524
\end{tabular}
alpha1 = p1[1]
n1 = p1[2]
#Silt loam
p2 = soil_vanGenuchtenParamsCarsel(textures[2])
p2

\begin{tabular}{lrrrrr} 
\#\# & alpha & n & theta_res & theta_sat & Ks \\
\#\# & 203.9955 & 1.4100 & 0.0670 & 0.4500 & 7077.1687
\end{tabular}
alpha2 = p2[1]
n2 = p2[2]
#Silty clay
p3 = soil_vanGenuchtenParamsCarsel(textures[3])
p3

\begin{tabular}{lrrrrr} 
\#\# & alpha & n & theta_res & theta_sat & Ks \\
\#\# & 81.59819 & 1.09000 & 0.06800 & 0.38000 & 3145.40832
\end{tabular}
alpha3 = p3[1]
n3 = p3[2]
```


We can estimate maximum rhizosphere conductance values assuming that they account for an average percentage of the resistance (e.g. 15\%) across the continuum (see functions hydraulics_averageRhizosphereResistancePercen and hydraulics_findRhizosphereMaximumConductance()):
```
percentResistance = 15
#Sandy clay loam
krmax1 =hydraulics_findRhizosphereMaximumConductance(percentResistance,
    n1,alpha1, krootmax, rootc,rootd, kstemmax, stemc, stemd,
    kleafmax, leafc, leafd)
krmax1
## [1] 7.375648e+14
#Silt loam
krmax2 =hydraulics_findRhizosphereMaximumConductance(percentResistance,
    n2,alpha2, krootmax, rootc,rootd, kstemmax, stemc, stemd,
    kleafmax, leafc, leafd)
krmax2
## [1] 3420747735
#Silty clay
krmax3 =hydraulics_findRhizosphereMaximumConductance(percentResistance,
    n3,alpha3, krootmax, rootc,rootd, kstemmax, stemc, stemd,
    kleafmax, leafc, leafd)
krmax3
## [1] 36831905
```


With these parameters, the resulting $k_{\text {rhizo }}(\Psi)$ functions can be displayed using the function hydraulics_vanGenuchtenConductance():

\subsection*{10.2.3 Xylem sap viscosity}

The ease of water flow (i.e. hydraulic conductance or resistance) is dependent on water viscosity, which fluctuates as a function of temperature and dissolved substances. Xylem sap can be considered to have negligible amounts of solutes, but temperature is still rellevant factor of viscosity. The dynamic viscosity of water $V_{w}$ varies with temperature (relative to its viscosity at $20^{\circ} \mathrm{C}$ ) according to the Vogel equation:
\[
V_{w}(T)=\exp \left[-3.7188+\frac{578.919}{-137.546+T}\right]
\]
where $T$ is the temperature of the medium in Kelvin. Temperature of segments (roots, stem, leaves) is used to correct maximum conductances simply as follows:
\[
k_{\max , T}=\frac{k_{\max }}{V_{w}(T)}
\]
where $k_{\text {max }}$ is the maximum conductance describing the vulnerability curve, assumed to be determined at $20^{\circ} \mathrm{C}$.

\subsection*{10.3 Water content of plant tissues}

Following Martin-StPaul et al. (2017), we consider two kind of tissues in (leaf and stem) plant segments (Tyree \& Yang 1990). The first are conduits (tracheids or vessels), which will release water due to cavitation and may be refilled with water from adjacent living tissue or upstream segments. The second source of water is formed by more elastic living cells (i.e. parenchyma) and can potentially be a large source of water. This source can be described using the relative water content of a symplasmic tissue.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-116.jpg?height=895&width=968&top_left_y=241&top_left_x=577}
\captionsetup{labelformat=empty}
\caption{Figure 10.4: Example rhizosphere vulnerability curves (i.e. Van Genuchten functions) for three different soil textures.}
\end{figure}

\subsection*{10.3.1 Relative water content of symplasmic tissues}

A pressure-volume curve of a tissue relates its water potential against its relative water content ( $R W C$; $k g \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{kg}^{-1} \mathrm{H}_{2} \mathrm{O}$ at saturation). Pressure-volume theory is usually applied to leaf tissues (Bartlett et al. 2012), but it can also be applied to other tissues such as sapwood or cambium cells.

For living cells, the relationship between $\Psi$ and $R W C$ of the symplasmic fraction ( $R W C_{\text {sym }}$ ) is achieved by separating $\Psi$ into osmotic (solute) potential ( $\Psi_{S}$ ) and the turgor potential ( $\Psi_{P}$ ):
\[
\Psi=\Psi_{S}+\Psi_{P}
\]

The relationship for $\Psi_{P}$ is:
\[
\Psi_{P}=-\pi_{0}-\epsilon \cdot\left(1.0-R W C_{\text {sym }}\right)
\]
where $\pi_{0}(\mathrm{MPa})$ is the osmotic potential at full turgor (i.e. when $R W C_{\text {sym }}=1$ ), and $\epsilon$ is the modulus of elasticity (i.e. the slope of the relationship). Assuming constant solute content, the relationship for $\Psi_{S}$ is:
\[
\Psi_{S}=\frac{-\pi_{0}}{R W C_{\text {sym }}}
\]

When $\Psi \leq \Psi_{t l p}$, the water potential at turgor loss point, then $\Psi_{P}=0$ and $\Psi=\Psi_{S}$. If $\Psi>\Psi_{t l p}$ then the two components are needed. The water potential at turgor loss point ( $\Psi_{t l p}$ ) can be found by (Bartlett et al. 2012):
\[
\Psi_{t l p}=\frac{\pi_{0} \cdot \epsilon}{\pi_{0}+\epsilon}
\]

As an example, the following figure draws the pressure-volume curve for a tissue with $\epsilon=12$ and $\pi_{0}=$ -3.0 MPa :
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-117.jpg?height=765&width=925&top_left_y=241&top_left_x=599)

To calculate $R W C_{\text {sym }}$ from the water potential of a tissue, the previous equations need to be combined and, after isolating $R W C_{\text {sym }}$, a quadratic relationship is obtained (Martin-StPaul et al. 2017).

\subsection*{10.3.2 Relative water content of apoplastic tissues}

In medfate it is assumed that apoplastic water fraction of an organ corresponds to the water in its xylem conduits. Xylem conduits consist of inelastic cells that have very small changes of water volume in relation to changes in water potential. However, xylem conduits release their water to the transpiration stream following the formation of emboli. As in Hölttä et al. (2009), we equate the relative water content of the apoplastic reservoir of a segment (leaves or stem) to the proportion of conductance lost (relative to the maximum conductance) for a given water potential (see (10.1)):
\[
R W C_{a p o}\left(\Psi_{a p o}\right)=\frac{k\left(\Psi_{a p o}\right)}{k_{\max }}=e^{-\left(\left(\Psi_{a p o} / d\right)^{c}\right)}
\]

Hence we assume that the relationship between $\Psi_{\text {apo }}$ and the relative water content follows the same function as the relationship between $\Psi_{\text {apo }}$ and the proportion of conductance loss (i.e. the hydraulic vulnerability curve, see (ref?)(vulnerabilitycurves)).
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-118.jpg?height=765&width=901&top_left_y=241&top_left_x=609)

\subsection*{10.3.3 Average relative water content of a compartment}

The average relative water content in a given segment or organ ( $R W C$ ) can be obtained by calculating $R W C_{\text {apo }}$ and $R W C_{\text {sym }}$ followed by assuming a constant apoplastic fraction $f_{\text {apo }}$ :
\[
R W C=R W C_{\text {apo }} \cdot f_{\text {apo }}+R W C_{\text {sym }} \cdot\left(1-f_{\text {apo }}\right)
\]

Normally the apoplastic fraction is large ( $\sim 80 \%$ ) in the stem and small ( $\sim 15 \%$ ) in leaves. Hence, the relative water content in stems will be mostly dictated by the level of cavitation, whereas that of leaves will mostly follow leaf symplastic water potential and the symplastic pressure-volume curve.

\subsection*{10.3.4 Live fuel moisture content}

Given an average relative water content ( $R W C$ ) of a plant organ, its live fuel moisture content ( $L F M C$ in $g \mathrm{H}_{2} \mathrm{O} \cdot g^{-1}$ of dry tissue) can be calculated using:
\[
L F M C=R W C \cdot \Theta \cdot \frac{\rho_{\mathrm{H}_{2} \mathrm{O}}}{\rho}=R W C \cdot L F M C_{\max }
\]
where $\Theta$ is the tissue porosity ( $\mathrm{cm}^{3}$ of water per $\mathrm{cm}^{3}$ of tissue), $\rho$ is the density of the tissue and $\rho_{\mathrm{H}_{2} \mathrm{O}}$ is the density of water. In practice estimates of maximum fuel moisture content $L F M C_{\max }$ are easier to obtain than porosity estimates, so it is more straightforward to estimate $L F M C$ as the product of $R W C$ and $L F M C_{\text {max }}$.

In medfate, $L F M C$ estimates are assumed to correspond to fine fuels (i.e. leaves and twigs of $<6.5 \mathrm{~mm}$ ) and are estimated from stem and leaf water content:
\[
L F M C=\left(R W C^{\text {leaf }} \cdot\left(1.0 / r_{6.35}\right)+R W C^{\text {stem }} \cdot\left(1.0-\left(1.0 / r_{6.35}\right)\right)\right) \cdot L F M C_{\max }
\]
where $r_{6.35}$ is the ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm ; $R W C^{\text {leaf }}$ is the relative water content of in leaves and $R W C^{\text {stem }}$ is the relative water content of in stem, respectively (already averaging symplasmic and apoplasmic tissues).

\subsection*{10.4 Sperry's sub-model of plant hydraulics}

The supply-loss theory of plant hydraulics, presented by Sperry \& Love (2015) and used in Sperry et al. (2017), uses the physics of flow through soil and xylem to quantify how steady-state canopy water supply declines with drought and ceases by hydraulic failure. The theory builds on the hydraulic model of Sperry et al. (1998) and can be applied to different segmentations of the soil-plant continuum.

The supply function describes the steady-state rate of water supply (i.e. flow) for transpiration ( $E$ ) as a function of water potential drop. The steady-state flow rate $E_{i}$ through any $i$ element of the continuum is related to the flow-induced drop in pressure across that element ( $\Delta \Psi_{i}=\Psi_{\text {down }}-\Psi_{\text {up }}$ ) by the integral transform of the element's vulnerability curve $k_{i}(\Psi)$ (Sperry \& Love 2015):
\[
E_{i}=\int_{\Psi_{u p}}^{\Psi_{\text {down }}} k_{i}(\Psi) d \Psi
\]
where $\Psi_{u p}$ and $\Psi_{\text {down }}$ are the upstream and downstream water potential values, respectively. The integral transform assumes infinite discretization of the flow path.

The supply function can be defined for individual elements of the continuum or for the whole soil-plant continuum using different hydraulic networks. Supply functions are used in the Sperry's sub-model to determine photosynthesis, stomatal conductance and transpiration (see chapters 11 and 12).
In the following subsections we illustrate the supply function for different cases.

\subsection*{10.4.1 Supply function for a single xylem element}

In the case of a single xylem element, the supply function describes the steady-state flow rate as a function of pressure at the stem top ( $\Psi_{\text {canopy }}$ ). It can be calculated by numerical integration or aproximated using an incomplete gamma function. The shape of the supply function starting at different root crown water potential values $\left(\Psi_{\text {rootcrown }}\right)$ is (see function hydraulics_EXylem()):

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-119.jpg?height=736&width=1652&top_left_y=1460&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 10.5: Supply function of a single xylem element starting at different root crown water potential values. Left pane shows the uncavitated supply functions and right pane shows the supply functions that are obtained in the case of a cavitated xylem (i.e. without refilling), assuming that the minimum water potential experienced so far was -2.5 MPa . Note the linear part of the flow rate between $\Psi_{\text {rootcrown }}$ and this limit.}
\end{figure}

The supply function of a rhizosphere element relates the steady-state flow rate to the pressure inside the roots ( $\Psi_{\text {root }}$ ). It is calculated by numerical integration of the van Genuchten function, for which we use
the analytical approximation of Van Lier et al. (2009) (see function hydraulics_EVanGenuchten()). In the figure below, we draw examples of the supply function for the rhizosphere. The nearly vertical lines indicate that for many values of $E_{i}$ the corresponding drop in water potential through the rhizosphere will be negligible. Only for increasingly negative soil water potential values the decrease in water potential through the rhizosphere becomes relevant. Both in the case of a xylem element or a rhyzosphere element the derivative $d E_{i} / d \Psi$ of the supply function is equal to the corresponding vulnerability curve.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-120.jpg?height=966&width=958&top_left_y=542&top_left_x=585}
\captionsetup{labelformat=empty}
\caption{Figure 10.6: Supply functions of the rhizosphere starting at the four different values of bulk soil pressure ( $\Psi_{\text {soil }}$ ) and for the same three texture types used for vulnerability curves.}
\end{figure}

\subsection*{10.4.2 Supply function of two elements in series}

Let us describe the soil-plant continuum is represented using two elements in series (rhizosphere + stem xylem). In this case, the supply function has to be calculated by using the previous supply functions sequentially. The $E_{i}$ is identical for each element and equal to the canopy $E$. Since $\Psi_{\text {soil }}$ is known, one first inverts the supply function of the rhizosphere to find $\Psi_{\text {root }}$ (see function hydraulics_E2psiVanGenuchten()) and then inverts the supply function of the xylem to find $\Psi_{\text {canopy }}$ (see function hydraulics_E2psiXylem()). The two operations can be summarized in a single supply function describing the potential rate of water supply for transpiration ( $E$ ) as function of the canopy xylem pressure ( $\Psi_{\text {canopy }}$ ), starting from different bulk soil ( $\Psi_{\text {soil }}$ ) values (see function hydraulics_supplyFunctionTwoElements()):

The supply function for the whole continuum contains much information. The $\Psi$ intercept at $E=0$ represents the (predawn) canopy sap pressure which integrates the rooted soil moisture profile. As $E$ increments from zero, the disproportionately greater drop in $\Psi_{\text {canopy }}$ results from the loss of conductance. As the soil dries the differences in flow due to soil texture become more apparent.

The derivative of the whole continuum supply function, $d E / d \Psi$, is not equal to either of the vulnerability curves and it has to be obtained numerically. The derivative functions corresponding to the supply functions shown in the previous figure are:

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-121.jpg?height=974&width=1676&top_left_y=246&top_left_x=222}
\captionsetup{labelformat=empty}
\caption{Figure 10.7: Example of two-element supply functions describing the potential rate of water supply for transpiration ( $E$ ) as function of the canopy xylem pressure ( $\Psi_{\text {canopy }}$ ), starting from different bulk soil ( $\Psi_{\text {soil }}$ ) values and for different soil textures. Left/right panel shows uncavitated/cavitated supply functions.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-121.jpg?height=950&width=1654&top_left_y=1417&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 10.8: Derivatives of two-element supply functions corresponding to figure 10.7. Left/right panel shows the derivatives of uncavitated/cavitated supply functions.}
\end{figure}

The derivative $d E / d \Psi_{\text {canopy }}$ is the conductance if the entire continuum was exposed to $\Psi_{\text {canopy }}$ (Sperry \& Love 2015). It corresponds to the local loss of hydraulic conductance at the downstream end of the flow path. It falls towards zero for asymptotic critical values ( $E_{\text {crit }}$ ). For a cavitated system $d E / d \Psi_{\text {canopy }}$ can be rather flat, in accordance with the close to linear part of the supply function.

\subsection*{10.4.3 Supply function of three elements in series}

If the soil-plant continuum is represented using three elements in series (rhizosphere + stem xylem + leaf), the resulting overall conductance and resistance fractions (under wet conditions) are:
```
rstemmin = 1/kstemmax
rleafmin = 1/kleafmax
#Percentages of minimum resistance
rvec = c(rstemmin,rleafmin)
100*rvec/sum(rvec)
## [1] 66.66667 33.33333
#Maximum overall conductance
1/sum(rvec)
## [1] 3.333333
```


As before, the supply function has to be calculated sequentially, knowing that $E_{i}$ is identical through each element. Since $\Psi_{\text {soil }}$ is known, one first inverts the supply function of the rhizosphere to find $\Psi_{\text {root }}$ and then inverts the supply function of the xylem to find $\Psi_{\text {stem }}$. Finally, one inverts the supply function of the leaf element to find $\Psi_{\text {leaf }}$. As before, the three operations can be summarized in a single supply function describing the potential rate of water supply for transpiration $(E)$ as function of the leaf pressure ( $\Psi_{\text {leaf }}$ ), starting from different bulk soil ( $\Psi_{\text {soil }}$ ) values (see function hydraulics_supplyFunctionThreeElements ()):
Note that overall conductance and the maximum flow of the supply function are smaller in this case than in the representation using two elements in series, because we added a new resistance (leaves). While the rhizosphere component only adds a significant resistance when the soil dries, considering the leaf segment (or a root xylem segment) substantially increases the overall resistance of the continuum. Higher vulnerability of leaves also makes the curve to saturate for less negative soil water potentials. The derivative functions corresponding to the supply functions shown in the previous figure are (note the highest value being equal to the overall maximum conductance):

\subsection*{10.4.4 Supply function of a root system}

So far we considered supply functions of elements in series, but resistance elements will be in parallel if the soil is represented using $S>1$ different layers. For each soil layer there is a rhizosphere element in series with a root xylem element. The $S$ soil layers are in parallel up to the root crown.
Network of $S$ rhizosphere components and root layers in parallel there are $S+1$ unknown pressures: the $S$ root surface pressures ( $\Psi_{\text {rootsurf }, 1}, \ldots, \Psi_{\text {rootsurf }, S}$ ) and the root crown pressure at the downstream junction for all root components ( $\Psi_{\text {rootcrown }}$ ). The unknown pressures are solved, for each specified total flow value $E$, using multidimensional Newton-Raphson on a set of equations for steady-state flow (Sperry et al. 2016):
\[
\begin{array}{r}
E_{r h i z o, s}-E_{r o o t, s}=0 \\
\sum_{s=1}^{S} E_{r o o t, s}-E=0
\end{array}
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-123.jpg?height=974&width=1674&top_left_y=246&top_left_x=224}
\captionsetup{labelformat=empty}
\caption{Figure 10.9: Example of three-element supply functions describing the potential rate of water supply for transpiration ( $E$ ) as function of the leaf pressure ( $\Psi_{\text {leaf }}$ ), starting from different bulk soil ( $\Psi_{\text {soil }}$ ) values and for different soil textures. Left/right panel shows uncavitated/cavitated supply functions.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-123.jpg?height=950&width=1654&top_left_y=1417&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 10.10: Derivatives of three-element supply functions corresponding to figure 10.9. Left/right panel shows the derivatives of uncavitated/cavitated supply functions.}
\end{figure}
where $E_{\text {rhizo }, s}$ and $E_{\text {root }, s}$ are steady-state supply flows calculated using the integrals of either van Genuchten or Weibull function as vulnerability curves, respectively. In the case of rhizosphere elements, $\Psi_{u p}=\Psi_{\text {soil,s }}$ and in the case of root elements $\Psi_{u p}=\Psi_{\text {rootsurf,s }}$. Solving the steady-state equations also provides values for flow across each of the parallel paths $E_{\text {rhizo }, s}=E_{\text {root }, s}$.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-124.jpg?height=719&width=882&top_left_y=574&top_left_x=509}
\captionsetup{labelformat=empty}
\caption{Figure 10.11: Schematic representation of hydraulics in a root network}
\end{figure}

As an example, we start by defining the water potential of three soil layers corresponding to four situations (analogously with the soil water potentials defined above):
```
psiSoilLayers1 = c(-0.3,-0.2,-0.1)
psiSoilLayers2 = c(-1.3,-1.2,-1.1)
psiSoilLayers3 = c(-2.3,-2.2,-2.1)
psiSoilLayers4 = c(-3.3,-3.2,-3.1)
```


In a network of several soil layers, one has to divide the total rhizosphere and root xylem conductances among layers. Let layer widths ( $d_{s}$ ) be:
```
d = c(300,700,3000) #Soil layer widths in mm
```


Now let $F R P_{1}, F R P_{2}$ and $F R P_{3}$ be the proportion of fine root biomass in each soil layer (see section 2.4.7), which can be calculated using:
```
Z50 = 200 #Parameter of LDR root distribution
Z95 = 1200 #Parameter of LDR root distribution
FRP = root_ldrDistribution(Z50, Z95, d)
FRP

\#\# [,1] [,2] [,3]
## [1,] 0.6652935 0.2749944 0.05971209
```


In the case of the rhizosphere conductances, we can simply define them (for each soil texture type) as:
```
krhizomaxvec1 = krmax1*FRP
krhizomaxvec2 = krmax2*FRP
krhizomaxvec3 = krmax3*FRP
```


To divide maximum root xylem conductance among soil layers we need weights inversely proportional to the length of transport distances (Sperry et al. 2016). Vertical transport lengths can be calculated from soil depths and radial spread can be calculated assuming cylinders with volume that has to be in accordance with the xylem root conductance (TO BE DESCRIBED). The whole process can be done using functions root_coarseRootSoilVolumeFromConductance() and root_coarseRootLengthsFromVolume():
```
rfc = c(20,50,70)
Vol = root_coarseRootSoilVolumeFromConductance(1.0, 2500,krootmax,
    FRP,d, rfc)
lengths = root_coarseRootLengthsFromVolume(Vol, FRP, d, rfc)
lengths
## [1] 3621.093 2768.105 4513.795
weights = lengths/sum(lengths)
```


Transport weights are quite different than the fine root biomass proportions. This is because radial lengths are largest for the first (top) layer and vertical lengths are largest for the third (bottom) layer. The root xylem conductances are (in this case they do not depend on soil texture):
```
krootmaxvec = krootmax*weights
krootmaxvec
## [1] 2.191987 1.675640 2.732373
```


Having all these maximum conductances, we can now build the supply functions for each soil texture and starting from the different soil water potential configurations (see function hydraulics_supplyFunctionBelowground()):
The derivative of $d E / d \Psi_{\text {rootcrown }}$ for the supply function of the root system is again obtained numerically.
Solving the previous system of equations provides the water potentials in different points of the root system. Here we plot them for the results of silt loam texture and the first and last soil potential vectors defined above:

Note that when soil is not dry (first situation) pressure drop in the rhizosphere is negligible, but not the pressure drop in the root xylem. For drier soils rhizosphere becomes more relevant.

We can also plot the flow rates across each of the parallel paths (again corresponding to the results of silt loam texture and for the four soil potential vectors):
Note that the contribution of each soil layer depends on the soil conditions and the total amount of flow. For a low total flow rate some layers may have negative flows if their potential is lower than others, which in a dynamic context will cause hydraulic redistribution of water among soil layers.

\subsection*{10.4.5 Supply function of the soil-plant continuum}

As mentioned above, medfate uses a hydraulic network of ( $S \times 2+2+1$ ) resistance elements to represent the soil-plant continuum, with soil being represented in $S$ different layers. As before, the $S$ soil layers are in

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-126.jpg?height=958&width=1668&top_left_y=227&top_left_x=227}
\captionsetup{labelformat=empty}
\caption{Figure 10.12: Example of supply function for a root system (left) and its derivative (right) under different soil textures and starting from different soil water potential vectors.}
\end{figure}
parallel up to the root crown and each soil layer requires at least a rhizosphere and a root segment. From the root crown there are two stem xylem elements in series and a final leaf element (Fig. 10.1).

To build the supply function for the whole hydraulic network, we proceed by calculating water potentials in the network for each value of flow. For any given $E$ value we start by calculating flows and potentials within the root system. After that, the water potential at the mid of the stem ( $\Psi_{\text {stem }, 1}$ ) is obtained using the inverse of the stem supply function and setting $\Psi_{u p}=\Psi_{\text {rootcrown }}$, and the water potential at the upper end of the stem, $\Psi_{\text {stem }, 2}$, is obtained similarly but setting $\Psi_{u p}=\Psi_{s t e m, 1}$. In both cases the maximum conductance for segments equal to $2 \cdot k_{\text {stem, } \max , i}$. Leaf water potential ( $\Psi_{\text {leaf }}$ ) is finaly obtained using the inverse of the leaf supply function and setting $\Psi_{u p}=\Psi_{s t e m, 2}$ and assuming a steady-state flow $E$. The whole supply function $E\left(\Psi_{\text {leaf }}\right)$ is obtained repeating these operations from $E=0$ to a critical value $E_{\text {crit }}$.

The following figure shows network supply functions for each soil texture and starting from the different soil water potential configurations (see function hydraulics_supplyFunctionNetwork()):

As with previous representations of the soil-plant continuum, the derivative of $d E / d \Psi_{\text {leaf }}$ for the network topology is obtained numerically:

As with the root system, we can know the water potentials in different points of the continuum. Here we plot them for the results of silt loam texture and the first and last soil potential vectors defined above:

A supply function of the soil-plant hydraulic network defines a set steady-state flows and corresponding water potentials given fixed values of soil moisture. Hence, supply functions need to be updated whenever soil moisture is updated, i.e. once a day in the water balance model (see subsection 7.5). This frequency should be enough in most cases, since soil water potentials change more slowly than plant water potentials.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-127.jpg?height=2044&width=1671&top_left_y=290&top_left_x=224}
\captionsetup{labelformat=empty}
\caption{Figure 10.13: Water potentials inside fine roots and at the root crown, for overall flow rates corresponding to fig. 10.12.}
\end{figure}

\section*{Soil potentials 1}
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-128.jpg?height=671&width=811&top_left_y=612&top_left_x=241)

\begin{figure}
\captionsetup{labelformat=empty}
\caption{Soil potentials 3}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-128.jpg?height=674&width=811&top_left_y=1441&top_left_x=241}
\end{figure}

\begin{figure}
\captionsetup{labelformat=empty}
\caption{Soil potentials 2}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-128.jpg?height=674&width=809&top_left_y=609&top_left_x=1073}
\end{figure}

\begin{figure}
\captionsetup{labelformat=empty}
\caption{Soil potentials 4}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-128.jpg?height=674&width=809&top_left_y=1441&top_left_x=1073}
\end{figure}

Figure 10.14: Flow rates inside roots corresponding to each soil layer, for overall flow rates corresponding to fig. 10.12.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-129.jpg?height=847&width=1654&top_left_y=308&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 10.15: Examples of supply functions for a hydraulic network describing the potential rate of water supply for transpiration $(E)$ as function of the leaf pressure ( $\Psi_{\text {leaf }}$ ), starting from different bulk soil ( $\Psi_{\text {soil }}$ ) values and for different soil textures. Left/right panel shows uncavitated/cavitated supply functions.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-129.jpg?height=852&width=1671&top_left_y=1463&top_left_x=227}
\captionsetup{labelformat=empty}
\caption{Figure 10.16: Derivatives of supply functions corresponding to figure 10.15. Left/right panel shows the derivatives of uncavitated/cavitated supply functions.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-130.jpg?height=1649&width=1674&top_left_y=485&top_left_x=224}
\captionsetup{labelformat=empty}
\caption{Figure 10.17: Water potential in network elements corresponding to overall flow rates of figure 10.15. Left/right panel shows the derivatives of uncavitated/cavitated supply functions.}
\end{figure}

\subsection*{10.5 Sureau's sub-model of plant hydraulics}

\subsection*{10.5.1 Constitutive equations}

Water dynamics of the SPA system in SurEau-Ecos (Ruffault et al. 2022) are governed by partial differential equations for water mass conservation.

The water balance of each of the four plant compartments (symplasm and apoplasm for leaf and stem, respectively) is determined according to a generic equation. For a given plant compartment $i$, the water balance differential equation is:
\[
C_{i} \cdot \frac{\mathrm{~d} \Psi_{i}}{\mathrm{~d} t}+\sum_{j} k_{i j} \cdot\left(\Psi_{i}-\Psi_{j}\right)-S=0
\]
and solved at each time step. In the above equation $\Psi_{i}$ and $\Psi_{j}$ would be the water potential of compartments $i$ and $j$, respectively (i.e. $\Psi_{\text {leaf,symp }}, \Psi_{\text {leaf,apo }}, \Psi_{\text {stem,symp }}$ or $\Psi_{\text {stem,apo }}$; see Fig. 10.2); $C_{i}$ is the capacitance associated to the compartment $i$ and defined generically as:
\[
C_{i}=\frac{Q_{i}}{\Psi_{i}}
\]
where $Q_{i}$ is the water volume content of the compartment; $k_{i j}$ is the conductance between the two compartments and $S$ represents an outflow of the target compartment. Flows in/out of compartments are stem cuticular transpiration ( $E_{\text {cuti,stem }}$ ), leaf cuticular transpiration ( $E_{\text {cuti,leaf }}$ ), leaf stomatal transpiration ( $E_{\text {stom }}$ ), stem cavitation flux ( $F_{\text {cav,stem }}$ ) and leaf cavitation flux ( $F_{\text {cav,leaf }}$ ).

\subsection*{10.5.2 Plant and soil conductances}

Overall plant conductance $k_{\text {plant }}$ is defined as the sum of resistances across the hydraulic network Fig. 10.2:
\[
k_{\text {plant }}=\left(\frac{1}{\sum_{s=1}^{S} k_{\text {root }, s}}+\frac{1}{k_{\text {stem }, \text { apo }}}+\frac{1}{k_{\text {leaf }, \text { apo }}}+\frac{1}{k_{\text {leaf }, \text { symp }}}\right)^{-1}
\]

Whenever needed, for each soil layer $s$, the conductance from the root surface to the root crown is updated using the current level of $P L C_{\text {stem }}$ :
\[
k_{\text {root }, s}=k_{\text {root }, \max , s} \cdot\left(1.0-P L C_{\text {stem }}\right)
\]
whereas the conductance from the root crown to the stem apoplasm is updated similarly:
\[
k_{\text {stem,apo }}=k_{\text {stem,apo, } \max } \cdot\left(1.0-P L C_{\text {stem }}\right)
\]
and the conductance from the stem apoplasm to the leaf apoplasm is updated using the current level of $P L C_{\text {leaf }}$ :
\[
k_{\text {leaf }, \text { apo }}=k_{\text {leaf }, \text { apo }, \max } \cdot\left(1.0-P L C_{\text {leaf }}\right)
\]

Unlike plant conductances, which are updated at short time steps, the conductance in the bulk soil for each soil layer ( $k_{\text {soil,s }}$ ) is updated once per day, from $\Psi_{\text {soil,s }}$ and using Van Genuchten equations.

\subsection*{10.5.3 Plant capacitances}

Symplasmic reservoirs behave as variable plant capacitances related to the pressure volume curve, which corresponds to the water quantity ( $Q$ ) changes in symplasmic cells, i.e.:
\[
\mathrm{d} Q / \mathrm{d} t=C \cdot(\mathrm{~d} \Psi / \mathrm{d} t)
\]
from which we get an expression to update $C$ :
\[
C=\frac{\mathrm{d} Q}{\mathrm{~d} \Psi}=Q^{s a t} \cdot \frac{\mathrm{~d} R W C}{\mathrm{~d} \Psi}
\]
where $Q^{\text {sat }}$ is the water volume of the compartment at saturation. From the former general equation, the capacitance of the leaf symplasm ( $C_{L S y m}$; in $\mathrm{mmol} \cdot M \mathrm{~Pa}^{-1} \cdot \mathrm{~m}^{-2}$ ) is updated using the derivative of the leaf symplasmic pressure-volume curve $\left(R W C_{\text {sym }}^{\text {leaf }}\right)$ with respect to $\Psi_{\text {leaf,sym }}($ Ruffault et al. 2022):
\[
C_{L S y m}=Q_{L S y m}^{s a t} \cdot \frac{\mathrm{~d} R W C_{s y m}^{\text {leaf }}\left(\Psi_{\text {leaf }, \text { sym }}\right)}{\mathrm{d} \Psi_{\text {leaf }, \text { sym }}}
\]
and the capacitance of the stem symplasm ( $C_{S S y m}$; in $\mathrm{mmol} \cdot M \mathrm{~Pa}^{-1} \cdot \mathrm{~m}^{-2}$ ) is updated analogously:
\[
C_{\text {SSym }}=Q_{\text {SSym }}^{\text {sat }} \cdot \frac{\mathrm{d} R W C_{\text {sym }}^{\text {stem }}\left(\Psi_{\text {stem }, \text { sym }}\right)}{\mathrm{d} \Psi_{\text {stem }, \text { sym }}}
\]

Equations for derivatives of the relative water content are given in Ruffault et al. (2022).

\subsection*{10.5.4 Cavitation flows}

SurEau-Ecos also considers the capacitance effect of xylem cavitation (Hölttä et al. 2009), i.e., the water released to the streamflow when cavitation occurs (Ruffault et al. 2022). The non-cavitated part of the xylem receives a water flux from the cavitated part and is then transferred to adjacent compartments. The amount of water corresponding to a new cavitation event ( $F_{\text {cav }}$ ) is derived from the quantity of water in the apoplasm at saturation ( $Q_{\text {apo }}^{\text {sat }}$ ) and the temporal variations in PLC as follows:
\[
F_{c a v}=Q^{s a t} \cdot \max \left(\frac{\mathrm{~d} P L C}{\mathrm{~d} t}, 0\right)
\]

This flux is linearized in temporal variations in $\Psi$ in order to express this flux in the form of a Darcy's law. For that purpose an equivalent conductance $k_{\text {cav }}$ is introduced as follows:
\[
\begin{aligned}
F_{c a v} & =Q^{s a t} \cdot \max \left(\frac{\mathrm{~d} P L C}{\mathrm{~d} \Psi} \cdot \frac{\mathrm{~d} \Psi}{\mathrm{~d} t}, 0\right) \\
& \approx k_{c a v} \cdot \max \left(\Psi_{c a v}-\Psi, 0\right)
\end{aligned}
\]
where $\Psi_{\text {cav }}$ is the minimum value of $\Psi$ reached for the apoplasmic compartment, $\mathrm{d} P L C / \mathrm{d} \Psi$ is the derivative of $P L C$ with respect to $\Psi$ and $k_{\text {cav }}$ is:
\[
k_{c a v}=-\frac{Q^{s a t} \cdot(\mathrm{~d} P L C / \mathrm{d} \Psi)}{\mathrm{dt}}
\]

The equation for $\mathrm{d} P L C / \mathrm{d} \Psi$ is given in Ruffault et al. (2022).

\subsection*{10.5.5 Transpiration flows}

Stem cuticular transpiration ( $E_{\text {cuti,stem }}$ ), leaf cuticular transpiration ( $E_{\text {cuti,leaf }}$ ) and leaf stomatal transpiration ( $E_{\text {stom }}$ ) are described in section 12.2.

\subsection*{10.5.6 Numerical scheme}

Three numerical schemes were presented and compared in Ruffault et al. (2022) to solve the system of differential equations, but only the semi-implicit solving approach has been implemented in medfate.

\section*{Chapter 11}

\section*{Leaf/canopy photosynthesis}

In chapter 10 we introduced the necessary concepts of steady-state plant hydraulics to define the hydraulic supply function for the soil-plant continuum. The supply function specifies the flow rate, as per leaf area, for values of leaf water potential and given a soil moisture status. In the first section of this chapter we describe leaf photosynthesis functions, which define leaf gas exchange, photosynthesis and energy balance for values of leaf water potential. This requires knowing wind, water vapor and temperature conditions of the air surrounding leaves (section 13.1.3), the short-wave radiation absorbed by leaf elements (section 9.1.3) and the leaf long-wave radiation balance (section 9.2). In the second section of this chapter we discuss how to upscale photosynthesis values to the crown level.

\subsection*{11.1 Leaf energy balance, gas exchange and photosynthesis}

The supply function specifies the transpiration flow rate $E$ for values of leaf water potential $\Psi_{\text {leaf }}$. If we know air temperature, water vapor pressure and the light conditions in which leaves are, we can translate the supply function into a leaf photosynthesis function (Sperry et al. 2017). In a nutshell, $E$ from the supply function is first used to calculate leaf temperature from an evaluation of the leaf energy balance. The diffusive conductances of the leaf to $\mathrm{H}_{2} \mathrm{O}$ and $C O_{2}$ are obtained from water supply and leaf water vapor deficit. Finally, the gross/net assimilation rate is then obtained from the diffusive conductance and a modelled curve between assimilation and leaf internal $C O_{2}$ concentration. The following subsections detail each of these steps separately.

\subsection*{11.1.1 Leaf temperature}

Leaf temperature ( $T_{\text {leaf }}$; in ${ }^{\circ} C$ ) can be calculated for any given flow rate $E$ using an energy balance equation (Campbell \& Norman 1998):
\[
T_{l e a f}=T_{a i r}+\frac{\Phi_{S W R}^{l e a f}+L_{n e t}^{l e a f}-\lambda_{v}\left(T_{a i r}\right) \cdot E_{t w o-s i d e d}}{C_{p} \cdot\left(g_{r}+g_{H a}\right)}
\]
where $\Phi_{S W R}^{\text {leaf }}$ (in $W \cdot m^{-2}$ ) is the instantaneous shortwave radiation absorbed per leaf area unit, $L_{\text {net }}^{\text {leaf }}$ is the instantaneous net long-wave radiation per leaf area unit, $E_{\text {two-sided }}$ is the flow rate $E$ converted to $\mathrm{mol} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2}$ per two-sided leaf area basis, $\epsilon$ is longwave radiation emissivity ( 0.97 ), $\sigma$ is the StephanBoltzman constant, $T_{\text {air }}$ is the temperature of the air surrounding the leaf (in ${ }^{\circ} \mathrm{C}$ ), $C_{p}=29.3 \mathrm{~J} \cdot \mathrm{~mol}^{-1} \cdot \check{z} \mathrm{C}^{-1}$ is the specific heat capacity of dry air at constant pressure and $\lambda_{v}\left(T_{\text {air }}\right)$ is the latent heat of vaporization (in $J \cdot \mathrm{~mol}^{-1}$ ) corresponding to $T_{\text {air }}$ (see utility functions in the meteoland reference manual). If canopy energy balance is performed assuming a single canopy layer $T_{\text {air }}$ corresponds to $T_{\text {can }}$, the whole-canopy air
temperature resulting from the energy balance of the previous step (see section 13.1.3). If a multi-layer canopy energy balance is used, $T_{\text {air }}$ corresponds to $T_{\text {air }, j}$, the air temperature of the canopy layer $j$ that contains the leaf. Finally, $g_{r}$ and $g_{H a}$ are the radiative and heat conductance values (in $\mathrm{mol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1}$ ), respectively (Campbell \& Norman 1998):
\[
\begin{aligned}
g_{r} & =\frac{4 \cdot \epsilon \cdot \sigma \cdot\left(T_{a i r}+273.15\right)^{3}}{C_{p}} \\
g_{H a} & =0.189 \cdot\left(u_{l e a f} / d\right)^{0.5}
\end{aligned}
\]
where $u_{\text {leaf }}$ is the leaf-level wind speed (in $m \cdot s^{-1}$ ) and $d$ is 0.72 times the leaf width (species parameter LeafWidth in $c m$ ). As before, $u_{\text {leaf }}$ corresponds to $u_{j}$, the wind-speed at the canopy layer $j$ where the leaf is located (see 23.2).

By inspecting eq. (11.1), we can conclude that transpiration flow decreases leaf temperature, whereas radiation increases it and wind speed makes it more similar to the temperature of the surrounding air. The following figures illustrate the effect of varying wind speed and flow rate on $T_{\text {leaf }}$ for two contrasted leaf widths (see function biophysics_leafTemperature):

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-134.jpg?height=814&width=1646&top_left_y=935&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 11.1: Values of $T_{\text {leaf }}$ for two leaf widths and varying values of wind speed and flow rate, calculated for $24^{\circ} \mathrm{C}$ air temperature and $740 W \cdot m^{-2}$ instantaneous absorbed radiation (including SWR and LWR).}
\end{figure}

Let us now fix wind speed at the leaf leavel to $u_{\text {leaf }}=2 \mathrm{~m} / \mathrm{s}$. The application of the above equations to the $E\left(\Psi_{\text {leaf }}\right)$ curves corresponding to the complete hydraulic network (10.4.5) yields the following $T_{\text {leaf }}\left(\Psi_{\text {leaf }}\right)$ curves:

\subsection*{11.1.2 Leaf vapor pressure deficit}

Vapor pressure deficit in the leaf ( $V P D_{\text {leaf }}$, in kPa ) is calculated as:
\[
V P D_{\text {leaf }}=e_{\text {leaf }}-e_{\text {air }}
\]

Where $e_{\text {air }}$ is the water vapor pressure of the air surrounding the leaf (but beyond the leaf boundary layer) and $e_{\text {leaf }}$ is the leaf vapor pressure, which can be calculated from leaf temperature ( $T_{\text {leaf }}$ ) and leaf water potential ( $\Psi_{\text {leaf }}$ ):
\[
e_{\text {leaf }}=e_{\text {sat }}\left(T_{\text {leaf }}\right) \cdot \exp \left\{\frac{2.17 \cdot \Psi_{\text {leaf }}}{T_{\text {leaf }}+273.15}\right\}
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-135.jpg?height=847&width=1652&top_left_y=230&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 11.2: Examples of leaf temperature functions for a hydraulic network, corresponding to fig. 10.15 and for different soil textures. Left/right panel shows values for uncavitated/cavitated supply functions.}
\end{figure}
where $e_{\text {sat }}(T)$ is a function giving the saturated vapor pressure for temperature $T$ (see utility functions of the meteoland reference manual). If a single-canopy energy balance is considered, the water vapor pressure of the air surrounding the leaf is taken as the average atmospheric water vapor pressure of the day, i.e. $e_{\text {air }}=e_{\text {atm }}$. When a multi-layer canopy energy balance is simulated, $e_{\text {air }}$ will correspond to the water vapor pressure $e_{a i r, j}$ of the canopy layer $j$ where the leaf is located.

Since $e_{\text {leaf }}$ decreases when leaf temperature decreases in eq. (11.5), increasing transpiration decreases leaf VPD as a result of decreasing leaf temperature. To illustrate this effect, let us assume the following values of relative humidity, yielding a $e_{\text {air }}=e_{\text {atm }}=1.91 \mathrm{kPa}$ :
```
RHmin = 60
RHmax = 75
VPatm = meteoland::utils_averageDailyVP(Tmin, Tmax, RHmin, RHmax)
VPatm
```

\#\# [1] 1.912181

The application of the above equation to the $T_{\text {leaf }}\left(\Psi_{\text {leaf }}\right)$ curves of fig. 11.2 yields the following $V P D_{\text {leaf }}\left(\Psi_{\text {leaf }}\right)$ curves:

Note that the VPD decreasing curves do not start at the same $V P D_{\text {leaf }}$ value despite corresponding to the same $T_{\text {leaf }}$ value, because of the effect of $\Psi_{\text {leaf }}$ on $e_{\text {leaf }}$ in eq. (11.5).

\subsection*{11.1.3 Leaf gas exchange}

Leaf diffusive conductance to water vapor ( $g_{w}$; in mol $H_{2} O \cdot s^{-1} \cdot m^{-2}$ ) and to carbon dioxide ( $g_{c}$; in $\mathrm{mol} \mathrm{CO} \mathrm{O}_{2} \cdot \mathrm{~s}^{-1} \cdot \mathrm{~m}^{-2}$ ) are obtained for each value of transpiration flow E (here expressed in $\mathrm{mol} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2}$ )

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-136.jpg?height=755&width=1671&top_left_y=224&top_left_x=227}
\captionsetup{labelformat=empty}
\caption{Figure 11.3: Examples of leaf vapour pressure deficit ( $V P D_{\text {leaf }}$ ) functions for a hydraulic network, corresponding to fig. 10.15 and for different soil textures. Left/right panel shows values for uncavitated/cavitated supply functions.}
\end{figure}
and $V P D_{\text {leaf }}$ using:
\[
\begin{aligned}
g_{w} & =E \cdot \frac{P_{a t m}}{V P D_{l e a f}} \\
g_{c} & =g_{w} / 1.6
\end{aligned}
\]

Diffusive conductance to water vapour is assumed to be result of stomatal ( $g_{s w}$ ) and boundary layer ( $g_{b w}$ ) conductances (both in $\mathrm{mol} \mathrm{H}_{2} \mathrm{O} \cdot s^{-1} \cdot m^{-2}$ ). If we estimate $g_{b w}$ using:
\[
g_{b w}=0.397 \cdot\left(u_{\text {leaf }} / d\right)^{0.5}
\]
then, stomatal conductance is:
\[
g_{s w}^{-1}=g_{w}^{-1}-g_{b w}^{-1}
\]

Ensuring here that $g_{w} \leq g_{b w}$ so that $g_{w}^{-1} \geq g_{b w}^{-1}$. The application of equations for $g_{w}, g_{b w}$ and $g_{s w}$ to the $V P D_{\text {leaf }}\left(\Psi_{\text {leaf }}\right)$ curves yields the following stomatal conductance $g_{s w}\left(\Psi_{\text {leaf }}\right)$ curves:

In the previous figure we have indicated the thresholds of $g_{s w, \min }$ and $g_{s w, \max }$, the species-specific minimum and maximum water vapour conductances (i.e. conductances when stomata are fully closed and fully open, respectively; see parameters Gswmin and Gswmax in SpParamsMED). $g_{s w}$ cannot exceed $g_{s w, \max }$ so that some flow rates may not be possible (see stomatal regulation below). However, $g_{s w, \max }$ should quickly become non-limiting as soil dries (i.e. reducing $E$ ) or $V P D_{\text {leaf }}$ increases (Sperry et al. 2017).

\subsection*{11.1.4 Leaf photosynthesis}

Rubisco-limited photosynthesis rate $A_{c}$ (in $\mu \mathrm{mol} \mathrm{CO}_{2} \cdot s^{-1} \cdot \mathrm{~m}^{-2}$ ) is modelled using (Collatz et al. 1991; Medlyn et al. 2002):
\[
A_{c}=\frac{V_{\max } \cdot\left(C_{i}-\Gamma *\right)}{C_{i}+K_{c} \cdot\left(1+O_{a} / K_{o}\right)}
\]
where $V_{\text {max }}$ is Rubisco's maximum carboxylation rate (in $\mu \mathrm{mol} C O_{2} \cdot s^{-1} \cdot m^{-2}$ ), $C_{i}$ is the internal carbon dioxide concentration (in $\mu \mathrm{mol} \cdot \mathrm{mol}^{-1}$ ), $\Gamma *$ is the compensation point (in $\mu \mathrm{mol} \cdot \mathrm{mol}^{-1}$ ), $K_{c}$ (in $\mu \mathrm{mol} \cdot \mathrm{mol}^{-1}$ ) and $K_{o}$ (in $\mathrm{mmol} \cdot \mathrm{mol}^{-1}$ ) are Michaelis-Menten constants for carboxylation and oxygenation, respectively,

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-137.jpg?height=744&width=1662&top_left_y=227&top_left_x=233}
\captionsetup{labelformat=empty}
\caption{Figure 11.4: Examples of stomatal conductance to water vapour ( $g_{s w}$ ) functions for a hydraulic network, corresponding to fig. 10.15 and for different soil textures. Left/right panel shows values for uncavitated/cavitated supply functions. Minimum and maximum conductance values ( $g_{s w, \min }=0.0045$ and $g_{s w, \max }=0.3$ ) are indicated using dashed lines.}
\end{figure}
and $O_{a}$ is the atmospheric oxygen concentration (i.e. $209 \mathrm{mmol} \cdot \mathrm{mol}^{-1}$ ). $\Gamma *, K_{c}$ and $K_{o}$ depend on leaf temperature ( $T_{\text {leaf }}$, in ${ }^{\circ} C$ ) (Bernacchi et al. 2001):
\[
\begin{aligned}
\Gamma * & =42.75 \cdot e^{\frac{37830 \cdot\left(T_{\text {leaf }}-25\right)}{298 \cdot R \cdot\left(T_{\text {leaf }}-273\right)}} \\
K_{c} & =404.9 \cdot e^{\frac{79430 \cdot\left(T_{\text {leaf }}-25\right)}{298 \cdot R \cdot\left(T_{\text {leaf }}-273\right)}} \\
K_{o} & =278.4 \cdot e^{\frac{36380 \cdot\left(T_{\text {leaf }}-25\right)}{298 \cdot R \cdot\left(T_{\text {leaf }}-273\right)}}
\end{aligned}
\]

Electron transport-limited photosynthesis $A_{e}$ (in $\mu m o l C O_{2} \cdot s^{-1} \cdot m^{-2}$ ) was obtained from Medlyn et al. (2002):
\[
\begin{aligned}
A_{e} & =\frac{J}{4} \cdot \frac{C_{i}-\Gamma *}{C_{i}+2 \cdot \Gamma *} \\
J & =\frac{\left(\alpha \cdot Q_{P A R}^{\text {leaf }}+J_{\max }\right)-\sqrt{\left(\alpha \cdot Q_{P A R}^{\text {leaf }}+J_{\max }\right)^{2}-4.0 \cdot c \cdot \alpha \cdot Q_{P A R}^{\text {leaf }} \cdot J_{\max }}}{2 \cdot c}
\end{aligned}
\]
where $\alpha=0.3$ mole $\cdot$ mol photon ${ }^{-1}$ is the quantum yield of electron transport, $Q_{\text {PAR }}^{\text {leaf }}$ is the absorbed PAR photon flux density per leaf area ( $\mu \mathrm{mol}$ photon $\cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1}$ ), which is calculated from absorbed PAR per leaf area $\left(\Phi_{P A R}^{\text {leaf }}\right.$; in $\left.W \cdot m^{-2}\right)$ :
\[
Q_{P A R}^{\text {leaf }}=\Phi_{P A R}^{\text {leaf }} \cdot 546 \cdot 0.836 \cdot 10^{-2}
\]
where 546 is the wavelength in $n m . J_{\text {max }}$ and $J$ are the maximum and actual rate of electron transport (both in $\mu \mathrm{mol} e \cdot m^{-2} \cdot s^{-1}$ ) and $c=0.9$ defines the curvature of the light-response curve. The gross assimilation rate $A$ at a given $C_{i}$ is the minimum of $A_{e}$ and $A_{c}$. To obtain a smooth $A$-vs- $C_{i}$ curve we used (Collatz et al. 1991):
\[
A=\frac{\left(A_{c}+A_{e}\right)-\sqrt{\left(A_{c}+A_{e}\right)^{2}-4.0 \cdot c^{\prime} \cdot A_{e} \cdot A_{c}}}{2 \cdot c^{\prime}}
\]
where $c^{\prime}=0.98$ is a curvature factor. The temperature dependence of $J_{\max }$ and $V_{\max }$ relative to $25^{\circ} \mathrm{C}$ (i.e., relative to input parameters $J_{\max , 298}$ and $V_{\max , 298}$ ) is modelled using Leuning (2002) (his eq. 1 with
parameters from his Table 2). The internal $C O_{2}$ concentration, $C_{i}$, needs to be known to calculate $A$ using the previous equations. Sperry et al. (2016) use a second equation for $A$ which uses $g_{c}$, the diffusive conductance to $C O_{2}$ (which includes both the stomatal conductance and boundary layer conductance):
\[
A=g_{c} \cdot\left(C_{a i r}-C_{i}\right)
\]
where $C_{\text {air }}$ is the $C O_{2}$ concentration (in $\mu \mathrm{mol} \cdot \mathrm{mol}^{-1}$ ) in the air surrounding the leaf (beyond the leaf boundary layer). If a single-layer canopy energy balance is used then $C_{\text {air }}=C_{a t m}$, the atmospheric $C O_{2}$ concentration (see weather input and parameter Catm in function defaultControl()), whereas if a multilayer canopy energy balance is used $C_{\text {air }}$ corresponds to $C_{\text {air }, j}$, the $C O_{2}$ concentration in the canopy layer $j$ where the leaf occurs, analogously to $T_{\text {air }}$ and $e_{\text {air }}$. Combining the two equations for $A$ and finding the root of the resulting equation using Newton-Raphson method allows determining $C_{i}$ and therefore $A$. Thus, after defining PAR photon flux density, atmosphere $C O_{2}$ concentration and maximum rate parameters:
```
Q = 2000
Catm = 386
Vmax298 = 100
Jmax298 = 1.67*Vmax298
```

one can obtain the following $A\left(\Psi_{\text {leaf }}\right)$ curves from $T_{\text {leaf }}\left(\Psi_{\text {leaf }}\right)$ and $g_{s w}\left(\Psi_{\text {leaf }}\right)$ :

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-138.jpg?height=744&width=1665&top_left_y=1108&top_left_x=230}
\captionsetup{labelformat=empty}
\caption{Figure 11.5: Examples of gross photosynthesis ( $A$ ) functions for a hydraulic network, corresponding to fig. 10.15 and for different soil textures. Left/right panel shows values for uncavitated/cavitated supply functions.}
\end{figure}

Finally, leaf net photosynthesis ( $A_{n}$; i.e. accounting for autotrophic respiration) is calculated as:
\[
A_{n}=A-0.015 \cdot V_{\max }
\]

\subsection*{11.2 Crown/canopy photosynthesis}

In the previous subsection we showed how to calculate photosynthesis at the leaf level, but gross or net assimilation needs to be up-scaled to the crown or canopy levels, while accounting for the variation of leaf photosynthetic conditions across canopies. In this section, we briefly describe different alternatives for canopy/crown photosynthesis and justify our modelling choice.

\subsection*{11.2.1 Multi-layer canopy photosynthesis model}

Ideally, crown or canopy photosynthesis requires repeating the calculations of leaf temperature, leaf VPD, leaf gas conductance and photosynthesis for every leaf. Multi-layer canopy models, however, divide the canopy into vertical layers and determine photosynthesis for each one (and each plant species or plant cohort, if required). Multi-layer models can account for the fact that environmental variables usually vary across the crown, including direct/diffuse absorbed radiation, air temperature, wind speed, water vapor pressure and $C O_{2}$ concentration. The amount of SWR and PAR absorbed per unit of leaf area at each canopy layer was shown in fig. 9.2.

Not only environmental factors, but leaves themselves may be different across canopy layers. Importantly, it is generally accepted that sunlit and shade leaves need to be treated separately (De Pury \& Farquhar 1997). Separating the two kinds of leaves acknowledges that they operate at different parts of the light-saturation curve. Following De Pury \& Farquhar (1997), we further assume that maximum carboxylation and electron transport rates are highest for leaves at the top of the canopy and there is a exponential decrease from there towards the bottom, where maximum rates are $50 \%$ of those at the top:
\[
\begin{aligned}
V_{\max , 298, i, j} & =V_{\max , 298, i} \cdot \exp \left(-0.713 \cdot \sum_{h>i} L A I_{h, j}^{\phi} / L A I_{i}^{\phi}\right) \\
J_{\max , 298, i, j} & =J_{\max , 298, i} \cdot \exp \left(-0.713 \cdot \sum_{h>i} L A I_{h, j}^{\phi} / L A I_{i}^{\phi}\right)
\end{aligned}
\]
where $L A I_{i, j}^{\phi}$ is the LAI value of the plant cohort $i$ at a given canopy layer $j$ and $L A I_{i}^{\phi}$ is the expanded LAI of the plant cohort. The following figure illustrate this decrease for the single-species canopy example of section 9.1.3:

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-139.jpg?height=760&width=1148&top_left_y=1433&top_left_x=487}
\captionsetup{labelformat=empty}
\caption{Figure 11.6: Decrease of Rubisco maximum carboxilation rate across the canopy}
\end{figure}

In a multi-layer canopy photosynthesis model, gross and net photosynthesis values (i.e. $A$ and $A n$ ) are determined for sunlit and shade leaves of each cohort in each canopy layer. Then, sunlit and shade photosynthesis values should be averaged across the crown for each plant cohort. Assuming that $\Psi_{\text {leaf }}$ is equal for all leaves across the crown, the function $A\left(\Psi_{\text {leaf }}\right)$ would be obtained for each plant cohort.

\subsection*{11.2.2 Big-leaf canopy photosynthesis model}

Multi-layer canopy photosynthesis models allow evaluating leaf conditions, stomatal conductance and photosynthesis for different points of the canopy. However, this comes at high computational cost. For this reason, many models implement what is called the big-leaf approximation. Assuming that wind speed, temperature, water vapor pressure and $C O_{2}$ concentration are similar for all leaves and that the distribution of photosynthetic capacity between leaves is in proportion to the profile of absorbed irradiance then the equation describing leaf photosynthesis will also represent canopy photosynthesis (Sellers et al. 1992).

\subsection*{11.2.3 Sun-shade canopy photosynthesis model}

An alternative between multi-layer and big-leaf canopy photosynthesis models is to collapse variation of photosynthetic conditions into two leaf classes: sunlit and shade leaves. While big-leaf canopy models are known to be unaccurate under some situations, sun-shade canopy models (De Pury \& Farquhar 1997) provide estimates that are close to multiple layer models (Hikosaka et al. 2016). The sun-shade canopy photosynthesis model was adopted here. Assuming that wind speed, temperature, water vapor pressure and and $C O_{2}$ concentration are similar for all leaves, sun-shade models involve the following steps:
a. Aggregate the leaf area of sunlit/shade leaves across layers:
\[
\begin{aligned}
L A I_{i}^{\text {sunlit }} & =\sum_{j=1}^{l} L A I_{i, j}^{\text {sunlit }} \\
L A I_{i}^{\text {shade }} & =\sum_{j=1}^{l} L A I_{i, j}^{\text {shade }}
\end{aligned}
\]
where $L A I_{i, j}^{\text {sunlit }}$ and $L A I_{i, j}^{\text {shade }}$ are the leaf area index of sunlit and shade leaves for cohort $i$ in canopy layer $j$, from eq. (9.8).
b. Average the SWR/PAR absorbed by leaves of each kind across layers. The average light absorbed by sunlit/shaded foliage of cohort $i$ per ground area unit is found using:
\[
\begin{aligned}
\Phi_{a b s, i}^{s u n l i t} & =\frac{\sum_{j=1}^{l} K_{a b s, i, j}^{s u n l i t}}{L A I_{i}^{s u n l i t}} \\
\Phi_{a b s, i}^{s h a d e} & =\frac{\sum_{j=1}^{l} K_{a b s, i, j}^{s h a d e}}{L A I_{i}^{s h a d e}}
\end{aligned}
\]
where $K_{a b s, i, j}^{s u n l i t}$ and $K_{a b s, i, j}^{s h a d e}$ are the light absorbed per ground area unit by sunlit/shade leaves of cohort $i$ at layer $j$ (see section 9.1.3). Analogous equations were already given for the net long-wave radiation balance of sunlit leaves $\left(L_{n e t, i}^{\text {sunlit }}\right)$ and shade leaves $\left(L_{n e t, i}^{\text {shade }}\right)$ in section 9.2.3.
c. Average the maximum carboxylation (respectively, electron transport) rates across layers, again separating sunlit and shade leaves:
\[
\begin{aligned}
V_{\text {max }, 298, i}^{\text {sunlit }} & =\frac{\sum_{j=1}^{l} V_{\text {max }, 298, i, j} \cdot L A I_{i, j}^{\text {sunlit }}}{L A I_{i}^{\text {sunlit }}} \\
V_{\text {max }, 298, i}^{\text {shade }} & =\frac{\sum_{j=1}^{l} V_{\text {max }, 298, i, j} \cdot L A I_{i, j}^{\text {shade }}}{L A I_{i}^{\text {shade }}}
\end{aligned}
\]
d. Use $V_{\text {max }, 298, i}^{\text {sunlit }}$ as $V_{\text {max }, 298}$ in Leuning (2002) to obtain $V_{\text {max }}$ for eq. (11.10); $\Phi_{S W R, i}^{\text {sunlit }}$ as $\Phi_{S W R}^{\text {leaf }}$ and $L_{\text {net }, i}^{\text {sunlit }}$ as $L_{\text {net }}^{\text {leaf }}$ in eq. (11.1); and $\Phi_{P A R, i}^{\text {sunlit }}$ as $\Phi_{P A R}^{\text {leaf }}$ in eq. (11.16) to estimate sunlit leaf photosynthesis, which can be up-scaled to the crown level multiplying by $L A I_{i}^{\text {sunlit }}$. The same would be done for shade leaves. In a sun-shade canopy model one then calls the photosynthesis function twice (i.e. once for shade leaves and once for sunlit leaves) for each plant cohort $i$.

\subsection*{11.2.4 Comparison of big-leaf, sun-shade and multi-canopy photosynthesis models}

The figure below provides the canopy photosynthesis functions obtained using the multi-layer canopy photosynthesis model (top), a sunshade canopy photosynthesis model (center) or a big-leaf photosynthesis model (bottom). These were generated using functions photo_multilayerPhotosynthesisFunction(), photo_sunshadePhotosynthesisFunction() and photo_leafPhotosynthesisFunction(), respectively, and assuming homogeneous wind, temperature and water vapor pressure through the canopy. Thus, only absorbed radiation varied across layers and leaf types. Note the coincidence between the multi-layer and the sun-shade models.

\subsection*{11.2.5 Within-canopy variation in environmental conditions}

When presenting the sun-shade photosynthesis model, we assumed constant wind, temperature, water vapor pressure and $C O_{2}$ concentration values through the canopy. If a single-layer canopy energy balance is used, $C O_{2}$ concentration and vapor pressure are assumed equal to the atmosphere (i.e., $e_{\text {air }}=e_{\text {atm }}$ and $C_{\text {air }}=C_{\text {atm }}$ ), whereas air temperature is that of the canopy (i.e., $T_{\text {air }}=T_{\text {can }}$ ), but leaf-level wind speed ( $u_{\text {leaf }}$ ) can still be different for different canopy layers. If a multi-layer canopy energy balance is used, all four environmental variables can differ between canopy layers (i.e. $T_{\text {air }, j}, e_{\text {air }, j}, C_{\text {air }, j}$ and $u_{j}$ ). In the sun-shade photosynthesis model, the question arises on how to determine layer $j$ for sunlit or shade leaves of a given cohort $i$. The choice is done by calculating the height corresponding to the mass center of sunlit leaves or shade leaves of each cohort $i$. The canopy layer $j$ where this mass center height is contained is chosen as the layer from which environmental conditions will be taken. For any given plant cohort $i$, sunlit leaves will take their environmental conditions from layers above (or equal to) those corresponding to shade leaves.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-142.jpg?height=2269&width=1589&top_left_y=241&top_left_x=265}
\captionsetup{labelformat=empty}
\caption{Figure 11.7: Whole-canopy photosynthesis functions obtained for a hydraulic network, corresponding to fig. 10.15 and different soil textures, using the multi-layer canopy photosynthesis model (top), a sunshade canopy photosynthesis model (center) or a big-leaf photosynthesis model (bottom). Left/right panel shows values for uncavitated/cavitated supply functions.}
\end{figure}

\section*{Chapter 12}

\section*{Stomatal regulation, transpiration and photosynthesis}

Plants must open their stomata to acquire $C O_{2}$ and perform photosynthesis, but doing so promotes water loss. This trade-off has resulted in a tight coordination between capacity to supply and transpire water (hydraulic conductance and diffusive conductance to water vapor) and the maximum capacity for photosynthesis (carboxylation rate and electron-transport rate). For modelling purposes, this carbon-for-water trade-off means that hydraulics, stomatal conductance, transpiration and photosynthesis need to be estimated simultaneously. In chapters 10 and 11 we introduced plant hydraulics and photosynthesis, respectively, but we did not explain how are actual transpiration and photosynthesis values determined. This depends on the sub-model chosen and is the subject of the present chapter.

\subsection*{12.1 Stomatal regulation under Sperry's sub-model}

The framework of Sperry et al. (2017) suggests estimating stomatal conductance from the instantaneous maximization of profit, defined as the difference between photosynthesis gain and hydraulic cost (both normalized for comparability). First, transpiration and photosynthesis is estimated separately for sunlit and shade leaves according to this framework. An average transpiration rate is then determined depending on sunlit/shade transpiration rates and their leaf area contributions. Finally, the instantaneous transpiration and assimilation rates of each time step are scaled to the duration of the time step and to the leaf area of the plant cohort. The following sections provide details for all these steps.

\subsection*{12.1.1 Water supply and sunlit/shade photosynthesis functions}

Let us start by summarizing the concepts introduced in the last two chapters. The supply function described in chapter 10 describes the rate of transpiration flow as a function of the pressure drop between the soil and the leaf, and incorporates both soil, xylem and leaf hydraulic constrains (Sperry et al. 1998, 2016; Sperry \& Love 2015). Here we assume that hydraulic conductance $k$ is in $\mathrm{mmol} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2} \cdot M \mathrm{~Pa}^{-1}$ of leaf area, transpiration rate $E_{\text {leaf }}$ in $\mathrm{mmol} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2}$ of leaf area and leaf water potential $\Psi_{\text {leaf }}$ is in MPa.

According to section 11.1, each $E_{\text {leaf }}$ value implies an energy balance at the leaf level, stomatal conductance to water vapour and a particular value of leaf photosynthesis. More specifically, for each pair of $E_{\text {leaf }}$ and $\Psi_{\text {leaf }}$ values, we have a corresponding leaf temperature ( $T_{\text {leaf }}$; in ${ }^{\circ} \mathrm{C}$ ), leaf-to-air vapor pressure deficit ( $V P D_{\text {leaf }}$; in kPa ), leaf water vapor conductance ( $g_{s w}$; in $m o l \mathrm{H}_{2} O \stackrel{\circ}{\mathrm{u}} s^{-1} \stackrel{\circ}{\mathrm{u}} m^{-2}$ ) and, finally the leaf gross and net (i.e. after accounting for autotrophic respiration) photosynthesis assimilation rates ( $A_{g}$ and $A_{n}$;
both in $\mu \mathrm{mol} \mathrm{CO}_{2} \stackrel{\circ}{\mathrm{u}} s^{-1} \stackrel{\circ}{\mathrm{u}} m^{-2}$ ). In short, the supply function generates a photosynthesis function. Since the model deals with canopies and not single leaves, however, different parts of the crowns of plant cohorts may be in different canopy positions. Calculating photosynthesis at the canopy level requires dividing the canopy into vertical layers, differentiating between sunlit and shade leaves and determining photosynthesis functions for sunlit and shade leaves separately, as explained in section 11.2.

\subsection*{12.1.2 Leaf stomatal regulation by profit maximization}

Wolf et al. (2016) proposed the carbon maximization criterion, which states that at each instant in time the stomata regulate canopy gas exchange and pressure to achieve the maximum profit, which is the maximum difference between photosynthetic gains and costs, the latter associated with hydraulic vulnerability attained with low water potentials. Such approach has been shown to be supported by data from global forest biomes (Anderegg et al. 2018). Building on this approach, Sperry et al. (2017) presented a profit maximization function where hydraulic costs of opening the stomata are compared against photosynthetic gains. Details of their formulation are given in this section. Stomatal regulation is performed in medfate separatedly for sunlit and shade leaves.

\subsection*{12.1.2.1 Cost and gain functions}

The hydraulic supply function is used to derive a transpirational cost function $\theta_{1}\left(\Psi_{\text {leaf }}\right)$ that reflects the increasing damage from cavitation and the greater difficulty of moving water along the continuum (Sperry et al. 2016):
\[
\theta\left(\Psi_{\text {leaf }}\right)=\frac{k_{c, \text { max }}-k_{c}\left(\Psi_{\text {leaf }}\right)}{k_{c, \text { max }}-k_{\text {crit }}}
\]
where $k_{c}\left(\Psi_{\text {leaf }}\right)=d E / d \Psi(\Psi)$ is the slope of the supply function corresponding to (leaf) water potential $\Psi_{\text {leaf }}, k_{c, \text { max }}$ is the maximum slope of the supply function (which occurs when $E_{\text {leaf }}=0$ ), i.e. the maximum whole-plant conductance for the current soil moisture conditions, and $k_{\text {crit }}=k_{c}\left(\Psi_{\text {crit }}\right)$ is the slope of the supply function at $E_{\text {leaf }}=E_{\text {crit }}$ the critical flow beyond which hydraulic failure occurs.

The following figures illustrate the $\theta\left(\Psi_{\text {leaf }}\right)$ curves corresponding to the supply functions:
The normalized photosynthetic gain function $\beta\left(\Psi_{\text {leaf }}\right)$ reflects the actual assimilation rate with respect to the maximum (Sperry et al. 2016):
\[
\beta\left(\Psi_{\text {leaf }}\right)=\frac{A\left(\Psi_{\text {leaf }}\right)}{A_{\max }}
\]
where $A_{\text {max }}$ is the instantaneous maximum (gross) assimilation rate estimated over the full $\Psi_{\text {leaf }}$ range (including values that imply a stomatal conductance larger than the maximum).
The following figures illustrate the $\beta\left(\Psi_{\text {leaf }}\right)$ curves corresponding to the supply and assimilation functions:

\subsection*{12.1.2.2 Profit maximization at the leaf level}

Sperry et al. (2017) suggested that stomatal regulation can be effectively estimated by determining the maximum of the profit function $\left(\operatorname{Profit}\left(\Psi_{\text {leaf }}\right)\right)$ :
\[
\operatorname{Profit}\left(\Psi_{\text {leaf }}\right)=\beta\left(\Psi_{\text {leaf }}\right)-\theta\left(\Psi_{\text {leaf }}\right)
\]

The maximization is achieved when the slopes of the gain and cost functions are equal:
\[
\frac{\delta \beta\left(\Psi_{\text {leaf }}\right)}{\delta \Psi_{\text {leaf }}}=\frac{\delta \theta\left(\Psi_{\text {leaf }}\right)}{\delta \Psi_{\text {leaf }}}
\]

Instantaneous profit maximization assumes a 'use it or lose it' reality with regards to available soil water. Because the gain function accelerates more quickly from zero and reaches 1 sooner than the cost function, their

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-145.jpg?height=830&width=1671&top_left_y=306&top_left_x=227}
\captionsetup{labelformat=empty}
\caption{Figure 12.1: Cost functions (i.e. $\theta\left(\Psi_{\text {leaf }}\right)$ ) obtained for a hydraulic network, corresponding to fig. 10.15 and different soil textures and soil water potentials. Left/right panels show values for uncavitated/cavitated supply functions, respectively.}
\end{figure}

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-145.jpg?height=831&width=1665&top_left_y=1441&top_left_x=230}
\captionsetup{labelformat=empty}
\caption{Figure 12.2: Gain function ( $\beta\left(\Psi_{\text {leaf }}\right)$ ) obtained for a hydraulic network, corresponding to fig. 10.15 and different soil textures and soil water potentials. Left/right panels show values for uncavitated/cavitated supply functions, respectively.}
\end{figure}
maximum difference occurs at intermediate $\Psi_{\text {leaf }}$ values. Once $\Psi_{\text {leaf }}$ that maximizes profit is determined, the values of the remaining variables are also determined. At this point, it may happen that $g_{s w}\left(\Psi_{l e a f}\right)$ is lower than the minimum (i.e. cuticular) water vapor conductance ( $g_{s w, \min }$ ) or larger than the maximum water vapor conductance ( $g_{s w, \max }$ ). These thresholds need to be taken into account when determining the maximum of the profit function.

The following figures illustrate the $\operatorname{Profit}\left(\Psi_{\text {leaf }}\right)$ curves of corresponding to the previous cost and gain curves:

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-146.jpg?height=849&width=1665&top_left_y=574&top_left_x=230}
\captionsetup{labelformat=empty}
\caption{Figure 12.3: Profit functions (i.e. $\left.\operatorname{Profit}\left(\Psi_{\text {leaf }}\right)\right)$ obtained for a hydraulic network, corresponding to fig. 10.15 and different soil textures and soil water potentials. Left/right panels show values for uncavitated/cavitated supply functions, respectively.}
\end{figure}

Squares in the previous figures indicate the maximum profit points in each situation. The drier the soil, the closer is the maximum profit $\Psi_{\text {leaf }}$ to soil water potential as one would expect intuitively (i.e. a smaller drop in water potential along the hydraulic pathway). Note that when the soil is very dry the squares are to the right of the true maximum. This is because the transp_profitMaximization() function takes into account the minimum and maximum stomatal conductance and, in this case, does not allow optimum stomatal conductances below the minimum (cuticular) value.

Note that $\theta, \beta$ and Profit functions can be expressed as a function of stomatal conductance, instead of leaf water potential. This allows visualizing more clearly the effect of $g_{s w, \min }$ and $g_{s w, \max }$ thresholds on the maximum profit optimization strategy, as illustrated in the following figures.

\subsection*{12.1.3 Cohort-level transpiration}

In the previous section, we considered stomatal regulation at the leaf level only. At the plant cohort level, the gain function could be build from a crown photosynthesis function $A\left(\Psi_{\text {leaf }}\right)$, as shown in section 11.2. However, applying the profit maximization approach for a single crown photosynthesis function would imply the assumption that the same stomatal aperture occurs in all leaves of the plant cohort, independently of whether they are in shade or sunlit. A more realistic approach is to determine stomatal regulation by profit maximization for sunlit and shade leaves separately. The gain function and profit maximization calculations conducted for each leaf type yield instantaneous leaf water potentials $\Psi_{\text {leaf }}^{\text {sunlit }}$ and $\Psi_{\text {leaf }}^{\text {shade }}$ and instantaneous flow values $E^{\text {shade }}$ and $E^{\text {sunlit }}$ from the supply functions. The corresponding photosynthesis functions allow

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-147.jpg?height=841&width=1654&top_left_y=227&top_left_x=238}
\captionsetup{labelformat=empty}
\caption{Figure 12.4: Profit function as a function of stomatal conductance, corresponding to fig. 12.3 and different soil textures and soil water potentials. Left/right panels show values for uncavitated/cavitated supply functions, respectively.}
\end{figure}
determining values for leaf temperatures $T_{\text {leaf }}^{\text {sunlit }}$ and $T_{\text {leaf }}^{\text {shade }}$, vapour pressure deficits $V P D_{\text {leaf }}^{\text {sunlit }} V P D_{\text {leaf }}^{\text {shade }}$, stomatal conductance $g_{s w}^{s u n l i t}$ and $g_{s w}^{s h a d e}$ and net photosynthesis rates $A_{n}^{s u n l i t}$ and $A_{n}^{s h a d e}$. This is a lot of useful information at the leaf level for each plant cohort $i$, but we also need transpiration and photosynthesis values at the plant cohort-level.

The average instantaneous flow rate ( $E_{i}^{\text {average }}$, in $\mathrm{mmol} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{s}^{-1} \cdot \mathrm{~m}^{-2}$ ) per leaf area unit of plant cohort $i$ is the weighed average:
\[
E_{i}^{\text {average }}=\frac{E_{i}^{\text {shade }} \cdot L A I_{i}^{\text {sunlit }}+E_{i}^{\text {shade }} \cdot L A I_{i}^{\text {shade }}}{L A I_{i}^{\phi}}
\]
where $L A I_{i}^{\text {sunlit }}$ and $L A I_{i}^{\text {shade }}$ are the cohorts LAI values for sunlit and shade leaves, from eq. (9.8), and $L A I_{i}^{\phi}$ is the leaf area index of plant cohort $i$. The model then uses the hydraulic supply function to find the transpiration rate $E_{i}$ numerically closest to $E_{i}^{\text {average }}$ (remember that the supply function is build in discrete steps). Finding the $E_{i}$ value numerically closest to $E_{i}^{\text {average }}$ determines the $E_{i, t}$ the instantaneous transpiration flow for current time step $t$, and also leads to setting values for $t$ of several other variables, such as water potentials ( $\Psi_{\text {leaf }, i, t}, \Psi_{\text {stem }, i, t}, \Psi_{\text {rootcrown }, i, t}, \ldots$ ), the slope of the supply function ( $\left(d E / d \Psi_{i}\right)_{t}$ ), and instantaneous soil water extraction rates ( $E_{i, s, t}$ ).

\subsection*{12.2 Stomatal regulation and transpiration under Sureau's submodel}

\subsection*{12.2.1 Transpiration flows}

In Sureau-ECOS (Ruffault et al. 2022), plants lose water through stomatal transpiration ( $E_{\text {stom }}$ ), cuticular transpiration of the leaf ( $E_{\text {leaf,cuti }}$ ) and cuticular transpiration of the stem ( $E_{\text {stem,cuti }}$ ), see Fig. 10.2.

The total plant transpiration $E_{\text {Plant }}$ is decomposed as the sum of the average leaf transpiration and wood cuticular transpiration:
\[
E_{\text {plant }}=E_{\text {leaf,average }}+E_{\text {stem,cuti }}
\]
where $E_{\text {leaf,average }}$ is computed as the weighted average of sunlit and shade leaf transpiration:
\[
E_{\text {leaf }, \text { average }}=\frac{E_{\text {sunlit }} \cdot L A I^{\text {sunlit }}+E_{\text {leaf }, \text { shade }} \cdot L A I^{\text {shade }}}{L A I^{\phi}}
\]

In turn, $E_{\text {leaf,sunlit }}$ and $E_{\text {leaf,shade }}$ are the result of considering stomatal transpiration and cuticular transpiration:
\[
\begin{aligned}
E_{\text {leaf }} & =E_{\text {stom }}+E_{\text {leaf,cuti }} \\
& =\left(\frac{1}{g_{\text {stom }}+g_{\text {leaf,cuti }}}+\frac{1}{g_{\text {bound }}}+\frac{1}{g_{\text {crown }}}\right)^{-1} \cdot \frac{V P D_{\text {leaf }}}{P_{\text {atm }}}
\end{aligned}
\]
where $V P D_{\text {leaf }}$ (in MPa ) is the vapor pressure deficit of the leaf, $P_{a t m}$ is the atmospheric pressure, $g_{s t o m}$ is the stomatal conductance, $g_{\text {leaf,cuti }}$ is the cuticular conductance of the leaf, $g_{\text {bound }}$ is the conductance of the leaf boundary layer and $g_{\text {crown }}$ is the conductance of the tree crown. Note that sunlit and shade leaves will differ in $g_{\text {stom }}, g_{\text {leaf,cuti }}$ and $V P D_{\text {leaf }}$, because of their different radiation and heat balance.
Finally, $E_{\text {stem,cuti }}$ is calculated as follows:
\[
E_{\text {stem }, \text { cuti }}=\left(\frac{1}{g_{\text {stem }, \text { cuti }}}+\frac{1}{g_{\text {bound }}}+\frac{1}{g_{\text {crown }}}\right)^{-1} \cdot \frac{V P D_{\text {air }}}{P_{\text {atm }}}
\]
where $V P D_{\text {air }}$ is the vapour pressure deficit in the canopy air:
\[
V P D_{a i r}=e_{s a t}\left(T_{a i r}\right)-e_{a i r}
\]

\subsection*{12.2.2 Cuticular conductances}
$g_{\text {leaf,cuti }}$ is a function of leaf temperature ( $T_{\text {leaf }}$ ), which is based on a single or double Q10 equation depending on whether leaf temperature is above or below the transition phase temperature ( $T_{\text {phase }}$ ). If $T_{\text {leaf }} \leq T_{\text {phase }}$ we have:
\[
g_{\text {leaf }, \text { cuti }}=g_{\text {leaf }, \text { cuti }, 20} \cdot Q_{10 a^{10}}^{\frac{T_{\text {leaf }}-20}{10}}
\]
whereas if $T_{\text {leaf }}>T_{\text {phase }}$ we have:
\[
g_{\text {leaf }, \text { cuti }}=g_{\text {leaf }, \text { cuti, } 20} \cdot Q_{10 a^{\frac{T_{\text {leaf }}-20}{10}}}^{10} \cdot Q_{10 b}^{\frac{T_{\text {leaf }}-T_{\text {phase }}}{10}}
\]

Sunlit and shade leaves will have different $g_{\text {leaf,cuti }}$ because of their different temperature. Unlike $g_{\text {leaf,cuti }}$, $g_{\text {stem,cuti }}$ is assumed non temperature dependent.

\subsection*{12.2.3 Stomatal conductance}
$g_{\text {stom }}$ is the stomatal conductance taking into account the dependence of stomata on light and temperature, as well as water status:
\[
g_{\text {stom }}=\lambda\left(\Psi_{\text {leaf }, \text { sym }}\right) \stackrel{\circ}{\mathrm{u}} g_{\text {stom }, \text { jarvis }}
\]
where $g_{\text {stom, jarvis }}$ is the stomatal conductance without water stress and is determined as a function of light and temperature following Jarvis (1976). $\lambda$ is a regulation factor that varies between 0 and 1 to represent stomatal closure according to leaf symplasmic water potential ( $\Psi_{\text {leaf }, \text { sym }}$ ) using sigmoid-type function:
\[
\left.\lambda\left(\Psi_{\text {leaf }, \text { sym }}\right)=1-\left(1+e^{\left(\text {slope }_{\text {gs }} / 25\right) \cdot\left(\Psi_{\text {leaf }, \text { sym }}-\Psi 50_{\text {gs }}\right.}\right)\right)^{-1}
\]
depending on the potential at $50 \%$ of stomatal closure $\left(\Psi 50_{g s}\right)$ and a shape parameter $\left(\right.$ slope $\left._{g s}\right)$ describing the rate of decrease in stomatal conductance per unit of water potential drop.
With the current implementation, $\lambda$ will be the same for sunlit and shade leaves (i.e. there is only one symplasmic water potential for both kind of leaves), but $g_{\text {stom, jarvis will differ because of the different light }}$ and temperature conditions.

\subsection*{12.3 Cohort-level transpiration and photosynthesis}

The amount of transpiration from the plant cohort in a given time step $t\left(\operatorname{Tr}_{i, t}\right.$, in $l \cdot m^{-2}$ of ground area, i.e. in mm ) is:
\[
\operatorname{Tr}_{i, t}=E_{i, t} \cdot L A I_{i}^{\phi} \cdot f_{d r y} \cdot 10^{-3} \cdot 0.01802 \cdot \Delta t_{\text {step }}
\]
where 0.01802 is the molar weight (in $k g=l$ ) of water and $\Delta t_{\text {step }}=86400 / n_{t}$ the size of the time step in seconds, being $n_{t}$ the number of time steps. $f_{d r y}$ is the fraction of the canopy that is assumed dry, which is necessary to avoid overestimating total evapo-transpiration. In non-rainy days $f_{d r y}=1$ whereas in rainy days it is derived from comparing the daily evaporation due to rainfall interception ( $I n ;$ in $m m$ ) with Penman's potential evapo-transpiration ( $P E T$; in $m m$ ):
\[
f_{d r y}=1.0-\frac{I n}{P E T}
\]

Soil extraction rates ( $E x$ ) are scaled to the cohort level as done for transpiration:
\[
E x_{i, s, t}=E_{i, s, t} \cdot L A I_{i}^{\phi} \cdot f_{d r y} \cdot 10^{-3} \cdot 0.01802 \cdot \Delta t_{s t e p}
\]

If plant capacitance is not considered, one should have that soil extraction equals transpiration:
\[
T r_{i, t}=E x_{i, t}=\sum_{s} E x_{i, s, t}
\]

Instantaneous net photosynthesis per leaf area of sunlit and shade leaves in a given time step $t$ (i.e. $A_{n, i, t}^{\text {sunlit }}$ and $A_{n, i, t}^{\text {shade }}$ ) are also aggregated into $A_{n, i, t}$, the net photosynthesis of the plant cohort $i$ for the time step $t$, in $g C \cdot m^{-2}$ of ground area:
\[
A_{n, i, t}=\left(A_{n, i, t}^{\text {sunlit }} \cdot L A I_{i}^{\text {sunlit }}+A_{n, i, t}^{\text {shade }} \cdot L A I_{i}^{\text {shade }}\right) \cdot 10^{-6} \cdot 12.01017 \cdot \Delta t_{\text {step }}
\]

\subsection*{12.4 Cavitation and conduit refilling}

Like with the basic water balance model, the advanced water balance model is normally run assuming that although soil drought may reduce transpiration. Embolized xylem conduits may be automatically refilled when soil moisture recovers if stemCavitationRecovery = "total". Automatic refilling is always assumed for root segments, but not for leaves and stems. There are three other options to deal with leaf and stem xylem cavitation besides automatic refilling. Any of them cause the model to keep track of the proportion of lost conductance in the leaf and stem xylem of the plant cohort $i\left(P L C_{\text {leaf }, i}\right.$ and $\left.P L C_{\text {stem }, i}\right)$ at successive time steps:
\[
\begin{aligned}
P L C_{\text {leaf }, i, t} & =\max \left\{P L C_{\text {leaf }, i, t-1}, 1-k_{\text {leaf }, i}\left(\Psi_{\text {leaf }}\right) / k_{\text {max }, \text { leaf }, i}\right\} \\
P L C_{\text {stem }, i, t} & =\max \left\{P L C_{\text {stem }, i, t-1}, 1-k_{\text {stem }, i}\left(\Psi_{\text {stem }}\right) / k_{\text {max }, \text { stem }, i}\right\}
\end{aligned}
\]

When water compartments are not considered, this equation is evaluated every hour time step, whereas it is evaluated every 1 s with water compartments, as part of the constitutive equations (see ??).

For simulations of less than one year one can use stemCavitationRecovery $=$ "none" to keep track of the maximum drought stress. However, for simulations of several years, it is normally advisable to allow recovery. If stemCavitationRecovery $=$ "annual", $P L C_{\text {leaf }, i}$ and $P L C_{\text {stem }, i}$ values are set to zero at the beginning of each year, assuming that embolized plants overcome the conductance loss by creating new xylem tissue. Finally, if stemCavitationRecovery = "rate" the model simulates stem refilling at daily steps as a function of symplasmic water potential. First, a daily recovery rate ( $r_{\text {refill }}$; in $\mathrm{cm}^{2} \cdot \mathrm{~m}^{-2} \cdot d a y^{-1}$ ) is estimated as a function of $\Psi_{\text {symp,stem }}$ :
\[
r_{\text {refill }}\left(\Psi_{\text {symp }, \text { stem }}\right)=r_{\max , \text { refill }} \cdot \max \left\{0.0,\left(\Psi_{\text {symp }, \text { stem }}+1.5\right) / 1.5\right\}
\]

Where $r_{\text {max }}$, refill is the control parameter cavitationRecoveryMaximumRate indicating a maximum refill rate. The right part of the equation normalizes the water potential, so that $r_{\text {refill }}=r_{\text {refill,max }}$ if $\Psi_{\text {symp,stem }}=0$ and $r_{\text {refill }}=0$ if $\Psi_{\text {symp,stem }}<=-1.5 \mathrm{MPa}$. The proportion of conductance lost in leaves and stem are then updated using:
\[
\begin{aligned}
P L C_{\text {leaf }, i} & =\max \left\{0.0, P L C_{\text {leaf }, i}-\left(r_{\text {refill }} / H_{v}\right)\right\} \\
P L C_{\text {stem }, i} & =\max \left\{0.0, P L C_{\text {stem }, i}-\left(r_{\text {refill }} / H_{v}\right)\right\}
\end{aligned}
\]
where $H_{v}$ is the Huber value in units of $c m^{2} \cdot m^{-2}$.

\section*{Chapter 13}

\section*{Closing energy balances}

In chapter 9 we described the details of radiation energy transfer. Transpiration is an important latent heat component of the energy balance, and the details of how plant transpiration is determined were given in chapters 10, 11 and 12. This chapter explains how to calculate the remaining components of the canopy energy balance, while distinguishing between assuming a single-layer canopy or considering a multiple-layer canopy.

\subsection*{13.1 Single-layer canopy}

The first part of the section describes the calculation of latent heat and convective energy exchanges between the soil, canopy and atmosphere layers. These are the remaining energy components that are needed to close the energy balances of the canopy (eq. (7.3)) and soil layers (eqs. (7.5) and (7.6)). Temperature changes applied to the canopy and soil layers are also described.

\subsection*{13.1.1 Latent heat}

Canopy exchanges of latent heat include latent heat exchanged from plant transpiration and evaporation of rain intercepted by the canopy. In the single-layer canopy energy balance, vaporisation latent heat exchange for the whole canopy ( $L E_{\text {vap }, \text { can }}$; in $W \cdot m^{-2}$ ) is calculated as:
\[
L E_{\text {vap }, \text { can }}=\lambda_{v}\left(T_{\text {can }}\right) \cdot\left(\frac{I n_{t}+\sum_{i=1}^{c} T r_{i, t}}{\Delta t_{\text {step }}}\right)
\]
where $\lambda_{v}\left(T_{\text {can }}\right)$ is the latent heat of vaporization at temperature $T_{\text {can }}$ (in $J \mathrm{u} \mathrm{kg}^{-1}$ ), $T r_{i, t}$ is the amount (in $m m=k g \cdot m^{-2}$ ) of transpiration for cohort $i$ during time step $t(12.16)$, and $I n_{t}$ is the amount of intercepted water evaporated from the canopy for time step $t$ (total daily interception In is divided into timesteps according to the proportion of shortwave radiation absorbed by the canopy at each time step).
Fusion latent heat due to snow melting ( $L E_{f u s, s o i l}$; in $W \cdot m^{-2}$ ) is estimated using:
\[
L E_{\text {fus }, \text { snow }}=\frac{\lambda_{f} \cdot S m_{t}}{\Delta t_{\text {step }}}
\]
where $\lambda_{f}=0.33355 J \mathrm{u} \mathrm{kg}^{-1}$ is the latent heat of fusion. The latent heat exchange between the soil and the atmosphere comes as vaporisation latent heat from water evaporated from the soil surface ( $L E_{\text {vap,soil }}$; in $W \cdot \mathrm{~m}^{-2}$ ). It is estimated from water flow in $\mathrm{mm}=\mathrm{kg} \cdot \mathrm{m}^{-2}$ using:
\[
L E_{\text {vap }, \text { soil }}=\frac{\lambda_{v}\left(T_{\text {soil }}\right) \cdot E s_{t}}{\Delta t_{\text {step }}}
\]
where $\lambda_{v}\left(T_{\text {soil }}\right)$ is the latent heat of vaporization at temperature $T_{\text {soil }}$.
As before, daily evaporation from bare soil ( $E s$ ) and snow melt water equivalent ( $S m$ ) are divided into time steps according to the proportion of shortwave radiation absorbed by the soil layer each step.

\subsection*{13.1.2 Convective energy}

Convective energy fluxes between atmosphere and the canopy ( $H_{\text {can,atm }}$ ) and between the canopy and the soil ( $H_{\text {can }, \text { soil }}$ ) are determined as follows:
\[
\begin{aligned}
H_{c a n, a t m} & =\frac{\rho_{a t m} \cdot c_{p}}{r_{c a n, a t m}} \cdot\left(T_{c a n}-T_{a t m}\right) \\
H_{c a n, s o i l} & =\frac{\rho_{c a n} \cdot c_{p}}{r_{c a n, s o i l}} \cdot\left(T_{c a n}-T_{s o i l, 1}\right)
\end{aligned}
\]
where $\rho_{a t m}$ and $\rho_{c a n}$ are the air density above-canopy and inside-canopy, respectively, calculated from the corresponding temperatures (see utility functions in meteoland reference manual); $c_{p}=1013.86 \mathrm{~J} \stackrel{\circ}{\mathrm{k}} \mathrm{kg}^{-1} \stackrel{\circ}{\mathrm{u}} \mathrm{C}^{-1}$ is the specific heat capacity of the air. $r_{c a n, a t m}$ and $r_{c a n, s o i l}$ are the atmosphere-canopy and canopy-soil aerodynamic resistances (in $s$ ů $m^{-1}$ ). These, in turn, are calculated using the FAO56 calculation procedure and canopy height, total LAI and above-canopy and below-canopy wind speeds. Wind speed below the canopy is calculated as explained in 23.2 assuming a height of 2 m .

\subsection*{13.1.3 Canopy temperature changes}

After evaluating the canopy energy balance equation (7.3) one has to translate energy balance into temperature variation of the canopy. Rearranging the same equation and expressing it in discrete time steps we have:
\[
\Delta T_{c a n}=\Delta t_{s t e p} \cdot \frac{K_{a b s, c a n}+L_{n e t, c a n}-L E_{c a n}-H_{c a n, a t m}-H_{c a n, s o i l}}{T C_{c a n}}
\]
where $T C_{c a n}$ is the canopy thermal capacitance (in $J \cdot m^{-2} \cdot K^{-1}$ ) and $\Delta t_{\text {step }}=86400 / n_{t}$ is the size of the time step in seconds. Canopy thermal capacitance depends on the leaf area index of the stand:
\[
T C_{c a n}=T C_{L A I} \cdot \frac{0.8 \cdot L A I_{s t a n d}+1.2 \cdot\left(L A I_{s t a n d}^{p h i}+\cdot L A I_{s t a n d}^{d e a d}\right)}{2}
\]
where $T C_{L A I}$ is the thermal capacitance per LAI unit, which is specified by the control parameter thermalCapacityLAI. By using both the maximum leaf area of the stand, $L A I_{\text {stand }}$, and its current live/dead leaf area ( $L A I_{\text {stand }}^{\text {phi }}+L A I_{\text {stand }}^{\text {dead }}$ ) it is assumed that part of thermal capacitance corresponds to stems and branches, so that capacitance does not drop to zero for deciduous canopies.

\subsection*{13.1.4 Soil temperature changes}

Analogously to the canopy, the change in temperature for a given soil layer $s$ in the current time step is given by rearranging eq. (7.6):
\[
\Delta T_{\text {soil }, s}=\Delta t_{\text {step }} \cdot \frac{G_{s-1, s}-G_{s, s+1}}{C_{\text {soil }, s}}
\]
where the energy balance on each soil layer $s$ depends on the balance between energy coming from above ( $G_{s-1, s}$ ) and energy going to below ( $G_{s, s+1}$ ) and $C_{s o i l, s}$, the thermal capacitance of soil layer $s$. Energy inflow to the first (uppermost) layer (i.e. $G_{0,1}$ ) is the result of energy exchanges between the soil layer and the canopy and atmosphere, i.e. from eq. (7.5):
\[
G_{0,1}=K_{\text {soil }}+L_{\text {net,soil }}+H_{\text {can,soil }}-L E_{\text {soil }}
\]

Heat conduction between layers $s$ and $s+1$ (i.e. $G_{s, s+1}$ ) depend on the soil temperature gradient (see function soil_temperatureGradient():
\[
G_{s, s+1}=\lambda_{s o i l, s} \cdot \frac{\delta T_{s o i l, s}}{\delta z}=\lambda_{s o i l, s} \cdot \frac{T_{s o i l, s}-T_{s o i l, s+1}}{\left(Z_{s-1}-Z_{s+1}\right) / 2}
\]
where $Z_{s-1}$ and $Z_{s+1}$ are expressed in $m$ and $\lambda_{s o i l, s}$ is the thermal conductivity of layer $s$, calculted from soil moisture and texture following Dharssi et al. (2009) (see function soil_thermalconductivity()). The gradient in the lowermost layer is calculated assuming a temperature of the earth (at 10 m ) of 15.5 Celsius.

Finally, $C_{\text {soil, } s}$ the thermal capacitance of soil layer $s$ is calculated as:
\[
C_{\text {soil }, s}=V T C_{\text {soil,s }} \cdot d_{s}
\]
where $d_{s}$ is the soil width of layer $s$ (expressed in $m$ ) and $V T C_{s}$ is the volumetric thermal capacity of soil layer $s$ (in $J \cdot m^{-3} \cdot K^{-1}$ ), calculated from soil moisture and texture following a simplification of Cox et al. (1999) (see function soil_thermalcapacity()).

\subsection*{13.2 Multi-layer canopy}

A multi-layer canopy energy balance requires the calculation of sensible heat and latent heat exchanges between the air in each canopy layer and the leaves it contains. In addition, one has to consider heat exchanges between each layer and the ones below/above, derived from turbulent flow.

\subsection*{13.2.1 Latent heat of vaporization}

The latent heat of vaporization for a given canopy layer $j\left(L E_{\text {vap }, j}\right.$; in $\left.W \cdot m^{-2}\right)$ includes transpiration and evaporation of intercepted rain, and is estimated analogously to the single-canopy case (eq. (13.1)):
\[
L E_{\text {vap }, j}=\lambda_{v}\left(T_{\text {air }, j}\right) \cdot\left(\frac{I n_{j, t}}{\Delta t_{\text {step }}}+E_{j, t}\right)
\]
where $\lambda_{v}\left(T_{\text {air }, j}\right)$ is the latent heat of vaporization at temperature $T_{\text {air }, j}\left(\right.$ in $\left.J \mathrm{u} \mathrm{kg}^{-1}\right), I n_{j, t}$ is the intercepted water that is evaporated from the canopy layer, determined by dividing $I n_{t}$ among canopy layers according to the fraction of total LAI in each one:
\[
I n_{j, t}=I n_{t} \cdot \frac{\sum_{i=1} L A I_{i, j}^{\phi}}{L A I_{\text {stand }}^{\phi}}
\]
and $E_{j, t}$ is the instantaneous transpiration rate in layer $j$ (in $\mathrm{kg} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1}$ ), given by:
\[
E_{j, t}=10^{-3} \cdot 0.01802 \cdot \sum_{i=1}^{c} E_{i, t}^{\text {sunlit }} \cdot L A I_{i, j}^{\text {sunlit }}+E_{i, t}^{\text {shade }} \cdot L A I_{i, j}^{\text {shade }}
\]
where $E_{i, t}^{\text {sunlit }}$ and $E_{i, t}^{\text {shade }}$ are the instantaneous transpiration rates (in $\mathrm{mmol} \mathrm{H}_{2} \mathrm{O} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1}$ ) of sunlit and shade leaves, respectively, of cohort $i$ during time step $t$; and $L A I_{i, j}^{\text {sunlit }}$ and $L A I_{i, j}^{\text {shade }}$ are the leaf area index of sunlit and shade leaves, respectively, of cohort $i$ in layer $j$ (9.8).

Latent heat derived from soil water evaporation and snow melting ( $L E_{\text {vap, soil }}$ and $L E_{\text {fus, snow }}$; in $W \cdot m^{-2}$ ) are estimated as in the single-canopy case, using eqs. (13.3) and (13.2).

\subsection*{13.2.2 Sensible heat between leaves and the canopy air space}

The sensible heat exchanged between the air of canopy layer $j$ and the leaves within it ( $H_{\text {leaf }, j} ; W \cdot m^{-2}$ ) is obtained using:
\[
H_{\text {leaf }, j}=\sum_{i=1}^{c} L A I_{i, j}^{\text {sunlit }} \cdot H_{i, j}^{\text {sunlit }}+L A I_{i, j}^{\text {shade }} \cdot H_{i, j}^{\text {shade }}
\]
where $L A I_{i, j}^{\text {sunlit }}$ and $L A I_{i, j}^{\text {shade }}$ are the leaf area index of sunlit and shade leaves of plant cohort $i$ in layer $j$, respectively (see eq. (9.8)). $H_{i, j}^{\text {sunlit }}$ and $H_{i, j}^{\text {shade }}$ are the sensible heat exchange between layer $j$ and sunlit or shade leaves of cohort $i$ (Ma \& Liu 2019):
\[
\begin{aligned}
H_{i, j}^{\text {sunlit }} & =-2 \cdot C_{p} \cdot\left(T_{\text {leaf }, i}^{\text {sunlit }}-T_{\text {air }, j}\right) \cdot g_{H a, i, j} \\
H_{i, j}^{\text {shade }} & =-2 \cdot C_{p} \cdot\left(T_{\text {leaf }, i}^{\text {shade }}-T_{a i r, j}\right) \cdot g_{H a, i, j}
\end{aligned}
\]
where $T_{\text {leaf }, i}^{\text {sunlit }}$ and $T_{\text {leaf }, i}^{\text {shade }}$ are, respectively, the sunlit and shade leaf temperatures for cohort $i$ (determined using eq. (11.1)); $T_{\text {air }, j}$ is the current air temperature in canopy layer $j, C_{p}=29.37152 \mathrm{~J} \cdot \mathrm{~mol}^{-1} \cdot \check{z} C^{-1}$ is the specific heat capacity of dry air at constant pressure; and $g_{H a, i, j}$ is the leaf boundary layer conductance for heat $\left(\mathrm{mol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1}\right)$ for leaves of cohort $i$ and wind speed in layer $j$ (see eq. (11.3)).

\subsection*{13.2.3 Turbulent heat exchange}

Turbulent heat exchanges occur between the soil and the bottom canopy layer (i.e. $j=1$ ):
\[
H_{1, \text { soil }}=\frac{\rho_{1} \cdot c_{p}}{r_{1, \text { soil }}} \cdot\left(T_{\text {air }, 1}-T_{\text {soil }, 1}\right)
\]
where $c_{p}=1013.86 \mathrm{~J}_{\mathrm{u}}^{\circ} \mathrm{kg}^{-1} \stackrel{\circ}{\mathrm{u}} C^{-1}$ is the specific heat capacity of the air, $\rho_{1}$ is the air density at $j=1, T_{\text {air }, 1}$ is the air temperature of layer $1, T_{\text {soil, } 1}$ is the temperature of the top soil layer and $r_{1, \text { soil }}$ is the aerodynamic resistance between the soil and canopy layer 1 (in $s \mathrm{u} m^{-1}$ ). The bottom layer also have turbulent heat exchanges with the layer above, determined by the canopy turbulence model. The turbulent heat flux gradient for layer $j=1$ is:
\[
\left(\delta F_{H} / \delta z\right)_{1}=\frac{-c_{p} \cdot \rho_{1} \cdot\left(T_{a i r, 2}-T_{a i r, 1}\right) \cdot u \bar{w}_{1}}{\Delta z \cdot(\delta u / \delta z)_{1}}-H_{1, s o i l}
\]
where $\Delta z$ is the size of vertical layers (in $m$ ); and $(\delta u / \delta z)_{1}$ and $u \bar{w}_{1}$ are the wind speed gradient and Reynolds stress at $j=1$.

For all intermediate layers (i.e. $1<j<l$ ) we have turbulent exchanges with the neighboring layers $j-1$ and $j+1$, which results in the following turbulent heat flux gradient:
\[
\left(\delta F_{H} / \delta z\right)_{j}=\frac{-c_{p} \cdot \rho_{j} \cdot\left(T_{a i r, j+1}-T_{a i r, j-1}\right) \cdot u \bar{w}_{j}}{2 \cdot \Delta z \cdot(\delta u / \delta z)_{j}}
\]

And, finally, the topmost layer (i.e. $j=l$ ) has turbulent heat exchanges with the layer below $l-1$ and the atmosphere, so that:
\[
\left(\delta F_{H} / \delta z\right)_{l}=\frac{-c_{p} \cdot \rho_{l} \cdot\left(T_{a t m}-T_{a i r, l-1}\right) \cdot u \bar{w}_{l}}{2 \cdot \Delta z \cdot(\delta u / \delta z)_{l}}
\]

\subsection*{13.2.4 Canopy and soil temperature changes}

Evaluation of the canopy layer energy balance equation (7.4) is done taking into account that sensible heat exchange for a given layer $j$ includes heat exchange with leaves (i.e. $H_{\text {leaf }, j}$ ) and the turbulent heat flux
gradient (i.e. $\left(\delta F_{H} / \delta z\right)_{j}$ ), so that the variation of air temperature in layer $j$ for a given time interval $\Delta t_{\text {substep }}$ is:
\[
\Delta T_{a i r, j}=\Delta t_{s u b s t e p} \cdot \frac{K_{a b s, j}+L_{n e t, j}-L E_{j}+H_{l e a f, j}+\left(\delta F_{H} / \delta z\right)_{j}}{T C_{j}}
\]
where $T C_{j}$ is the thermal capacitance of canopy layer $j$ (in $J \cdot m^{-2} \cdot K^{-1}$ ), found analogously to $T C_{c a n}$ (eq. (13.7)):
\[
T C_{j}=T C_{L A I} \cdot \frac{0.8 \cdot L A I_{j}+1.2 \cdot\left(L A I_{j}^{p h i}+\cdot L A I_{j}^{d e a d}\right)}{2}
\]
$\Delta t_{\text {substep }}$ is the time step for closing the energy balance, which has to be smaller than $\Delta t_{\text {step }}$ to avoid numerical instabilities due to turbulent flow.

When simulating a multiple-layer energy balance, we have to replace $H_{\text {can,soil }}$ by $H_{1, \text { soil }}$ in the energy inflow of soil layer 1: (13.9):
\[
G_{0,1}=K_{\text {soil }}+L_{\text {net,soil }}+H_{1, \text { soil }}-L E_{\text {vap,soil }}
\]

Soil temperature changes are estimated in the same way as for single-canopy energy balance, except that a smaller temporal step is used:
\[
\Delta T_{\text {soil }, s}=\Delta t_{\text {substep }} \cdot \frac{G_{s-1, s}-G_{s, s+1}}{C_{\text {soil }, s}}
\]

\subsection*{13.2.5 Within-canopy changes in water vapor and $C O_{2}$}

Multi-layer canopy energy balance also entails the possibility of considering gradients of scalars such as water vapor or $C O_{2}$. Analogously to the turbulent heat exchange, wind turbulence leads to changes in concentration of water vapor or $C O_{2}$ within canopy layers. In addition, plant physiology also alters the concentration of these gases through transpiration in photosynthesis. To model temporal changes in these scalars for canopy layers, we first have to estimate $\mathrm{CO}_{2}$ concentration in $\mathrm{mg} \cdot \mathrm{m}^{-3}$ and $\mathrm{H}_{2} \mathrm{O}$ concentration in $\mathrm{kg} \cdot \mathrm{m}^{-3}$ from $C_{\text {air }, j}(p p m)$ and $e_{\text {air }, j}(k P a)$ using:
\[
\begin{aligned}
{\left[\mathrm{CO}_{2}\right]_{j} } & =0.409 \cdot 44.01 \cdot C_{a i r, j} \\
{\left[\mathrm{H}_{2} \mathrm{O}\right]_{j} } & =0.622 \cdot \frac{e_{a i r, j} \cdot \rho_{j}}{P_{a t m}}
\end{aligned}
\]

The one-dimensional scalar flux balance for an homogeneous turbulent flow can be described by the following conservation equations (Lai et al. 2000):
\[
\begin{aligned}
\left(\delta\left[\mathrm{CO}_{2}\right] / \delta t\right)_{j} & =\left(\delta F_{\left[\mathrm{CO}_{2}\right]} / \delta z\right)_{j}+S_{\left[\mathrm{CO}_{2}\right], j} \\
\left(\delta\left[\mathrm{H}_{2} \mathrm{O}\right] / \delta t\right)_{j} & =\left(\delta F_{\left[\mathrm{H}_{2} \mathrm{O}\right]} / \delta z\right)_{j}+S_{\left[\mathrm{H}_{2} \mathrm{O}\right], j}
\end{aligned}
\]
where $\left(\delta F_{\left[\mathrm{CO}_{2}\right]} / \delta z\right)_{j}$ and $\left(\delta F_{\left[\mathrm{H}_{2} \mathrm{O}\right]} / \delta z\right)_{j}$ are the gradients of vertical flux of $\mathrm{CO}_{2}$ and $\mathrm{H}_{2} \mathrm{O}$ in layer $j$, respectively; and $S_{\left[\mathrm{H}_{2} \mathrm{O}\right], j}$ and $S_{\left[\mathrm{CO}_{2}\right], j}$ are the source strengths for $\left[\mathrm{H}_{2} \mathrm{O}\right]$ (in $\mathrm{kg} \mathrm{H} 2 \mathrm{O} \cdot \mathrm{m}^{-3} \cdot \mathrm{~s}^{-1}$ ) and $\left[\mathrm{CO}_{2}\right]$ (in $m g C O_{2} \cdot m^{-3} \cdot s^{-1}$ ) in layer $j$, respectively, which derive from transpiration (source of water) and photosynthesis (sink of $C O_{2}$ ):
\[
\begin{aligned}
S_{\left[H_{2} O\right], j} & =\frac{\left(I n_{j, t} / \Delta t\right)+E_{j, t}}{\Delta z} \\
S_{\left[C O_{2}\right], j} & =-\frac{A_{n, j, t}}{\Delta z}
\end{aligned}
\]
where $E_{j, t}$ and $A_{n, j, t}$ are the instantaneous transpiration and photosynthesis rates in layer $j$. The former was already defined in eq. (13.14), whereas the latter ( $A_{n, j, t}$; in $m g C O_{2} \cdot m^{-2} \cdot s^{-1}$ ) is defined analogously:
\[
A_{n, j, t}=10^{-3} \cdot 44.01 \cdot \sum_{i=1}^{c} A_{n, i, t}^{\text {sunlit }} \cdot L A I_{i, j}^{\text {sunlit }}+A_{n, i, t}^{\text {shade }} \cdot L A I_{i, j}^{\text {shade }}
\]
where $A_{n, i, t}^{\text {sunlit }}$ and $A_{n, i, t}^{\text {shade }}$ are the instantaneous net photosynthesis rates (in $\mu$ mol $C O_{2} \cdot m^{-2} \cdot s^{-1}$ ) of sunlit and shade leaves, respectively, of cohort $i$ during time step $t$; and $L A I_{i, j}^{\text {sunlit }}$ and $L A I_{i, j}^{\text {shade }}$ are the leaf area index of sunlit and shade leaves, respectively of cohort $i$ in layer $j$ (9.8). For the special case of the lowest canopy layer, water vapor needs to include the evaporation from soil, i.e.:
\[
S_{\left[H_{2} O\right], 1}=\frac{\left(\left(I n_{1, t}+E s_{t}\right) / \Delta t\right)+E_{1, t}}{\Delta z}
\]

For any layer $1<j<l$ the gradients of vertical scalar fluxes are found using:
\[
\begin{aligned}
\left(\delta F_{\left[H_{2} O\right]} / \delta z\right)_{j} & =-\frac{c_{p} \cdot \rho_{j} \cdot\left(\left[H_{2} O\right]_{j+1}-\left[H_{2} O\right]_{j-1}\right) \cdot u \bar{w}_{j}}{2 \cdot \Delta z \cdot(\delta u / \delta z)_{j}} \\
\left(\delta F_{\left[\mathrm{CO}_{2}\right]} / \delta z\right)_{j} & =-\frac{c_{p} \cdot \rho_{j} \cdot\left(\left[C O_{2}\right]_{j+1}-\left[C O_{2}\right]_{j-1}\right) \cdot u \bar{w}_{j}}{2 \cdot \Delta z \cdot(\delta u / \delta z)_{j}}
\end{aligned}
\]
whereas for the bottom layer ( $j=1$ ) we have:
\[
\begin{aligned}
\left(\delta F_{\left[H_{2} O\right]} / \delta z\right)_{1} & =-\frac{c_{p} \cdot \rho_{1} \cdot\left(\left[H_{2} O\right]_{2}-\left[H_{2} O\right]_{1}\right) \cdot u \bar{w} w_{1}}{\Delta z \cdot(\delta u / \delta z)_{1}} \\
\left(\delta F_{\left[C O_{2}\right]} / \delta z\right)_{1} & =-\frac{c_{p} \cdot \rho_{1} \cdot\left(\left[C O_{2}\right]_{2}-\left[C O_{2}\right]_{1}\right) \cdot u \bar{w} w_{1}}{\Delta z \cdot(\delta u / \delta z)_{1}}
\end{aligned}
\]
and for the top layer ( $j=l$ ) we have:
\[
\begin{aligned}
\left(\delta F_{\left[\mathrm{H}_{2} \mathrm{O}\right]} / \delta z\right)_{l} & =-\frac{c_{p} \cdot \rho_{l} \cdot\left(\left[\mathrm{H}_{2} \mathrm{O}\right]_{a t m}-\left[\mathrm{H}_{2} \mathrm{O}\right]_{l-1}\right) \cdot u \overline{w_{l}}}{2 \cdot \Delta z \cdot(\delta u / \delta z)_{l}} \\
\left(\delta F_{\left[\mathrm{CO}_{2}\right]} / \delta z\right)_{l} & =-\frac{c_{p} \cdot \rho_{j} \cdot\left([\mathrm{CO}]_{a t m}-\left[C O_{2}\right]_{l-1}\right) \cdot u \overline{w_{l}}}{2 \cdot \Delta z \cdot(\delta u / \delta z)_{l}}
\end{aligned}
\]

Equation (13.29) is solved via discretization both in terms of space (vertical layers) and time, the latter using $\Delta t_{\text {substep }}$ as for the energy balance.

\section*{Chapter 14}

\section*{Day-level results}

In the preceeding chapters we detailed how the model performs canopy and soil energy balances for subdaily time steps and how transpiration and photosynthesis values are determined for any given substep. This chapter indicates how these are aggregated at the daily scale and how other day-level model outputs are calculated.

\subsection*{14.1 Photosynthesis and transpiration}

Cohort's transpiration $T r_{i, t}$ (eq. (12.16)) are added across subdaily steps to yield daily transpiration ( $T r_{i}$, in $m m \mathrm{H}_{2} \mathrm{O}$ ):
\[
T r_{i}=\sum_{t=1}^{n_{t}} T r_{i, t}
\]

An the same for water extraction $E x_{i, s, t}$ for each soil layer $s$ (eq.(12.18)):
\[
E x_{i, s}=\sum_{t=1}^{n_{t}} E x_{i, s, t}
\]
$E x_{i, s}$ are substracted from the water content of the corresponding soil layer, closing the soil water balance of the day (eq. (7.1)).
Daily values of net carbon assimilation for plant cohorts are obtained similarly. $A_{n, i, t}$ (eq. (12.20)) are added across subdaily steps to obtain $A_{n, i}$, the daily net assimilation at the cohort level (in $g C \stackrel{\circ}{\mathrm{u}} m^{-2}$ ):
\[
A_{n, i}=\sum_{t=1}^{n_{t}} A_{n, i, t}
\]

\subsection*{14.2 Plant water potentials and relative water contents}

Because the model determines optimum transpiration for every subdaily time step, this leads to a daily sequence of leaf water potential ( $\Psi_{\text {leaf }, i, t}$ ), stem water potential ( $\Psi_{\text {stem }, i, t}$ ), root crown water potential ( $\Psi_{\text {rootcrown }, i, t}$ ) and root surface water potential ( $\Psi_{\text {rootcrown }, i, s, t}$ ) values for each plant cohort $i$ (and soil layer $s$ in the last case). The model defines the following daily water potentials for every cohort $i$ :
- Pre-dawn leaf water potential ( $\Psi_{p d, i}$ ): the maximum of $\Psi_{l e a f, i, t}$ values.
- Pre-dawn shade leaf water potential ( $\Psi_{p d, i}^{\text {shade }}$ ): the maximum of $\Psi_{\text {leaf }, i, t}^{\text {shade }}$ values.
- Pre-dawn sunlit leaf water potential ( $\Psi_{p d, i}^{\text {sunlit }}$ ): the maximum of $\Psi_{\text {leaf }, i, t}^{\text {sunlit }}$ values.
- Mid-day leaf water potential ( $\Psi_{m d, i}$ ): the minimum of $\Psi_{l e a f, i, t}$ values.
- Mid-day shade leaf water potential ( $\Psi_{m d, i}^{\text {shade }}$ ): the minimum of $\Psi_{\text {leaf }, i, t}^{\text {shade }}$ values.
- Mid-day sunlit leaf water potential ( $\Psi_{m d, i}^{s u n l t}$ ): the minimum of $\Psi_{\text {leaf }, i, t}^{\text {sunlit }}$ values.
- Stem water potential ( $\Psi_{\text {stem }, i}$ ): the minimum of $\Psi_{\text {stem }, i, t}$ values.
- Root-crown water potential ( $\Psi_{\text {rootcrown }, i}$ ): the minimum of $\Psi_{\text {rootcrown }, i, t}$ values.
- Root surface water potentials ( $\Psi_{\text {rootsurf }, i, s}$ ): the minimum of $\Psi_{\text {rootsurf }, i, s, t}$ values for each soil layer $s$.

Analogously, relative water content of stems and leaves is known for every subdaily time step, which results in a daily sequence of leaf relative water content ( $R W C_{\text {leaf }, i, t}$ ) and stem relative water content ( $R W C_{\text {stem }, i, t}$ ). These are summarized at the daily level for each plant cohort $i$ :
- Leaf relative water content ( $R W C_{\text {leaf }, i}$ ): the mean $R W C_{\text {leaf }, i, t}$ values.
- Stem relative water content ( $R W C_{\text {stem }, i}$ ): the mean of $R W C_{\text {stem }, i, t}$ values.

Finally, the daily sequence of slopes of the supply function ( $d E / d \Psi_{i, t}$ ) is also averaged at the daily level:
- Slope of the supply function ( $d E / d \Psi_{i}$ ): the mean $d E / d \Psi_{i, t}$ values.

\subsection*{14.3 Plant drought stress}

In order to have an estimate of daily drought stress for the plant cohort, the model uses the stem vulnerability curve of the plant to find the conductance relative to maximum stem conductance and turns it into its complement:
\[
D D S_{i}=\phi_{i} \cdot\left(1.0-\frac{k_{\text {stem }, i}\left(\Psi_{\text {rootcrown }, i}\right)}{k_{\max \text { stem }, i}}\right)=\phi_{i} \cdot\left(1.0-e^{-\left(\Psi_{\text {rootcrown }, i} / d_{\text {stem }}\right)^{c_{\text {stem }}}}\right)
\]
where $\phi_{i}$ is the leaf phenological status. Note the use of $\Psi_{\text {rootcrown }, i}$ (and not $\Psi_{\text {leaf }, i}$ ) to determine drought stress index. Thus the model tracks the degree of conductance decrease at the beginning of the stem as a measure of drought stress. This choice makes daily drought stress values of the Simple and Complex transpiration modes more comparable (because leaf mid-day water potentials are usually much more negative than soil water potentials) and is a sensible choice if one wants to run the model in irreversible cavitation mode (see below).

\section*{Part IV}

\section*{Forest growth modelling}

\section*{Chapter 15}

\section*{Forest growth model}

This chapter provides an overview of a forest growth model, which builds on the previous two models and allows simulating carbon and water balance as well as growth and mortality on a daily step basis for a given forest stand and for the period corresponding to input weather data. The model was described in De Cáceres et al. (2023) and is run using function growth(), for a set of days, or function growth_day(), for a single day.
The forest growth model can be run in two different levels of complexity, depending on the water balance submodel employed (basic and advanced, corresponding to chapters 3 and 7). In this and the following chapters, we indicate those design and formulation elements where the forest growth model building on the basic water balance differs from that building on the advanced one.

The information provided in the current chapter should be enough to understand what the growth model does, but the reading previous chapters and the following ones should provide a more detailed understanding on how the different processes are designed and formulated.

\subsection*{15.1 Design principles}

\subsection*{15.1.1 Overview}

Like in the preceding models, the physical structure of the stand is represented in one (vertical) dimension (i.e. the horizontal coordinates of plants are not explicit). The model is cohort-based, meaning that similar plant individuals are represented using a single entity with average characteristics (e.g. tree height and diameter at breast height) and a density variable is used to scale from individual level to the cohort level. Processes are modelled either at the cohort level (water balance, photosynthesis, or plant mortality) or at the "average" individual level (carbon balance, tissue growth and senescence). Water fluxes, soil water balance and plant photosynthesis processes follow the design of the soil water balance model and will not be repeated here (see chapters 3 and 7). The growth model tries to reproduce the physical and physiological processes that modulate leaf area changes, sapwood area changes and fine root area changes (the latter only under the advanced water balance submodel), while accounting for both source and sink limitations to tissue growth. Formation of new sapwood leads to diameter and height increases, so that physiological processes involve structural changes. Since the model does not implement all processes and drivers (such as nutrient availability) potentially affecting growth, user input parameters are used to empirically constrain growth rates and plant size, i.e. maximum relative sapwood area growth rates, maximum plant height and diameterheight ratios. The forest growth model also implements tree mortality, which reduces cohort density, arising from different processes. A baseline mortality rate is incremented either because of exhaustion of carbon reserves (i.e. plant starvation) or dehydration of plant tissues (i.e. plant desiccation). Additionally, fire behavior and effects (i.e. fire severity) can be simulated. Fires can partially or totally burn crown leaves and buds. Fire heat can also induce necrosis in the cambium, leading to full above-ground mortality.

\subsection*{15.1.2 Carbon compartments, transport and carbon balance}

Three carbon compartments are considered separately: leaves, sapwood (including stem, branches and coarse roots) and fine roots. Each compartments has one or more carbon pools where carbon is in different form. Carbon pools are differentiated between structural and labile. In turn, labile carbon involves metabolic and storage (Richardson et al. 2013; Dietze et al. 2014), with a conversion rate regulated by the need to maintain, as much as possible, an equilibrium in the amount of metabolic carbon to sustain cell metabolism and for osmotic purposes. Similar designs of two non-structural carbon compartments have been implemented in other forest ecosystem models (Cho et al. 2022).
Details of the carbon pools in different compartments are as follows (Fig. 15.1):
- Structural carbon corresponds carbon forming cell membranes, cell walls and the cytosolic machinery (in the case of living cells). The amount of structural carbon in a given compartment is used to determine maintenance respiration costs (together with labile carbon), and the structural carbon per tissue unit determines growth respiration costs. Structural carbon occurs in the three compartments, leaves, sapwood and fine roots, which however have different maintenance and growth costs. Sapwood carbon includes branches, stem and coarse roots. Only live (parenchymatic) sapwood cells, accounting for between 5 and $40 \%$ of sapwood volume (Plavcová \& Jansen 2015), contribute to estimate sapwood maintenance respiration costs. The fraction of embolized sapwood is also discounted from sapwood respiratory biomass. Structural carbon is lost via tissue senescence (in the case of sapwood due to conversion to heartwood).
- Metabolic carbon is a labile carbon form assumed to correspond to sugars (e.g., glucose or fructose) used to sustain cell functioning (i.e. provide carbon for maintenance respiration). Moreover, changes in metabolic carbon are coupled to variations in osmotic potential. Metabolic carbon occurs in leaves and sapwood compartments only. Leaf metabolic carbon is generated from photosynthesis or leaf starch degradation and used in different functions, including leaf maintenance respiration and export to sapwood via phloem transport. An excess of leaf metabolic carbon can inhibit photosynthesis. Sugar concentration in the phloem is assumed to be (passively) in equilibrium with leaf metabolic sugar concentration. Sapwood metabolic carbon comes from phloem transport, or sapwood starch degradation, and is used to directly sustain maintenance respiration of sapwood and fine roots.
- Storage carbon is a labile carbon form assumed to loosely correspond to starch. Leaf storage carbon is intended to represent short-term storage (mainly starch within chloroplasts) and its inclusion in the model follows the need to buffer daily variations in leaf metabolic carbon as well as in the corresponding leaf osmotic potential. Sapwood storage carbon in parenchymatic tissues of branches, stems and coarse roots conforms a much larger carbon pool and is intended to serve as carbon source for growth and long-term (seasonal and inter-annual) storage (Plavcová \& Jansen 2015).

Different processes contribute to the carbon balance of structural and labile compartments:
- Carbon balance of labile carbon pools is performed by considering photosynthesis, maintenance respiration, growth costs, sugar-starch conversion, root exudation and phloem transport. Photosynthesis estimates come from the water balance submodel. Respiration is modelled following the growth-maintenance paradigm, but we acknowledge that such approach has limitations and that others have been proposed such as assuming a constant carbon use efficiency or the process/residual approach (Cannell \& Thornley 2000; Gifford 2003). Maintenance respiration demand of leaves and sapwood depends on both structural and metabolic carbon, whereas only structural carbon counts for fine root maintenance respiration because they lack labile carbon pools. Maintenance respiration of leaves and fine roots can be species-specific rates, but can also be estimated from species-specific values of nitrogen concentration (Reich et al. 2008). In contrast, the species-specific maintenance respiration per sapwood unit mass (in fact, only parenchymatic tissues contribute to sapwood respiration) is not estimated from nitrogen concentration and should be calibrated. In all three cases, however, temperature dependencies are included in the actual respiration rates(Tjoelker et al. 2001). Growth costs include the carbon cost of building new structures as well as the respiration expenses of growth. Sugar-starch conversion is

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-163.jpg?height=1630&width=1636&top_left_y=498&top_left_x=246}
\captionsetup{labelformat=empty}
\caption{Figure 15.1: Schematic representation of carbon compartments, carbon pools and carbon balance components (translocation of reserves during senescence not included)}
\end{figure}
designed to maintain an equilibrium in the concentration of metabolic sugar. Any surplus in sapwood storage carbon over storage capacity is assumed to be diverted towards root exudation. Hence, root exudation is not modeled as a process actively competing for metabolic carbon, but as a consequence of plant C storage capacity being surpassed (Prescott et al. 2020).
- Biomass balance in structural pools comes from the interplay between growth (i.e. new tissue formation) and senescence (see below). Structural growth rates are lower than growth costs for labile pools, since growth costs also include growth respiration expenses. During leaf senescence it is assumed that non-structural carbon sources (i.e. labile carbon pools) are recycled and relocated to sapwood storage. Analogously, when sapwood is converted into heartwood, labile carbon in the protoplasm of parenchyma cells is assumed to be re-absorbed by neighboring living cells as storage (Spicer 2005).

Further design details and formulation regarding the estimation of carbon pool sizes and carbon balance components are given in chapter 16.

\subsection*{15.1.3 Tissue growth, senescence and allocation}

The forest growth model allows simulating the variation of leaf area, sapwood area and fine root area via the following processes (see fig. 15.2):
i. Leaf growth: Whereas in the water balance models expanded leaf area corresponded to the portion of live leaf area that was unfolded according to the phenological status (see 4.1), in the growth model expanded leaf area results from explicit simulation of growth. However, leaf phenology submodel still controls the duration of phenophases corresponding budburst, leaf development and senescence. Leaf area growth occurs during leaf unfolding periods only, whereas bud formation periods are required to update the target leaf area (in accordance to an allocation strategy, see below). Storage carbon levels need to be at more than $10 \%$ of their capacity to allow leaf growth. Moreover, leaf area target is constrained by stand structure (i.e. competition) via allometric equations.
ii. Leaf senescence: Leaf senescence (and the corresponding increases in dead leaf area) can occur in the model due to leaf aging in evergreen species, due to programmed leaf senescence in deciduous species, or due to leaf dessication (as a result of xylem cavitation and/or low leaf relative water content). In addition, fires can induce foliage burning, which also leads to a decrease in leaf area (but where non-structural carbon reallocation is not possible and dead leaf area does not increase).
iii. Sapwood growth: Formation of new sapwood can only occur if unfolded leaves are present, assuming that hormonal signals controlling cambium division are mainly synthesized within leaves. Sapwood formation corresponds mostly to secondary growth (but primary growth occurs at the same time due to diameter-height relationships), and is only allowed if storage carbon levels are above a given speciesspecific threshold (e.g. $50 \%$ ). These levels are much higher than required for leaf or fine root growth. Thus, when carbon levels are low, sapwood growth rates fall to zero, whereas replacement of leaves and fine roots continues to sustain metabolism. This design was chosen to stop sapwood growth much before emptying storage carbon reserves, so that maintenance respiration can be sustained longer whenever photosynthesis is low, as in shadow-tolerant species.
iv. Sapwood senescence: Losses in sapwood area (i.e. conversion to heartwood) occur via tissue aging (i.e. assuming a daily rate of conversion). Similarly to $3-$ PG (Landsberg \& Waring 1997) we assume that the relative turnover rate of sapwood is smallest for young plants, and it increases up to a maximum value. However, recent reviews indicate that heartwood formation should be viewed as an active developmental program during which a conductive but vulnerable sapwood is transformed in a non-conductive but durable heartwood (Spicer 2005). Tree sapwood senescence also occurs whenever the sapwood area exceeds the amount required to sustain the current leaf area target. Note that stem cavitation reduces the area of sapwood that is effectively functional for water transport, but does not lead to sapwood senescence per se.
v. Fine root growth: Fine root growth can in principle occur any time of the year (i.e. the model does not explicitly consider root phenology), but since fine root biomass targets depend on leaf area,
seasonal fine root area patterns may follow phenological changes in leaf area. Like in leaf growth, storage carbon levels need to be at more than $10 \%$ of their capacity to allow fine root growth.
vi. Fine root senescence: Fine root senescence occurs via aging with a turnover rate depending on soil temperature.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-165.jpg?height=976&width=1639&top_left_y=485&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 15.2: Schematic representation of tissue growth and senescence drivers for trees}
\end{figure}

Formation of new leaf, sapwood and fine root tissues is determined taking into account both source (i.e. carbon availability) and sink (i.e. biophysical constraints on plant tissue expansion) limitations (Fatichi et al. 2014; Guillemot et al. 2015; Körner 2015). Temperature and turgor sink limitations are implemented following Cabon et al. (2020a) and Cabon et al. (2020b). These authors developed their approach for tracheid production and enlargement only, whereas we apply it to different kinds of tissues. In the case of fine roots, differences in soil water potential between layers can lead to different degrees of turgor limitation for the growth of fine roots, resulting in adaptation of fine root distribution.

The growth rates in all three compartments are modulated by parameters specifying maximum daily growth rates relative to the amount of sapwood area. Nevertheless, tree leaf area and fine root biomass targets are constrained by leaf biomass allometric equations, which limits leaf and fine root growth to the replacement of aging tissues, unless there are changes in forest structure, i.e. competition is released or the target tree increases in diameter (see fig. 15.2). In contrast, the sapwood area target modulates sapwood senescence (i.e. the conversion to heartwood), but not sapwood growth. Sapwood growth rates are mainly determined by maximum relative growth rates (which can be parameterized with empirical observations), carbon availability and sink limitations. Since sapwood formation leads to tree diameter increases, maximum sapwood growth rate indirectly determine the rate of growth of leaves and fine roots at seasonal and annual scales, hence determining the whole-plant maximum growth rate.

Two options are possible regarding the relationship between structural carbon of leaves and sapwood:
1. Stable Huber value: In this strategy, growth of leaf area and sapwood area need are coordinated so that the ratio of sapwood area to leaf area (i.e. Huber value) is in dynamic equilibrium around its initial
value. To this aim, sapwood senescence is scheduled whenever the current Huber value is larger than the target (i.e. there is an excess of sapwood area). This approach is similar to the LPG model (Sitch et al. 2003), where different turnover rates are applied for different tissues, but then the model tries to satisfy the pipe model (Shinozaki et al. 1964) by allocating C where it is more limiting. Note that in this strategy the whole-plant conductance will progressively decrease with the increase in plant height, because of the increase in the length of stem xylem pathway.
2. Stable whole-plant conductance: Ratios of sapwood area to leaf area (i.e. Huber values) can vary within species, due to environmental conditions (Mencuccini \& Grace 1995). In this allocation strategy, growth of leaf area, sapwood area and height needs to be coordinated so that whole-plant conductance (i.e. from roots to leaves) is in dynamic equilibrium around its initial value. Sapwood senescence is scheduled whenever the current whole-plant conductance is above the target value. In this strategy, the Huber value will tend to increase with the increase in plant height, thereby increasing the sapwood respiratory demands.

When running the growth model along with the basic water balance submodel, a stable Huber value is the only strategy available and fine root area growth also follows the need to achieve a stable ratio between leaf area and fine root area. In contrast, the two strategies are possible when simulating growth along with the advanced water balance. In this case, fine root area growth is coordinated with the formation of the other tissues via the need to ensure an average resistance fraction in the rhizosphere, which is used to define the fine root area target and, hence, the allocation to fine roots.

Further details and formulation of growth, senescence and allocation are given in chapter 17.

\subsection*{15.1.4 Coordination between water and carbon balances}

The growth model allows coordinating several aspects of carbon and water balances through different state variables (Fig. 15.3), most of them applying to the simulation using the advanced transpiration model:
a. Transpiration and photosynthesis are coordinated via the stomatal regulation submodel (see chapter 11).
b. Hydrostatic water potential of leaf symplastic tissues influences the turgor pressure necessary for leaf growth (17.1.2), while (metabolic) leaf sugar concentration determines changes in osmotic potential at full turgor and hence, the relative water content of leaf symplasmic tissue.
c. Analogously, water potential of stem symplastic tissues determines the turgor in the cambium and the sapwood formation rate (17.1.3), while the sugar concentration in the sapwood determines the osmotic potential at full turgor of stem symplastic tissues and its relative water content.
d. Leaf growth and senescence influence hydraulic conductances of several tissues (fine roots, coarse root sapwood and stem sapwood), as they are defined on a leaf area basis (17.3.1).
e. Sapwood growth and senescence influence hydraulic conductance of stems via changes in sapwood area, and indirectly those of coarse roots and the rhizosphere (17.3.1).
f. Fine root biomass dynamics determines fine root distribution and rhizosphere conductance across soil layers (17.3.1).

\subsection*{15.1.5 Plant mortality}

\section*{Mortality pathways}

Dynamic vegetation models implement mortality processes in very different ways, from purely-empirical to process-based (Hawkes 2000; Keane et al. 2001; Bugmann et al. 2019). The fact that proximal causes of mortality are complex, co-occurring, interrelated and variable has prompted the question of whether a mechanistic approach will improve prediction ability (Adams et al. 2013). In medfate, (above-ground parts of) woody plants can die following a combination of empirical and process-based approaches:

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-167.jpg?height=968&width=1614&top_left_y=802&top_left_x=254}
\captionsetup{labelformat=empty}
\caption{Figure 15.3: Schematic representation of relationships between water balance (advanced model) and carbon balance. Relationships within water or carbon balances have been omitted}
\end{figure}
1. Trees with $D B H<7.5 \mathrm{~cm}$ (i.e. saplings) are assumed to suffer mortality due to a self-thinning process of unspecified cause. Specifically, the model represents the self-thinning process occurring between small trees (e.g. 1 cm DBH ) resulting from seed establishment (or resprouting) and trees achieving the size (e.g. 7.5 cm ) corresponding to inclusion as individual in forest inventories (e.g. ingrowth size). Although implemented here, this self-thinning process is most relevant for simulations of mid- and long-term forest dynamics (see 18).
2. All woody cohorts are assumed to die at a basal rate due to processes not included in the model (e.g. biotic attacks). This rate is empirically determined and can be a constant value or, in the case of trees, can depend on the degree of competition (i.e. basal area). This latter option is important to ensure a limit in stand basal area, which may not occur as a result of mechanistic mortality processes.
3. Mortality rates can be higher than the basal rates whenever physiological thresholds presumed to lead to plant mortality are surpassed (Hawkes 2000). The model allows plants to die from either starvation (if metabolic carbon is exhausted) or dessication (tissue dehydration) (McDowell et al. 2008; McDowell 2011). Allowing for starvation is important to simulate death due to shading by other plant cohorts, whereas plant dessication is important to represent situations of low soil water availability.

With respect to intra-cohort variability, the model can be run assuming that all individuals within plant cohorts are functionally equal, so that mortality applies to the entire plant cohort. Alternatively, mortality can be applied to a fraction of the plant cohort, in proportion to the mortality likelihood, which implicitly acknowledges intra-cohort differences. As common in other models, mortality process can be simulated in a deterministic or stochastic fashion.

\section*{Physiological underpinnings of drought-related mortality}

Multiple mechanisms determine plant survival or mortality under drought (McDowell et al. 2008; McDowell et al. 2022). However, hydraulic failure is widely recognized as one of the key mechanisms of drought-induced mortality in woody plants. Lethal water potential have been defined as a critical threshold beyond which trees are unable to recover from drought, even after rewatering. Experimental work by Urli et al. (2013) determined that irreversible damage in angiosperm saplings occurred only after $88 \%$ losses in stem hydraulic conductance. Similarly, Hammond et al. (2019) found probability of mortality to strongly increase beyond $80 \%$ of loss in hydraulic conductivity in saplings a gymnosperm species. In a multi-species synthesis, Adams et al. (2017) assessed found that all studied species showed at least $60 \%$ or higher loss of xylem hydraulic conductivity, whereas evidence for carbon starvation was more common for gymnosperms. While loss of hydraulic function seems ubiquitous in drought-related mortality, not all researchers agree that hydraulic failure be the primary cause of mortality. Körner (2019) argued that hydraulic failure often correlates with a critical degree of tree dehydration and that the disruption of capillary continuum from soil to the root because of soil dehydration is more important because it forces trees to drop their leaves and rely on their own water reserves. Trees will die when the symplast surpasses its dehydration tolerance, and Körner (2019) considers xylem embolism as a byproduct rather than the cause of critical tree dehydration under severe drought, so that mechanistic models should focus on the dehydration process. Other authors have stressed the importance of the interplay between water reserves and water loss rates through cuticule after stomatal closure (Blackman et al. 2016; Martin-StPaul et al. 2017). Regardless of causality, loss of hydraulic function could still be a good indicator of mortality likelihood. However, recently Martinez-Vilalta et al. (2019) suggested use the relative water content as an indicator of mortality risk, as it integrates several aspects related to hydraulics, stomatal responses and carbon economy during drought.

\section*{Starvation thresholds}

We use the amount of metabolic sugar in the stem as indicator of carbon starvation. Martínez-Vilalta et al. (2016) found that plants can have very distinct amounts of non-structural carbon concentration but minimum seasonal values are around $46 \%$ of maximum values. Accordingly, we define the indicator of starvation in relative terms (see control variable mortalityRelativeSugarThreshold, set to $30 \%$ by default) with respect to the stem equilibrium sugar concentration.

\section*{Dessication thresholds}

Following Martinez-Vilalta et al. (2019), we primarily use the relative water content (RWC) in the stem symplastic tissues as the stress variable increasing dessication likelihood under drought. Whereas the stem
symplastic pressure-volume curve is always used to determine RWC from the stem water potential, in the basic water balance model the latter is assumed to be equal to the estimated plant water potential (i.e. $\Psi_{\text {sym,stem }}=\Psi_{\text {plant }}$; see 6.2.1). Moreover, in the advanced water balance model there is no distinction between stem apoplastic and symplastic (i.e. parenchymatic) water potentials (i.e. $\Psi_{\text {sym,stem }}=\Psi_{\text {apo,stem }}$ ) unless plant water compartments are explicitly simulated.
Using stem relative water content as indicator of dessication has the inconvenient, however, that the parameters $\pi_{0, \text { stem }}$ and $\epsilon_{\text {stem }}$ specifying the stem pressure-volume curve are often not known, so that estimates have to come from its covariation with other traits (here wood density, see @ref\{inputationPV\}). The uncertainty coming from this parameterization issue can be avoided if one combines the use of RWC with the loss of xylem hydraulic conductivity, since parameters of the hydraulic vulnerability curve are much more frequently available. For this reason, we use the maximum of stem relative water content and relative xylem hydraulic conductance as the drought stress variable to determine dessication.
The critical threshold for dessication is specified in the control variable mortalityRWCThreshold, set to $40 \%$ by default. Note that most studies focus on leaf RWC, for which Kursar et al. (2009) indicate ranges between $16 \%$ and $61 \%$, and Körner (2019) advocates for values around $50 \%$.
Details of the implementation of plant mortality are given in section 17.4.

\subsection*{15.1.6 Fire occurrence and severity}

The occurrence of fires is represented in the growth model in a forcing variable that describes the daily probability that a wildfire strikes the stand. Whenever a fire occurs, the model first simulates fire behavior according to the conditions of the stand (see chapter 24) and then fire severity is evaluated.

The degree to which vegetation is impacted by fire depends on the heat fluxes incident on plant tissues and organs, which is an outcome of various fire behavior variables (such as fireline intensity and residence time) and the position of plant organs in the stand, and the physiological responses triggered thereafter. Fire effects on plants can be classified as two types: first- and second-order effects (Hood et al. 2018; Bär et al. 2019). First-order effects comprise the immediate impacts of heat transfer on plant tissues. Nonlethal first-order heat injuries can trigger second-order effects, such as physiological limitations in carbon and water relations or increased susceptibility to insect attacks and pathogenic infections. The growth model currently deals with first-order effects only. Moreover, the model focuses on effects in above-ground tissues (leaves, buds and cambium), disregarding fire effects on below-ground structures such as seed banks, or below-ground meristems, which are also important for the resilience of ecosystems (Stephan et al. 2010).
Fire-induced plant injury and mortality models can be grouped into two categories: (1) statistical models that involve regression equations relating injury and mortality to observable indicators; and (2) process models that explicitly simulate the underlying thermal and biophysical processes occurring when a plant is heated (Butler \& Dickinson 2010; Hood et al. 2018). The design of first-order fire effects on vegetation follows, with some modifications, the process-based model proposed by Michaletz \& Johnson (2008) for surface fires, and it is outlined in fig. 15.3. The surface fire behavior variables required for severity evaluation are the residence time and fireline intensity. With them, the model estimates the air temperature gradient of the plume, which is then compared to the distribution of foliage for the determination of the proportion of the crown foliage and crown buds that die due to heat accumulation. In addition, the model determines the effects on the cambium by estimating the radial necrosis depth and comparing it with bark thickness. If enough heat reaches the cambium, the tree is considered girdled, which leads to above-ground mortality. Otherwise, the degree of crown bud necrosis will determine whether the plant can resprout from the crown (and rebuild the leaf area lost) or not.
Crown fires will be considered to impact the forest stand whenever surface fireline intensity is larger than the critical value considered necessary for crowing (Scott \& Reinhardt 2002). Crown fires are considered to burn for all plant cohorts, $100 \%$ of crown foliage and, most likely, $100 \%$ of crown buds (although very fast crown fires could spare buds if sufficiently protected, (Michaletz \& Johnson 2008)). When crown fires do not occur at the stand level, torching may still occur for particular plant cohorts depending on its crown base height, with the same effects.

If $100 \%$ of crown buds have died but the cambium is alive and the species has dormant buds beneath the bark, then the plant has suffered crown kill but it can resprout epicormically without losing height (Hood et al. 2018). If the cambium is dead, however, all above-ground plant organs will be considered dead (i.e. topkill; Hood et al. (2018)). At this point, the plant may still exhibit basal resprouting from the root crown or below-ground meristems, but is dealt in the forest dynamics model (see chapter 18).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-170.jpg?height=1280&width=1639&top_left_y=504&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 15.4: Schematic representation of the design of fire effects on foliage, buds and cambium.}
\end{figure}

While the severity sub-model described above is based on heat transfer and accumulation in tissues, causing necrosis, it is important to note that a growing number of studies increasingly have been documenting fire impacts on xylem hydraulic function, both via increased vapor pressure deficit (causing cavitation) and via structural damage in the xylem, affecting its efficiency and vulnerability (Hood et al. 2018; Bär et al. 2019). These first-order effects are not considered here.

Details of the implementation of fire severity are given in section 17.5.

\subsection*{15.1.7 Tree diameter, tree height and shrub cover updates}

Tree diameter increment follows the creation of sapwood area, whereas sapwood area decreases do not affect diameter, as they imply conversion to heartwood. Tree height increments are estimated from diameter increments following diameter-height ratios that are modulated by the proportion of light available to the plant cohort, as frequently done in forest gap models (Lindner et al. 1997). Tree crown ratios are updated
using static allometric relationships, whereas shrub height and cover are estimated from new leaf area values by inverting static leaf biomass allometries.
Further details and formulation of structural update are given in chapter 17.6.

\subsection*{15.2 State variables}

Many state variables are inherited by the corresponding water balance model and depend on its level of complexity (see 3.2 and 7.3). Several cohort-level state variables were treated as fixed parameters in the water balance models. For each plant cohort:
- Leaf area index of live leaves, $L A I^{\text {live }}$, and the actual expanded leaf area, $L A I^{\phi}$.
- Diameter at breast height for trees, $D B H$ (cohort average).
- Percent cover of shrubs, Cover.
- Density of individuals in the plant cohort, $N$.
- Plant height, $H$ (cohort average).
- Crown ratio, $C R$.
- The proportion of fine roots, $F R P_{s}$, in each soil layer $s$.
- The radial length of coarse roots $L_{\text {radial, } s}$ in each soil layer $s$.

Additional individual-level state variables are needed in growth model simulations:
- Leaf area, $L A\left(m^{2}\right)$, and target leaf area, $L A_{\text {target }}\left(m^{2}\right)$.
- Sapwood area, $S A\left(\mathrm{~cm}^{2}\right)$, and target sapwood area, $S A_{\text {target }}\left(\mathrm{cm}^{2}\right)$.
- The percentage of the crown with active buds $(P C A B)$.
- Fine root biomass, $B_{\text {fineroot }, s}(g d r y)$, and the target fine root biomass, $B_{\text {fineroot }, \text { target }, s}(g d r y)$, in each soil layer $s$.
- Sugar concentration in leaves, $S S_{\text {leaf }}$ ( mol gluc $\cdot L^{-1}$ ).
- Starch concentration in leaves, $S T_{\text {leaf }}$ ( mol gluc $\cdot L^{-1}$ ).
- Sugar concentration in sapwood (stem, branches and coarse roots), $S S_{\text {sapwood }}$ ( mol gluc $\cdot L^{-1}$ ).
- Starch concentration in sapwood (stem, branches and coarse roots), $S T_{\text {sapwood }}$ ( mol gluc $\cdot L^{-1}$ ).

Note that $L A$ is the same state variable as $L A I^{\phi}$, but expressed at the individual level, and the same occurs between $L A_{\text {target }}$ and $L A I^{\text {live }}$. These pairs of state variables are related by cohort density $(N)$.
Other functional variables can be derived from the true state variables and, hence, hence do not need to be treated as state variables themselves but are often used in equations instead of the true state variables:
- Leaf biomass ( $B_{\text {leaf }}$; in $g d r y$ ) from $L A$.
- Sapwood biomass ( $B_{\text {sapwood }}$; in $g d r y$ ) from $S A, H$ and $F R P_{s}$ and $L_{\text {radial }, s}$.
- Leaf storage volume ( $V_{\text {storage,leaf }}$; in $L$ ) from $B_{\text {leaf }}$.
- Sapwood storage volume ( $V_{\text {storage,sapwood }}$; in $L$ ) from $S A, H$ and $F R P_{s}$ and $L_{\text {radial,s }}$.
- Fine root area $\left(F R A_{s} ;\right.$ in $\left.m^{2}\right)$ in each soil layer $s$, from $B_{\text {fineroot }, s}$.

Some belowground variables (such as the radial length of coarse roots) are only considered dynamic when simulating growth with advance water balance.

\subsection*{15.3 Mass and energy balances}

\subsection*{15.3.1 Water and energy balance}

Since the growth model builds on soil and plant water balance models, the water and energy balances explained in sections 3.3 or 7.4 (depending on transpirationMode) also hold for this model.

\subsection*{15.3.2 Labile carbon balance}

The model performs daily carbon balance of labile carbon in leaves and sapwood (stem, branches and coarse roots) for each plant cohort. In each of these two compartments carbon balance is performed for the two labile carbon forms, dissolved sugars (i.e. metabolic carbon) and starch (i.e. storage carbon). In the following all carbon flows (i.e. the components of right hand side of equations) are assumed to be in units of $g g l u c \cdot d a y^{-1}$. At the leaf level, the carbon balance equations for dissolved sugars and starch are ( $i$ subscripts omitted):
\[
\begin{aligned}
\Delta S S_{\text {leaf }} \cdot V_{\text {storage,leaf }} & =A-M_{\text {leaf }}-F_{\text {phloem }}-S C_{\text {leaf }}-T S_{\text {leaf }} \\
\Delta S T_{\text {leaf }} \cdot V_{\text {storage,leaf }} & =S C_{\text {leaf }}-T T_{\text {leaf }}
\end{aligned}
\]
where $A$ is (gross) photosynthesis, $M_{\text {leaf }}$ is leaf maintenance respiration, $F_{\text {phloem }}$ is the sugar flow via phloem towards the stem and roots, $S C_{\text {leaf }}$ is the conversion from leaf sugar to leaf starch, $T S_{\text {leaf }}$ and $T T_{\text {leaf }}$ are the translocation of leaf sugars and starch into sapwood storage, respectively, during leaf senescence (see (15.6) below) or if leaf storage capacity is surpassed.

The corresponding carbon balance equations for sapwood dissolved sugars and starch are:
\[
\begin{aligned}
\Delta S S_{\text {sapwood }} \cdot V_{\text {storage,sapwood }}= & F_{\text {phloem }}-M_{\text {sapwood }}-M_{\text {fineroot }} \\
& -S C_{\text {sapwood }}-T S_{\text {sapwood }} \\
\Delta S T_{\text {sapwood }} \cdot V_{\text {storage,sapwood }}= & S C_{\text {sapwood }}+T S_{\text {leaf }}+T T_{\text {leaf }}+T S_{\text {sapwood }} \\
& -G_{\text {sapwood }}-G_{\text {leaf }}-G_{\text {fineroot }}-R E_{\text {sapwood }}
\end{aligned}
\]
where $F_{\text {phloem }}$ is the sugar inflow via phloem transport, $M_{\text {sapwood }}$ is the sum of maintenance respiration of branches, stem and coarse roots, $M_{\text {fineroot }}$ is the maintenance respiration of fine roots, $G_{\text {leaf }}, G_{\text {sapwood }}$ and $G_{\text {fineroot }}$ are the carbon costs of forming new leaves, sapwood or fine roots (respectively), $S C_{\text {sapwood }}$ is the conversion of sapwood sugar to sapwood starch, $T S_{\text {sapwood }}$ is the translocation of sapwood sugars into starch during leaf senescence and $R E_{\text {sapwood }}$ is the root exudation of sapwood carbon.

If we define $S_{\text {labile }}$ as the total amount of labile carbon in the plant (in $g g l u c$ ):
\[
S_{\text {labile }}=\left(S S_{\text {leaf }}+S T_{\text {leaf }}\right) \cdot V_{\text {storage,leaf }}+\left(S S_{\text {sapwood }}+S T_{\text {sapwood }}\right) \cdot V_{\text {storage,sapwood }}
\]
then labile carbon balance at the plant level reduces to:
\[
\Delta S_{\text {labile }}=A-M-G-R E
\]
where $M=M_{\text {leaf }}+M_{\text {sapwood }}+M_{\text {fineroot }}$ is plant-level maintenance respiration, $G=G_{\text {leaf }}+G_{\text {sapwood }}+$ $G_{\text {fineroot }}$ is plant-level growth costs and $R E=R E_{\text {sapwood }}$ is plant-level root exudation.

\subsection*{15.3.3 Biomass balance}

In addition to changes in labile carbon pools, the model also implements changes in the size of carbon compartments (leaves, sapwood and fine roots), as a result of the interplay between growth and senescence processes. Hence, we can define the following structural equations:
\[
\begin{aligned}
\Delta B_{\text {leaves }} & =B_{\text {leaves,growth }}-B_{\text {leaves,senescence }} \\
\Delta B_{\text {sapwood }} & =B_{\text {sapwood,growth }}-B_{\text {sapwood,senescence }} \\
\Delta B_{\text {fineroot }} & =B_{\text {fineroot,growth }}-B_{\text {fineroot,senescence }}
\end{aligned}
\]
where all variables would be in units of $g d r y \cdot d a y^{-1}$. And the following equation defines the structural biomass balance at the plant level:
\[
\Delta B_{\text {structure }}=\Delta B_{\text {leaves }}+\Delta B_{\text {sapwood }}+\Delta B_{\text {fineroot }}
\]

The biomass balance at the individual level is completed if we add the labile biomass balance to the structural biomass balance:
\[
\Delta B_{\text {plant }}=\Delta B_{\text {structure }}+\Delta S_{\text {labile }}
\]

At the cohort level, however, we need to take into account that some individuals will die, so that the biomass balance needs to incorporate mortality losses:
\[
\Delta B_{\text {cohort }}=\Delta B_{\text {plant }} \cdot N_{\text {cohort }}-B_{\text {mortality }}
\]
where $N_{\text {cohort }}$ is the initial cohort density (before mortality occurred) and $B_{\text {mortality }}$ is the biomass loss due to mortality of individuals, which in order to close the balance has to be defined as:
\[
B_{\text {mortality }}=\left(B_{\text {plant }}+\Delta B_{\text {plant }}\right) \cdot N_{\text {dead }}
\]
where $N_{\text {dead }}$ is the density of dead individuals and $B_{\text {plant }}$ is the initial plant biomass.

\subsection*{15.3.4 Stand-level carbon balance}

With the aim to produce outputs to be compared with Eddy-covariance flux data, the model produces aggregates of gross photosynthesis and respiration at the stand level, all expressed using units of $g C \cdot m^{-2}$.
- Gross primary production ( $G P P$ ) is the sum of gross photosynthesis across plant cohorts.
- Maintenance respiration is the sum across cohorts of the carbon emitted to the atmosphere as a result of maintenance respiration, i.e. $M$.
- Synthesis respiration is the sum across cohorts of the carbon returned to the atmosphere as a result of the process of synthesizing new structures. Note that this is less than $G$, as it does not include the carbon allocated to the new structures.
- Net primary production ( $N P P$ ) is $G P P$ minus the maintenance and synthesis respiration terms.

\subsection*{15.4 Process scheduling}

Growth simulations are conducted in daily time steps. If using the basic water balance sub-model, processes are scheduled following the regular scheduling. In contrast, if using the advanced water balance model, the growth processes can be simulated using a detailed scheduling.

\subsection*{15.4.1 Regular scheduling}

For every day to be simulated, first executes soil water balance, transpiration and photosynthesis calculations by calling the basic water balance model (3.4). After that, the model performs the following steps for each plant cohort:
1. Determine the amount of live structural biomass (in leaves, sapwood and fine root compartments), storage volume (in leaves and sapwood) and storage capacity (16.1).
2. Calculate gross photosynthesis per individual ( $A$ ), maintenance respiration for leaves ( $M_{\text {leaf }}$ ), sapwood $\left(M_{\text {sapwood }}\right)$ and fine roots $\left(M_{\text {fineroot }}\right)(16.2)$.
3. If phenology indicates leaf unfolding, evaluate leaf temperature and turgor sink limitations, growth costs ( $G_{\text {leaf }}$ ) and leaf area increase (17.1.2).
4. If sapwood growth is permitted, evaluate sapwood temperature and turgor sink limitations, growth costs ( $G_{\text {sapwood }}$ ) and sapwood area increase (17.1.3).
5. Evaluate fineroot temperature and turgor sink limitations, growth costs ( $G_{\text {fineroot }}$ ) and fineroot biomass increase (17.1.4).
6. Update changes in sugar and starch compartments due to photosynthesis, maintenance respiration and growth. Apply transfer from leaf metabolic to sapwood metabolic carbon (16.2.4) and conversions between storage and metabolic carbon (16.2.5).
7. Determine leaf senescence due to aging or cavitation effects (17.2.1).
8. Determine sapwood area senescence by aging (17.2.2).
9. Determine fine root senescence by aging (17.2.3).
10. Evaluate labile carbon translocation due to leaf and sapwood senescence ( $T S_{\text {leaf }}, T T_{\text {leaf }}$ and $\left.T S_{\text {sapwood }}\right)$. If leaf storage carbon is surpassed, add the excess to $T T_{\text {leaf }}$. Add the sum of translocated carbon to the starch sapwood pool.
11. Move any surplus in sapwood storage carbon to root exudation ( $R E_{\text {sapwood }}$ ). This completes the daily carbon balance for leaf labile pools (15.2), sapwood labile pools (15.6), and plant-level labile carbon. (15.8).
12. Update leaf area, sapwood area, fine root area and derived variables (e.g., leaf area index and Huber value) (17.3.1).
13. Determine if a wildfire stroke the forest stand and, if so, fire severity effects (17.5).
14. Determine if plant death by starvation or desiccation occurred (17.4).
15. Update fine root area target and, if phenology indicates bud formation, update the leaf area target (17.3.2).
16. Translate sapwood area growth into structural variables (i.e., plant height, tree DBH , tree crown ratio and shrub cover), (17.6) and update storage volumes and the concentration of labile pools.

\subsection*{15.4.2 Advanced scheduling}

For every day to be simulated, the model first executes soil water balance, energy balance, transpiration and photosynthesis calculations in subdaily times steps, by calling the advanced water balance model (7.5). After that, the model performs the following steps for each plant cohort:
1. Determine the amount of live structural biomass (in leaves, sapwood and fine root compartments), storage volume (in leaves and sapwood) and storage capacity (16.1).
2. For every subdaily step, perform carbon balance as follows:
a. Calculate gross photosynthesis per individual ( $A$ ) and maintenance respiration for leaves ( $M_{\text {leaf }}$ ), sapwood ( $M_{\text {sapwood }}$ ) and fine roots ( $M_{\text {fineroot }}$ ), taking into account both live structural biomass and labile sugar biomass (see 16.2).
b. If phenology indicates leaf unfolding, evaluate temperature and turgor sink limitations for growth of leaves, estimate growth costs ( $G_{\text {leaf }}$ ) and record leaf area increases (17.1.2).
c. If sapwood growth is permitted, evaluate temperature and turgor sink limitations for growth of sapwood, estimate growth costs ( $G_{\text {sapwood }}$ ) and record sapwood area increases (17.1.3).
d. Evaluate temperature and turgor sink limitations for growth of fine roots, estimate growth costs ( $G_{\text {fineroot }}$ ) and record fine root biomass increases (17.1.4).
e. Evaluate phloem transport ( $F_{\text {phloem }}$ ) and sugar-starch dynamics in the leaf and sapwood compartments at 1s time steps (16.2.4), including photosynthesis, maintenance respiration and growth respiration as well as diversion towards root exudation if maximum leaf or sapwood starch capacity is attained ( $R E_{\text {leaf }}$ and $R E_{\text {sapwood }}$ ). This completes the sub-daily carbon balance for plant-level labile carbon (15.8).
3. Determine leaf senescence due to aging or cavitation effects (17.2.1).
4. Determine sapwood area senescence by aging (17.2.2).
5. Determine fine root senescence by aging (17.2.3).
6. Evaluate labile carbon translocation due to leaf and sapwood senescence ( $T S_{\text {leaf }}, T T_{\text {leaf }}$ and $T S_{\text {sapwood }}$ ), adding the resulting carbon to the starch sapwood pool. This completes the daily carbon balance for leaf labile pools (15.2), sapwood labile pools (15.6), and plant-level labile carbon.
7. Update leaf area, sapwood area, fine root biomass and distribution. Update derived variables (e.g., leaf area index, Huber values, hydraulic conductance of stems, roots and rhizosphere, osmotic potential at full turgor of leaves and sapwood) (17.3.1).
8. Determine if plant death by starvation or desiccation occurred (17.4).
9. If phenology indicates bud formation, update the leaf area target (17.3.2). Update the fine root biomass target, according to the hydraulic conductance in the rhizosphere (17.3.2).
10. Translate sapwood area growth into structural variables (i.e., plant height, tree DBH , tree crown ratio and shrub cover), (17.6) and update storage volumes and the concentration of labile pools.

\subsection*{15.5 Inputs and outputs}

\subsection*{15.5.1 Soil, vegetation and meteorology}

\section*{Soil}

Soil input requirements are the same as for the basic water balance model and were fully described in section 2.3. Genuchten (1980) water retention curves are forced for this model, because rhizosphere conductance is modelled using van Genuchten hydraulic equations (see subsection 10.2).

\section*{Vegetation}

Vegetation input requirements were fully described in section 2.4. Trees and shrubs do not need to be characterized with different variables in soil water balance calculations, since both kinds of cohort have a $L A I$ value. In most cases, users only need to estimate the leaf area index corresponding to live leaves, i.e. $L A I^{\text {live }}$, because one can assume no dead leaves in the canopy (i.e., $L A I^{\text {dead }}=0$ ). Note that vegetation characteristics are modified by simulations in this model.

\section*{Metereological input}

The minimum weather variables required to run the model are $\min / \max$ temperatures ( $T_{\min }$ and $T_{\max }$ ), $\min / \max$ relative humidity ( $R H_{\text {min }}$ and $R H_{\text {max }}$ ), precipitation ( $P$ ) and solar radiation ( $R a d$ ). Wind speed ( $u$ ) is also needed, but the user may use missing values if not available (a default value will be used in this case). Wind speed is assumed to have been measured at a specific height above the canopy (by default at 2 $\mathrm{m})$. Atmospheric $C O_{2}$ concentration ( $C_{a t m}$ ) may also be specified, but if missing a default constant value is assumed, which is taken from the control parameters. If wildfire occurrence and severity is to be simulated, the user has to specify daily fire probability ( $P_{\text {fire }}$ ) in an additional column. Definitions and units of these variables were given in section 2.5.

\subsection*{15.5.2 Vegetation functional parameters}

The growth model requires many functional parameters to be specified for plant cohorts. Some of them depend on whether the basic or advanced water balance is adopted. Here we report functional parameters needed in addition to those necessary for the water balance submodel.

A first set of parameters refers to anatomical features (paramsAnatomy), most of them already required by water balance model simulations:

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $H_{\text {max }}$ & cm & Hmax & Maximum plant height \\
\hline $H_{\text {med }}$ & cm & Hmed & Median plant height \\
\hline $1 / H_{v}$ & $m^{2} \cdot m^{-2}$ & Al2As & Leaf area to sapwood area ratio \\
\hline RLR & $m^{2} \cdot m^{-2}$ & Ar2Al & Fine root area to leaf area ratio \\
\hline SLA & $m^{2} \cdot k g^{-1}$ & SLA & Specific leaf area \\
\hline $L W$ & cm & \multicolumn{2}{|l|}{LeafWidtlheaf width} \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $\rho_{\text {leaf }}$ & $g \cdot \mathrm{~cm}^{-3}$ & \multicolumn{2}{|l|}{LeafDensictafy tissue density} \\
\hline $\rho_{\text {wood }}$ & $g \cdot c m^{-3}$ & \multicolumn{2}{|l|}{WoodDenshtoyd tissue density} \\
\hline $\rho_{\text {fineroot }}$ & $g \cdot \mathrm{~cm}^{-3}$ & \multicolumn{2}{|l|}{FineRootWienssitat tissue density} \\
\hline $f_{\text {conduits }}$ & [0-1] & \multicolumn{2}{|l|}{conduit X 1 appwaidn of sapwood corresponding to xylem conduits (the remaining corresponds to parenchymatic tissues)} \\
\hline $S R L$ & $\mathrm{cm} \cdot g^{-1}$ & SRL & Specific root length \\
\hline RLD & $\mathrm{cm} \cdot \mathrm{cm}^{-3}$ & RLD & Fine root length density (i.e. density of root length per soil volume) \\
\hline $r_{6.35}$ & & r635 & Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm \\
\hline
\end{tabular}

A second set of parameters refers to allometric coefficients needed for structural updates (paramsAllometries).

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $a_{\text {ash }}$ & & Aash & Coefficient relating the square of shrub height with shrub area \\
\hline $a_{b s h}, b_{b s h}$ & & Absh, Bbsh & Coefficients relating crown volume with dry weight of shrub individuals \\
\hline $b t_{s h}$ & & BTsh & Bark thickness in shrubs \\
\hline $a_{c r}, b_{1 c r}, b_{2 c r}, b_{3 c r}$, & & B1cr, B2cr, B3cr, & Coefficients to calculate crown ratio of trees \\
\hline $c_{1 c r}, c_{2 c r}$ & & C1cr, C2cr & \\
\hline $a_{c w}, b_{c w}$ & & Acw, Bcw & Regression coefficients used to calculate the crown width of trees (as intermediary step to obtain the crown ratio). \\
\hline $a_{b t}, b_{b t}$ & & Abt, Bbt & Regression coefficients used to calculate the bark thickness of trees \\
\hline
\end{tabular}

A third set of parameters refers to growth parameters (paramsGrowth).

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $N_{\text {leaf }}$ & $m g N$. gdry ${ }^{-1}$ & Nleaf & Leaf nitrogen concentration per dry mass \\
\hline $N_{\text {sapwood }}$ & $m g N$. gdry ${ }^{-1}$ & Nsapwood & Sapwood nitrogen concentration per dry mass \\
\hline $N_{\text {fineroot }}$ & $m g N$. gdry ${ }^{-1}$ & Nfineroot & Fine root nitrogen concentration per dry mass \\
\hline $M R_{\text {leaf }}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & RERleaf & Leaf respiration rate at $20^{\circ} \mathrm{C}$. Normally estimated via $N_{\text {leaf }}$. \\
\hline $M R_{\text {sapwood }}$ & ggluc. g $d r y^{-1}$. $d a y^{-1}$ & RERsapwood & Living sapwood (parenchymatic tissue) respiration rate at $20^{\circ} \mathrm{C}$. Normally estimated via $N_{\text {sapwood }}$. \\
\hline $M R_{\text {fineroot }}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & RERfineroot & Fine root respiration rate at $20^{\circ} \mathrm{C}$. Normally estimated via $N_{\text {fineroot }}$. \\
\hline $M R_{\text {leaf }}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & RERleaf & Leaf respiration rate at $20{ }^{\circ} \mathrm{C}$ \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $M R_{\text {sapwood }}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & RERsapwood & Living sapwood (parenchymatic tissue) respiration rate at $20^{\circ} \mathrm{C}$ \\
\hline $M R_{\text {fineroot }}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & RERfineroot & Fine root respiration rate at $20{ }^{\circ} \mathrm{C}$ \\
\hline $R G R_{\text {leaf,max }}$ & $m^{2} \cdot c m^{-2}$. $d a y^{-1}$ & RGRleafmax & Maximum leaf area daily growth rate, relative to sapwood area \\
\hline $R G R_{\text {cambium }, \text { max }}$ & $\mathrm{cm}^{2}$. $c m^{-1}$. $d a y^{-1}$ & RGRcambiummax & Maximum daily tree sapwood growth rate relative to cambium perimeter length \\
\hline $R G R_{\text {sapwood,max }}$ & $\mathrm{cm}^{2}$. $c m^{-2}$. $d a y^{-1}$ & RGRsapwoodmax & Maximum daily shrub sapwood growth rate relative to sapwood area \\
\hline $R G R_{\text {fineroot,max }}$ & gdry. gdry ${ }^{-1}$. $d a y^{-1}$ & RGRfinerootmax & Maximum daily fine root relative growth rate \\
\hline $C C_{\text {leaf }}$ & ggluc. gdry ${ }^{-1}$ & CCleaf & Leaf construction cost \\
\hline $C C_{\text {sapwood }}$ & ggluc. gdry ${ }^{-1}$ & CCsapwood & Sapwood construction cost \\
\hline $C C_{\text {fineroot }}$ & ggluc. gdry ${ }^{-1}$ & CCfineroot & Fine root construction cost \\
\hline $S R_{\text {sapwood }}$ & $d a y^{-1}$ & SRsapwood & Daily sapwood senescence rate \\
\hline $S R_{\text {fineroot }}$ & $d a y^{-1}$ & SRfineroot & Daily fine root senescence rate \\
\hline RSSG & [0-1] & RSSG & Minimum relative starch for sapwood growth to occur. \\
\hline $f_{H D, \text { min }}$ & $\mathrm{cm} \cdot \mathrm{cm}^{-1}$ & fHDmin & Minimum height-to-diameter ratio \\
\hline $f_{H D, \text { max }}$ & $\mathrm{cm} \cdot \mathrm{cm}^{-1}$ & fHDmax & Maximum height-to-diameter ratio \\
\hline & $g C$. & WoodC & Wood carbon content per dry weight \\
\hline
\end{tabular}

A third set of parameters refers to mortality/regeneration parameters (paramsMortalityRegeneration).

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $P_{\text {mort }, \text { base }}$ & [0-1] & MortalityBaselineRat & Đeterministic proportion or probability specifying the baseline reduction of cohort's density occurring in a year as a result of processes not explicitly modelled \\
\hline $T S_{\text {surv }}$ & [0-1] & SurvivalModelStep & Time step in years of the empirical survival model depending on stand basal area (e.g. 10) \\
\hline $\beta_{\text {surv }, 0}$ & [0-1] & SurvivalB0 & Intercept of the logistic baseline survival model depending on stand basal area \\
\hline $\beta_{\text {surv }, 1}$ & [0-1] & SurvivalB1 & Slope of the logistic baseline survival model depending on stand basal area \\
\hline $N_{\text {tree,recr }}$ & ind $\cdot h a^{-1}$ & RecrTreeDensity & Density of tree recruits from seeds. \\
\hline $N_{\text {tree,ingrowth }}$ & ind $\cdot h a^{-1}$ & IngrowthTreeDensity & Density of trees reaching ingrowth DBH. \\
\hline $D B H_{\text {tree,recr }}$ & cm & RecrTreeDBH & DBH for tree recruits from seeds or resprouting (e.g. 1 cm ). \\
\hline $D B H_{\text {tree,ingrowth }}$ & cm & IngrowthTreeDBH & Ingrowth DBH for trees (e.g. 7.5 cm ). \\
\hline
\end{tabular}

Vegetation functional attributes are normally filled for each cohort by function growthInput() or forest2growthInput() from species identity. However, different parameters can be specified for different cohorts of the same species if desired (see section 2.4.9).

\subsection*{15.5.3 Control parameters}

Control parameters modulate the overall behaviour of growth simulations (see section 2.6). Parameters controlling water balance have been already described in sections 3.5.3 and 7.6.3. Here we only mention those control parameters specific to the growth() function.

First, there are flags that regulate the application of processes:
- allowDessication [=TRUE]: Boolean flag to indicate that mortality by dessication is allowed.
- allowStarvation [=TRUE]: Boolean flag to indicate that mortality by starvation is allowed.
- sinkLimitation [=TRUE]: Boolean flag to indicate that temperature and turgor limitations to growth are applied.
- shrubDynamics [= TRUE]: Boolean flag to allow the application of demographic processes to shrubs.
- herbDynamics [= TRUE]: Boolean flag to allow dynamic herb leaf area as a function of shading due to leaf area of woody cohorts.

An important parameter concerns the allocation strategy:
- allocationStrategy [="Plant_kmax"] defines the allocation strategy (investment in leaf area vs. sapwood area) of the growth model. If allocationStrategy = "Plant_kmax" then the target leaf area is set to maintain the input whole-plant maximum conductance. If allocationStrategy $=$ "Al2As" then the target leaf area is set to maintain the input Huber value.

A number of control parameters regulate carbon balance:
- phloemConductanceFactor $[=0.2]$ : Factor to transform stem xylem conductance to phloem conductance (only for transpirationMode = "Sperry").
- nonSugarConcentration [=0.25]: A constant specifying non-sugar (inorganic) solute concentration ( $\mathrm{mol} \cdot L^{-1}$ ) in cells.
- equilibriumOsmoticConcentration $[=c($ leaf $=0.8$, sapwood $=0.6)]$ : Equilibrium osmotic concentrations ( $\mathrm{mol} \cdot L^{-1}$ ) for leaf and sapwood cells. The difference between leaf and sapwood values helps maintaining phloem transport. The equilibrium sugar concentration is found using equilibriumOsmoticConcentration - nonSugarConcentration and defaults to $[=c$ (leaf = 0.55, sapwood $=0.35$ )].
- minimumRelativeStarchForGrowth [= 0.50]: Default minimum concentration of storage carbon (starch), relative to the maximum storage capacity, for sapwood growth to occur. This default value is used when species-specific values are not specified via SpParams.
- senescenceRates $[=c(s a p w o o d=0.0001261398$, fineroot $=0.001897231)]$ : Relative senescence rates ( $d a y^{-1}$ ) for sapwood and fine roots. Default are equivalent to $4.5 \%$ and $50 \%$ annual turnover for sapwood and fine roots, respectively. Leaf senescence rates depend on leaf lifespan (i.e. leaf duration) for evergreen species. These are default values used when relative growth rates are not specified via species-specific SpParams.
- constructionCosts $[=c($ leaf $=1.5$, sapwood $=1.47$, fineroot $=1.30)]$ : Default construction costs, including respiration and structural carbon, per dry weight of new tissue ( $g$ gluc $\cdot g d r y^{-1}$ ). These are default values used when relative growth rates are not specified via species-specific SpParams.
- maximumRelativeGrowthRates $[=c$ (leaf $=0.01$, cambium $=0.005$, sapwood $=0.002$, fineroot $=0.1)]$ : Default maximum relative growth rates for leaves $\left(\mathrm{m}^{2} \cdot \mathrm{~cm}^{-2} \cdot d a y^{-1}\right)$, tree sapwood $\left(\mathrm{cm}^{2} \cdot \mathrm{~cm}^{-1} \cdot d a y^{-1}\right)$, shrub sapwood $\left(\mathrm{cm}^{2} \cdot \mathrm{~cm}^{-2} \cdot d a y^{-1}\right)$ and fine roots $\left(\mathrm{gdry} \cdot \mathrm{gdry} y^{-1} \cdot d a y^{-1}\right)$. These are default values used when relative growth rates are not specified via species-specific SpParams.

Finally, we have the following options regarding mortality:
- mortalityMode [= "density/deterministic"]: String describing how mortality is applied. Current accepted values are combinations of "cohort" vs "density" (for whole-cohort mortality vs reduction of stem density) and "deterministic" vs. "stochastic".
- mortalityBaselineRate [= 0.0015]: Default deterministic proportion or probability specifying the baseline reduction of cohort's density occurring in a year as a result of processes not explicitly modelled (for mortalityMode = "density/deterministic" or "density/stochastic").
- mortalityRelativeSugarThreshold [= 0.4]: Threshold of stem sugar concentration relative to equilibrium values (by default $40 \%$ ), resulting in an increased mortality rate/probability whenever levels are below.
- mortalityRWCThreshold [= 0.4]: Threshold of stem relative water content resulting in increased mortality rate/probability whenever levels are below (by default $40 \%$ ).

\subsection*{15.5.4 Model output}

\subsection*{15.5.4.1 Daily output}

Functions growth() returns a list of a class with the same name. The first four elements of this list (i.e., latitude, topography, weather and growthInput) are simply copies of model inputs. The next element is growthOutput, which contains the state of the input object at the end of the simulation (this can be used to perform further simulations starting with current values of state variables). The remaining list elements are:

\begin{tabular}{|l|l|}
\hline Element & Description \\
\hline WaterBalance & Climatic input and water balance flows (i.e. net precipitation, infiltration, runoff, transpiration...). All of them in $m m=L \cdot m^{-2}$. \\
\hline \multicolumn{2}{|l|}{EnergyBalance Energy balance components (instantaneous values) for the soil and the canopy} \\
\hline \multicolumn{2}{|l|}{CarbonBalance Stand-level carbon balance components (gross primary production, maintenance respiration, synthesis respiration and net primary production). All of them in $g C \cdot m^{-2}$.} \\
\hline \multicolumn{2}{|l|}{BiomassBalanceStand-level biomass balance components. All of them in $g d r y \cdot m^{-2}$.} \\
\hline Temperature & Minimum and maximum temperature values for topsoil, canopy and atmosphere (if transpirationMode = "Sperry") \\
\hline Soil & Soil variables for each soil layer: Moisture relative to field capacity ( $W_{s}$ ), water potential ( $\Psi_{s}$ ) and volumetric water content ( $V_{s}$ ). \\
\hline Stand & Stand-level variables, such as $L A I_{\text {stand }}^{\phi}=L A I_{\text {stand }}^{\text {live }}, L A I_{\text {stand }}^{\text {dead }}$, the water retention capacity of the canopy ( $S_{\text {canopy }}$ ) or the fraction of light reaching the ground ( $L_{\text {ground }}^{\text {PAR }}$ and $L_{\text {ground }}^{S W R}$ ). \\
\hline Plants & Plant-level variables, such as $L A I_{i}^{p h i}$, plant transpiration, plant water potential, etc. \\
\hline SunlitLeaves & Leaf-level output variables for sunlit leaves (transpirationMode = "Sperry"). \\
\hline ShadeLeaves & Leaf-level output variables for shade leaves (transpirationMode = "Sperry"). \\
\hline \multicolumn{2}{|l|}{LabileCarbonBaAalmstewith the daily results of labile carbon balance components and carbon pools.} \\
\hline \multicolumn{2}{|l|}{PlantBiomassBaAalmstewith the daily results of biomass balance components for plant cohorts.} \\
\hline \multicolumn{2}{|l|}{PlantStructureA list with daily results of plant compartment sizes, in terms of area and biomass.} \\
\hline \multicolumn{2}{|l|}{GrowthMortalith list with daily results of growth rates for leaf, sapwood and fine roots; as well as daily mortality rates.} \\
\hline
\end{tabular}

Elements WaterBalance to ShadeLeaves are equal to the output of function spwb() and were described in previous chapters (see 3.5.4 and 7.6.4).

The following table describes the child elements of LabileCarbonBalance, each of them a data frame with dates in rows and plant cohorts in columns:

\begin{tabular}{|l|l|l|}
\hline Element Symbol & Units & Description \\
\hline GrossPhotosynthelslis & ggluc • gdry ${ }^{-1}$. $d a y^{-1}$ & Daily gross photosynthesis per dry weight of living biomass. \\
\hline MaintentanceRelsphation & ggluc $\cdot$ gdry ${ }^{-1}$. $d a y^{-1}$ & Daily maintenance respiration (including leaves, sapwood and fine roots) per dry weight of living biomass. \\
\hline GrowthCosts $\quad G_{i} / B_{i}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & Daily growth costs (including leaves, sapwood and fine roots) per dry weight of living biomass. \\
\hline RootExudation $R E_{i}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & Daily root exudation per dry weight of living biomass. \\
\hline CarbonBalance $\Delta S_{i} / B_{i}$ & ggluc $\cdot$ gdry ${ }^{-1}$ & Daily labile carbon balance (eq. (15.8)) per dry weight of living biomass. \\
\hline SugarLeaf & mol gluc $\cdot$ $L^{-1}$ & Sugar concentration in leaves. \\
\hline StarchLeaf $\quad S T_{\text {leaf }, i}$ & molgluc. $L^{-1}$ & Starch concentration in leaves. \\
\hline SugarSapwood $S S_{\text {sapwood, } i}$ & molgluc $\cdot$ $L^{-1}$ & Sugar concentration in sapwood. \\
\hline StarchSapwood $S T_{\text {sapwood, } i}$ & molgluc $\cdot$ $L^{-1}$ & Starch concentration in sapwood. \\
\hline SugarTransport $F_{\text {phloem }}$ & molgluc $\cdot$ $s^{-1}$ & Average instantaneous rate of carbon transferred between leaves and stem compartments via phloem. \\
\hline
\end{tabular}

The following table describes the child elements of PlantCarbonBalance, each of them a data frame with dates in rows and plant cohorts in columns:

\begin{tabular}{|l|l|l|}
\hline Element & Units & Description \\
\hline StructuralBiomassBalance & \begin{tabular}{l}
gdry. $m^{-2}$. \\
$d a y^{-1}$
\end{tabular} & Daily structural biomass balance. \\
\hline LabileBiomassBalance & \begin{tabular}{l}
gdry. $m^{-2}$. \\
$d a y^{-1}$
\end{tabular} & Daily labile biomass balance. \\
\hline PlantBiomassBalance & \begin{tabular}{l}
gdry. $m^{-2}$. \\
$d a y^{-1}$
\end{tabular} & Daily plant biomass balance. \\
\hline MortalityBiomassLoss & gdry. $m^{-2}$. $d a y^{-1}$ & Daily biomass loss due to mortality. \\
\hline CohortBiomassBalance & \begin{tabular}{l}
gdry. $m^{-2}$. \\
$d a y^{-1}$
\end{tabular} & Daily cohort biomass balance (includes plant biomass balance and mortality). \\
\hline
\end{tabular}

The following table describes the child elements of PlantStructure, again each of them a data frame with dates in rows and plant cohorts in columns:

\begin{tabular}{|l|l|l|l|}
\hline Element & Symbol & Units & Description \\
\hline LeafBiomass & $B_{\text {leaf }, i}$ & gdry. ind ${ }^{-1}$ & Daily leaf structural biomass for an average individual. \\
\hline SapwoodBiomass $\boldsymbol{B}_{\text {sapwood }, i}$ & & gdry. ind ${ }^{-1}$ & Daily sapwood structural biomass for an average individual. \\
\hline \multicolumn{2}{|c|}{FineRootBiomass ${ }_{\text {fineroot }, i}$} & gdry. ind ${ }^{-1}$ & Daily fine root biomass for an average individual. \\
\hline LeafArea & $L A_{i}$ & $m^{2}$ & Daily amount of leaf area for an average individual. \\
\hline SapwoodArea & $S A_{i}$ & $\mathrm{cm}^{2}$ & Daily amount of sapwood area for an average individual. \\
\hline FineRootArea & $F R A_{i}$ & $m^{2}$ & Daily amount of fine root area for an average individual. \\
\hline HuberValue & $H_{v}$ & $\mathrm{cm}^{2} \cdot \mathrm{~m}^{-2}$ & The ratio of sapwood area to (target) leaf area \\
\hline \multicolumn{2}{|l|}{RootAreaLeafArea} & $m^{2} \cdot m^{-2}$ & The ratio of fine root area to (target) leaf area \\
\hline DBH & $D B H_{i}$ & cm & Daily diameter at breast height for an average individual. \\
\hline Height & $H_{i}$ & cm & Daily total height for an average individual. \\
\hline
\end{tabular}

The following table describes the child elements of GrowthMortality, again each of them a data frame with dates in rows and plant cohorts in columns:

\begin{tabular}{|l|l|l|}
\hline Element & Units & Description \\
\hline LAgrowth & $m^{2} \cdot \mathrm{~cm}^{-2}$. $d a y^{-1}$ & Leaf area growth relative to sapwood area for an average individual. \\
\hline SAgrowth & $c m^{2}$. $c m^{-2}$. $d a y^{-1}$ & Leaf area growth relative to sapwood area for an average individual. \\
\hline FRAgrowth & $m^{2} \cdot \mathrm{~cm}^{-2}$. $d a y^{-1}$ & Fine root area growth relative to sapwood area for an average individual. \\
\hline StarvationRate & ind. ind ${ }^{-1}$. $d a y^{-1}$ & Daily mortality rate from starvation. \\
\hline DessicationRate & \begin{tabular}{l}
ind. ind ${ }^{-1}$. \\
$d a y^{-1}$
\end{tabular} & Daily mortality rate from dessication. \\
\hline MortalityRate & ind. ind ${ }^{-1}$. $d a y^{-1}$ & Daily mortality rate (any cause). \\
\hline
\end{tabular}

\subsection*{15.5.4.2 Subdaily output}

As with function spwb(), subdaily output can also be generated with function growth(). This is done via setting subdailyResults = TRUE in the control parameter list. In that case, the output list of growth() will include an element subdaily, whose subelements correspond to the results of growth_day() for each date simulated. Refer to the documentation of function growth_day() for details of sub-daily output.

\section*{Chapter 16}

\section*{Carbon pools and components of the carbon balance}

\subsection*{16.1 Size of carbon pools}

Biomass of leaves, sapwood and fine roots is needed in the model to estimate respiratory costs and the size of the C storage pools.

\subsection*{16.1.1 Leaf structural, metabolic and storage biomass}

The live leaf area $L A^{\text {live }}$ per individual (in $m^{2}$ ) is:
\[
L A^{\text {live }}=10000 \cdot L A I^{\text {live }} / N
\]
where $N$ is the density of the cohort and $L A I^{\text {live }}$ is the leaf area index. The actual (expanded) leaf area $L A^{\phi}$ is estimated analogously from $L A I^{\phi}$ :
\[
L A^{\phi}=10000 \cdot L A I^{\phi} / N
\]

Structural leaf biomass per individual ( $B_{\text {leaf }} ; g d r y$ ů $i n d^{-1}$ ) is the result of dividing leaf area by $S L A\left(m^{2}\right.$. $k g^{-1}$ ), the specific leaf area of the species:
\[
B_{l e a f}=1000 \cdot L A^{\phi} / S L A
\]
where a factor 1000 is used to convert from kg to g. Hence, only expanded leaf area has respiratory cost (i.e. winter resistance buds do not). Leaf storage volume for an individual ( $V_{\text {storage, leaf }}$; in $L \cdot$ ind ${ }^{-1}$ ) is:
\[
V_{\text {storage }, \text { leaf }}=L A^{\phi} \cdot V_{\text {leaf }}
\]
where $V_{\text {leaf }}$ is the water storage capacity of leaf tissue per leaf area unit (in $L \cdot m^{-2}$ ) (see A.4.5). Leaf storage volume is necessary to estimate the biomass of metabolic (sugars) or storage (starch) from the concentration of these substances in leaves ( $S S_{\text {leaf }}$ and $S T_{\text {leaf }}$, which are expressed in $\mathrm{mol} \mathrm{gluc} \cdot L^{-1}$ ), and conversely. For example:
\[
B_{\text {sugar }, \text { leaf }}=S S_{\text {leaf }} \cdot V_{\text {storage }, \text { leaf }} \cdot m_{\text {gluc }}
\]
where $m_{\text {gluc }}$ is the molar mass of glucose. To estimate leaf starch storage capacity, the model assumes that up to $10 \%$ of leaf tissue volume can be occupied with starch, so that the leaf starch storage capacity ( $S T_{\text {leaf }}^{\max }$; in $\mathrm{mol} \cdot$ ind $^{-1}$ ) is:
\[
S T_{\text {leaf }}^{\max }=0.1 \cdot 1000 \cdot \frac{V_{\text {storage }, \text { leaf }} \cdot \rho_{\text {starch }}}{m_{\text {starch }}}
\]
where $\rho_{\text {starch }}$ is the density of starch and $m_{\text {starch }}$ is its molar mass.

\subsection*{16.1.2 Sapwood structural, metabolic and storage biomass}

Sapwood volume ( $V_{\text {sapwood }}$; in $L \cdot$ ind ${ }^{-1}$ ) is defined as the product of sapwood area and the sum of aboveground height and belowground coarse root length:
\[
V_{\text {sapwood }}=1000 \cdot S A \cdot\left(H+\sum_{s} F R P_{s} \cdot L_{s}\right)
\]
where $S A$ is sapwood area, $H$ is plant height, $F R P_{s}$ is the proportion of fine roots in soil layer $s$ and $L_{s}$ is the coarse root length in layer $s$ (all lengths expressed here in $m$ ). Sapwood structural biomass per individual ( $B_{\text {sapwood }} ; g d r y$ ůind ${ }^{-1}$ ) represents the sapwood biomass of sapwood of trunks, branches and coarse roots. It is defined as the product of $V_{\text {sapwood }}$ and wood density ( $\rho_{\text {wood }} ; g d r y \stackrel{\circ}{\mathrm{u}} \mathrm{cm}^{-3}$ ):
\[
B_{\text {sapwood }}=1000 \cdot V_{\text {sapwood }} \cdot \rho_{\text {wood }}
\]

While $B_{\text {sapwood }}$ represents the structural sapwood biomass, it cannot be used to estimate sapwood respiration, since only xylem axial or radial parenchymatic rays (and not dead cells like tracheids or vessels) contribute to sapwood respiration. In addition, we assume that embolized parts of sapwood do not contribute to sapwood respiration. Hence, sapwood living (respiratory) biomass is estimated using:
\[
B_{\text {living,sapwood }}=1000 \cdot\left(1-P L C_{\text {stem }}\right) \cdot V_{\text {sapwood }} \cdot \rho_{\text {wood }} \cdot\left(1-f_{\text {conduits }}\right)
\]
where $P L C_{\text {stem }}$ is the current proportion of stem conductance lost and $f_{\text {conduits }}$ is the fraction of sapwood volume that corresponds to dead conducts, being the complement of the fraction of parenchymatic tissue. The volume available for metabolic or storage carbon within sapwood is limited by both the sapwood fraction that corresponds to parenchyma and wood porosity (i.e. $\left(1-\left(\rho_{\text {wood }} / 1.54\right)\right)$ ). Sapwood storage volume ( $V_{\text {storage,sapwood }}$; in $L \cdot$ ind $^{-1}$ ) is:
\[
V_{\text {storage }, \text { sapwood }}=V_{\text {sapwood }} \cdot\left(1-\left(\rho_{\text {wood }} / 1.54\right)\right) \cdot\left(1-f_{\text {conduits }}\right)
\]

Analogously to leaf carbon, $V_{\text {storage,sapwood }}$ is used to estimate the biomass of metabolic (sugars) or storage (starch) from the concentration of these substances in sapwood ( $S S_{\text {sapwood }}$ and $S T_{\text {sapwood }}$, which are expressed in $m o l g l u c \cdot L^{-1}$ ), and conversely. For example:
\[
B_{\text {sugar }, \text { sapwood }}=S S_{\text {sapwood }} \cdot V_{\text {storage }, \text { sapwood }} \cdot m_{\text {gluc }}
\]
where $m_{\text {gluc }}$ is the molar mass of glucose. To estimate sapwood storage capacity, the model assumes that up to $50 \%$ of volume of parenchymatic cells can be occupied with starch, so that the sapwood starch storage capacity ( $S T_{\text {sapwood }}^{\text {max }}$; in $\mathrm{mol} \cdot$ ind $^{-1}$ ) is:
\[
S T_{\text {sapwood }}^{\max }=0.5 \cdot 1000 \cdot \frac{V_{\text {storage }, \text { sapwood }} \cdot \rho_{\text {starch }}}{m_{\text {starch }}}
\]

\subsection*{16.1.3 Fine root area and biomass}

The fine root compartment does not have labile carbon (i.e. the model supplies labile carbon for fine roots from sapwood compartment), so that only the structural biomass of fine roots needs to be estimated. If growth is simulated using the basic water balance model, the initial area of fine roots ( $F R A, m^{2}$ ) for layer $s$ is estimated from leaf area using:
\[
F R A=F R P_{s} \cdot L A^{\phi} \cdot R L R
\]
where $F R P_{s}$ is the proportion of fine roots in layer $s$ and $R L R$ is the species-specific root area to leaf area ratio. Biomass of fine roots per individual for a given layer $s$ ( $B_{\text {fineroot }, s} ; g d r y \mathrm{u} i n d^{-1}$ ) is then estimated from $F R A_{s}$ using:
\[
B_{\text {fineroot }, s}=\frac{10^{4} \cdot F R A_{s}}{2.0 \cdot \sqrt{\frac{\pi \cdot S R L}{\rho_{\text {fineroot }}}}}
\]
where $\rho_{\text {fineroot }}$ is fine root tissue density ( $g d r y \cdot \mathrm{~cm}^{-3}$ ) and $S R L\left(\mathrm{~cm} \cdot g d r y^{-1}\right)$ is the specific root length. Fine root biomass per individual ( $g d r y \cdot i n d^{-1}$ ) is simply the sum across layers:
\[
B_{\text {fineroot }}=\sum_{s} B_{\text {fineroot }, s}
\]

If growth is simulated using the advanced water balance model, the initial fine root length per area in each soil layer ( $F L A_{s} ; m \cdot m^{-2}$ ) is estimated from rhizosphere conductance, assuming a cylindrical flow geometry in the rhizosphere. The initial fine root biomass for a given layer $s\left(g d r y \cdot i n d^{-1}\right)$ is then calculated using:
\[
B_{\text {fineroot }, s}=\frac{10000 \cdot F L A_{s}}{N \cdot 0.01 \cdot S R L}
\]
where $N$ is the density of individuals. Finally, initial fine root area in each soil layer ( $F R A_{s}$ ) is then calculated from $B_{\text {fineroot }}$ by inverting the equation presented above:
\[
F R A_{s}=10^{-4} \cdot B_{\text {fineroot }, s} \cdot 2.0 \cdot \sqrt{\frac{\pi \cdot S R L}{\rho_{\text {fineroot }}}}
\]

\subsection*{16.1.4 Total living biomass}

Total living biomass per individual (i.e. not accounting for heartwood or xylem conduits) is:
\[
\begin{aligned}
B_{\text {total }} & =B_{\text {leaf }}+B_{\text {living,sapwood }}+B_{\text {fineroot }}+ \\
& +B_{\text {sugar,leaf }}+B_{\text {starch,leaf }}+B_{\text {sugar,sapwood }}+B_{\text {starch,sapwood }}
\end{aligned}
\]
$B_{\text {total }}$ is used to express carbon balance components per dry weight of living biomass in the model output, which allows a better comparison across plant cohorts of different size and species.

\subsection*{16.2 Components of labile carbon balance}

Here we provide the details of labile carbon balance calculations, i.e. how the components of eqs. (15.2) and (15.6) are determined.

\subsection*{16.2.1 Gross photosynthesis}

The soil water balance submodel provides values of photosynthesis calculated at the plant cohort level, but note that the user output of function spwb and pwb refers to net photosynthesis ( $A_{n}$ ) after accounting for an estimate of leaf respiration. In the basic water balance model there is no way to make the distinction between gross and net photosynthesis, so we will assume here that $A_{g}=A_{n}$ (in $g C \cdot m^{-2}$ ) as calculated in section 6.1.6. In the advance water balance model the output is also net photosynthesis, but the distinction is possible (see section 11.1). In any case, here we start with a $A_{g}$ value in units of carbon per ground area unit, i.e. $g C \cdot m^{-2}$, and to enter the carbon balance we need scale photosynthesis to units of glucose per individual ( $A$; in g gluc $\cdot i n d^{-1}$ ). This is done using:
\[
A=\frac{10000 \cdot A_{g}}{N} \cdot \frac{m_{g l u c}}{m_{\text {carbon }} \cdot 6}
\]
where $N$ is the density of individuals per hectare, $m_{\text {gluc }}$ is the glucose molar mass and $m_{\text {carbon }}$ is the carbon molar mass.

\subsection*{16.2.2 Maintenance respiration}

Maintenance respiration (in $g$ glucuind ${ }^{-1}$ ) is calculated for each of the three compartments (leaves, sapwood, and fine roots) individually (Mouillot et al. 2001), and differs slightly depending on the complexity of the transpiration submodel.

When simulating growth with the basic water balance, the model uses a $Q_{10}$ relationship of baseline respiration with temperature, which means that for every $10{ }^{\circ} \mathrm{C}$ change in temperature there is a $Q_{10}$ factor change in respiration:
\[
\begin{aligned}
M_{\text {leaf }} & =\left(B_{\text {leaf }}+B_{\text {sugar,leaf }}\right) \cdot M R_{\text {leaf }} \cdot Q_{10}^{\left(T_{\text {mean }}-20\right) / 10} \cdot\left(L^{\text {PAR }}\right)^{\text {WU } E_{\text {decay }}} \\
M_{\text {sapwood }} & =\left(B_{\text {living,sapwood }}+B_{\text {sugar,sapwood }}\right) \cdot M R_{\text {sapwood }} \cdot Q_{10}^{\left(T_{\text {mean }}-20\right) / 10} \\
M_{\text {fineroot }} & =B_{\text {fineroot }} \cdot M R_{\text {fineroot }} \cdot Q_{10}^{\left(T_{\text {mean }}-20\right) / 10} \cdot\left(L A_{i} / L A_{i}^{\text {live }}\right)
\end{aligned}
\]
where $T_{\text {mean }}$ is the average daily temperature (in ${ }^{\circ} \mathrm{C}$ ). Baseline maintenance respiration rates per dry biomass ( $M R_{\text {leaf }}, M R_{\text {sapwood }}$ and $M R_{\text {fineroot }}$ for leaves, parenchymatic sapwood and fine roots, respectively; in $g g l u c \cdot g d r y^{-1} \cdot d a y^{-1}$ ) are can be supplied via species-specific parameters and should refer to $20{ }^{\circ} \mathrm{C}$. Leaf and fine root rates can also be estimated from nitrogen concentration, following Reich et al. (2008) (see section A.3.18). Factor $Q_{10}$ has been found to decrease with temperature (Tjoelker et al. 2001). For example, a $10^{\circ} \mathrm{C}$ increase in measurement temperature at low measurement temperatures from 5 to $15^{\circ} \mathrm{C}$ results in an approximate 2.8 fold increase in respiration rate, whereas an increase in temperature from 25 to $35^{\circ} \mathrm{C}$ results in a less than two-fold (1.8) increase in rate. The general temperature relationship proposed by Tjoelker et al. (2001) is used here:
\[
Q_{10}=3.22-0.046 \cdot T_{\text {mean }}
\]

Factor $\left(L^{P A R}\right)^{W U E_{\text {decay }}}$ is added to reduce respiration rates in leaves under shade, analogously to the reduction of water use efficiency explained in 6.1.6. Thus, it is assumed that the carbon use efficiency of the leaves is more or less constant. Factor $L A_{i} / L A_{i}^{\text {live }}$ is added to the maintenance respiration of fine roots to reduce respiration rates during winter in winter-deciduous species, assuming a decrease in respiration rates of fine roots parallel to that of leaves.

When simulating growth with the advanced model, sub-daily leaf maintenance respiration rates are estimated as the difference between gross and net photosynthesis (see 11.1.4). Sapwood and fine root respiration rates are also estimated at sub-daily steps and, hence, sub-daily canopy temperature variation is taken into account (i.e. sub-daily canopy $T_{\text {can }}$ values are used instead of the daily temperature mean, $T_{\text {mean }}$ ).

\subsection*{16.2.3 Growth respiration}

Construction costs per unit dry weight of new tissue ( $C C_{\text {leaf }}, C C_{\text {sapwood }}$ and $C C_{\text {fineroot }}$ for leaves, sapwood and fine roots; in $g g l u c \cdot g d r y^{-1}$ ) are specified as control parameters (i.e. they are not species-specific). These unitary costs include both the carbon used in respiration during growth and structural carbon. Given an increase in leaf area $\Delta L A$, leaf growth respiration is:
\[
G_{\text {leaf }}=\Delta L A \cdot C C_{\text {leaf }} \cdot 1000 / S L A
\]

Analogously, given an increase in sapwood area $\Delta L A$, sapwood growth respiration is:
\[
G_{\text {sapwood }}=\Delta S A \cdot C C_{\text {sapwood }} \cdot\left(H+\sum_{s} F R P_{s} \cdot L_{s}\right) \cdot \rho_{\text {wood }}
\]

Finally, and given an increase in fine root biomass $\Delta B_{\text {fineroot }}$ :
\[
G_{\text {fineroot }}=\Delta B_{\text {fineroot }} \cdot C C_{\text {fineroot }}
\]

\subsection*{16.2.4 Phloem transport}

When growth is simulated using the basic water balance model, phloem transport between leaf and sapwood ( $F_{\text {phloem }}$ ) is simply modelled as the flow needed to make the concentration of metabolic carbon equal in both compartments. When the advanced water balance submodel is used, $F_{\text {phloem }}$ is modelled following Hölttä et al. (2017). Specifically, the instantaneous phloem flow per leaf area basis ( $\mathrm{mol} \mathrm{gluc} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1}$ ) depends on $k_{\text {phloem }}$, i.e. the phloem conductance per leaf area basis ( $L \cdot m^{-2} \cdot M P a^{-1} \cdot s^{-1}$ ), sap viscosity relative to water and the difference in turgor between the sieve cells of leaf and sapwood compartments. $k_{\text {phloem }}$ is estimated as linear function of stem maximum conductance, $k_{\text {stem, max }}$ :
\[
k_{\text {phloem }}=f_{\text {phloem }} \cdot k_{\text {stem }, \max }
\]
where factor $f_{\text {phloem }}$ is specified by the control parameter phloemConductanceFactor. Sap viscosity is calculated following Först et al. (2002), which takes into account temperature and the average sugar concentration between the two compartments (no phloem flow can occur if temperature is below zero). Turgor in sieve cells of each compartment depends on symplastic water potential and osmotic water potential, with Van't Hoff's equation being used to calculate the osmotic water potential, based on temperature, sugar concentration and the concentration of other solutes (control parameter nonSugarConcentration). Note that here leaf or sapwood sugar concentration is modulated to account for the effect of the relative water content of the compartment on osmotic water potential.

\subsection*{16.2.5 Sugar-starch dynamics}

When growth is simulated using the basic water balance submodel, sugar-starch dynamics ( $S C_{\text {leaf }}$ and $S C_{\text {sapwood }}$ ) are simply defined as the conversion between metabolic and storage carbon needed to keep the sugar concentration equal to an equilibrium required for metabolic functioning, which is specified by control parameters equilibriumOsmoticConcentration (including two values, for leaves and sapwood respectively) and nonSugarConcentration. For example, if leaf osmotic equilibrium concentration is $0.8 \mathrm{~mol} \mathrm{gluc} \cdot L^{-1}$ and non-sugar concentration is $0.3 \mathrm{~mol} \mathrm{gluc} \cdot L^{-1}$, the model will simulate sugar-starch dynamics to stabilize sugar concentration in leaves to $0.5 \mathrm{~mol} \mathrm{gluc} \cdot L^{-1}$. A lower equilibrium osmotic concentration is required for sapwood, by default $0.6 \mathrm{~mol} g l u c \cdot L^{-1}$, so that sugar equilibrium concentration is $0.1 \mathrm{~mol} g l u c \cdot L^{-1}$. That lower equilibrium concentrations are required for sapwood than for leaves is necessary to sustain the phloem transport of sugars from leaves towards sapwood.

When growth is simulated using the advanced water balance submodel, sugar-starch dynamics are similar to the previous case, in the sense that equilibrium sugar concentrations are sought for leaves and sapwood. However, instantaneous conversion rates are calculated depending on equations regulating starch synthesis (occurring when sugar concentration is higher than the equilibrium concentration) and starch hydrolysis (occurring when sugar concentration is lower than the equilibrium concentration). Synthesis is modelled as a Michaelis-Menten function, whereas hydrolysis rate is simply a linear function of starch concentration. Maximum synthesis rates and hydrolysis linear factors are larger (i.e. faster sugar-starch dynamics) in leaves than sapwood.

\subsection*{16.2.6 Root exudation}

Whereas surplus in leaf storage capacity is relocated into sapwood storage, surplus in sapwood storage carbon is diverted towards root exudation ( $R E_{\text {sapwood }}$ ). Hence, root exudation is not a process competing for metabolic carbon, but only a consequence of plant C storage capacity being surpassed (Prescott et al. 2020). Root exudation may happen in the model when growth is restricted due to sink limitations but photosynthesis continues and storage carbon levels have attained the storage capacity in the sapwood compartment ( $S T_{\text {sapwood }}>S T_{\text {sapwood }}^{\text {max }}$ ).

\section*{Chapter 17}

\section*{Growth, senescence and mortality}

\subsection*{17.1 Growth}

\subsection*{17.1.1 Temperature and turgor sink limitations}

Sink limitations due to temperature and turgor effects on growth are modelled following Cabon et al. (2020a) and Cabon et al. (2020b). These authors suggested equations to model sink limitations on cambium cell division and tracheid expansion, but we apply the same approach for simulating growth of leaves, sapwood and fine roots. Cell relative expansion rate ( $r_{\text {cell }}$ ) is central to the approach by Cabon et al. and is defined as the relative time derivative of cell volume:
\[
r_{c e l l}=\frac{d V}{V d t}
\]

Cabon et al. (2020a) first suggested to model the dependence of $r_{\text {cell }}$ on cell turgor using Lockhart's equation:
\[
r_{c e l l}\left(\Psi, \pi_{0}\right)=\phi_{\max } \cdot\left(\Psi-\pi_{0}-Y_{P}\right)
\]
where $\Psi$ is the water potential, $\pi_{0}$ is the osmotic water potential at full turgor, $Y_{P}$ is the turgor yield threshold and $\phi_{\text {max }}$ is the maximum cell wall extensibility. Later, Cabon et al. (2020b) suggested to account for both turgor and temperature limitations on $r_{\text {cell }}$ using the following expanded equation:
\[
r_{c e l l}\left(T, \Psi, \pi_{0}\right)=\phi_{\max } \cdot\left(\Psi-\pi_{0}-Y_{P}\right) \cdot \frac{f_{\operatorname{met}}\left(T_{K}\right)}{f_{\operatorname{met}}(288.15)} \cdot f_{\text {micro }}\left(T, T_{\text {thr }}\right)
\]
where $T$ is temperature, $f_{\text {met }}\left(T_{K}\right)$ is a function modulating the effect of temperature $T_{K}$ in Kelvin, on metabolic rate, and $f_{\text {micro }}\left(T, T_{\text {thr }}\right)$ is a sigmoidal function modulating the effect of temperature on microtubule stability, depending on a temperature threshold $T_{\text {thr }}$. Function $f_{\text {met }}\left(T_{K}\right)$ is defined as:
\[
f_{m e t}\left(T_{K}\right)=\frac{T_{K} \cdot \exp \left\{\frac{\Delta H_{A}}{R^{n} \cdot T_{K}}\right\}}{1+\exp \left\{\frac{\Delta S_{D}}{R^{n}} \cdot\left(1-\frac{\Delta H_{D}}{\Delta S_{D} \cdot T_{K}}\right)\right\}}
\]
where $R^{n}$ is the ideal gas constant, $\Delta H_{A}=87500$ the enthalpy of activation and $\Delta H_{D}=333000$ and $\Delta S_{D}=1090$ the enthalpy and entropy difference (respectively) between the catalytically active and inactive states of the enzymatic system).

Scaling from the cell to the tissue level is conducted by assuming that maximum cell-level expansion rates correspond to maximum tissue-level relative growth rates.

\subsection*{17.1.2 Leaf growth}

Leaf area increment $\Delta L A$ only occurs when phenological state is unfolding, and is defined as the minimum of three values expressing three corresponding constraints:
\[
\Delta L A=\min \left(\Delta L A_{\text {alloc }}, \Delta L A_{\text {source }}, \Delta L A_{\text {sink }}\right)
\]

First, $\Delta L A_{\text {alloc }}$ is the maximum leaf area increment allowed by the leaf area target set by the allocation rule, $L A^{\text {target }}$, in comparison with current leaf area $L A^{\phi}$ :
\[
\Delta L A_{\text {alloc }}=\max \left(L A^{\text {target }}-L A^{\phi}, 0\right)
\]

Remember that leaf area target is updated during bud formation (see 17.3.2).
Second, $\Delta L A_{\text {source }}$ represents the leaf area increment expected given carbon source limitations and is calculated:
\[
\Delta L A_{\text {source }}=\frac{S T_{\text {sapwood }} \cdot m_{\text {gluc }} \cdot V_{\text {sapwood }, \text { leaf }}}{1000 \cdot C C_{\text {leaf }} / S L A}
\]
where $S T_{\text {sapwood }}$ is the current concentration of sapwood storage carbon (starch), $V_{\text {storage,sapwood }}$ is the sapwood storage volume and $m_{\text {gluc }}$ is glucose molar mass and the denominator contains the construction costs per leaf area unit, see eq. (16.23).
Finally, $\Delta L A_{\text {sink }}$ represents the leaf area increment expected by taking into account the maximum leaf tissue growth rate relative to sapwood area ( $R G R_{\text {leaf,max }}$; in $\mathrm{m}^{2} \cdot \mathrm{~cm}^{-2} \cdot d a y^{-1}$ ), the percentage of the crown with active buds ( $P C A B$ ) and the relative cell expansion rate given $T_{\text {day }}, \Psi_{\text {symp,leaf }}$ and $\pi_{0, \text { leaf }}$ :
\[
\begin{aligned}
\Delta L A_{\text {sink }} & =S A \cdot(P C A B / 100) \cdot R G R_{\text {leaf }, \text { max }} \cdot \frac{r_{\text {cell }}\left(T_{\text {day }}, \Psi_{\text {symp,leaf }}, \pi_{0, \text { leaf }}\right)}{r_{\text {cell,max }}} \\
& =S A \cdot(P C A B / 100) \cdot R G R_{\text {leaf }, \text { max }} \cdot \frac{\left(\Psi_{\text {symp,leaf }}-\pi_{0, \text { leaf }}-Y_{P}\right)}{\left(2-Y_{P}\right)} \cdot \frac{f_{\text {met }}\left(T_{\text {day }}\right)}{f_{\text {met }}(30)}
\end{aligned}
\]
where cell relative expansion rate is divided by the maximum relative cell expansion rate $r_{\text {cell,max }}=$ $r_{\text {cell }}(30,0,-2)$ so that $R G R_{\text {leaf,max }}$ is attained when sink conditions are optimal. Other parameters for eq. (17.3) are $\phi_{\text {max }}=0.5$ (which becomes irrelevant), $Y_{P}=0.05 M P a$ and $T_{\text {thr }}=5^{\circ} \mathrm{C}$. Note that the final expression of $\Delta L A_{\text {sink }}$ reduces to a product of the maximum leaf area growth times two factors (for turgor and temperature) bounded between 0 and 1 .

\subsection*{17.1.3 Sapwood growth}

Sapwood area increment $\Delta S A$ can only occur if $L A^{\text {live }}>0$. Unlike leaf area or fine root biomass, it is not explicitly constrained by any allocation rule. However, newly assimilated carbon is preferentially allocated to leaves and fine roots whenever storage levels are low. $\Delta S A$ is defined as the minimum of two values expressing source and sink constraints:
\[
\Delta S A=\min \left(\Delta S A_{\text {source }}, \Delta S A_{\text {sink }}\right)
\]
$\Delta S A_{\text {source }}$ represents the sapwood area increment expected given carbon source limitations and is calculated using:
\[
\Delta S A_{\text {source }}=\frac{\max \left(S T_{\text {sapwood }}-S T_{\text {sapwood,growth }}, 0\right) \cdot m_{\text {gluc }} \cdot V_{\text {storage,sapwood }}}{C C_{\text {sapwood }} \cdot\left(H+\sum_{s} F R P_{s} \cdot L_{s}\right) \cdot \rho_{\text {wood }}}
\]
where $S T_{\text {sapwood }}$ is the current starch concentration, $S T_{\text {sapwood,growth }}$ is the minimum starch concentration required for sapwood growth, $V_{\text {storage,sapwood }}$ is the sapwood storage volume, $m_{\text {gluc }}$ is glucose molar mass and the denominator contains the construction costs per sapwood area unit, see eq. (16.24). $S T_{\text {sapwood,growth }}$ is related to the minimum relative starch concentration for growth ( $R S S G$ ), which is specified via the speciesspecific parameter RSSG or the control parameter minimumRelativeStarchForGrowth. This parameter is
important because it allows specifying to which extent a given plant species stops growth and saves carbon to ensure survival (e.g. shadow tolerant species), as opposed to a species strongly investing in growth to reach the top of the canopy and have access to high light levels (e.g. light-demanding species).
Sink limitations to sapwood growth are simulated using a set of $N_{c}=10$ cambium cells that undergo division and the new cells are added to a ring (i.e. a vector) of vessels that later suffer enlargement and maturation (Friend et al. 2019). Assuming that cambium cell volume must double before division, that cell-doubling time is the variable limiting cell division and that each division instantly results in a cell exiting the cambium and initiating differentiation into a vessel, production rate ( $P R_{\text {cambium }}$ ) of new vessels cells can be related to the cambial cell expansion rate $r_{\text {cambium }}$ such that (Cabon et al. 2020b):
\[
P R_{\text {cambium }}=\frac{N_{c}}{\ln (2)} \cdot r_{\text {cambium }}
\]
where $r_{\text {cambium }}=r_{\text {cell }}\left(T_{\text {day }}, \Psi_{\text {symp, stem }},-0.8\right)$, with other parameters of eq. (17.3) being $\phi_{\text {max }}=0.13$, $Y_{P}=0.05 M P a$ and $Y_{\text {thr }}=8{ }^{\circ} \mathrm{C}$. The ring growth model is implemented at daily time steps and daily $P R_{\text {cambium }}$ values are accumulated (i.e. $P_{\text {cambium }, t}=P_{\text {cambium }, t-1}+P R_{\text {cambium }, t}$ ). A new vessel is formed and added to the ring every time $P_{\text {cambium }}$ advances one integer. All vessel cells in the ring undergo daily enlargement following eq. (17.3), again with $Y_{P}=0.05 M P a$ and $Y_{t h r}=8{ }^{\circ} \mathrm{C}$. During cell later stages of enlargement, the cell wall becomes thicker and more rigid as a consequence of cell wall deposition. Consequently, $\phi_{\text {max }}=0.13$ for newly formed cells, but then variations in $\phi_{\text {max }}$ are modelled as (Cabon et al. 2020a):
\[
\frac{d \phi_{\max }}{\phi_{\max } \cdot d t}=s \cdot r_{c e l l}-h \cdot \frac{f_{m e t}\left(T_{K}\right)}{f_{m e t}(288.15)}
\]
where $s=1.8$ and $h=0.043 \cdot 1.8$ are a softening factor and a constant hardening rate, respectively, and the hardening rate is modulated by temperature effects. Cell radial diameter is initially $8.3 \mu m$ and tangential diameter is assumed constant and equal to $20 \mu \mathrm{~m}$, so that volume increases in ring cells can be translated to daily ring area increases, $\Delta A_{\text {ring }}$ (in $\mu m^{2}$ ).

Assuming that the maximum relative sapwood growth rate ( $R G R_{\text {cambium, } \max }$ or $R G R_{\text {sapwood, } \max }$ ) corresponds to a maximum rate of daily ring area increase, we have that the daily increase in sapwood area according to sink limitations, $\Delta S A_{\text {sink }}$, is defined as:
\[
\Delta S A_{\text {sink }}=\pi \cdot D B H \cdot R G R_{\text {cambium }, \text { max }} \cdot \frac{\Delta A_{\text {ring }}}{\Delta A_{\text {ring }, \text { max }}}
\]
for trees, and as:
\[
\Delta S A_{\text {sink }}=S A \cdot R G R_{\text {sapwood }, \max } \cdot \frac{\Delta A_{\text {ring }}}{\Delta A_{\text {ring }, \max }}
\]
for shrubs. Sapwood growth in trees is proportional to the cambium length (in cm), whereas in trees it is proportional to the current sapwood area (in cm 2 ). Hence, two different maximum relative growth rates are defined for trees $\left(R G R_{\text {cambium, } \max }\right)$ and shrubs $\left(R G R_{\text {sapwood, } \max }\right)$. In the previous equations, $\Delta A_{\text {ring, } \max }=$ $N_{c} \cdot 950 \mu m^{2} \cdot d a y^{-1}$, which was obtained by simulating a ring growth under optimum temperature ( $T_{\text {day }}=30$ $\left.{ }^{\circ} \mathrm{C}\right)$ and water ( $\Psi_{\text {symp,stem }}=-0.033 \mathrm{MPa}$ ) conditions and observing the steady-state ring area increase.

\subsection*{17.1.4 Fine root growth}

Fine root biomass increment is modelled for each soil layer separately, and is defined analogously to leaf area increment:
\[
\Delta B_{\text {fineroot }}=\min \left(\Delta B_{\text {fineroot }, \text { alloc }}, \Delta B_{\text {fineroot }, \text { source }}, \Delta B_{\text {fineroot }, \text { sink }}\right)
\]

First, $\Delta B_{\text {fineroot, alloc }}$ is the maximum fine root biomass increment allowed by the biomass target set by the allocation rule, $B_{\text {fineroot, target }}$ (see 17.3.2), in comparison with current biomass, $B_{\text {fineroot }}$ :
\[
\Delta B_{\text {fineroot }, \text { alloc }}=\max \left(B_{\text {fineroot }, \text { target }}-B_{\text {fineroot }}, 0\right)
\]

Second, $\Delta B_{\text {fineroot,source }}$ represents the biomass increment expected given the available storage carbon (starch):
\[
\Delta B_{\text {fineroot }, \text { source }}=\frac{S T_{\text {sapwood }} \cdot m_{\text {gluc }} \cdot V_{\text {storage }, \text { sapwood }}}{C C_{\text {fineroot }}}
\]
where $S T_{\text {sapwood }}$ is the current sapwood concentration of storage carbon, $V_{\text {storage,sapwood }}$ is the sapwood storage volume, $m_{\text {gluc }}$ is glucose molar mass and $C C_{\text {fineroot }}$ is the construction costs per fine root biomass unit.

Finally, $\Delta B_{\text {fineroot,sink }}$ represents the biomass increment expected by taking into account maximum tissue growth rate ( $R G R_{\text {fineroot, max }}$; in $g d r y \cdot g d r y^{-1} \cdot d a y^{-1}$ ) and the relative cell expansion rate given temperature $\left(T_{\text {day }}\right)$, water potential in the rhizosphere ( $\Psi_{\text {rhizos }, s}$ ) and the stem osmotic potential at full turgor( $\pi_{0, \text { stem }}$ ):
\[
\begin{aligned}
\Delta B_{\text {fineroot }, \text { sink }} & =B_{\text {fineroot }} \cdot R G R_{\text {fineroot }, \text { max }} \cdot \frac{r_{\text {cell }}\left(T_{\text {day }}, \Psi_{\text {rhizo }, s}, \pi_{0, \text { stem }}\right)}{r_{\text {cell, max }}} \\
& =B_{\text {fineroot }} \cdot R G R_{\text {fineroot, max }} \cdot \frac{\left(\Psi_{\text {rhizo, } s}-\pi_{0, \text { stem }}-Y_{P}\right)}{\left(2-Y_{P}\right)} \cdot \frac{f_{\text {met }}\left(T_{\text {day }}\right)}{f_{\text {met }}(30)}
\end{aligned}
\]
cell relative expansion rate is divided by the maximum relative cell expansion rate $r_{\text {cell,max }}=r_{\text {cell }}(30,0,-2)$ so that $R G R_{\text {fineroot, max }}$ is attained when sink conditions are optimal. Other parameters for eq. (17.3) are like for leaf growth, $\phi_{\max }=0.5, Y_{P}=0.05 M P a$ and $T_{\text {thr }}=5^{\circ} \mathrm{C}$.

\subsection*{17.2 Senescence}

\subsection*{17.2.1 Leaf senescence and cavitation effects on leaves and buds}

Leaf senescence can occur due to two processes: aging or dessication. Senescence due to advanced leaf age is assumed to be programmed (Ca+ accumulation?). In deciduous species all live leaf area turns to death leaf area when the phenology submodel indicates it (4.1.3). In evergreen species the proportion of leaf area that undergoes senescence each day is determined by the species-specific leaf duration parameter ( $L D$ ):
\[
p_{\text {aging }, \text { leaf }}=\frac{1}{365.25 \cdot L D}
\]

Senescence due to drought effects occurs as a consequence of stem cavitation. If the proportion of conductance loss has increased with respect to the preceeding day, the model determines the leaf area corresponding to the current level of cavitation:
\[
L A^{\text {cavitation }}=\left(1-P L C_{\text {stem }}\right) \cdot L A^{\text {target }}
\]
if $L A^{\text {cavitation }}<L A^{\phi}$ then the corresponding proportion $p_{\text {cavitation, leaf }}$ is estimated. The maximum of $p_{\text {aging,leaf }}$ and $p_{\text {cavitation,leaf }}$ is applied as a reduction of leaf area. If growth is simulated using the advanced water model, it also checks whether the relative water content in leaves becomes less than $50 \%$ (i.e. $\left.R W C_{\text {leaf }}<0.5\right)$ and, if this happens, the plant cohort is completely defoliated.

Xylem cavitation not only causes defoliation but also mortality of buds, which has the effect of slowing down post-drought leaf area recovery. The percentage of the crown with active buds ( $P C A B$ ) is reduced whenever the proportion of conductance loss has increased with respect to the preceeding day.
\[
P C A B=\min \left(P C A B, 100 \cdot\left(1-P L C_{\text {stem }}\right)\right)
\]

\subsection*{17.2.2 Sapwood senescence}

The daily rate of sapwood senescence is specified via the species-specific parameter $S R_{\text {sapwood }}$ or, when missing, via a control parameter. Prentice et al. (1993) assumed a constant annual rate of $4 \%$ for the
conversion from sapwood to heartwood. Similarly, Sitch et al. (2003) assumed a sapwood annual turnover rate of $5 \%$ for all biomes. In our model, the proportion of sapwood area that is transformed into heartwood daily is estimated using:
\[
p_{\text {aging }, \text { sapwood }}=\frac{S R_{\text {sapwood }}}{1+15 \cdot e^{-0.01 \cdot H}} \cdot \frac{\max \left(T_{\text {day }}-5,0\right)}{20}
\]
where $S R_{\text {sapwood }}$ is a species-specific parameter, $T_{\text {day }}$ is the average day temperature and 0.01 is a constant causing shorter plants to have slower senescence rates. It is important to mention that, while stem cavitation $P L C_{\text {stem }}$ reduces the amount of functional sapwood in with respect to hydraulics (and therefore transpiration and photosynthesis), it does not increase the rate of sapwood senescence. Hence, when xylem embolism occurs air bubbles are formed within vessels but surrounding parenchymatic cells (as well as the storage carbon they contain) are assumed unaffected.

\subsection*{17.2.3 Fine root senescence}

Aging is the only process leading to fine root senescence. The daily turnover proportion for fine roots ( $S R_{\text {fineroot }}$ ) is assumed to correspond to a temperature of $25^{\circ} \mathrm{C}$, is specified via species-specific parameters or the control parameters turnoverRates. Actual turnover proportion for a given soil layer ( $p_{\text {aging }, \text { fineroot }}$ ) decreases linearly with soil temperature down to zero at $5{ }^{\circ} \mathrm{C}$ :
\[
p_{\text {aging }, \text { fineroot }}=S R_{\text {fineroot }} \cdot \frac{\max \left(T_{\text {soil }, s}-5,0\right)}{20}
\]
where $T_{\text {soil,s }}$ is the temperature of soil layer $s$. When $S R_{\text {fineroot }}$ is missing from species parameter, a default control value for $S R_{\text {fineroot }}$ is taken, which produces an annual $50 \%$ turnover of fine roots.

\subsection*{17.3 Update of plant traits and allocation targets}

\subsection*{17.3.1 Plant traits}

Multiple anatomic and physiological parameters are updated every day after applying changes in the size of leaf, sapwood and fine root compartments, which creates a feedback to those hydraulic and physiological processes simulated in the water balance submodel (15.1.4). Hence, the growth model allows emulating plant acclimation to environmental cues, mediated by growth and senescence of plant tissues.

First leaf area index ( $L A I^{\phi}$ ) is updated from leaf area ( $L A^{\phi}$ ) inverting eq. (16.2). The Huber value ( $H_{v}$, the sapwood area to leaf area ratio; in $m^{2} \cdot m^{-2}$ ) is affected by changes in $L A^{\text {live }}=L A_{\text {target }}$ and sapwood area $S A$ :
\[
H_{v}=\frac{S A / 10000}{L A^{\text {live }}}
\]

Note that we specify $L A^{\text {live }}=L A_{\text {target }}$ and not $L A^{\phi}$ to avoid variations in Huber value due to leaf phenology. By definition, fine root biomass changes in each soil layer ( $B_{\text {fineroot }, s}$ ) lead to updates in the proportion of fine roots in each layer $\left(F R P_{s}\right)$ :
\[
F R P_{s}=\frac{B_{\text {fineroot }, s}}{\sum_{l} B_{\text {fineroot }, l}}
\]

When we simulate growth with the advanced water balance model other parameters are subject to acclimation. Stem maximum conductance per leaf area unit ( $k_{\text {stem,max }}$; in $\mathrm{mmol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1} \cdot M P a^{-1}$ ) is determined as a function of species-specific xylem conductivity ( $K_{x y l e m, \text { max }}$; in $\mathrm{kg} \cdot \mathrm{m}^{-1} \cdot \mathrm{~s}^{-1} \cdot M \mathrm{~Pa}^{-1}$ ), leaf area, sapwood area and tree height (Christoffersen et al. 2016):
\[
k_{\text {stem }, \max }=\frac{1000}{0.018} \cdot \frac{K_{x y l e m, \max } \cdot H_{v}}{(H / 100)} \cdot \chi_{\text {taper }}
\]
where $\chi_{\text {taper }}$ is a factor to account for taper of xylem conduit with height (Savage et al. 2010; Christoffersen et al. 2016), 0.018 is the molar weight of water (in $\mathrm{kg} \cdot \mathrm{mol}^{-1}$ ). Both an increase in $S A$ or a decrease in $L A^{\text {live }}$ (i.e. an increase in $H_{v}$ ) increase $k_{\text {stem, max }}$ and, hence, alleviate drought effects (i.e. a lower decrease in water potential across the stem for the same flow). In contrast, an increase in plant height will decrease stem conductance and increase drought stress. Changes in stem maximum conductance has cascade effects on root maximum conductance. First, coarse root minimum resistance is defined as a fixed proportion of whole-plant minimum resistance, so an increase in stem maximum conductance will increase whole-plant conductance and coarse root conductance, $k_{\text {root, max }}$.
Rhizosphere maximum conductance per leaf area unit in a given soil layer $s\left(k_{\text {rhizo,max, } s}\right.$; in $\mathrm{mmol} \cdot \mathrm{m}^{-2}$. $s^{-1} \cdot M P a^{-1}$ ) depends on fine root biomass in this layer ( $B_{\text {fineroot }, s}$ ) and on leaf area (i.e. $L A^{\text {live }}$ ). The equations regulating these relationships are modulated by several soil and species parameters, such as soil saturated hydraulic conductance, species-specific root length, root length density and density of fine roots.

The proportion of conductance loss due to cavitation ( $P L C_{\text {stem }}$ ) is reduced whenever sapwood area growth occurs:
\[
P L C_{\text {stem }, t+1}=\min \left(P L C_{\text {stem }, t}-\frac{\Delta S A}{S A}, 0\right)
\]

This allows a progressive increase in functional sapwood area. Similarly, if previous drought or fire impacts had reduced the percentage of the crown with active buds ( $P C A B$ ), this percentage is increased along with the formation of new sapwood area (until it achieves 100\%):
\[
P C A B_{t+1}=\min \left(P C A B_{t}+100 \cdot \frac{\Delta S A}{S A}, 100\right)
\]

\subsection*{17.3.2 Leaf area and fine root biomass targets}

Leaf area target ( $L A^{\text {live }}=L A_{\text {target }}$ ) is updated when phenological phase is bud formation. If the allocation strategy pursues a stable Huber value, the model tries to bring $H_{v}$ close to an initial value $H_{v, \text { target }}$, and the leaf area target is defined as:
\[
L A^{\text {live }}=L A_{\text {target }}=\frac{S A}{10000 \cdot H_{v, \text { target }}}
\]

Note that the specification of $L A_{\text {target }}$ will cause sapwood area increases to be followed by leaf area increases, as long as $H_{v}>H_{v, \text { target }}$. On the contrary, if $H_{v}<H_{v, \text { target }}$ then leaf area growth is inhibited and sapwood area growth will progressively increase $H_{v}$. Fine root biomass target is set using:
\[
B_{\text {fineroot, target }}=\frac{10^{4} \cdot L A_{\text {target }} \cdot R L R}{2.0 \cdot \sqrt{\frac{\pi \cdot S R L}{\rho_{\text {fineroot }}}}}
\]
where $R L R$ is the root area to leaf area ratio, $\rho_{\text {fineroot }}$ is fine root tissue density $\left(g d r y \cdot \mathrm{~cm}^{-3}\right)$ and $S R L$ ( $\mathrm{cm} \cdot g d r y^{-1}$ ) is the specific root length.
If the allocation strategy pursues a stable whole-plant conductance, the model tries to keep $k_{\text {plant }}$ close to an initial value $k_{\text {plant,target }}$, and here the leaf area target is defined as:
\[
L A_{\text {target }}=L A^{\text {live }} \cdot \frac{k_{\text {plant }, \text { max }}}{k_{\text {plant,target }}}
\]

In this strategy, increases in leaf area will be scheduled whenever the current whole-plant conductance is above target value (i.e. $k_{\text {plant,max }}>k_{\text {plant,target }}$ ). Analogously to the previous strategy, if $k_{\text {plant,max }}<k_{\text {plant,target }}$ then leaf area growth is inhibited and sapwood area growth will progressively increase $k_{\text {plant,max }}$.
While leaf area target depends on the allocation strategy, the target of fine root biomass for any given soil layer $s$ ( $B_{\text {fineroot, } \text { target }, s}$ ) directly follows changes in maximum whole-plant conductance. The average resistance in the rhizosphere is assumed to correspond to a fixed percentage of total soil-plant resistance. Hence, changes
in the conductance of leaves, stem or coarse roots will entail a variation in the absolute rhizosphere maximum conductance to be targeted ( $k_{\text {rhizo,max,target,s }}$ ), which in turn will determine $B_{\text {fineroot,target,s }}$. For example $k_{\text {rhizo,max,target,s }}$ will increase as a consequence of sapwood area growth. The model thus first estimate $k_{\text {rhizo,max,target,s }}$ for each layer $s$ and then translates $k_{\text {rhizo,max,target,s }}$ values to $B_{\text {fineroot,target,s }}$ using the relationships based on soil saturated hydraulic conductance, species-specific root length, root length density and density of fine roots mentioned above.

\subsection*{17.4 Plant mortality}

\subsection*{17.4.1 Self-thinning of small trees}

As explained in the mortality design section (15.1.5), the model implements a mortality process for young individual trees, meant to represent a self-thinning process occurring between trees of small diameter ( $D B H_{\text {tree }, \text { recr }}$, typically 1 cm ) and trees having a diameter corresponding to inclusion as individual in forest inventories ( $D B H_{\text {tree, ingrowth }}$, typically 7.5 cm ). The aim is to ensure that the tree density is progressively reduced until the tree cohort reaches $D B H_{\text {tree }, \text { ingrowth }}$, where the density should be $N_{\text {tree }, \text { ingrowth }}$. The following relationship between tree diameter and density is used:
\[
N=a_{s t} \cdot D B H^{b_{s t}}
\]
where $a_{s t}$ and $b_{s t}$ are parameters regulating the speed of the self-thinning process. Note that if we know the diameter and density of recruitment (i.e. $D B H_{\text {tree,recr }}$ and $N_{\text {tree,recr }}$ ), as well as $N_{\text {tree,ingrowth }}$, the density we want to ensure when the tree reaches $D B H_{\text {tree,ingrowth }}$, the self-thinning curve is completely determined. Hence, we can estimate $b_{s t}$ using:
\[
b_{s t}=\frac{\log \left(N_{\text {tree }, \text { ingrowth }} / N_{\text {tree }, \text { recr }}\right)}{\log \left(D B H_{\text {tree }, \text { ingrowth }} / D B H_{\text {tree }, \text { recr }}\right)}
\]
whereas $a_{s t}$ can be estimated using:
\[
a_{s t}=\frac{N_{\text {tree,ingrowth }}}{D B H_{\text {tree,ingrowth }}^{b_{s t}}}
\]

Once we know the parameters of the self-thinning curve, we can determine the maximum cohort density allowed for any cohort of diameter $D B H_{i}$. If the tree cohort has density $N_{i}$, the density decrease due to self-thinning mortality can be estimated using:
\[
N_{d e a d, i}=N_{i}-\min \left(N_{i}, a_{s t} \cdot D B H_{i}^{b_{s t}}\right)
\]

Note that the self-thinning process does not distinguish between tree resprouts or trees recruited from seeds.

\subsection*{17.4.2 Basal mortality rates}

Adult trees $(D B H>7.5 \mathrm{~cm})$ and shrubs die at a basal rate due to unspecific causes. For shrubs, the basal rate is always a species-specific constant ( $P_{\text {mort }, \text { base }}$ ). For trees, the basal rate can alternatively depend on the degree of (symmetric) competition, which is measured using the tree basal area $B A\left(m^{2} \cdot h a^{-1}\right)$ of the stand, through a simple survival logistic model:
\[
P_{\text {surv }, \text { base }}=\text { logit }^{-1}\left(\beta_{\text {surv }, 0}+\beta_{\text {surv }, 1} \cdot \sqrt{B A}\right)=\frac{\exp \left(\beta_{\text {surv }, 0}+\beta_{\text {surv }, 1} \cdot \sqrt{B A}\right)}{1+\exp \left(\beta_{\text {surv }, 0}+\beta_{\text {surv }, 1} \cdot \sqrt{B A}\right)}
\]
where $\beta_{\text {surv }, 0}$ and $\beta_{\text {surv }, 1}$ are species-specific coefficients obtained by fitting Generalized Linear Models on repeated forest inventory plot data. These models can be developed for arbitrary time steps (normally 5 or 10 years), but the basal mortality rate has to be finally expressed as a daily probability ( $P_{\text {base,daily }}$ ).

\subsection*{17.4.3 Mortality due to starvation}

The starvation stress indicator is $S T_{\text {relative }}^{\text {sapwood }}$, the starch concentration in sapwood relative to the equilibrium value:
\[
S T_{\text {relative }}^{\text {sapwood }}=\frac{S T_{\text {sapwood }}}{S T_{\text {equilibrium }}^{\text {sapwood }}}
\]
where $S T_{\text {sapwood }}$ ( mol gluc $\cdot l^{-1}$ ) is the current starch concentration in sapwood and $S T_{\text {equilibrium }}^{\text {sapwood }}$ is the equilibrium concentration (by default $S T_{\text {equilibrium }}^{\text {sapwood }}=0.35 \mathrm{molgluc} \cdot l^{-1}$. Assuming that a threshold of relative starch concentration ( $S T_{\text {relative }}^{\text {thresh }}$ ) corresponds to $50 \%$ annual mortality due to starvation, a logistic sigmoidal function is used to estimate the probability of annual starvation from a given $S T_{\text {relative }}^{\text {sapwood }}$ :
\[
P_{\text {starv }, \text { annual }}=1.0-\frac{\exp \left(40 \cdot\left(S T_{\text {relative }}^{\text {sapwood }}-S T_{\text {relative }}^{\text {thresh }}\right)\right)}{1.0+\exp \left(40 \cdot\left(S T_{\text {relative }}^{\text {sapwood }}-S T_{\text {relative }}^{\text {thresh }}\right)\right)}
\]

Since the model operates at the daily temporal resolution, $P_{\text {starv,annual }}$ is re-expressed as a daily probability using:
\[
P_{\text {starv }, \text { daily }}=1.0-\exp \left(\log \left(1.0-P_{\text {starv }, \text { annual }}\right) / 356\right)
\]

Assuming a relative threshold $S T_{\text {relative }}^{\text {thresh }}=0.4$, the figure below illustrates the shape of the sigmoidal function (top) and the corresponding daily probability function.

\subsection*{17.4.4 Mortality due to dessication}

As explained in the section 15.1.5, the dessication stress indicator ( $D_{\text {stem }}$ ) is the maximum of relative water content in the stem ( $R W C_{\text {stem }}$ ) and relative hydraulic conductance in the stem, i.e. the complement of $P L C_{\text {stem }}$
\[
D_{\text {stem }}=\left(R W C_{\text {stem }}, 1.0-P L C_{\text {stem }}\right) / 2.0
\]

Assuming that a threshold of relative water content ( $R W C_{\text {thresh }}$ ) corresponds to $50 \%$ annual mortality due to dessication, its probability is estimated analogously to starvation. First, a logistic sigmoidal function is used to estimate the probability of annual dessication from a given $D_{\text {stem }}$ value:
\[
P_{\text {dessic }, \text { annual }}=1.0-\frac{\exp \left(40 \cdot\left(D_{\text {stem }}-R W C_{\text {thresh }}\right)\right)}{1.0+\exp \left(40 \cdot\left(D_{\text {stem }}-R W C_{\text {thresh }}\right)\right)}
\]

Since the model operates at the daily temporal resolution, $P_{\text {dessic,annual }}$ is re-expressed as a daily probability using:
\[
P_{\text {dessic,daily }}=1.0-\exp \left(\log \left(1.0-P_{\text {dessic,annual }}\right) / 356\right)
\]

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-197.jpg?height=1237&width=1660&top_left_y=696&top_left_x=230}
\captionsetup{labelformat=empty}
\caption{Figure 17.1: Annual (top) and daily (bottom) probability of starvation as a function of sapwood starch concentration relative to its equilibrium value.}
\end{figure}

Assuming a relative threshold $R W C_{\text {thresh }}=0.4$, the figure below illustrates the shape of the sigmoidal func-
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-198.jpg?height=605&width=991&top_left_y=287&top_left_x=1132)
tion (top) and the corresponding daily probability function.
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-198.jpg?height=606&width=991&top_left_y=910&top_left_x=1132)

\section*{Uncertainty of stem pressure-volume parameters}

As explained in 15.1.5, using stem relative water content as indicator of dessication has the inconvenient that the parameters $\pi_{0, \text { stem }}$ and $\epsilon_{\text {stem }}$ specifying the pressure-volume curve are often not known, so that estimates have to come from wood density (see section A.3.13). The following figure shows the water potential corresponding to the dessication threshold for species with different wood density:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-199.jpg?height=1105&width=1608&top_left_y=243&top_left_x=241)

If the relationship between wood density and the stem pressure-volume curve (A.3.13) does not hold for a particular species the mortality rate may be under or overestimated. Here an example would be Cistus albidus, which has a low wood density but high dessication resistance. This is illustrated when we draw a scatter plot between the water potential corresponding to $60 \%$ stem PLC (i.e. $40 \%$ stem relative hydraulic conductance) against the water potential corresponding to $40 \%$ stem RWC:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-200.jpg?height=1112&width=1622&top_left_y=241&top_left_x=230)

As explained in 15.1.5, one can avoid the potential uncertainty in dessication mortality by defining the dessication stress indicator ( $D_{\text {stem }}$ ) as the maximum of relative water content in the stem ( $R W C_{\text {stem }}$ ) and relative hydraulic conductance in the stem. When we do so, the following curves are obtained for each of the previous species:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-201.jpg?height=703&width=1641&top_left_y=243&top_left_x=241)
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-201.jpg?height=703&width=1641&top_left_y=959&top_left_x=241)

It is obvious in the former figure that using $D_{\text {stem }}$ is indicator results in curves that are not continuous in all their range. However, we prefer this inconvenient to the potential overestimation of mortality due to an uncertainty in the pressure-volume curve parameters.

\subsection*{17.4.5 Overall mortality probability}

Every day the model determines for woody cohorts the overall probability of mortality ( $P_{\text {mort }, \text { daily }}$ ) as the maximum of the basal probability, starvation probability and dessication probability:
\[
P_{m o r t, d a i l y}=\max \left(P_{\text {base }, \text { daily }}, P_{\text {starv }, \text { daily }}, P_{\text {dessic }, \text { daily }}\right)
\]

At this point $P_{\text {mort }, \text { daily }}$ may be used deterministically (i.e., as a proportion of $N$ to kill) or stochastically (i.e. throwing a random number between 0 and 1 to determine the mortality event).

\subsection*{17.5 Fire severity}

Fire effects on plants follow, with some modifications, the model by Michaletz \& Johnson (2008). Buoyant plume theory is first used to estimate the vertical plume temperature $T_{\text {plume }}$ distribution that will drive heat transfer to the vascular cambium and vegetative organs. Heat transfer theory is then used to calculate the depth of vascular cambium necrosis and height of crown foliage and crown bud necrosis. Finally, these severity metrics are used to define the fate of the plant cohort, as described in section 15.1.6.

\subsection*{17.5.1 Plume temperature distribution}

The surface fire is assumed to occur at the time of the day where temperature is $T_{\text {max }}$ is the maximum daily temperature. For a line-source plume in a quiescent atmosphere (no wind), the plume temperature $T_{\text {plume }}$ at height $z$ (in m) can be estimated using (Michaletz \& Johnson 2008):
\[
T_{\text {plume }}(z)=\min \left[900, C_{\text {plume }} \cdot\left(\frac{1}{z}\right) \cdot\left(\frac{T_{\max }+273.15}{g}\right)^{1 / 3} \cdot\left(\frac{I_{B}}{c_{p, \text { air }} \cdot \rho_{\text {air }}}\right)^{2 / 3}+T_{\max }\right]
\]
where $C_{\text {plume }}=2.6$ is the plume proportionality constant, $g=9.8 \mathrm{~m} \cdot \mathrm{~s}^{-2}$ is the gravity constant, $I_{B}$ is Byram's surface fireline intensity (eq. (24.131); expressed in $k W \cdot \mathrm{~m}^{-1}$ ), $c_{p, a i r}=1.007 \mathrm{~J} \cdot \mathrm{~kg}^{-1} \cdot{ }^{\circ} \mathrm{C}^{-1}$ is the specific heat capacity of the air and $\rho_{\text {air }}$ is the air density at temperature $T_{\text {max }}$. Because this similarity analysis fails at heights comparable with the fireline width, $T_{\text {plume }}$ is constrained to a maximum flame temperature of $900^{\circ} \mathrm{C}$.

\subsection*{17.5.2 Foliage and crown bud necrosis}

The model predicting the distribution of plume temperature and the residence time of surface fires $t_{R}$ (eq. (24.132)), are used to determine the height of necrosis for plant organs, here foliage or crown buds, depending also on their heat capacitance. The estimate (foliage or bud) necrosis height $z_{n}(\mathrm{in} \mathrm{m})$ is given by (Michaletz \& Johnson 2008):
\[
z_{n}=C_{\text {plume }} \cdot\left(\frac{1}{T_{\text {crit }}-T_{\max }}\right) \cdot\left(\frac{T_{\max }+273.15}{g}\right)^{1 / 3} \cdot\left(\frac{I_{B}}{c_{p, \text { air }} \cdot \rho_{\text {air }}}\right)^{2 / 3}
\]
where $T_{\text {crit }}$ is the critical temperature of the plume required for organ necrosis, given a residence time $t_{R}$, which is estimated using:
\[
T_{c r i t}=\frac{T_{n}-\theta_{T} \cdot T_{\max }}{1-\theta_{T}}
\]

Here, $T_{n}$ is the temperature leading to necrosis, assumed to be $60^{\circ} \mathrm{C}$ and $\theta_{T}$ is defined as the excess temperature ratio, which depends on the organ thermal factor $(T F)$ and $t_{R}$ :
\[
\theta_{T}=\exp \left(-T F \cdot t_{R}\right)
\]

The thermal factor $T F$ is normally larger for leaves than buds, given their higher surface are to volume ratio, resulting in lower values of $T_{\text {crit }}$ and, therefore, higher values of necrosis height. In the case of leaves, the thermal factor ( $T F_{\text {leaves }}$ ) is estimated from specific leaf area, $S L A$, using (Michaletz \& Johnson 2006; Michaletz \& Johnson 2008):
\[
T F_{\text {leaves }}=S L A \cdot\left(h_{\text {leaves }} / c_{\text {leaves }}\right)
\]
where $h_{\text {leaves }}=130$ stands for the convection heat transfer coefficient of leaves and $c_{\text {leaves }}=2500$ is the specific heat capacity of leaves. Typical values would be $T F_{\text {leaves }}=0.208$ for $S L A=4$ and $T F_{\text {leaves }}=0.624$ for $S L A=12$. Currently, for crown buds a constant $T F_{\text {buds }}=0.130$ is assumed, on the basis of values given in Michaletz \& Johnson (2006), but we acknowledge that $T F_{\text {buds }}$ should be at least species-specific. Once
$z_{n}$ is defined, for either leaves or crown buds, depending on their $T F$ value, the vertical leaf distribution described in 2.4.6 is used to determine the proportion of crown leaves or crown buds with necrosis.

If the case of a crown fires, i.e. if surface fireline intensity is larger than van Wagner's critical intensity; eq. (24.160), then all crown foliage is burned. The same happens if torching occurs for the target plant cohort, which is determined by calculating a cohort-specific critical intensity. Crown bud necrosis is decided in those cases by calculating $T_{\text {crit }}$ using the crown fire residence time and comparing it to the flame temperature, i.e. $900^{\circ} \mathrm{C}$. Despite these calculations, in practice all crown buds will also normally suffer necrosis under a crown fire.

\subsection*{17.5.3 Cambium necrosis}

Vascular cambium necrosis is a one-dimensional transient conduction problem depending the thermal diffusivity of the bark, $\alpha_{\text {bark }}$, and the surface fire residence time $t_{R}$. Assuming that the bark surface temperature is equal to the plume temperature at $z=0.1$, i.e. $T_{\text {plume }}(0.1)$, the radial bole necrosis depth, $x_{n}$ (in m ), can be estimated using:
\[
x_{n}=2 \cdot\left(\alpha_{\text {bark }} \cdot t_{R}\right)^{1 / 2} \cdot \operatorname{erf}^{-1}\left(\frac{T_{n}-T_{\text {plume }}(0.1)}{T_{\text {max }}-T_{\text {plume }}(0.1)}\right)
\]
where $\operatorname{erf}^{-1}$ is the inverse error function. Bark diffusivity ( $\alpha_{\text {bark }}$ ) is estimated following the equations given in Michaletz \& Johnson (2008), which depend on bark's tissue density, moisture content (estimated assuming a fine dead fuel) and temperature. Cambium necrosis is determined by comparing $x_{n}$ (in m) with $x_{b a}$ (in $\mathrm{mm})$ the bark thickness of the plant, which in case of trees depends on DBH :
\[
x_{b a}=a_{b t} \cdot D B H^{b_{b t}}
\]
and in the case of shrubs $x_{b a}$ is assumed to be equal to a fixed species-specific value $b t_{s h}$.

\subsection*{17.6 Update of structural variables}

\subsection*{17.6.1 Tree diameter, height and crown ratio}

In the case of tree cohorts, the new sapwood area ( $\Delta S A$, in $\mathrm{cm}^{2}$ ) is translated to an increment in DBH ( $\triangle D B H$, in cm ) following:
\[
\Delta D B H=2 \cdot \sqrt{(D B H / 2)^{2}+(\Delta S A / \pi)}-D B H
\]

Furthermore, the model assumes that increments in height are linearly related to increments in diameter through a function $f_{H D}$ (Lindner et al. 1997):
\[
\Delta H=f_{H D} \cdot \Delta D B H
\]

Hence, $f_{H D}$ represents the height increment (in cm ) per each cm of diameter increment. It was customary in forest gap models to prevent height from being larger than a species-specific value $H_{\max }$, so that beyond some point trees only grew in size by increasing their diameter. Moreover, light conditions influence growth in height with trees living under the shade of others generally showing larger increases in height than trees living in open conditions. Hence, our formulation for $f_{H D}$ is (Lindner et al. 1997; Rasche et al. 2012):
\[
f_{H D}=\left[f_{H D, \min } \cdot L^{P A R}+f_{H D, \max } \cdot\left(1-L^{P A R}\right)\right] \cdot\left(1-\frac{H-137}{H_{\max }-137}\right)
\]
where $f_{H D, \min }$ would be the height-diameter ratio for a tree of 137 cm height growing in full light and $f_{H D, \max }$ would be the same ratio for a tree of the same height growing in the shadow, and $L^{P A R}$ is the proportion
of photosynthetically active radiation available at mid-crown height (4.2). This formulation seems slightly easier to calibrate than that presented in Rasche et al. (2012). $H_{\text {max }}$ could be dependent on environmental conditions, but we skip this here, because environmental conditions already affect growth rate and carbon balance.

After updating tree diameter ( $D B H$ ) and tree height ( $H$ ), the model updates tree crown ratio ( $C R$ ) by applying allometric relationships that take into account tree size and competition (see details in 21.2.3).

\subsection*{17.6.2 Shrub height and cover}

Since shrub structural variables are height and cover, shrub growth is done in a way somewhat different from trees. Shrubs are often multi-stemmed (some trees also are), so that increases in sapwood area are not easily related to diameter growth. Since leaf biomass is related to sapwood area, one may model shrub growth assuming an allometric relationship between phytovolume of individual shrub crowns and photosynthetic biomass. This strategy entails that shrubs may grow or shrink in size depending on their C balance, in the same way that tree crowns would become denser or sparser depending on their C balance. Hence, shrubs can be understood as crowns in the floor.

Starting from live leaf area ( $m^{2} \stackrel{\circ}{\mathrm{u}} m^{-2}$ ) we can calculate the foliar weight per shrub individual (in $k g \stackrel{\circ}{\mathrm{u}} i n d^{-1}$ ):
\[
W_{\text {leaves }}=\frac{L A I^{\text {live }}}{(N / 10000) \cdot S L A}
\]

An allometric relationship relating the biomass of leaves plus small branches and crown phytovolume ( $P V$; in $m^{3} \mathrm{u} i n d^{-1}$ ) can be drawn from fuel calculations:
\[
W_{\text {leaves }+ \text { branches }}=W_{\text {leaves }} \cdot r_{6.35}=a_{b s h} \cdot P V^{b_{b s h}}
\]
where $a_{b s h}$ and $b_{b s h}$ are allometric relationships and $r_{6.35}$ is a species-specific ratio relating the dry weight of leaves plus small branches to the dry weight of leaves. Inverting this relationship we obtain an expression of shrub crown phytovolume:
\[
P V=\left[\frac{W_{\text {leaves }} \cdot r_{6.35}}{a_{b s h}}\right]^{1 / b_{b s h}}
\]

Phytovolume is defined as the volume occupied by the shrub individual, i.e.:
\[
P V=\left(A_{s h} / 10000\right) \cdot(H / 100)
\]
where $A_{s h}$ is the area of a single shrub individual (in $\mathrm{cm}^{2}$ ). If we use the following quadratic relationship between $A_{s h}$ and $H$ :
\[
A_{s h}=a_{a s h} \cdot H^{b_{a s h}}
\]
we can calculate shrub height from phytovolume using:
\[
H=\left[\frac{10^{6} \cdot P V}{a_{a s h}}\right]^{1 /\left(1+b_{a s h}\right)}
\]

Finally, the new value for shrub cover (in percent) can be obtained from $H$ and $N$ (in ind $\cdot \mathrm{ha}^{-1}$ ):
\[
\text { Cover }=100 \cdot(N / 10000) \cdot\left(A_{s h} / 10000\right)=\frac{N \cdot a_{a s h} \cdot H^{2}}{10^{6}}
\]

Note that crown ratio for shrubs is assumed constant in the model. Like for trees, shrub height is limited to a maximum height $H_{\max }$. However, unlike trees, shrubs are not allowed to continue growing once this maximum size is attained.

\section*{Part V}

\section*{Forest dynamics modelling}

\section*{Chapter 18}

\section*{Forest dynamics model}

This chapter provides an overview of a forest dynamics model, which builds on the previous models and allows simulating the recruitment, growth, mortality and management of woody plant cohorts in a forest stand. The model was described in De Cáceres et al. (2023) and is run using function fordyn() for a set of years.

\subsection*{18.1 Design principles}

The design of the forest dynamics model is to a large degree inherited from the water balance and growth models it builds on. Readers should refer to former sections to learn the design of the basic water balance (see 3.1), advanced water/energy balance (see 7.2) or growth/mortality processes (see 15.1). Regeneration, from either seed germination and establishment or via resprouting, and forest management are explicitly simulated at the level of fordyn() and hence will be the focus of this chapter.

\subsection*{18.1.1 Recruitment from seeds}

Recruitment of saplings involves a number of processes (flowering and pollination, fruit/seed production, dispersal, storage, seed predation, germination, seedling establishment and survival until the sapling stage). All these processes have their own biotic and abiotic drivers (Price et al. 2001), so that modelling becomes a challenging task. Processes leading to sapling recruitment are frequently extremely simplified or their mechanisms ignored in many forest models (Price et al. 2001). The design of the forest dynamics model with respect to recruitment follows that of many gap models. Local seed production is considered in a binary way, where plants are considered fertile and able to produce viable seeds if they reach a given height (different for shrubs and trees). Alternatively, the user can specify a set of species whose seeds arrive to the target stand via simulation control parameters or dispersal processes (see chapter 20). A seed bank exists in the forest stand, where seed levels are relative (up to $100 \%$ ) and result from the interplay between seed rain and seed mortality. Actual recruitment from seeds depends on a set of regeneration thresholds are used to determine whether recruitment of new saplings (i.e. ingrowth into a given diameter class for trees or size for shrubs) is possible. Typically, regeneration thresholds concern environmental conditions, although some models also consider ungulate browsing (Wehrli et al. 2007). In our case we focus on three environmental drivers limiting the transition from seedlings to saplings:
1. Tolerance to low temperatures, indicated by the mean temperature of the coldest month.
2. Drought tolerance, indicated by the annual moisture index (annual precipitation divided by annual evapotranspiration).
3. Shade tolerance, indicated by the percentage of photosynthetic active radiation reaching the ground.

A target species can recruit on a given year if current conditions for all three environmental indicators are above the species tolerance thresholds. A constant probability of recruitment determines actual recruitment within these bioclimatic limits. Recruitment densities and plant size of recruited individuals are specified via species parameters. Trees recruited from seed are subject to self-thinning processes before attaining the diameter of ingrowth (see 17.4.1).

\subsection*{18.1.2 Resprouting}

Resprouting is a common feature of Mediterranean species. Most, if not all, Mediterranean broadleaved species are able to resprout from buds protected in branches, subterranean structures (e.g. burl, taproot, lateral roots) or in the root collar after a disturbance destroys the aerial part. Yet, some differences in the resprouting ability (i.e. survival) exist regarding the type of disturbance and the species affected.

In medfate, resprouting is assumed happen from buds at the stump/stool level after a given disturbance has led to aboveground plant die-back. Resprouting can occur as a response to different disturbances. For example, resprouting occurs after clipping (e.g. if management is applied), after a fire, or after cavitation has led to dessication of above-ground plant organs.

Regarding disturbance type, differences in survivorship through resprouting mostly depends on the intensity of the disturbance experienced, with an increasing occurrence of mortality after disturbances in the following order: browsing, cutting, drought and fire (Espelta et al. 1999). Fire is the disturbance that causes greatest mortality, probably because it may physically destroy part of the bud bank due to lethal temperatures or directly charring it (Pausas et al. 2016). Moreover, resprouting vigor also depends on the size of the plant (Moreira et al. 2012). According to different literature sources, the number of resprouts initially produced is approximately 2 per 1 cm 2 of stump area (Retana et al. 1992; García-Jiménez et al. 2017). Hence, in medfate the final density of resprouts depends on the disturbance that caused resprouting (via survivorship) and on the diameter of the parent plant, but in all cases the resprouts inherit the root system of their parent.

Like saplings originated from seeds, resprouts are subject to self-thinning processes before attaining the diameter of ingrowth (see 17.4.1).

\subsection*{18.1.3 Forest management}

Forest management is an optional process in fordyn() simulations. Furthermore, management actions need to be defined in an external function to be supplied by the user. This design was chosen because there are multiple potential management strategies, and different traditions are followed in different countries. To work properly within fordyn() simulations, the supplied management function needs to accept a forest object as input, as well as a list of management parameters, and it has to return the reduction in tree density, the reduction in shrub cover and the management parameters to be applied in subsequent calls.

Although the former design allows users to tailor management functions to their simulation needs, the package includes defaultManagementFunction() to facilitate the simulation of these process in many situations, and which is briefly described here. The function implements two different management models:
- Irregular management: An uneven-aged stand is managed using thinning operations each time a threshold value of a chosen stand-level metric (such as basal area or Hart-Becking index) is trespassed. Thinning operations can focus on trees of specific diameter classes.
- Regular management: An even-aged (monospecific) stand is managed in cycles where thinning (preparatory) cuts are followed by final (regeneration) cuts. Thinning operations are similar as those of irregular management. One or several final cuts can be scheduled, the first starting whenever mean diameter surpasses a chosen threshold, and the following after a chosen number of years. Optionally, tree planting (of a chosen species) can be scheduled to occur after the last final cut.

The former models apply cuts on tree cohorts irrespective of their species. The default management function applies shrub clearing each time there is an operation on trees, resulting in removal of any shrub cover above a given maximum value.

\subsection*{18.2 State variables}

The main state variables of the forest dynamic model are those conforming the structure and composition of the forest stand, i.e. the set of woody cohorts (either trees or shrubs) and their attributes (height, density, DBH , cover, etc.). Additionally, the seed species identity and relative abundance in the seed bank are also state variables of the model. Since the model performs calls to the growth() model, many other state variables are defined for intra-annual simulations (see 15.4). When including forest management action, additional state variables may be defined as management parameters.

\subsection*{18.3 Process scheduling}

The fordyn() model divides the period to be simulated in years, which is the top-level time step of simulations. Given an input forest object, the function first initializes the input for function growth(). For each year to be simulated the model the performs the following steps:
1. Calls function growth() to simulate daily water/carbon balance, growth and mortality processes (subdaily processes may also be involved in transpirationMode $=$ "Sperry" or transpirationMode $=$ "Sureau"). See section 15.4 for details of growth scheduling.
2. If a management function is supplied, calls this function and apply the resulting reductions in tree density and shrub cover.
3. If required, simulates seed production, seed bank mortality, seed rain, recruitment from seeds and/or resprouting. In a spatial context, seed rain will include seeds dispersed from other forest stands 20.
4. Removes tree (or shrub) cohorts whose remaining density (resp. cover) is lower than a specified threshold.
5. Merges surviving cohorts with recruitment in the forest object and prepares the input of function growth() for the next annual time step.
6. Store current status of the forest object and update output tables/summaries.

\subsection*{18.4 Inputs and outputs}

An important difference between fordyn() and the previous simulation functions is that it does not require a specific input object, as in spwb()or growth() functions. In other words, soil, vegetation, meteorology and control inputs are directly introduced as parameters to the function call to fordyn().

\subsection*{18.4.1 Soil, vegetation and meteorology}

\section*{Soil}

Soil input requirements are the same as for the former models and were fully described in section 2.3.

\section*{Vegetation}

Unlike the former models, vegetation input for fordyn are objects of the class forest, which were described in section 2.4.4.

\section*{Metereological input}

The minimum weather variables required to run the model are min/max temperatures ( $T_{\min }$ and $T_{\max }$ ), min/max relative humidity ( $R H_{\text {min }}$ and $R H_{\text {max }}$ ), precipitation ( $P$ ) and solar radiation ( $R a d$ ). Wind speed ( $u$ ) is also needed, but the user may use missing values if not available (a default value will be used in this case). Wind speed is assumed to have been measured at a specific height above the canopy (by default at 2 $\mathrm{m})$. Atmospheric $C O_{2}$ concentration ( $C_{a t m}$ ) may also be specified, but if missing a default constant value is assumed, which is taken from the control parameters. Definitions and units of these variables were given in section 2.5.

\subsection*{18.4.2 Vegetation functional parameters}

The forest dynamics model requires many functional parameters to be specified for plant cohorts. Some of them depend on whether the basic or advanced water balance is adopted, whereas others are inherited from the growth model. Here we report functional parameters needed in addition to those necessary for the growth model (see 15.5.2).

All of them concern the simulation of recruitment and are specified in the species parameter table (i.e. SpParams).

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $H_{\text {seed }}$ & cm & SeedProducition\#ingingth for seed production \\
\hline SM & $m g$ & SeedMasseed dry mass \\
\hline $S L$ & yr & SeedLongereiltrank average longevity \\
\hline Disp ${ }_{\text {dist }}$ & $m$ & Dispersallistian perameter for dispersal kernel \\
\hline Disp ${ }_{\text {shape }}$ & & Dispersallllymparameter for dispersal kernel \\
\hline $P_{\text {recr }}$ & [0-1] & ProbRecrProbability of recruitment from seeds within the bioclimatic limits imposed by temperature, moisture and light thresholds \\
\hline $T C M_{\text {recr }}$ & ${ }^{\circ} \mathrm{C}$ & MinTempRediamum average temperature (Celsius) of the coldest month for successful recruitment from seeds \\
\hline $M I_{\text {recr }}$ & & MinMoisthdieikerm value of the moisture index (annual precipitation over annual PET) for successful recruitment from seeds \\
\hline $F P A R_{\text {recr }}$ & \% & MinFPARRAdearimum percentage of PAR at the ground level for successful recruitment from seeds \\
\hline $N_{\text {tree,recr }}$ & ind $\cdot h a^{-1}$ & RecrTredDemsifty of tree recruits from seeds. \\
\hline $N_{\text {tree,ingrowth }}$ & ind $\cdot h a^{-1}$ & IngrowthTemesiderofittyes reaching ingrowth DBH. \\
\hline $D B H_{\text {tree,recr }}$ & cm & RecrTredDBII for tree recruits from seeds or resprouting (e.g. 1 cm ). \\
\hline $D B H_{\text {tree,ingrow }}$ \&m & & IngrowtHTheed BH DBH for trees (e.g. 7.5 cm ). \\
\hline $H_{\text {tree,recr }}$ & cm & RecrTredfleightfor tree recruits from seeds or resprouting \\
\hline Cover $_{\text {shrub,recr }}$ \% & & RecrShrubeavètment cover for shrubs \\
\hline $H_{\text {shrub,recr }}$ & cm & RecrShrußderightment height for shrubs \\
\hline $Z 50_{\text {recr }}$ & mm & RecrZ50 Soil depth corresponding to 50\% of fine roots for recruitment \\
\hline $Z 95_{\text {recr }}$ & mm & RecrZ95 Soil depth corresponding to 95\% of fine roots for recruitment \\
\hline Resp ${ }_{\text {fire }}$ & & RespFireNumber of resprouts per stem after fire disturbance \\
\hline Resp ${ }_{\text {dist }}$ & & RespDistNumber of resprouts per stem after undefined disturbance (typically desiccation) \\
\hline Resp ${ }_{\text {clip }}$ & & RespClipNumber of resprouts per stem after clipping \\
\hline
\end{tabular}

\subsection*{18.4.3 Control parameters}

Control parameters modulate the overall behavior of fordyn simulations, which extend the parameters used for growth simulations (see section 15.5.3). First, there are parameters that regulate the application of seed production, seed bank dynamics, recruitment from seeds, resprouting and the removal of cohorts with few individuals:
- applySeedBankDynamics [= TRUE]: Boolean flag to indicate that seed bank dynamics (seed production, seed bank mortality and seed rain) need to be simulated.
- applyRecruitment [= TRUE]: Boolean flag to indicate that recruitment from seeds is allowed.
- applyResprouting [= TRUE]: Boolean flag to indicate that resprouting is allowed.
- recruitmentMode [= "stochastic"]: String describing how recruitment from seeds is applied. Current accepted values are "deterministic" or "stochastic".
- removeEmptyCohorts [= FALSE]: Boolean flag to indicate the removal of cohorts whose density is too low.
- minimumTreeCohortDensity $[=1]$ : Threshold of tree density resulting in cohort removal.
- minimumShrubCohortCover $[=0.01]$ : Threshold of shrub cover resulting in cohort removal.
- dynamicallyMergeCohorts [= TRUE]: Boolean flag to indicate that cohorts should be merged when possible. This option speeds up calculations but results in a loss of cohort identity and reinitialization of many state variables.

Next, a few parameters control the production/arrival of seeds:
- seedRain [= NULL]: Vector of species names whose seed rain is to be added to seed bank, regardless of local seed production.
- seedProductionTreeHeight [= 300]: Default minimum tree height for producing seeds (when species parameter SeedProductionHeight is missing).
- seedProductionShrubHeight [= 30]: Default minimum shrub height for producing seeds (when species parameter SeedProductionHeight is missing).

Then we have default parameters determining whether recruitment occurs:
- probRecr [ $=0.05$ ]: Default annual probability of recruitment (when species parameter ProbRecr is missing).
- minTempRecr $[=0]$ : Default threshold of minimum average temperature of the coldest month necessary for recruiting (when species parameter MinTempRecr is missing).
- minMoistureRecr [= 0.3]: Default threshold of minimum moisture index (annual precipitation over annual ETP) necessary for recruiting (when species parameter MinMoistureRecr is missing).
- minFPARRecr [= 10]: Default threshold of minimum fraction of PAR (in \%) reaching the ground necessary for recruiting (when species parameter MinFPARRecr is missing).

Finally, there are a set of parameters specifying default values for recruited cohort attributes:
- recrTreeDBH [= 1]: Default DBH (cm) for recruited trees (when species parameter RecrTreeDBH is missing).
- recrTreeDensity [= 100]: Default density (ind $\cdot$ ha-1) for recruited trees (when species parameter RecrTreeDensity is missing).
- recrTreeHeight [= 100]: Default height (cm) for recruited trees (when species parameter RecrTreeHeight is missing).
- recrShrubCover [= 1]: Default cover (\%) for recruited shrubs (when species parameter RecrShrubCover is missing).
- recrShrubHeight [= 100]: Default height (cm) for recruited shrubs (when species parameter RecrShrubHeight is missing).
- recrTreeZ50 [= 100]: Default value for Z50 (mm) in recruited trees (when species parameter RecrZ50 is missing).
- recrShrubZ50 [= 50]: Default value for Z50 (mm) in recruited shrubs (when species parameter RecrZ50 is missing).
- recrTreeZ95 [= 1000]: Default value for Z95 (mm) in recruited trees (when species parameter RecrZ50 is missing).
- recrShrubZ50 [= 500]: Default value for Z95 (mm) in recruited shrubs (when species parameter RecrZ50 is missing).

\subsection*{18.4.4 Model output}

\begin{tabular}{|l|l|}
\hline Element & Description \\
\hline StandSummary & A data frame with stand-level summaries (leaf area index, tree basal area, tree density, shrub cover, etc.) at the beginning of the simulation and after each simulated year. \\
\hline SpeciesSummar & A data frame with species-level summaries (leaf area index, tree basal area, tree density, shrub cover, etc.) at the beginning of the simulation and after each simulated year. \\
\hline CohortSummary & A data frame with cohort-level summaries (leaf area index, tree basal area, tree density, shrub cover, etc.) at the beginning of the simulation and after each simulated year. \\
\hline TreeTable & A data frame with tree-cohort data (species, density, diameter, height, etc.) at the beginning of the simulation (if any) and after each simulated year. \\
\hline DeadTreeTable & A data frame with dead tree-cohort data (species, density, diameter, height, etc.) at the beginning of the simulation and after each simulated year. \\
\hline CutTreeTable & A data frame with cut tree-cohort data (species, density, diameter, height, etc.) per each simulated year. \\
\hline ShrubTable & A data frame with shrub-cohort data (species, density, cover, height, etc.) at the beginning of the simulation and after each simulated year. \\
\hline DeadShrubTabl & A data frame with dead shrub-cohort data (species, density, cover, height, etc.) at the beginning of the simulation (if any) and after each simulated year. \\
\hline & CutShrubTable A data frame with cut shrub-cohort data (species, density, cover, height, etc.) per each simulated year. \\
\hline \multicolumn{2}{|l|}{ForestStructurdslist with the forest object of the stand at the beginning of the simulation and after each simulated year.} \\
\hline ManagementArgsIf management is considered, a list of management arguments to be used in another call to fordyn(). & GrowthResults A list with the results of calling function growth (i.e., see 15.5.4) for each simulated year. \\
\hline & ![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-212.jpg?height=17\&width=1635\&top_left_y=1389\&top_left_x=243) \\
\hline
\end{tabular}

\subsection*{18.5 Process details}

\subsection*{18.5.1 Seed production and seed bank dynamics}

The model considers mortality of seeds in the seed bank before adding new seeds. Annual seed bank mortality is simulated for each species using an exponential decay function, driven by the species-specific seed longevity ( $S L$ ):
\[
\text { Seeds }_{t+1}=\text { Seeds }_{t} \cdot \exp (-1 / S L)
\]

To determine seed production, the model determines the seed rain in the stand by determining which cohorts have total plant heights above maturity thresholds for trees and shrubs. This is done, for each cohort, by comparing its height with the species-specific parameter seed production height ( $H_{\text {seed }}$ ). Missing values of $H_{\text {seed }}$ are given values from control variables seedProductionTreeHeight and seedProductionShrubHeight for trees and shrubs, respectively. In addition to locally produced seeds, the user can use control parameter seedRain to specify a list of species names whose seeds arrive to the stand. Despite the origin, in non-spatial simulations the seed bank relative amount of species with seed rain is set to $100 \%$, assuming that there is enough seed production to allow normal recruitment. However, when simulations are conducted in a spatial context, the species identity and relative amount of seeds is determined via dispersal sub-model (see chapter 20).

\subsection*{18.5.2 Recruitment from seeds}

Actual sapling recruitment (i.e. recruitment of small trees, typically 1 cm diameter) depends on environmental conditions in the stand. Specifically, the model calculates, for the year that ended, the mean temperature of the coldest month ( $T C M$ ), the moisture index ( $M I$ ) and the fraction of photosynthetic active radiation reaching the ground, given the current structure ( $F P A R$ ). These values are compared to species specific parameter thresholds $T C M_{\text {recr }}, M I_{\text {recr }}$ and $F P A R_{\text {recr }}$, respectively. More specifically, a given species $j$ can recruit only if $T C M>T C M_{r e c r, j}, M I>M I_{r e c r, j}$ and $F P A R>F P A R_{r e c r, j}$. These filters do not ensure recruitment, as it is assumed that multiple processes can further determine the death of recruits. A probability of recruitment $P_{\text {recr }}$ is used to represent these additional processes. When simulation of recruitment is stochastic, a given species will recruit if (in addition to the bioclimatic limits) a Bernouilli draw falls below $P_{\text {recr }}$ and, if so, the initial density or cover will be fixed. If recruitment is deterministic, then the probability of recruitment is used to multiply the recruitment density or cover.

Tree recruitment density, diameter and height are determined by parameters $N_{\text {tree,recr }}, D B H_{\text {tree,recr }}$ and $H_{\text {tree,recr }}$, respectively; whereas cover and height of shrub recruitment is determined by parameters Cover $_{\text {recr }}$ and $H_{\text {shrub,recr }}$, respectively. Density/cover of recruits is reduced depending on the relative amount of seeds in the seed bank (i.e. maximum density or cover will occur if seed bank levels are $100 \%$ ). If stochastic simulation of recruitment is requested, then density or cover values are considered mean values of a Poisson distribution. Note that density of tree recruits will decrease during the years after recruitment due to a self-thinning process, until $D B H$ reaches $D B H_{\text {tree,ingrowth }}$ where $N$ will be $N_{\text {tree,ingrowth }}$, as explained in 17.4.1.

\subsection*{18.5.3 Resprouting}

Currently, resprouting only occurs in the model if plant cohorts have been cut, burned or they died of desiccation (future model versions will include resprouting after fire impacts). In other words, resprouting does not occur for baseline mortality, self-thinning of recruits or due to starvation.

\section*{Resprouting survivorship}

The model first determines resprouting survivorship, which depends on the disturbance type and, in the case of fire, on species identity. Unfortunately, we lack information on the mortality caused in resprouting by cutting or drought for the vast majority of species except for holm oak (Quercus ilex). Thus, we suggest applying tentatively to all species the mortality values obtained in different studies for this species: $2.5 \%$ after browsing (Espelta et al. 2006), 4\% after cutting (Retana et al. 1992), 5\% after drought (Lloret et al. 2004). Larger differences among species have been reported for fire (Espelta et al. 2012). This pattern may be linked to inter-specific differences in the size of the bud bank, the degree of bud protection or the amount of stored resources in belowground organs (burl, taproot). Accordingly, default values for survivorship are $R e s p_{\text {clip }}=0.96$ (for cutting) and $R e s p_{\text {dist }}=0.95$ (for dessication), whereas no default value is given for Resp fire. Naturally, the number of surviving trees (stumps) is given by the number of trees affected by the disturbance multiplied by the survivorship rate:
\[
N_{\text {surv }}=N_{\text {mort }, \text { dist }} \cdot \operatorname{Resp} p_{\text {dist }}
\]
for a generic disturbance, but the same equation would apply for cutting, dessication or fire.

\section*{Resprouting vigor}

For those individuals that survive the disturbance event and are able to resprout, the number of resprouts present in a given moment is a matter of the stump area and age. According to different literature sources, the number of resprouts initially produced is approximately 1.82 per 1 cm 2 of stump area, but owing to the intra- and inter-individual competition (self-thinning), the number of resprouts will decrease with time following an exponential equation (Retana et al. 1999. Espelta et al. 1999, 2013):
\[
N_{\text {resp }}=N_{\text {surv }} \cdot \pi \cdot(D B H / 2)^{2} \cdot 1.82 \cdot 10^{-0.053 \cdot x}
\]
where $D B H$ is diameter at breast height of the parent tree cohort, in $\mathrm{cm}, x=5$ is time in years, $N_{\text {resp }}$ is the number of resprouts, $N_{\text {surv }}$ is the number of parent trees that survived.

\section*{Initial characteristics and self-thinning}

Tree resprouts have all a starting diameter $D B H_{\text {tree,recr }}$ and a height $H_{\text {tree,recr }}$, but the root system is the same of the parent tree cohort. Analogously to recruitment from seeds, the initial density of tree resprout will decrease during the years after the initial resprouting due to a self-thinning process, until $D B H$ reaches $D B H_{\text {tree,ingrowth }}$ where $N$ will be $N_{\text {tree,ingrowth }}$, as explained in 17.4.1.

\section*{Resprouting in shrubs}

In the case of shrub species, the same operations are done, but on cover values instead of density values. Shrub height of resprouts is assumed to be $H_{\text {shrub,recr }}$.

\section*{Part VI}

\section*{Landscape/regional modelling}

\section*{Chapter 19}

\section*{Watershed hydrology}

This chapter describes the distributed watershed water balance sub-model implemented in functions spwb_land(), growth_land() and fordyn_land() of package medfateland (Fig. 1.3).

\subsection*{19.1 Design principles}

Watersheds are described in raster (i.e. gridded) mode, each cell representing a patch of vegetation (or another land cover) in a catchment. Land cover types are:
a. wildland: forests, shrublands or grasslands.
b. agriculture: agricultural lands.
c. rock: rock outcrops.
d. artificial: urban areas.
e. water: water bodies.

Watershed water balance simulations extend the simulation of soil water balance to the landscape scale. Hence, the design of most vertical hydrological processes is the same as those of forest water balance. However, additional water compartments and processes are represented in watershed water balance simulations. Each cell in the watershed may include the following: a snow-pack compartment, one or several soil layers (including a rocky layer down to several meters depth), and a groundwater compartment assumed to be beyond the reach of plant roots. Similar to other models such as TETIS (Francés et al. 2007), three lateral flows are considered between adjacent cells:
(i) Overland surface flows from upper elevation cells.
(ii) Lateral saturated soil flows (i.e. interflow) between adjacent cells.
(iii) Lateral groundwater flow (i.e. baseflow) between adjacent cells.

Overland surface flows are modeled following T-HYDRO Ostendorf \& Reynolds (1993). Subsurface flows, including both soil saturated flow and groundwater flow, are modeled following the kinematic wave approach of DSHVM Wigmosta et al. (1994).

Split-parameter parametrization following Francés et al. (2007).

\subsection*{19.2 State variables}

Distributed simulation of rainfall-runoff processes implies that state variables are defined for each cell of the watershed. For this kind of simulations, state variables describing the water content of different compartments are the most important. In the case of wildland and agriculture cells these are:
- $W_{s}$, the proportion of soil moisture in relation to field capacity for each soil layer $s$ in the cell.
- $S_{\text {snow }}$ the snow water equivalent (mm) of the snow pack storage over the cell surface.
- $S_{\text {aquifer }}$ the water content (mm) in the cell's aquifer beyond the reach of plant roots.

Additional cell state variables in wildland cells concern the water status (or other state variables) of plant cohorts in the cell, and they were described in chapters 3 and 7 . In the case of cells of other land cover types (i.e. rock, artificial or water) soils are not defined, and neither are soil state variables.

\subsection*{19.3 Water balance}

In distributed watershed simulations water balance can be defined both at the cell level and at the watershed level.

\subsection*{19.3.1 Cell level water balance}

At the cell level, daily variations in water content can occur in the snowpack, soil or groundwater compartments:
1. Variations in snowpack water equivalent content follows eq. (3.2).
2. Variations in soil water content ( $\Delta V_{\text {soil }}$ ) need to account for additional flows and are summarized as (compare to (3.5)):
\[
\Delta V_{\text {soil }}=\operatorname{Pr}+S m+R o+A d-I n-R u-D d-E s-T r+\Delta S_{\text {sat }}
\]
where $P r$ is precipitation as rainfall, $S m$ is snowmelt, $R o$ is surface runon water entering the cell from neighboring cells at higher elevation, $A d$ is aquifer discharge, $I n$ is rainfall interception loss, $R u$ is cell surface runoff, $D d$ is deep drainage towards the aquifer, $E s$ is soil evaporation, $T r$ is plant transpiration and $\Delta S_{\text {sat }}$ is the variation in soil water content derived from the balance between saturated soil lateral inputs and outputs.
3. Variations in the aquifer water content of a cell are summarized by:
\[
\Delta S_{\text {aquifer }}=D d-A d-\Delta S_{\text {base }}
\]
where $\Delta S_{\text {base }}$ is the variation in water content of the aquifer derived from the balance between groundwater lateral inputs and outputs.

\subsection*{19.3.2 Watershed water balance}

At the watershed level, separate water balances can again be defined for the average water content of snow pack, soil or groundwater compartments. These result from averaging water balances across cells. Additionally, a water balance is defined regarding the overall water content in the watershed.
1. Changes in the average snow pack water equivalent over cells is the result of balancing precipitation as snow ( $P s$ ) and snow melt ( $S m$ ), both flows averaged over cells:
\[
\Delta \hat{S}_{\text {snow }}=\hat{P} s-\hat{S m}
\]
where $\hat{P} s$ and $\hat{S m}$ are the average snow fall and snow melt over cells.
2. Changes in the average soil moisture ( $\Delta \hat{V}_{\text {soil }}$ ) are the result of pooling soil inputs and outputs over cells, which yields:
\[
\Delta \hat{V}_{\text {soil }}=\hat{P} r+\hat{S m}+\hat{A} d+\hat{R} o-\hat{R} u-\hat{I n}-\hat{D} d-\hat{E} s-\hat{T} r
\]
where $\hat{P r}, \hat{A d}, \hat{R o}, \hat{R u}, \hat{I n}, \hat{D d}, \hat{E s}$ and $\hat{T r}$ are the average (over cells) of precipitation (including rain and snow), aquifer discharge, lateral surface water input (runon), runoff, rainfall interception loss, deep drainage, soil evaporation and plant transpiration, respectively. Lateral saturated soil flows are not included as they cancel out at the watershed level.
3. Changes in the average of cell aquifer water content ( $\Delta \hat{S}_{\text {aquifer }}$ ) are the result of balancing deep drainage ( $D d$ ) from soils and aquifer discharge ( $A d$ ):
\[
\Delta \hat{S}_{\text {aquifer }}=\hat{D} d-\hat{A} d
\]
4. If we integrate the three water compartments, water balance at the watershed level is given by:
\[
\Delta S_{\text {watershed }}=\hat{P r}-\hat{I n}-\hat{E s}-\hat{T r}-\hat{E x}
\]
where $\Delta S_{\text {watershed }}=\Delta \hat{S}_{\text {snow }}+\Delta \hat{V}_{\text {soil }}+\Delta \hat{S}_{\text {aquifer }}$ is the change in water content in the watershed and $\hat{E x}$ is the water exported as runoff from cells without neighbors (i.e. catchment outlet cells).

\subsection*{19.4 Process scheduling}

For every day to be simulated, the model performs the following steps:
1. Calculation of soil and groundwater hydraulic heads for each cell (see 19.6.1).
2. Calculation of soil and groundwater lateral flows between adjacent cells, according to hydraulic gradients (see 19.6.1).
3. Apply changes in cell soil moisture content due to soil lateral flows (i.e. determine $\Delta S_{s u b}$ for each cell), including the possibility of a return flow to the surface if the soil becomes saturated (i.e. saturation excess flow).
4. Apply changes in cell aquifer water content, including the possibility of discharge from the aquifer to the soil and a saturation excess flow (eq. (19.2)).
5. Determine remaining cell flows by processing watershed cells in order of decreasing elevation (i.e. cells at higher elevation are processed before cells at lower elevation). For each cell to be processed:
a. For wildland or agriculture cells, determine snow-pack dynamics, rainfall interception loss, infiltration and runoff, transpiration, soil evaporation processes as described in 3.4, while including saturation excess flow as well as potential runon (Ro) from upslope cells as additional water inputs. For rock and artificial cells, snow pack dynamics is still processed in these cells, but all runon or rainfall input becomes runoff to be passed downhill, and when the level of the aquifer reaches the surface any discharge also becomes runoff. In the case of water cells, snow pack dynamics is also processed, but evaporation from the water surface is not modelled. All liquid water inputs are poured onto the aquifer water content, and runoff can still occur when the aquifer reaches the surface.
b. Distribute surface runoff among cells downhill (19.6.2). If a cell does not have downhill neighbors (i.e outlet cell) its runoff becomes water exported from the watershed.

\subsection*{19.5 Inputs and outputs}

\subsection*{19.5.1 Gridded inputs}

Hydrological distributed models demand large amounts of data, information and parameters in order to accurately represent the spatial variability of the main hydrological processes and weather inputs. As mentioned in design principles, watersheds are described in raster (i.e. gridded) mode, each cell representing
a patch of vegetation (or another land cover) in a catchment. Rasters do not need to be (should not be) complete, since the model is intended to be used on individual catchments with defined boundaries.

Given a set of grid cells representing the watershed at a given spatial resolution, input data for spwb_land() and growth_land() should be specified using sf objects. These were described in section 2.1.2.

\subsection*{19.5.2 Watershed meteorology input}

Simulation of watershed hydrology requires specifying weather variables for all cells and the simulation period considered. Functions spwb_land() and growth_land() allow weather to be specified in three ways:
- If a single data frame of daily weather is provided, the model assumes that all watershed cells experience the same weather.
- A different data frame of daily weather may be provided for each cell, using column meteo of the sf object (see 2.1.2).
- If an interpolator object of class stars is provided, the model will call function interpolate_data() for every day to be simulated (see meteoland package documentation).

\subsection*{19.5.3 Watershed hydraulic correction parameters}

Distributed hydrological models suffer from the need to specify many parameters. Frances et al. (2007) demonstrated that by using a proper parameter structure, it is possible to obtain an excellent automatic calibration of a distributed conceptual model while maintaining the spatial variability of parameters. In particular, they showed how to define effective model parameters for those quantities normally estimated at the point scale, so that model parameters and estimates usually suffer from being uncommensurable. Effective model parameters can in this situation be defined as a correction function of the corresponding hydrological characteristic. If the correction function takes into account the model and input errors, the temporal and spatial scale effects and also the hydrological characteristics estimation error, it is reasonable to assume the correction function for each parameter will be common to all cells within the watershed. Frances et al. (2007) suggest using a correction factor for each hydraulic parameter, in a strategy called split-parameter. From the calibration point of view, a very important consequence of the split-parameter approach is that the number of variables to be adjusted is reduced dramatically.

Our model follows Frances et al. (2007) in that correction factors are defined for three hydraulic parameters with spatial variation across the watershed:
- $K_{\text {drain }}$ vertical saturated soil conductivity for deep drainage.
- $K_{\text {sat }}$ horizontal saturated soil conductivity for soil lateral flows.
- $K_{\text {base }}$ bedrock conductivity for groundwater lateral flows.

The effective model parameter for each of these is defined for the spatial (depending on the grid resolution) and temporal (daily) scales of the model. Each effective parameter is split into the input value, assumed to have been estimated at a given spatial and temporal scale, and the corresponding correction factor, i.e. $R_{\text {drain }}, R_{\text {sat }}$ and $R_{\text {base }}$. The values for these correction factors should be the target of calibration procedures, assuming that the spatial heterogeneity of effective parameters is adequately covered by the soil and bedrock spatial inputs.

\subsection*{19.5.4 Model outputs}

Distributed hydrological models can produce very detailed spatial and temporal outputs, hence consuming lots of memory resources. While the model runs at a daily scale, functions spwb_land() and growth_land()
can be asked to retain spatial outputs and summaries at coarser temporal scales (i.e. weekly, monthly, etc.). The output of functions spwb_land() and growth_land() is an S3 list with the following data elements:

\begin{tabular}{|l|l|}
\hline Element & Description \\
\hline sf & An object of class sf containing the geometries, final state and temporal summary for each of the landscape cells (values in mm/day, mm/week, mm/month or mm/year depending on summary frequency). \\
\hline \multicolumn{2}{|l|}{watershed_baladnata frame with spatially-averaged (over watershed cells) components of the water balance corresponding to each temporal summary (values in mm/day, mm/week, mm/month or $\mathrm{mm} /$ year depending on summary frequency).} \\
\hline & watershed_soilSpatliahyeaveraged (over watershed cells) components of the water balance, including only cells that have defined soils (i.e. wildland and agriculture cells), corresponding to each temporal summary (values in mm/day, mm/week, mm/month or mm/year depending on summary frequency). \\
\hline & daily_runoff A matrix with daily runoff (in m3/day) at each of the outlet cells of the landscape. \\
\hline
\end{tabular}

\subsection*{19.6 Process details}

\subsection*{19.6.1 Subsurface flows}

Both soil saturated lateral flow and groundwater lateral flow follow the saturated subsurface flow model of Wigmosta et al. (1994), which is based on a kinematic wave approximation. Each grid cell can exchange water with its eight adjacent neighbors. Local hydraulic gradients are approximated by local ground surface slopes, so that each cell will generally receive water from its upslope neighbors and discharge to its downslope neighbors. The rate of saturated flow from cell $i$ to its downgradient neighbors is equal to (Wigmosta \& Lettenmaier 1999):
\[
\begin{aligned}
q_{i j} & =-T_{i} \cdot \tan \left(\beta_{i, j}\right) \cdot w_{j} \quad \beta_{i, j}<0 \\
q_{i j} & =0 \beta_{i, j} \geq 0
\end{aligned}
\]
where $q_{i, k}$ is the flow rate from cell $i$ in the direction towards neighbor $j, T_{i}$ is the transmissivity at cell $i$, $\beta_{i, j}$ is the water table slope in the direction of $j$. The transmissivity function for soil saturated lateral flow in cell $i\left(T_{s a t, i}\right)$ is specified using:
\[
T_{s a t, i}=\frac{R_{s a t} \cdot K_{s a t, i} \cdot Z_{s o i l, i}}{n_{s a t}} \cdot\left(1-Z_{w t, i} / Z_{s o i l, i}\right)^{n_{s a t}}
\]
where $K_{\text {sat }, i}$ is the saturated conductivity of the first (top) soil layer in cell $i, Z_{\text {soil, } i}$ is the soil depth at cell $i, Z_{w t, i}$ is the water table depth at cell $i$ and $n_{s a t}$ is a power exponent. $R_{s a t}$ is a correction factor (a watershed parameter) for the fact that $K_{s a t, i}$ is assessed from soil samples, whereas the parameter in the model is defined at the scale of a grid cell (Francés et al. 2007). The transmissivity function for groundwater lateral flow in cell $i\left(T_{\text {base }, i}\right)$ is analogous:
\[
T_{\text {base }, i}=\frac{R_{\text {base }} \cdot K_{\text {base }, i} \cdot Z_{\text {bedrock }, i}}{n_{\text {base }}} \cdot\left(1-Z_{\text {aquifer }, i} / Z_{\text {bedrock }, i}\right)^{n_{\text {base }}}
\]
where $K_{\text {base }, i}$ is the bedrock conductivity at cell $i, Z_{\text {bedrock }, i}$ is the depth of the unaltered bedrock, $Z_{\text {aquifer }, i}$ is the depth of the aquifer water table and $n_{\text {base }}$ is again a power exponent.

Saturated lateral flow inputs and outputs for a given cell $i$ are balanced to determine increase or decrease in soil moisture:
\[
\Delta S_{s a t, i}=\sum_{j} q_{s a t, j i}-\sum_{j} q_{s a t, i j}
\]
and the same occurs for groundwater lateral flows and aquifer balance:
\[
\Delta S_{\text {base }, i}=\sum_{j} q_{\text {base }, j i}-\sum_{j} q_{\text {base }, i j}
\]

\subsection*{19.6.2 Overland flows}

To simulate surface runoff routing from one cell to the other, the approach of Ostendorf \& Reynolds (1993) is used, as in SIERRA (Mouillot et al. 2001). Overland water lateral transport for a given day occurs instantaneously (i.e. no velocities are calculated) and depends on topography only. The model determines cell neighbors following the queen rule (up to eight neighbors per cell). The proportion of surface water runoff of cell $i$ that will be added to the infiltration input (runon) of a neighboring cell $j$ is Ostendorf \& Reynolds (1993):
\[
q_{i j}=\frac{\Delta z_{i j} / L_{i j}}{\sum_{j} \Delta z_{i j} / L_{i j}}
\]
if $\Delta z_{i j}=z_{i}-z_{j}>0$, that is, if the difference in elevation between the two cells is positive (i.e. if $z_{j}<z_{i}$ ). Otherwise there is no overland transport from $i$ to $j$, i.e. $q_{i j}=0 . L_{i j}$ indicates the distance between cell $i$ and $j$ (which depends on cell size and on whether the neighboring cell $j$ is diagonal to cell $i$ ). The summation of the denominator is done only for neighbors at lower elevation, so that $\sum_{i} q_{i j}=1$. The table of $q_{i j}$ values is calculated when initializing distributed watershed objects.

Every day, cells are processed in order from higher to lower elevation. After the daily water balance of a given cell $i$, water runoff $R u_{i}$ is divided among the neighboring cells at lower elevation. The runon of a neighbor $j, R o_{j}$ is updated as:
\[
R o_{j}=R o_{j}+R u_{i} \cdot q_{i j}
\]

Note that a given cell $j$ can receive overland flow from more than one neighbor.

\subsection*{19.6.3 Watershed runoff}

A special situation arises when processing cells that do not have downhill neighbors defined (i.e. where $q_{i j}=0$ for all $j$ ), either because they are in flat surfaces or at the watershed boundary. In both cases, these cells should correspond to water bodies or streams connecting to the catchment outlet. Hence, these cells are called outlet cells in the model, and the runoff they generate becomes watershed runoff.

\section*{Chapter 20}

\section*{Seed dispersal}

This chapter describes the seed dispersal sub-model implemented in functions fordyn_scenario() and fordyn_land() of package medfateland (Fig. 1.3).

\subsection*{20.1 Design principles}

Given their sessile lifestyle, dispersal is the only process through which plants can spread in a landscape. Different parts of plants can be dispersed (seeds, fruits, branches or even the entire plant), but here it is assumed that seeds are the dispersed elements. Mathematically, dispersal can be addressed via process-based models (e.g. Nathan et al. (2001)). However, it is more commonly addressed via empirical dispersal kernels, which describe the statistical distribution of dispersal distances in a population (Nathan et al. 2012). More specifically, the dispersal kernel is a probability density function describing the distribution of post-dispersal locations relative to a source point. While many different equations can be used and compared to describe dispersal (Nathan et al. 2012), here we focus on the exponential power kernel proposed by Clark et al. (1998), which has shown a good performance compared to other kernels (Bullock et al. 2017) and has been used for other dynamic vegetation models (Snell 2014). The kernel is isotropic, meaning that is equal in all directions. Therefore, one can consider dispersal either from source or sink locations.

When implementing a dispersal kernel in a dynamic forest simulation model, an important issue to overcome is the fact that forest stands in the target landscape are often separated by distances that are larger (e.g. 500 $\mathrm{m}, 1 \mathrm{~km}$ or even more) than the average area that they represent (normally forest plots have a radius between 10 and 25 m ). This entails that there is a uncertainty in the model regarding the presence of seed sources from forest stands at distances between the two scales. In other words, the model does not know whether there are forest patches that can act as seed sources, between a given target forest stand and its nearest neighbors (Fig. 20.1). Ignoring this fact can lead to underestimating colonization. We address this issue by considering that seed sources from unavailable forest stands can be estimated from the set of stands that are represented in the data set, using weights inverse to their distance to the location of the unavailable stand. This is illustrated in Fig. 20.1 below with the area with unavailable stands in grey and distances represented using red and black arrows:

\subsection*{20.2 Process scheduling}

Seed dispersal is considered once a year. Process scheduling in the dispersal sub-model is rather straightforward:
1. Mortality of seeds in first performed for all stands (see 18.5.1).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-224.jpg?height=1435&width=833&top_left_y=533&top_left_x=645}
\captionsetup{labelformat=empty}
\caption{Figure 20.1: Example of sparse forest stand distribution and how to deal with dispersal in this situation. The target stand where seed rain is to be determined is represented using a red dot. Blue dots are the remaining forest stands. The upper figure shows the spatial distribution of stands, whereas the figure below represents the number of stands per distance classes. In both cases, grey is used to identify an area with unavailable data.}
\end{figure}
2. Seed production is simulated in all stands with woody vegetation (see 18.5.1).
3. For each target forest stand, seed dispersal (including local seed rain) is simulated, leading to a replenishment of its seed bank.

\subsection*{20.3 Process details}

The exponential power kernel depends on species-specific parameters Disp ${ }_{\text {dist }}$ and Disp ${ }_{\text {shape }}$ and is calculated for a given distance $r$ using (Clark et al. 1998):
\[
f(r)=\frac{1}{N} \cdot \exp \left[-\left(\frac{r}{D i s p_{d i s t}}\right)^{\text {Disp } p_{\text {shape }}}\right]
\]
where $N$ is the normalizing constant:
\[
N=\frac{2 \cdot \pi \cdot \text { Disp }_{\text {dist }}^{2} \cdot \Gamma\left(2 / \text { Disp }_{\text {shape }}\right)}{\text { Disp }_{\text {shape }}}
\]
and $\Gamma()$ is the Gamma function.
Let $i$ be the stand corresponding to seed sink location (e.g. the red dot in Fig. 20.1). We begin by computing the geographic distances between $i$ and all the other stands using geographic coordinates $x$ and $y$ (assuming these are in meters).
\[
d(i, j)=\sqrt{\left(x_{i}-x_{j}\right)^{2}+\left(y_{i}-y_{j}\right)^{2}}
\]

Let us now consider a given distance value $r>0$ from $i$ (e.g. the grey band in Fig. 20.1). We define the probability of choosing a given stand $j$ for a location at this distance from $i$ as follows:
\[
p_{i}(r, j)=\frac{1}{M} \cdot \frac{1}{|r-d(i, j)|}
\]
where $M$ is an appropriate normalizing factor so that:
\[
\sum_{j=1}^{n} p_{i}(r, j)=1
\]

Note that this last equation assumes that the density of spatial points is even across space. If not, the sum should be lower than one.

Given the above definitions and assuming that seed bank of a given species should be refilled to $100 \%$ if and only if all plots are seed sources for that species, the percentage of seeds of species $s$ reaching the target location $i$, i.e. $P_{s, i}$, is estimated using:
\[
P_{s, i}=100 \cdot 2 \pi \cdot \int_{r>0}^{r_{\max }} r \cdot f(r) \cdot\left(\sum_{j=1}^{n} I(s, j) \cdot p_{i}(r, j)\right) \cdot \delta r
\]
where $r_{\text {max }}$ is the maximum allowed dispersal distance and $I(s, j) \in 0,1$ is an indicator variable of the availability of seed sources of species $s$ in stand $j$.

\section*{Part VII}

\section*{Static modules}

\section*{Chapter 21}

\section*{Allometric models}

The purpose of this chapter is to describe how certain plant structural attributes are estimated in medfate using allometric relationships. These static models are used to initialize vegetation input parameters from forest plot data before simulations (in functions forest2spwbInput() and forest2growthInput()), to update vegetation structure during growth simulations or to calculate foliar biomass for fuel assessments.

\subsection*{21.1 Input data}

\subsection*{21.1.1 Forest plot data}

As explained in section 2.4, medfate has been specially designed to work with forest inventory plots with data in form of plant cohorts. The tree/shrub cohort attributes required to apply allometric models are the following:

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & Units & R & Description & trees & shrubs \\
\hline $S P_{i}$ & & \multicolumn{2}{|l|}{SpeciesSpecies identity} & Y & Y \\
\hline $H_{i}$ & cm & Height & Average tree or shrub height & Y & Y \\
\hline $N_{i}$ & $i n d \mathrm{u} h a^{-1}$ & N & Density of tree individuals & Y & N \\
\hline $D B H_{i}$ & cm & DBH & Tree diameter at breast height & Y & N \\
\hline Cover $_{i}$ & \% & Cover & Shrub percent cover & N & Y \\
\hline
\end{tabular}

Most allometric functions require data in form of a forest object (see section 2.4.4).

\subsection*{21.1.2 Species parameters}

The following table shows the allometric coefficients needed for the calculations detailed in this chapter.

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $a_{f b t}, b_{f b t}, c_{f b t}$ & & a_fbt, b_fbt, c_fbt & Coefficients to calculate foliar biomass of an individual tree \\
\hline $a_{a s h}, b_{a s h}$ & & a_ash, b_ash & Coefficients relating the square of shrub height with shrub area \\
\hline $a_{b s h}, b_{b s h}$ & & a_bsh, b_bsh & Coefficients relating crown volume with dry weight of shrub individuals \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R param & Description \\
\hline $a_{c r}, b_{1 c r}, b_{2 c r}, b_{3 c r}$, & & a_cr, b_1cr, b_2cr, & Coefficients to calculate crown ratio of trees \\
\hline cr & [0-1] & cr & Ratio between crown length and total height for shrubs \\
\hline $r_{6.35}$ & & r635 & Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm \\
\hline $S L A$ & $m^{2} \cdot k g^{-1}$ & SLA & Specific leaf area \\
\hline
\end{tabular}

\subsection*{21.2 Allometric relationships}

\subsection*{21.2.1 Leaf biomass}

Leaf biomass calculations are done differently for trees and shrub cohorts. They are calculated from forest objects using function plant_foliarBiomass().

\section*{Tree cohorts}

Foliar biomass for a single tree of cohort $i\left(F B_{\text {tree }, i}\right.$; in kg$)$ is calculated using:
\[
F B_{\text {tree }, i}=a_{f b t} \cdot D B H_{i}^{b_{f b t}} \cdot e^{c_{f b t} \cdot B A L_{i}} \cdot e^{-0.0001 \cdot N_{i}}
\]
where $D B H_{i}$ is the diameter of the tree (in $c m$ ), $B A L_{i}$ is the cummulative basal area ( $m^{2} \cdot h a^{-1}$ ) of trees having an equal or larger diameter (including the target tree), $N_{i}$ is the density of the cohort, and $a_{f b t}$, $b_{f b t}$ and $c_{f b t}$ are species-specific regression coefficients. The first two determine the relationship between tree diameter and its foliar biomass, whereas the third one leads to reductions of foliar biomass because of over-shading and self-shading. Factor $e^{-0.001 \cdot N_{i}}$ reduces foliar biomass for cohorts with very high density (such as very dense regeneration after a fire). The foliar biomass of the whole tree cohort ( $F B_{i}$; in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) is obtained multiplying tree foliar biomass by tree density ( $N_{i}$; in ind. $\cdot h a^{-1}$ ):
\[
F B_{i}=F B_{\text {tree }, i} \cdot\left(N_{i} / 10000\right)
\]

\section*{Shrub cohorts}

To calculate the leaf biomass of a shrub cohort, we first determine $A_{s h, i}$, the area (in $\mathrm{cm}^{2}$ ) occupied by one average individual of height $H_{i}$ (in cm ), using the relationship:
\[
A_{s h, i}=a_{a s h} \cdot H_{i}^{b_{a s h}}
\]
where $a_{\text {ash }}$ and $b_{\text {ash }}$ are species-specific parameters. The model then estimates the dry weight of leaves and branches up to 6.35 mm in diameter ( $B_{s h, i}$, in kg ) of this average individual (i.e. fine fuel biomass), using an allometric relationship with shrub crown phytovolume assuming a cylinder (in $\mathrm{cm}^{3}$ ):
\[
B_{s h, i}=a_{b s h} \cdot\left(A_{s h, i} \cdot H_{i}\right)^{b_{b s h}} \cdot e^{-0.235 \cdot L A I_{\text {trees }}^{\text {live }}}
\]
where $a_{b s h}$ and $b_{b s h}$ are species-specific parameters. Here $L A I_{\text {trees }}^{\text {live }}\left(m^{2} \cdot m^{-2}\right)$ is the sum of leaf area index values of tree cohorts, which induces a reduction of $B_{s h, i}$ similar to the one described for tree foliar biomass by $B A L_{i}$. This reduction is important for biomass and leaf area estimation of shrubs in forests, since it has been observed that light availability affects the growth, architecture and bulk density of the understory (Pimont et al. 2018).
Shrub density ( $N_{i}$; in ind. $\cdot m^{-2}$ ) can be grossly estimated from percent cover ( $C_{i}$, in percent) and $A_{s h, i}$ (in $\mathrm{cm}^{-2}$ ):
\[
N_{i}=\frac{C_{i} / 100}{A_{s h, i} / 10000}
\]

The fine fuel biomass of a shrub cohort ( $W_{i}$, in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) is simply the product of $B_{s h, i}$ ( kg of dry weight) and $N_{i}$ :
\[
W_{i}=B_{s h, i} \cdot N_{i}
\]

Foliar biomass (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) can be obtained using the species-specific ratio $r_{6.35, i}$ :
\[
F B_{i}=W_{i} / r_{6.35, i}
\]

If not known, $r_{6.35, i}$ can be set to a default value of 2 (equivalent to $50 \%$ of weight corresponding to leaves).

\section*{Herbaceous layer}

Foliar biomass of the herbaceous layer (which is equal to its fine fuel loading) is estimated from herbaceous cover (Cover ${ }_{\text {herb }}$; in \%) and height ( $H_{\text {herb }}$; in cm ) assuming a constant bulk density coefficient:
\[
F B_{\text {herb }}=0.014 \cdot \text { Cover }_{\text {herb }} \cdot\left(H_{\text {herb }} / 100.0\right) \cdot e^{-0.235 \cdot L A I_{\text {woody }}^{\text {live }}}
\]
where the factor $e^{-0.235 \cdot L A I_{\text {woody }}^{\text {live }}}$ is analogous to that of shrubs (eq. (21.4)), but using the overall leaf area index of woody cohorts as driving variable.

\subsection*{21.2.2 Leaf area and LAI}

Leaf area index ( $L A I$ in $\mathrm{m}^{2} \cdot \mathrm{~m}^{-2}$ ) of a given cohort $i$ can be calculated from its foliar biomass (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) by using a specific leaf area coefficient ( $S L A$, in $m^{2} \cdot k g^{-1}$ ) that in medfate is species-specific:
\[
L A I_{i}=F B_{i} \cdot S L A
\]

The leaf area ( $L A$ in $m^{2}$ ) of an individual of the cohort is found by dividing it by plant density ( $N_{i}$, in ind. $\cdot h a^{-1}$ ) and multiplying by $10000 \mathrm{~m}^{2} \cdot h a^{-1}$ :
\[
L A_{i}=10000 \cdot L A I_{i} / N_{i}
\]

LAI values of woody cohorts are calculated from forest objects using function plant_LAI().
Leaf area index of the herbaceous layer ( $L A I_{\text {herb }}$ ) is estimated from $F B_{\text {herb }}$ by applying a $S L A=9$ value, is limited to $L A I_{\text {herb }}=2 \mathrm{~m}^{2} \cdot \mathrm{~m}^{-2}$, and can be calculated from forest objects using function herb_LAI().

\subsection*{21.2.3 Crown vertical dimensions}

Crown base height, i.e. the height were the first living branch of trees or shrubs occurs, is an important parameter to know the vertical distribution of leaves (see section 2.4.6). Crown base height of a plant cohort $i$ (i.e., $H_{\text {crown }, i}$, in cm ) is related to the total height of the cohort ( $H_{i}$, in cm ) and its crown ratio ( $C R_{i}$ ), which is the ratio between crown length and plant height:
\[
H_{\text {crown }, i}=\left(1-C R_{i}\right) \cdot H_{i}
\]

In the case of shrubs the crown ratio $C R_{i}$ is normally an input (species-specific) parameter (cr). In the case of trees, the crown ratio is modelled as a function of tree size and stand competition, following a modification of the logistic equation of Hasenauer \& Monserud (1996) :
\[
C R_{i}=\frac{1}{1+e^{-\left(a_{c r}+b_{1 c r} \cdot H D_{i}+b_{2 c r} \cdot\left(H_{i} / 100\right)+b_{3 c r} \cdot D B H_{i}^{2}+c_{1 c r} \cdot B A L_{i}+c_{2 c r} \cdot \ln \left(C C F_{i}\right)\right)}}
\]
where $H D_{i}=H_{i} /\left(100 \cdot D B H_{i}\right)$ is the height to diameter ratio (in $\mathrm{m} \cdot \mathrm{cm}^{-1}$ ), $H_{i}$ is the tree height, $D B H_{i}$ is the diameter, $C C F_{i}$ is the crown competition factor and $a_{c r}, b_{1 c r}, b_{2 c r}, b_{3 c r}, c_{1 c r}$ and $c_{2 c r}$ are species-specific parameters. The crown competition factor is in turn calculated using (Krajicek et al. 1961):
\[
C C F_{i}=\sum_{i} N_{i} \cdot \pi \cdot\left(C W_{i} / 2\right)^{2} / 100
\]
where $N_{i}$ is the tree density and $C W_{i}$ is the crown width (in $m$ ) assuming an open-grown tree, estimated from an allometric relationship with tree diameter:
\[
C W_{i}=a_{c w} \cdot D B H_{i}^{b_{c w}}
\]
where again $a_{c w}$ and $b_{c w}$ are species-specific parameters.
Crown ratios can be calculated from forest objects using function plant_crownRatio(). Similar calculations are performed to estimate crown length and crown base height, with functions plant_crownLength() and plant_crownBaseHeight(), respectively.

\section*{Chapter 22}

\section*{Post-simulation procedures}
22.1 Water use efficiency

\section*{Chapter 23}

\section*{Wind extinction}

In this chapter we describe a few wind extinction models that are implemented in medfate. Wind extinction is rellevant: (a) to determine convective heat exchanges between the soil and the canopy; (b) to estimate wind speed and energy balance at the leaf level for different plant cohorts; and (c) for fire behaviour calculations.

\subsection*{23.1 Wind speed at the top of the canopy}

Input wind speed ( $u$ ) is assumed to represent the speed of wind at 6 m ( 20 feet) above the canopy. Following Albini \& Baughman (1979) the wind speed (in $m \dot{\mathrm{u}} s^{-1}$ ) at the top of the canopy is:
\[
u_{t o p}=\frac{(1.01857 \cdot u) \cdot 0.4265092 \cdot H_{c a n o p y}}{\log \left(20+1.181102 \cdot H_{t o p}\right)}
\]
where $H_{\text {top }}$ is the canopy top height in $m$.

\subsection*{23.2 Wind extinction profile}

The wind extinction profile, i.e the wind speed at any height $z$ in $m$, can be calculated following Massman (1987):
\[
\begin{aligned}
\beta_{\text {stand }} & =\frac{4.0 \cdot 0.2 \cdot L A I_{\text {stand }}^{\text {phi }}}{0.16 \cdot 1.5^{2}} \\
u(z) & =u_{\text {top }} \cdot \sqrt{\frac{\cosh \left(\beta_{\text {stand }} \cdot z / H_{\text {top }}\right)}{\cosh \left(\beta_{\text {stand }}\right)}}
\end{aligned}
\]

\section*{Chapter 24}

\section*{Fuel characteristics and fire behaviour}

\subsection*{24.1 Overview}

Functions fuel_FCCS() and fire_FCCS() allow calculating potential fire behaviour for forest inventory plots. Formulation of fuel characteristics and fire behaviour is an adaptation of the Fuel Characteristics Classification System [FCCS; Prichard et al. (2013)]. In FCCS, fuelbed is divided into six strata, including canopy, shrub, herbaceous vegetation, dead woody materials, leaf litter and ground fuels. All except ground fuels are considered here. The intensity of burning depends on several factors, including topography, wind conditions, fuel structure and its moisture content, which is determined from antecedent and current meteorological conditions. A modification of the Rothermel's (1972) model is used to calculate the intensity of surface fire reaction (in $\mathrm{kW} / \mathrm{m}^{2}$ ) and the rate of fire spread (in $\mathrm{m} / \mathrm{min}$ ) of surface fires assuming a steady-state fire. Both quantities are dependent on fuel characteristics, windspeed and direction, and topographic slope and aspect.

Fuel and fire behavior calculations provide the following results:
1) Fuel characteristics by stratum.
2) Surface fire behavior (i.e. reaction intensity. rate of spread, fireline intensity and flame length);
3) Crown fire behavior.
4) Fire potential ratings of surface fire behavior and crown fire behavior.

The following figure provide an overview of the steps to calculate surface/crown fire behavior and fire potentials from fuel characteristics.

\subsection*{24.2 Input data}

\subsection*{24.2.1 Forest plot data}

As explained in section 2.4, medfate has been specially designed to work with forest inventory plots. The tree/shrub cohort attributes required to apply allometric models are same as for chapter 21:

\begin{tabular}{llllll}
\hline Symbol & Units & R & Description & trees & shrubs \\
\hline$S P_{i}$ & & SpeciesSpecies identity & Y & Y \\
$H_{i}$ & $c m$ & Height Average tree or shrub height & Y & Y \\
$N_{i}$ & indů $h a^{-1}$ & $\mathrm{~N} \quad$ Density of tree individuals & Y & N
\end{tabular}

\begin{tabular}{llllll}
\hline Symbol & Units & R & Description & trees & shrubs \\
\hline$D B H_{i}$ & $c m$ & DBH & Tree diameter at breast height & Y & N \\
Cover $_{i}$ & $\%$ & Cover & Shrub percent cover & N & Y \\
\hline
\end{tabular}

Cohorts are not distinguished for the herbaceous stratum, and the variables needed are:

\begin{tabular}{llll}
\hline Symbol & Units & R & Description \\
\hline$C_{h e}$ & $\%$ & herbCover & Herbaceous percent cover \\
$H_{h e}$ & $c m$ & herbHeight & Mean herb height \\
\hline
\end{tabular}

Finally, the model also requires the percent cover of trees in the canopy ( $C_{c a}$ ). This is easily available from forest inventory data, but could also be derived from the description of tree cohorts.

Fire behaviour functions require data in form of a forest object (see section 2.4.4).

\subsection*{24.2.2 Species parameters}

The following functional parameters are required for each species:

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $L_{\text {shape }}$ & Categorical & LeafShap屯eaf shape: "Broad", "Needle", "Linear", "Scale", "Spines" or "Succulent" \\
\hline $L_{\text {size }}$ & Categorical & LeafSize Leaf size: "Small" ( $<225 \mathrm{~mm}$ ), "Medium" ( $>225 \mathrm{~mm} \&<$ $2025 \mathrm{~mm})$ or "Large" (> 2025 mm ) \\
\hline $r_{6.35}$ & & r635 Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm \\
\hline $\rho_{\text {wood }}$ & $g \cdot c m^{-3}$ & WoodDensitegnsity of wood tissue \\
\hline $\rho_{\text {leaf }}$ & $g \cdot \mathrm{~cm}^{-3}$ & LeafDensitgnsity of leaf tissue \\
\hline $\sigma_{i}$ & $m^{2} \cdot m^{-3}$ & SAV Surface-area-to-volume ratio of the small fuel (1h) fraction \\
\hline $h$ & $k J \cdot k g^{-1}$ & HeatCont $\not$ High fuel heat content. \\
\hline LD & years & LeafDuratiearf duration (in years) \\
\hline LI & \% & PercentLPgridantage of lignin in leaves \\
\hline
\end{tabular}

Leaf shape and size categories are used to determine leaf litter fuel types.

\subsection*{24.2.3 Other inputs}

Other inputs may be given by expert opinion or they may be calculated from another model. Specifically, for each plant cohort (and for any day of application) the fire behaviour model requires:
- $P_{\text {dead }}$ : Proportion of the plant that is dead.
- FMC: Fuel moisture content (in percent of dry weight).

Analogously, the same variables are needed for the herbaceous stratum.
- $P_{\text {dead,he }}$ : Proportion of herb fuels that respond to humidity changes as $1-\mathrm{h}$ dead fuels.
- FMC ${ }_{\text {live }, h e}$ : Fuel moisture content of live herb fuels (in percent of dry weight).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-239.jpg?height=600&width=1647&top_left_y=249&top_left_x=243}
\captionsetup{labelformat=empty}
\caption{Figure 24.1: Overview of the steps involved in fire behavior and fire potential calculations starting from fuel properties}
\end{figure}

The model also needs the following input parameters:
- FMC dead: the moisture content of $1-\mathrm{h}$ dead fuels (in percent of dry weight).
- $U$ : Midflame windspeed (in $m \cdot s^{-1}$ ).
- $S$ : Slope (in percent).

\subsection*{24.3 Fuel characteristics}

\subsection*{24.3.1 Fuel strata}

The Fuel Characteristics Classification System (FCCS) on which this document is based, defines six fuel strata (Prichard et al. 2013):
- Canopy: Trees, snags and ladder fuels.
- Shrubs: Primary and secondary layers.
- Non-woody vegetation (herbs): grasses, sedges, rushes and forbs.
- Woody fuels: All downed and dead wood, sound wood, rotten wood and stumps.
- Litter-lichen-moss: Lichen, litter and moss layers.
- Ground fuels: Duff, basal accumulation and squirrel middens.

Shrubs, herbs and woody fuels are constitute the upper surface fuels, whereas herbs and woody fuels alone consitute the lower surface fuels. FCCS summarizes and calculates characteristics for each fuelbed stratum and layer. Our model estimates fuel loading and characteristics for canopy, shrub, non-woody vegetation, as well as fine ( 1 h ) woody fuels and litter fuels. Larger woody fuels ( 10 h or 100 h ) could be considered if information about forest management actions is available. Ground fuels are not included here.

\subsection*{24.3.2 Cohort fuel loading}

Here we consider as burnable fuels foliage and branches up to $6.35 \mathrm{~mm}=0.25$ in in diameter. The same consideration applies to both trees and shrubs. They are calculated from forest objects using function plant_fuel().

\section*{Tree cohorts}

Fine fuel loading for a tree cohort ( $W_{i}$; in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ), including its leaves and branches with diameter up to $6.35 \mathrm{~mm}=0.25 \mathrm{in}$, is calculated from foliar biomass ( $F B_{i}$, see eq. (21.2)) using:
\[
W_{i}=r_{6.35, i} \cdot F B_{i}
\]
where $r_{6.35, i}$ is the ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm in diameter for the species of cohort $i$. The biomass corresponding to branches of less than $<$ $6.35 \mathrm{~mm}\left(S B B_{i}\right.$, also in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) is obtained by subtraction:
\[
S B B_{i}=\left(r_{6.35, i}-1\right) \cdot F B_{i}
\]

Whereas $W_{i}$ is the cohort loading variable influencing fire behavior, $F B_{i}$ and $S B B_{i}$ are cohort variables used to estimate fine dead woody and leaf litter loadings.

\section*{Shrub cohorts}

Our procedure to estimate shrub fuel loading differs from Prichard et al. (2013) because they calculate first total biomass of the shrub species and then consider the percentage of total weight that corresponds to leaves and small branches. In our case, we estimate fine fuel loading ( $W_{i}$, in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) and foliar biomass ( $F B_{i}$, in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) of shrubs from eqs. (21.6) and (21.7). Biomass of small branches (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) can be obtained from :
\[
S B B_{i}=W_{i}-F B_{i}
\]

\subsection*{24.3.3 Vertical distribution of cohort fuels}

Vertical distribution of fine fuels are distributed between the crown base height ( $H_{\text {crown }, i}$; in cm ) and the total height ( $H_{i}$, in cm ) following a truncated Gaussian distribution, as done for the distribution of leaves (see section 2.4.6). Crown base height of trees is calculated as explained in 21.2.3. The loading of a cohort that occurs within a given height interval of limits $H_{1}$ and $H_{2}$ is calculated as:
\[
W_{i}\left(H_{1}, H_{2}\right)=W_{i} \cdot p_{i}\left(H_{1}, H_{2}\right)
\]
where $p_{i}\left(H_{1}, H_{2}\right)$ is the proportion of the crown of cohort $i$ that corresponds to the height interval ( $H_{1}, H_{2}$ ).

\subsection*{24.3.4 Fuel bulk density profile}

Knowing at which height fuels are placed, the fuel bulk density profile (Reinhardt et al. 2006) is defined for any given interval ( $H_{1}, H_{2}$ ) as the bulk density ( $\mathrm{kg} / \mathrm{m}^{3}$ ) of fine fuels corresponding to that interval:
\[
B D P\left(H_{1}, H_{2}\right)=\frac{\sum_{i} W_{i}\left(H_{1}, H_{2}\right)}{H_{2}-H_{1}}
\]

Canopy bulk density normally ranges between 0 and $0.4 \mathrm{~kg} / \mathrm{m}^{3}$ (Scott \& Reinhardt 2002). Sando \& Wick (1972) arbitrarily defined canopy base height as the lower vertical $0.3-\mathrm{m}$ section with a weight greater than $0.01124 \mathrm{~kg} / \mathrm{m}^{3}$. A user-defined threshold $t_{B D P}$ (in $\mathrm{kg} / \mathrm{m}^{3}$ ) in $0.1-\mathrm{m}$ sections is used to differentiate the surface fuelbed from canopy fuels. Using this threshold the model calculates the following three heights (Reinhardt et al. 2006):
- Shrub stratum base height, $H_{s b}$ (in cm ): the minimum height between 0 and 2 m where fuel bulk density is larger than $t_{B D P}$.
- Shrub stratum top height, $H_{s t}$ (in cm ): the maximum height between 0 and 2 m where fuel bulk density larger than $t_{B D P}$. With this definition $h_{s}$ cannot be higher than 2 m (corresponding to fuel model 4 in Anderson 1982).
- Canopy base height, $H_{c b}$ (in cm ): In terms of its consequences to crown fire initiation, canopy base height can be defined as the lowest height above the ground at which there is sufficient canopy fuel to propagate fire vertically through the canopy. It is calculated as the minimum height over $H_{s} t$ when the bulk density starts again to be larger than $t_{B D P}$.
- Canopy top height, $H_{c t}$ (in cm ): the maximum height where bulk density is larger than $t_{B D P}$.
- Canopy gap, $H_{\text {gap }}$ (in cm): the difference between $H_{c b}$ and $H_{s t}$. The canopy gap is used to calculate crown initiation potential.

Figure 24.2 illustrates the definition and analysis of the fuel bulk density profile for a given forest stand (see function vprofile_fuelBulkDensity()). Following Mitsopoulos \& Dimitrakopoulos (2007), a threshold $t_{B D P}=0.04$ is used to determine shrub and canopy heights.

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-241.jpg?height=979&width=985&top_left_y=745&top_left_x=569}
\captionsetup{labelformat=empty}
\caption{Figure 24.2: Bulk density profile of an example forest}
\end{figure}

\subsection*{24.3.5 Fuel loading ( $w$ ) and fuel depth ( $\delta$ )}

\subsection*{24.3.5.1 Canopy stratum}

Canopy loading (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) is the sum of (tree and shrub) cohort loadings above 2 m (i.e. 200 cm ):
\[
w_{c a}=\sum_{i} w_{i, c a}=\sum_{i} W_{i}(200, \infty)
\]
where $w_{i, c a}$ is the canopy stratum loading of cohort $i$. Canopy depth (in $m$ ) is defined as the average of tree (or shrub) crown lengths above 2 m , weighted by the loadings of cohorts in the canopy:
\[
\delta_{c a}=\frac{1}{100} \cdot \frac{\sum_{i} w_{i, c a} \cdot\left(H_{i}-H_{b, i}\right) \cdot p_{i, c a}}{\sum_{i} w_{i, c a}}
\]
where the proportion of a tree (or shrub) cohort in the canopy stratum is $p_{i, c a}=p_{i}(200, \infty)$.

\subsection*{24.3.5.2 Shrub stratum}

Shrub loading (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) is the sum of (tree and shrub) cohort loadings between the ground and 2 m (i.e. 200 cm ):
\[
w_{s h}=\sum_{i} w_{i, s h}=\sum_{i} W_{i}(0,200)
\]
where $w_{i, s h}$ is the shrub stratum loading of cohort $i$. The depth of the shrub stratum (in $m$ ) is defined as the average of tree (or shrub) crown lengths below 2 m , weighted by the loadings of cohorts in the shrub stratum:
\[
\delta_{s h}=\frac{1}{100} \cdot \frac{\sum_{i} w_{i, s h} \cdot\left(H_{i}-H_{b, i}\right) \cdot p_{i, s h}}{\sum_{i} w_{i, s h}}
\]
where the proportion of a shrub (or tree) cohort in the shrub stratum is $p_{i, s h}=p_{i}(0,200)$.

\subsection*{24.3.5.3 Non-woody stratum}

Herb percent cover and average herb height are transformed into herbaceous loading ( $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ) using (ref piropinos):
\[
w_{h e}=0.014 \cdot C_{h e} \cdot\left(H_{h e} / 100\right)
\]

The depth of the herbaceous stratum (in $m$ ) is simply the mean height of herbs:
\[
\delta_{h e}=H_{h e} / 100
\]

\subsection*{24.3.5.4 Woody and litter strata}

In FCCS (Prichard et al. 2013), woody surface loading includes several fuel sizes. However, when calculating surface fire behavior $w_{w o}$ includes $100 \%$ of 1 h fuels, $25 \%$ of 10 h fuels and $12.5 \%$ of 100 h fuels, which represents the material available for flaming combustion. Obtaining loading estimates for 10 h - and 100 h -fuels is very difficult without field fuel sampling. However, we might estimate 1 h woody fuels and leaf litter from standing biomass of small branches ( $<6.35 \mathrm{~mm}$ ) and leaves for trees and shrubs. Hence, our treatment of surface woody fuels includes only fine (1h) fuels.

Assuming a continuous input of litter, the variation in accumulated litter is described by a simple differential equation (Birk \& Simpson 1980):
\[
\frac{\mathrm{d} X}{\mathrm{~d} t}=L-k \cdot X
\]
where $k$ is the decay constant, $L$ is the rate of litterfall and $X$ is the litter mass accumulated in the forest floor. Assuming that litter mass has reached a steady state, $X$ can be estimated as the ratio between $L$ and $k$. If litterfall is estimated as the total foliar biomass divided by leaf duration, the amount of steady state leaf litter corresponding to each tree and srhub cohort can be estimated using:
\[
w_{l i, i}=\frac{F B_{i}}{L D\left(S P_{i}\right) \cdot k_{i}}
\]
where $F B_{i}$ is the foliar biomass of cohort $i, L D\left(S P_{i}\right)$ is the species-specific average leaf duration (in years) and $k_{i}$ is the rate of decay of leaves of cohort $i$, which is given by the regreession model of Meentemeyer (1978):
\[
k_{i}=(-0.5365+0.00241 \cdot A E T)-(-0.01586+0.000056 \cdot A E T) \cdot L I\left(S P_{i}\right)
\]
where $L I\left(S P_{i}\right)$ is the species-specific percentage of lignin content in leaves and AET is actual evapotranspiration (default $A E T=1000 \mathrm{~mm}$ ). Litter loadings are summed for four litter types (short pine needles, long pine needles, other conifers, broadleaves). In the case of fine dead woody materials (small fallen branches),
loading of small branches is taken as woody litter and it is assumed that small branch litterfall occurs at the same time as leaf litterfall (i.e. according to leaf duration):
\[
w_{w o}=\sum_{i} w_{w o, i}=\sum_{i} \frac{S B B_{i}}{L D\left(S P_{i}\right) \cdot k_{w o}}
\]
where $k_{w o}=0.95 y^{-1}$ is a constant rate of decomposition for small branches.
In FCCS, the depth of woody and LLM strata are inputs. In our case the depth of the woody and litter strata are estimated from the corresponding fuel loadings:
\[
\begin{aligned}
\delta_{w o} & =w_{w o} / \rho_{b, w o} \\
\delta_{l i} & =w_{l i} / \rho_{b, l i}
\end{aligned}
\]
where $\rho_{b, w o}, \rho_{b, l i}$ are the woody and litter bulk density (in $\mathrm{kg} \cdot \mathrm{m}^{-3}$ ), respectively. Litter bulk density $\rho_{b, l i}$ is calculated as a weighted average of litter types:
\[
\rho_{b, l i}=\frac{\sum_{k} \rho_{b, k} \cdot w_{l i, k}}{\sum_{k} \cdot w_{l i, k}}
\]
where $k$ indicates litter type. The bulk density for litter types are [Prichard et al. (2013); Table 1]:
\[
\begin{aligned}
\rho_{b, \text { shortneedlepine }} & =\rho_{b, \text { longneedlepine }}=\rho_{b, \text { otherconifer }}=1.65 \mathrm{lb} \cdot \mathrm{ft}^{-3}=26.43 \mathrm{~kg} \cdot \mathrm{~m}^{-3} \\
\rho_{b, \text { hardwood }} & =0.83 \mathrm{lb} \cdot \mathrm{ft}^{-3}=13.30 \mathrm{~kg} \cdot \mathrm{~m}^{-3}
\end{aligned}
\]

\subsection*{24.3.6 Other fuel characteristics}

All the following characteristics are calculated in metric units (although British units are indicated to qualify specific values for compatibility).

\subsection*{24.3.6.1 Particle density ( $\rho_{p}$ )}

Particle density is the ratio of dry weight over volume for fuel particles (in $\mathrm{kg} \cdot \mathrm{m}^{-3}$ ). When species have different values, particle density averages for shrub and canopy strata can be obtained as:
\[
\begin{aligned}
\rho_{p, s h} & =\frac{\sum_{i} w_{i, s h} \cdot \rho_{p}\left(S P_{i}\right)}{\sum_{i} w_{i, s h}} \\
\rho_{p, c a} & =\frac{\sum_{i} w_{i, c a} \cdot \rho_{p}\left(S P_{i}\right)}{\sum_{i} w_{i, c a}}
\end{aligned}
\]
where $\rho_{p}\left(S P_{i}\right)$ is the species-specific particle density (in $\mathrm{kg} \cdot \mathrm{m}^{-3}$ ), which can be obtained from wood tissue ( $\rho_{\text {wood }}$ ) and leaf tissue ( $\rho_{\text {leaf }}$ ) densities, using $r_{6.35}$ to weight them:
\[
\rho_{p}\left(S P_{i}\right)=1000 \cdot\left(\rho_{\text {leaf }}\left(S P_{i}\right) \cdot f_{\text {leaves }, \text { vol }}+\rho_{\text {wood }}\left(S P_{i}\right) \cdot\left(1-f_{\text {leaves }, \text { vol }}\right)\right)
\]
where $f_{\text {leaves,vol }}$ is the volumetric fraction of leaves with respect to branchlets:
\[
f_{\text {leaves }, \text { vol }}=\left[1.0+\left(r_{6.35}\left(S P_{i}\right)-1.0\right) \cdot \frac{\rho_{\text {wood }}\left(S P_{i}\right)}{\rho_{\text {leaf }}\left(S P_{i}\right)}\right]^{-1}
\]

Dead woody and litter particle densities, i.e. $\rho_{p, w o}$ and $\rho_{p, l i}$, are obtained averaging wood tissue and leaf tissue densities across cohorts:
\[
\begin{aligned}
\rho_{p, w o} & =\frac{\sum_{i} w_{i} \cdot \rho_{\text {wood }}\left(S P_{i}\right)}{\sum_{i} w_{i}} \\
\rho_{p, l i} & =\frac{\sum_{i} w_{i} \cdot \rho_{\text {leaf }}\left(S P_{i}\right)}{\sum_{i} w_{i}}
\end{aligned}
\]

Finally, herb particle density, $\rho_{p, h e}$, is set to a default value $\rho_{p, h e}=400 \mathrm{~kg} \cdot \mathrm{~m}^{-3}=25 \mathrm{lb} \cdot \mathrm{ft}^{-3}$ (Prichard et al. 2013).

\subsection*{24.3.6.2 Particle volume ( $P V$ )}

Particle volume is defined as the volume of particles per surface area (in $m^{3} \cdot m^{-2}$ ). Is calculated as dry weight loading divided by particle density. If species have different particle density values, the particle volume for canopy ( $P V_{c a}$ ) and shrub ( $P V_{s h}$ ) strata can be calculated using:
\[
\begin{aligned}
P V_{c a} & =\sum_{i} P V_{i, c a}=\sum_{i} w_{i, c a} / \rho_{p}\left(S P_{i}\right) \\
P V_{s h} & =\sum_{i} P V_{i, s h}=\sum_{i} w_{i, s h} / \rho_{p}\left(S P_{i}\right)
\end{aligned}
\]
where $P V_{i, c a}$ and $P V_{i, s h}$ are the particle volume of cohort $i$ in the canopy and shrub strata, respectively. The particle volume for woody and herb strata are simply:
\[
\begin{aligned}
P V_{w o} & =w_{w o} / \rho_{p, w o} \\
P V_{h e} & =w_{h e} / \rho_{p, h e}
\end{aligned}
\]

The particle volume for the litter stratum is the sum of particle volume of litter components:
\[
P V_{l i}=\sum_{i} P V_{l i, k}=\sum_{i} w_{l i, k} / \rho_{p, l i}
\]

\subsection*{24.3.6.3 Packing ratio $(\beta)$}

The proportion of fuelbed stratum volume occupied by fuel particles is an important factor to predict fire behavior. At low packing ratios (low particle density) fire intensity is limited by excessive heat loss. At high packing ratios (high particle density), lack of oxygen limits combustion. The packing ratios for the canopy and shrub stratum ( $\beta_{c a}$ and $\beta_{s h}$; dimensionless) are given by:
\[
\begin{aligned}
\beta_{c a} & =\frac{P V_{c a}}{\delta_{c a}} \\
\beta_{s h} & =\frac{P V_{s h}}{\delta_{s h}}
\end{aligned}
\]
where $w_{i, c a}$ and $w_{i, s h}$ are the contribution of cohort $i$ to canopy and shrub strata loading (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ), respectively, and $\rho_{p}\left(S P_{i}\right)$ is the particle density (in $\mathrm{kg} \cdot \mathrm{m}^{-3}$ ) of fuels in cohort $i$. The packing ratio for the herbaceous, woody and litter strata are:
\[
\begin{aligned}
\beta_{h e} & =\frac{P V_{h e}}{\delta_{h e}} \\
\beta_{w o} & =\frac{P V_{w o}}{\delta_{w o}}=\frac{\rho_{b, w o}}{\rho_{p, w o}} \\
\beta_{l i} & =\frac{P V_{l i}}{\delta_{l i}}=\frac{\rho_{b, l i}}{\rho_{p, l i}}
\end{aligned}
\]

Note that the packing ratio expressions for woody and litter strata as a ratio of bulk and particle density arises as a consequence of how fuel depth and particle volume are estimated.

\subsection*{24.3.6.4 Surface-area-to-volume ratio ( $\sigma$ )}

The surface-area-to-volume ratio (in $m^{2} \cdot m^{-3}$ ) for the canopy or shrub strata are calculated using weighted averages:
\[
\begin{aligned}
\sigma_{c a} & =\frac{\sum_{i} w_{i, c a} \cdot \sigma\left(S P_{i}\right)}{\sum_{i} w_{i, c a}} \\
\sigma_{s h} & =\frac{\sum_{i} w_{i, s h} \cdot \sigma\left(S P_{i}\right)}{\sum_{i} w_{i, s h}}
\end{aligned}
\]
where $w_{i, c a}$ and $w_{i, s h}$ are the contribution of cohort $i$ to canopy and shrub strata loading (in $\mathrm{kg} \cdot \mathrm{m}^{-2}$ ), respectively, and $\sigma\left(S P_{i}\right)$ is the species-specific surface-area-to-volume ratio. The surface-area-to-volume ratio of herbs is assumed constant $\sigma_{h e}=11483 \mathrm{~m}^{2} \cdot \mathrm{~m}^{-3}=3500 \mathrm{ft}^{2} \cdot \mathrm{ft}^{-3}$ and that of small ( $1-\mathrm{h}$ ) woody fuels is $\sigma_{w o}=1601.05 \mathrm{~m}^{2} \cdot \mathrm{~m}^{-3}=488 \mathrm{ft}^{2} \cdot \mathrm{ft}^{-3}$. The surface-area-to-volume ratio for the litter stratum is:
\[
\sigma_{l i}=\frac{\sum_{k} w_{l i, k} \cdot \sigma_{k}}{\sum_{k} w_{l i, k}}
\]
and the surface-area-to-volume ratio for litter types are:
\[
\begin{aligned}
\sigma_{\text {shortneedlepine }} & =6562 m^{2} \cdot m^{-3}=2000 f t^{2} \cdot f t^{-3} \\
\sigma_{\text {longneedlepine }} & =4921 m^{2} \cdot m^{-3}=1500 f t^{2} \cdot f t^{-3} \\
\sigma_{\text {otherconifer }} & =8202 m^{2} \cdot m^{-3}=2500 f t^{2} \cdot f t^{-3} \\
\sigma_{\text {hardwood }} & =8202 m^{2} \cdot m^{-3}=2500 f t^{2} \cdot f t^{-3}
\end{aligned}
\]

\subsection*{24.3.6.5 Fuel area index (FAI)}

The fuel area index (FAI) is the total fuel surface area per unit of ground area (unitless). It is analogous to leave area index (LAI), and it is used to calculate FCCS fire potentials (Schaaf et al. 2007). For shrub and canopy strata, FAI is calculated as:
\[
\begin{aligned}
F A I_{c a} & =\sum_{i} F A I_{i, c a}=\sum_{i} P V_{i, c a} \cdot \sigma\left(S P_{i}\right) \\
F A I_{s h} & =\sum_{i} F A I_{i, s h}=\sum_{i} P V_{i, s h} \cdot \sigma\left(S P_{i}\right)
\end{aligned}
\]
where $F A I_{i, c a}$ and $F A I_{i, s h}$ are the FAI of cohort $i$ in the canopy and shrub strata, respectively. The FAI of herbs and woody strata are given by:
\[
\begin{aligned}
F A I_{h e} & =P V_{h e} \cdot \sigma_{h e} \\
F A I_{w o} & =P V_{w o} \cdot \sigma_{w o}
\end{aligned}
\]

For the litter layer, FAI is calculated as a sum of FAI for litter components:
\[
F A I_{l i}=\sum_{k} F A I_{l i, k}=\sum_{k} P V_{l i, k} \cdot \sigma_{k}
\]

\subsection*{24.3.6.6 Moisture content (FMC)}

Fuel moisture content ( $F M C$ in percent of dry weight) is averaged across cohorts composing the shrub or canopy strata, to obtain $F M C_{\text {live }, \text { sh }}$ and $F M C_{\text {live }, c a}$ :
\[
\begin{aligned}
F M C_{\text {live }, s h} & =\frac{\sum_{i} w_{i, s h} \cdot F M C_{i}}{\sum_{i} w_{i, s h}} \\
F M C_{\text {live }, c a} & =\frac{\sum_{i} w_{i, c a} \cdot F M C_{i}}{\sum_{i} w_{i, c a}}
\end{aligned}
\]

Live fuel moisture of herb stratum ( $F M C_{\text {live,he }}$ ) is an input. The moisture of dead plant in the canopy and shrub layers ( $F M C_{\text {dead }, c a}$ and $F M C_{\text {dead }, s h}$ ), the moisture of dead herbs ( $F M C_{\text {dead,he }}$ ), as well as that of litter ( $F M C_{l i}$ ) and woody ( $F M C_{w o}$ ) strata are all assumed equal to the moisture of 1 -h dead fuels, which is an input of the model.

\subsection*{24.3.6.7 Proportion of dead fuel ( $P_{\text {dead }}$ )}

Woody and litter strata are dead fuels, but for canopy, shrub and herb strata the proportion of fuels that are dead are variable. The proportion of dead fuels in the herbaceous stratum ( $P_{\text {dead,he }}$ ) is an input of the model, but for the shrub and canopy strata these are calculated from the proportion of dead fuels in each cohort:
\[
\begin{aligned}
P_{\text {dead }, s h} & =\frac{\sum_{i} w_{i, s h} \cdot P_{\text {dead }, i}}{\sum_{i} w_{i, s h}} \\
P_{\text {dead }, c a} & =\frac{\sum_{i} w_{i, c a} \cdot P_{\text {dead }, i}}{\sum_{i} w_{i, c a}}
\end{aligned}
\]

\subsection*{24.3.6.8 Low heat content (h)}

The low fuel heat content of each surface fuel stratum (in $k J \cdot k g^{-1}$ ) is used for the calculation of reaction intensity. Heat content values are adjusted for live foliar moisture content in canopy, shrub and herb strata; and are left to the default value for woody and litter strata:
\[
\begin{aligned}
h_{c a} & =h_{c a, d e f}-\left(M_{\text {live }, c a} / 100\right) \cdot V \\
h_{s h} & =h_{s h, d e f}-\left(M_{\text {live }, s h} / 100\right) \cdot V \\
h_{h e} & =h_{\text {def }}-\left(M_{\text {live }, \text { he }} / 100\right) \cdot V \\
h_{w o} & =h_{\text {li }}=h_{\text {def }}
\end{aligned}
\]
where $h_{\text {def }}=18608 \mathrm{~kJ} \cdot \mathrm{~kg}^{-1}=8000 \mathrm{Btu} \cdot \mathrm{lb}^{-1}$ is the default low heat content value for herbs, woody and litter strata, and $V=2596 \mathrm{~kJ} \cdot \mathrm{~kg}^{-1}=1116 B t u \cdot l b$ is the latent heat of vaporisation of water. The default low heat of contents for the canopy and shrub strata ( $h_{c a, d e f}$ and $h_{s h, d e f}$ ) are calculated as a weighted average across cohorts:
\[
\begin{aligned}
h_{c a, d e f} & =\frac{\sum_{i} w_{i, c a} \cdot h\left(S P_{i}\right)}{\sum_{i} w_{i, c a}} \\
h_{s h, d e f} & =\frac{\sum_{i} w_{i, s h} \cdot h\left(S P_{i}\right)}{\sum_{i} w_{i, s h}}
\end{aligned}
\]
where $h\left(S P_{i}\right)$ is a species-specific low heat content value.

\subsection*{24.3.6.9 Reactive volume ( $R V$ )}

The volume per surface unit ( $m^{3} \cdot m^{-2}$ ) that would be involved in flaming combustion.
\[
\begin{aligned}
R V_{s h} & =w_{s h r u b} / \rho_{p, s h} \\
R V_{h e} & =w_{h e} / \rho_{p, h e} \\
R V_{w o} & =w_{w o} / \rho_{p, w o} \\
R V_{l i} & =\min \left(w_{l i}, w_{\max , l i}\right) / \rho_{p, l i}
\end{aligned}
\]

In the case of litter, the flame loading is limited by $w_{\max , l i}$, the maximum loading that would be consumed in the flaming stage of combustion, calculated as a weighted average of litter types:
\[
w_{\max , l i}=\frac{\sum_{k} w_{\max , k} \cdot w_{l i, k}}{\sum_{k} \cdot w_{l i, k}}
\]
where $k$ indicates litter type. The maximum combustion loadings for litter types are [Prichard et al. (2013); Table 2]:
\[
\begin{aligned}
w_{\max , \text { shortneedlepine }} & =w_{\max , \text { otherconifer }}=0.3248 \mathrm{~kg} \cdot \mathrm{~m}^{-2}=2900 \mathrm{lb} \cdot \mathrm{ac}^{-1} \\
w_{\max , \text { longneedlepine }} & =0.6496 \mathrm{~kg} \cdot \mathrm{~m}^{-2}=5800 \mathrm{lb} \cdot \mathrm{ac}{ }^{-1} \\
w_{\max , \text { hardwood }} & =0.3472 \mathrm{~kg} \cdot \mathrm{~m}^{-2}=3100 \mathrm{lb} \cdot \mathrm{ac}{ }^{-1}
\end{aligned}
\]

\subsection*{24.3.7 Unit conversion of fuel characteristics}

FCCS calculations employ empirical equations that were derived in British units system. Hence, all the fuel characteristics and model inputs that are in metric units have to be translated into British units prior to fire behaviour calculations:
- Loading: $1 \mathrm{~kg} \cdot \mathrm{~m}^{-2}=0.204918 \mathrm{lb} \cdot \mathrm{ft}^{-2}$
- Depths: $1 m=3.2808399 f t$
- Particle density and bulk density: $1 \mathrm{~kg} \cdot \mathrm{~m}^{-3}=0.06242796 \mathrm{lb} \cdot \mathrm{ft}^{-3}$
- Particle volume and reactive volume: $1 m^{3} \cdot m^{-2}=3.2808399 f t^{3} \cdot f t^{-2}$
- Surface-to-area-volume ratio: $1 m^{2} \cdot m^{-3}=0.3048 f t^{2} \cdot f t^{-3}$
- Heat content: $1 \mathrm{~kJ} \cdot \mathrm{~kg}^{-1}=0.429922614 B t u \cdot l b^{-1}$
- Wind speed: $1 m \cdot s^{-1}=2.23693629 m p h$

\subsection*{24.4 Surface fire behavior}

\subsection*{24.4.1 Surface rate of spread (R)}

In the Rothermel (1972) model, surface rate of spread is defined as the ratio of heat source (i.e. the surface fire energy propagated to unburned fuels) to surface fuel heat sink (i.e. the energy required to preheat fuels). Owing to the difference in packing ratio between the litter stratum and the other surface fuels, litterdominated fuelbeds may have substantially different spread rates than other fuelbeds. For this reason, in FCCS the rate of spread (in $f t \cdot \mathrm{~min}^{-1}$ ) is calculated separately for litter stratum and the final rate of spread is the maximum of the rate of spread of all surface fuels and that of the litter stratum. Rate of spread is also limited to a maximum based in windspeed and slope.
\[
R=\min \left(\text { WindSlopeCap }, \max \left(R_{\text {surf }}, R_{\text {litter }}\right)\right)
\]

The surface fuel and litter fuel rates of spread are given by the application of Rothermel's (1972) equation to each case:
\[
\begin{aligned}
R_{\text {surf }} & =\frac{I_{R, \text { surf }} \cdot \xi_{\text {surf }} \cdot\left(1+\phi_{W}+\phi_{S}\right)}{q_{\text {surf }}} \\
R_{\text {litter }} & =\frac{I_{R, \text { litter }} \cdot \xi_{\text {litter }} \cdot\left(1+\phi_{W}+\phi_{S}\right)}{q_{\text {litter }}}
\end{aligned}
\]
where $I_{R, \text { surf }}$ and $I_{R, \text { litter }}$ are the reaction intensities (in $B t u \cdot f t^{-2} \cdot$ min $^{-1}$ ), $\xi_{\text {surf }}$ and $\xi_{\text {litter }}$ are the propagating flux ratios, $q_{\text {surf }}$ and $q_{\text {litter }}$ are the heat sinks. Finally, $\phi_{W}$ and $\phi_{S}$ are the slope and wind modifiers. All of them are explained in the following sections. The maximum rate of spread calculated from windspeed and slope is:
\[
\text { WindSlopeCap }=88 \cdot U \cdot\left(1+\phi_{S}\right)
\]
where $U$ is windspeed (in mph) and 88 is a conversion factor (from mph to $f t / \min$ ).

\subsection*{24.4.1.1 Reaction intensity ( $I_{R}$ )}

Reaction intensity of surface fuels (in $B t u \cdot f t^{-2} \cdot$ min $^{-1}$ ) is calculated as the sum of component reaction intensities of the four different surface fuel strata, whereas the reaction intensity in the litter uses this strata alone:
\[
\begin{aligned}
I_{R, \text { surf }} & =I_{R, \text { sh }}+I_{R, \text { he }}+I_{R, \text { wo }}+I_{R, l i} \\
I_{R, \text { litter }} & =I_{R, l i}
\end{aligned}
\]

Each component reaction intensity is calculated using:
\[
\begin{aligned}
I_{R, s h} & =\left(\eta_{\beta_{\text {allsurf }}^{\prime}}\right)^{A_{s h}} \cdot \Gamma_{\max , s h}^{\prime} \cdot w_{s h} \cdot h_{s h} \cdot \eta_{F M C, s h} \cdot \eta_{K, s h} \\
I_{R, h e} & =\left(\eta_{\beta_{\text {lowsurf }}^{\prime}}\right)^{A_{h e}} \cdot \Gamma_{\max , h e}^{\prime} \cdot w_{h e} \cdot h_{h e} \cdot \eta_{F M C, h e} \cdot \eta_{K, h e} \\
I_{R, w o} & =\left(\eta_{\beta_{\text {lowsurf }}^{\prime}}\right)^{A_{w o}} \cdot \Gamma_{\max , w o}^{\prime} \cdot w_{w o} \cdot h_{w o} \cdot \eta_{F M C, w o} \cdot \eta_{K, w o} \\
I_{R, l i} & =\left(\eta_{\beta_{\text {litter }}^{\prime}}\right)^{A_{l i}} \cdot \Gamma_{\max , l i}^{\prime} \cdot w_{l i} \cdot h_{l i} \cdot \eta_{F M C, l i} \cdot \eta_{K, l i}
\end{aligned}
\]

In the above equations, $w_{s h}, w_{h e}, w_{w o}$ and $w_{l i}$ are the loadings of the corresponding shrub, herb, woody and litter strata, respectively. These quantities were defined in previous sections, as were the corresponding low heat fuel contents ( $h_{s h}, h_{h e}, h_{w o}$ and $h_{l i}$ ). Mineral damping coefficient ( $\eta_{K}$; dimensionless) is set to the same value (corresponding to the conventional value for silica-free ash content of $1 \%$ ) for all strata:
\[
\eta_{K, s h}=\eta_{K, h e}=\eta_{K, w o}=\eta_{K, l i}=0.42
\]

In the following subsections, we describe the calculation of the remaining variables for each stratum: reaction efficiency ( $\eta_{\beta^{\prime}}$ ), Rothermel's $A$ parameter, maximum reaction velocity ( $\Gamma_{\max }^{\prime}$ ) and moisture damping coefficient $\left(\eta_{F M C}\right)$.

\subsection*{24.4.1.2 Reaction efficiency ( $\eta_{\beta^{\prime}}$ )}

Reaction efficiency (between 0 and 1) represents the damping effect of inefficiently packed fuels in the reaction intensity. Because shrubs rarely burn without lower surface fuels, the reaction efficiency of the surface layer $\left(\eta_{\beta_{\text {allsurf }}^{\prime}}\right)$ includes shrubs, herbs and woody fuels. Low surface fuels may carry flames without involving shrubs, so are assumed to burn with a single reaction efficiency ( $\eta_{\beta_{\text {lowsurf }}^{\prime}}$ ) determined by the combined characteristics of herb and woody fuel strata. Both are calculated similarly:
\[
\begin{aligned}
\eta_{\beta_{\text {allsurf }}^{\prime}} & =\beta_{\text {allsurf }}^{\prime} \cdot e^{1-\beta_{\text {allsurf }}^{\prime}} \\
\eta_{\beta_{\text {lowsurf }}^{\prime}} & =\beta_{\text {lowsurf }}^{\prime} \cdot e^{1-\beta_{\text {lowsurf }}^{\prime}}
\end{aligned}
\]
where $\beta_{\text {allsurf }}^{\prime}$ and $\beta_{\text {lowsurf }}^{\prime}$ are the relative packing ratios corresponding to all surface fuels and low surface fuels, respectively. Relative packing ratios ( $\beta^{\prime}$; dimensionless) are defined as the ratio of optimum depth $\left(\delta_{\text {opt }}\right)$ to effective depth $\left(\delta_{e f f}\right)$ :
\[
\begin{aligned}
\beta_{\text {allsurf }}^{\prime} & =\delta_{\text {opt,allsurf }} / \delta_{\text {eff,allsurf }} \\
\beta_{\text {lowsurf }}^{\prime} & =\delta_{\text {opt,lowsurf }} / \delta_{\text {eff,lowsurf }}
\end{aligned}
\]

Optimum depth is the depth (in $f t$ ) at which fuels are optimally packed for maximum reaction intensity:
\[
\begin{aligned}
\delta_{\text {opt }, \text { allsurf }} & =P V_{\text {allsurf }}+\text { OptAirVolallsurf } \\
\delta_{\text {opt }, \text { lowsurf }} & =P V_{\text {lowsurf }}+\text { OptAirVol }{ }_{\text {lowsurf }}
\end{aligned}
\]
where $P V_{\text {allsurf }}$ and $P V_{\text {lowsurf }}$ are the volume of particles (in $f t^{3} \cdot f t^{-2}$ ) for all surface fuels and low surface fuels, respectively, given by:
\[
\begin{aligned}
P V_{\text {allsurf }} & =P V_{\text {sh }}+P V_{\text {he }}+P V_{w o} \\
P V_{\text {lowsurf }} & =P V_{\text {he }}+P V_{w o}
\end{aligned}
\]

OptAirVolallsurf and OptAirVolallsurf are the volume of air space (in $f t^{3} \cdot f t^{-2}$ ) between fuel particles that would result in maximum reaction intensity:
\[
\begin{aligned}
\text { OptAirVol }{ }_{\text {allsurf }} & =45 \cdot\left(R V_{\text {sh }}+R V_{h e}+R V_{w o}\right) \\
\text { OptAirVol }{ }_{\text {lowsurf }} & =45 \cdot\left(R V_{h e}+R V_{w o}\right)
\end{aligned}
\]

On the other hand, effective depths of all surface fuels and low surface fuels (in $f t$ ) are calculated as their depth, weighted by the reactive volume (and percentage cover in FCCS):
\[
\begin{aligned}
\delta_{e f f, a l l s u r f} & =\frac{\left(R V_{s h} \cdot \delta_{s h}\right)+\left(R V_{h e} \cdot \delta_{h e}\right)+\left(R V_{w o} \cdot \delta_{w o}\right)}{R V_{s h}+R V_{h e}+R V_{w o}} \\
\delta_{e f f, l o w s u r f} & =\frac{\left(R V_{h e} \cdot \delta_{h e}\right)+\left(R V_{w o} \cdot \delta_{w o}\right)}{R V_{h e}+R V_{w o}}
\end{aligned}
\]

Reaction efficiency of the litter stratum is determined separately from the other strata. It is defined as the average of reaction efficiency across litter types, calculated using loadings as weights:
\[
\eta_{\beta_{l i t t e r}^{\prime}}=\frac{\sum_{k} \eta_{\beta_{k}^{\prime}} \cdot w_{l i, k}}{\sum_{k} \cdot w_{l i, k}}
\]
where $k$ indicates litter type. The reaction efficiencies of litter types are [Prichard et al. (2013); Table 2]:
\[
\begin{aligned}
\eta_{\beta_{\text {shortneedlepine }}^{\prime}} & =\eta_{\beta_{\text {otherconifer }}^{\prime}}=0.18 \\
\eta_{\beta_{\text {longneedlepine }}^{\prime}} & =0.27 \\
\eta_{\beta_{\text {hardwood }}^{\prime}} & =0.11
\end{aligned}
\]

\subsection*{24.4.1.3 Rothermel's A}

A dimensionless coefficient that modifies reaction's efficiency (eq. (24.80)) to account for lower sensitivity of reaction efficiency to relative packing ratio in flash fuels:
\[
\begin{aligned}
A_{w o} & =A_{l i}=1.0 \\
A_{s h} & =133 \cdot \sigma_{s h}^{-0.7913} \\
A_{h e} & =133 \cdot \sigma_{h e}^{-0.7913}
\end{aligned}
\]
where $\sigma_{s h}$ and $\sigma_{h e}$ have to be expressed in $f t^{2} \cdot f t^{-3}$; Values 133 and -0.7913 are empirical constants (Rothermel 1972).

\subsection*{24.4.1.4 Maximum reaction velocity ( $\Gamma_{\text {max }}^{\prime}$ )}

The reaction velocity (in $\mathrm{min}^{-1}$ ) that would exist at optimum fuelbed depth with no fuel moisture or mineral content.
\[
\begin{aligned}
\Gamma_{\max , s h}^{\prime} & =9.495 \cdot \frac{\sigma_{s h}}{\sigma_{w o}} \\
\Gamma_{\max , h e}^{\prime} & =9.495 \cdot \frac{\sigma_{h e}}{\sigma_{w o}} \\
\Gamma_{\max , w o}^{\prime} & =9.495 \\
\Gamma_{\max , l i}^{\prime} & =15
\end{aligned}
\]
where $\sigma_{w o}=488 f t^{2} \cdot f t^{-3}=1601.05 m^{2} \cdot m^{-3}$ is the surface-to-area-volume ratio typical of small woody fuels. In Prichard et al. (2013) $\sigma_{s h}$ is defined as the average of shrub foliar surface-to-area-volume ratio and $\sigma_{w o}$, but in our case $\left.\sigma_{( } S P_{i}\right)$ for each species includes both leaves and small branches. Eq. (24.101) represent a significant departure from Rothermel (1972) maximum reaction velocity, and are also different from Sandberg et al. (2007).

\subsection*{24.4.1.5 Moisture damping coefficient ( $\eta_{F M C}$ )}

Moisture damping reduces reaction velocity and hence reaction intensity (eq. (24.73)). It is calculated for each stratum using the following regression equations:
\[
\begin{aligned}
\eta_{F M C, \text { live }, \text { sh }} & =\left[1-2.59 \cdot\left(\frac{F M C_{\text {live }, s h}}{X_{\text {live }, s h}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{\text {live }, s h}}{X_{\text {live }, s h}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{\text {live }, s h}}{X_{\text {live }, s h}}(24] 102\right)\right. \\
\eta_{F M C, \text { dead }, s h} & =\left[1-2.59 \cdot\left(\frac{F M C_{\text {dead }, s h}}{X_{\text {dead }, s h}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{\text {dead }, s h}}{X_{\text {dead }, s h}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{\text {dead }, s h}}{X_{\text {dead }, s h}}(24) \cdot 103\right)\right. \\
\eta_{F M C, \text { live }, h e} & =\left[1-2.59 \cdot\left(\frac{F M C_{\text {live }, h e}}{X_{\text {live }, h e}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{\text {live }, h e}}{X_{\text {live }, h e}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{\text {live }, h e}}{X_{\text {live }, h e}}(24] \cdot 104\right)\right. \\
\eta_{F M C, \text { dead }, h e} & =\left[1-2.59 \cdot\left(\frac{F M C_{\text {dead }, h e}}{X_{\text {dead }, h e}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{\text {dead }, h e}}{X_{\text {dead }, h e}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{\text {dead }, h}}{X_{\text {dead }, h e}}(24) \cdot 105\right)\right. \\
\eta_{F M C, w o} & =\left[1-2.59 \cdot\left(\frac{F M C_{w o}}{X_{w o}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{w o}}{X_{w o}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{w o}}{X_{w o}}\right)^{3}\right] \\
\eta_{F M C, l i} & =\left[1-2.59 \cdot\left(\frac{F M C_{l i}}{X_{l i}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{l i}}{X_{l i}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{l i}}{X_{l i}}\right)^{3}\right]
\end{aligned}
\]
where moisture contents of extinctions were arbitrarily set to $X_{\text {dead }, \text { sh }}=X_{\text {dead,he }} X_{\text {wo }}=X_{\text {li }}=25, X_{\text {live,sh }}=$ 180 and $X_{\text {live,he }}=120$ in Sandberg et al. (2007). As it can be seen in the equations above, in the case of shrub and herb strata, moisture damping of live and dead fuels are differentiated. Average values are found after accounting for the proportion of live and dead material:
\[
\begin{aligned}
& \eta_{F M C, s h}=\eta_{F M C, \text { live }, s h} \cdot\left(1-P_{\text {dead }, s h}\right)+\eta_{F M C, \text { dead }, s h} \cdot P_{\text {dead }, s h} \\
& \eta_{F M C, h e}=\eta_{F M C, \text { live }, h e} \cdot\left(1-P_{\text {dead,he }}\right)+\eta_{F M C, \text { dead,he }} \cdot P_{\text {dead,he }}
\end{aligned}
\]

\subsection*{24.4.1.6 Propagating flux ratio ( $\xi$ )}

The propagating flux ratio (dimensionless) is the proportion of the reaction intensity (eq. (24.73)) that contributes to the forward rate of spread, estimated using an empirical regression:
\[
\begin{aligned}
\xi_{\text {surf }} & =0.03+2.5 \cdot \min \left[0.06, \frac{R V_{\text {sh }}+R V_{\text {he }}+R V_{\text {wo }}+R V_{l i}}{\delta_{\text {surfheatsink }}}\right] \\
\xi_{\text {litter }} & =0.03+2.5 \cdot \min \left[0.06, \frac{R V_{l i}}{\delta_{l i}}\right]
\end{aligned}
\]
where $\delta_{\text {surfheatsink }}$ is the depth of surface heat sink (in $f t$ ), which in Prichard et al. (2013) is calculated as the sum of strata depths weighted by their relative cover. In our case we weighted stratum depths as in the calculation of effective depth ( $\delta_{\text {eff,allsurf }}$ ), but considering all four strata:
\[
\delta_{\text {surfheatsink }}=\frac{\left(R V_{s h} \cdot \delta_{s h}\right)+\left(R V_{h e} \cdot \delta_{h e}\right)+\left(R V_{w o} \cdot \delta_{w o}\right)+\left(R V_{l i} \cdot \delta_{l i}\right)}{R V_{s h}+R V_{h e}+R V_{w o}+R V_{l i}}
\]

\subsection*{24.4.2 Heat sink (q)}

Like reaction intensity, the heat sink term (in $B t u \cdot f t^{-3}$ ) of the rate of spread equation is calculated in FCCS for each fuel stratum and then summed:
\[
\begin{aligned}
q_{s u r f} & =q_{s h}+q_{h e}+q_{w o}+q_{l i} \\
q_{l i t t e r} & =q_{l i}
\end{aligned}
\]
where the heat sink for each stratum is:
\[
\begin{aligned}
q_{s h} & =\eta_{\beta_{s u r f}^{\prime}} \cdot \frac{R V_{s h} \cdot \rho_{p, s h} \cdot Q i g_{s h}}{\min \left(\delta_{s h}, 1 f t\right)} \\
q_{h e} & =\eta_{\beta_{l o w s u r f}^{\prime}} \cdot \frac{R V_{h e} \cdot \rho_{p, h e} \cdot Q i g_{h e}}{\min \left(\delta_{h e}, 1 f t\right)} \\
q_{w o} & =\eta_{\beta_{l o w s u r f}^{\prime}} \cdot \frac{R V_{w o} \cdot \rho_{p, w o} \cdot Q i g_{w o}}{\min \left(\delta_{w o}, 1 f t\right)} \\
q_{l i} & =\eta_{\beta_{l i}^{\prime}} \cdot \frac{R V_{l i} \cdot \rho_{p, l i} \cdot Q i g_{l i}}{\min \left(\delta_{l i}, 1 f t\right)}
\end{aligned}
\]

Where $\rho_{p, s h}, \rho_{p, h e}, \rho_{p, w o}$ and $\rho_{p, l i}$ are the particle densities (in $l b \cdot f t^{-3}$ ) of each fuel stratum; and $R V_{s h}$, $R V_{h e}, R V_{w o}$, and $R V_{l i}$ are the reactive volumes of each fuel stratum. Unlike in Sandberg et al. (2007), the calculated heat sink is corrected by the reaction-efficiency term ( $\eta_{\beta_{\text {surf }}^{\prime}}, \eta_{\beta_{\text {lowsurf }}^{\prime}}$ or $\eta_{\beta_{l i}^{\prime}}$ ), and the effective depth of each stratum included is limited to 1 ft , based on the assumption that it is not necessary to preheat more than one 1 ft of depth within a stratum to achieve ignition.
Heat of pre-ignition ( Qig ; in $\mathrm{Btu} \cdot l b^{-1}$ ) is the amount of heat required to ignite $1 l b$ of fuel. It is calculated by stratum as a weighted average of live and dead fuels in shrubs and herbs.
\[
\begin{aligned}
\text { Qigsh } & =\text { Qig }_{\text {live }, \text { sh }} \cdot\left(1-P_{\text {dead }, \text { sh }}\right)+\text { Qig }_{\text {dead,sh }} \cdot P_{\text {dead,sh }} \\
\text { Qig }_{\text {he }} & =\text { Qig }_{\text {live,he }} \cdot\left(1-P_{\text {dead,he }}\right)+\text { Qig }_{\text {dead,he }} \cdot P_{\text {dead,he }}
\end{aligned}
\]

Whereas Qig $_{\text {live }, \text { sh }}$ and Qig $_{\text {live,he }}$ are corrected by fuel moisture, Qig $_{\text {dead,sh }}$, Qig $_{\text {dead,he }}$ and the other strata (Qigwo and Qigli) are assumed a constant value:
\[
\begin{aligned}
\text { Qig }{ }_{\text {live }, \text { sh }} & =250+\left(V \cdot\left(M_{\text {live }, \text { sh }} / 100\right)\right) \\
\text { Qig }{ }_{\text {live }, \text { he }} & =250+\left(V \cdot\left(M_{\text {live }, \text { he }} / 100\right)\right) \\
\text { Qig }{ }_{\text {dead }, \text { sh }} & =\text { Qig }{ }_{\text {dead }, \text { he }}=\text { Qig }{ }_{\text {wo }}=\text { Qig }{ }_{\text {li }}=250
\end{aligned}
\]
where $250 B t u / l b$ is the heat of preignition of dry cellulose and $V=1116 B t u / l b$ is the latent heat of vaporization.

\subsection*{24.4.3 Wind and slope coefficients ( $\phi_{W}$ and $\phi_{S}$ )}

Wind and slope coefficients modify the heat source term of the rate of spread equation. Owing to differences in fuel characteristics and boundary conditions between the litter stratum and other surface fuel strata, in FCCS wind and slope coefficients are calculated separately for the litter stratum. The wind and slope coefficients terms in the rate fo spread equation are a weighted average of litter and surface wind and slope coefficients using the relative contribution to reaction intensity as weights:
\[
\begin{aligned}
\phi_{W} & =\left(1-I_{R, \text { litter }} / I_{R, \text { surf }}\right) \cdot \phi_{W, \text { surf }}+\left(I_{R, \text { litter }} / I_{R, \text { surf }}\right) \cdot \phi_{W, \text { litter }} \\
\phi_{S} & =\left(1-I_{R, \text { litter }} / I_{R, \text { surf }}\right) \cdot \phi_{S, \text { surf }}+\left(I_{R, \text { litter }} / I_{R, \text { surf }}\right) \cdot \phi_{S, \text { litter }}
\end{aligned}
\]

Wind coefficients are calculated using:
\[
\begin{aligned}
\phi_{W, \text { surf }} & =8.8 \cdot \beta_{\text {surf }}^{\prime-E} \cdot(U / B M U)^{B} \\
\phi_{W, \text { litter }} & =8.8 \cdot \beta_{\text {litter }}^{-E} \cdot(U / B M U)^{B}
\end{aligned}
\]
where $U$ is the input midflame windspeed (in $\mathrm{ft} \cdot \mathrm{min}^{-1}$ ), $B M U=352 \mathrm{ft} \cdot \mathrm{min}^{-1}$ is the benchmark midflame windspeed, $\beta_{\text {surf }}^{\prime}$ is the relative packing ratio (eq. 24.82), $B$ is the exponential response of wind coefficient to windspeed ( $B=1.2$ in Sandberg et al. (2007)), and $E$ is the exponential term representing the mild effect of large fuels in reducing the accelerating effect of wind on fire spread by attenuating wind flow, given by:
\[
E=0.55-0.2 \cdot \frac{F A I_{s h}+F A I_{h e}}{F A I_{s h}+F A I_{h e}+F A I_{w o}}
\]
$E$ is assumed to be the same for both all surface fuels and litter fuels.
Slope coefficients are calculated using the empirical equation of Rothermel (1972), applied to all surface fuels and litter fuels:
\[
\begin{aligned}
\phi_{S, \text { surf }} & =5.275 \cdot(S / 100)^{2} \cdot\left(\beta_{s h}+\beta_{h e}+\beta_{w o}\right)^{-0.3} \\
\phi_{S, \text { litter }} & =5.275 \cdot(S / 100)^{2} \cdot \beta_{l i}^{-0.3}
\end{aligned}
\]
where $S$ is the slope (in percent) and $\beta$ is the packing ratio (not relative!) of fuels.

\subsection*{24.4.4 Fireline intensity ( $I_{B}$ ) and flame length ( $F L$ )}

Byram's fireline intensity ( $I_{B}$ ) is the rate of heat release per unit of fire edge (in $\mathrm{Btu} \cdot \mathrm{ft}^{-1} \cdot \mathrm{~min}^{-1}$ ), and in FCCS is calculated as (Albini 1976):
\[
I_{B}=I_{R, \text { surf }} \cdot\left(R \cdot t_{R}\right)
\]
where $I_{R, s u r f}$ is the surface reaction intensity, $R$ is the rate of spread and $t_{R}$ is the flame residence time, which is defined as the time (in min) fuels contribute to propagating flux and is estimated as Albini (1976):
\[
t_{R}=192 \cdot \frac{\left(I_{R, s h} \cdot R T_{s h}\right)+\left(I_{R, h e} \cdot R T_{h e}\right)+\left(I_{R, w o} \cdot R T_{w o}\right)+\left(I_{R, l i} \cdot R T_{l i}\right)}{I_{R, s u r f}}
\]
where $R T$ is the reaction thickness, the approximate thickness (in $f t$ ) of a fuel element shell that contributes to reaction intensity. In FCCS, reaction thickness is estimated as $R T=0.0028 f t$ for thermally thick fuel elements (Sandberg et al. 2007). When the diameter of a fuel element is less than twice the reaction thickness, the entire fuel element contributes to reaction intensity. Reaction thickness values for each stratum are given by:
\[
\begin{aligned}
R T_{s h} & =\min \left(0.0028,2 / \sigma_{s h}\right) \\
R T_{h e} & =\min \left(0.0028,2 / \sigma_{h e}\right) \\
R T_{w o} & =\min \left(0.0028,2 / \sigma_{w o}\right) \\
R T_{l i} & =\min \left(0.0028,2 / \sigma_{l i}\right)
\end{aligned}
\]

Flame length is defined as the distance (in $f t$ ) between the flame tip and the midpoint of the flame depth at the base of the flame, and is calculated (Byram 1959):
\[
F L=0.45 \cdot\left(I_{B} / 60\right)^{0.46}
\]
where 60.0 is a factor to convert from $B t u \cdot f t^{-1} \cdot$ min $^{-1}$ to $B t u \cdot f t^{-1} \cdot s^{-1}$.

\subsection*{24.5 Crown fire behavior}

Crown fire behavior is difficult to model and actual rates of spread are not possible to predict. Here we mainly follow the approach given in FCCS (Prichard et al. 2013), although in our case the canopy is not subdivided into layers (overstory, midstory and understory).

\subsection*{24.5.1 Crown fire rate of spread ( $R_{\text {crown }}$ )}

The rate of spread of crown fires is estimated by using a modification of Rothermel's equation:
\[
R_{\text {crown }}=\frac{I_{R, \text { crown }} \cdot \xi_{\text {crown }} \cdot W A F}{q_{\text {crown }}}=\frac{\left(I_{R, \text { surf }}+I_{R, \text { ca }}\right) \cdot \xi_{\text {crown }} \cdot W A F}{q_{\text {surf }}+q_{\text {ca }}}
\]
where $I_{R, \text { surf }}$ is the surface reaction intensity, $I_{R, \text { ca }}$ is the canopy reaction intensity, $\xi_{\text {crown }}$ is the propagating flux ratio in the canopy, $q_{\text {surf }}$ is the surface heat sink and $q_{c a}$ is the canopy heat sink. Note that reaction intensities and heat sinks of canopy and surface fuels are added for the application of Rothermel's equation. Other modifications include the exclusion of slope effects and the consideration of wind effects through a wind adjusment factor (WAF).

Crown propagating flux ratio ( $\xi_{\text {crown }}$; in $B t u \cdot f t^{-3}$ ) represents the proportion of the crown reaction intensity that contributes to crown fire's forward rate of spread:
\[
\xi_{\text {crown }}=1-e^{\left(-\frac{F A I_{c a}}{4 \cdot \delta_{c a}}\right)}
\]
where $F A I_{c a}$ is the fuel area index of the canopy, and $\delta_{c a}$ is the canopy depth (in $f t$ ). Wind adjustment factor ( $W A F$ ) is defined as:
\[
W A F=\frac{U / \sqrt{U^{2}+V S^{2}}}{B M U / \sqrt{B M U^{2}+V S^{2}}}
\]
where $U$ is the input (midflame) windspeed (in $\mathrm{ft} \cdot$ min $^{-1}$ ), BMU $=352 \mathrm{ft} \cdot$ min $^{-1}$ is the benchmark windspeed and $V S=900 \mathrm{ft} \cdot \mathrm{min}^{-1}$ is the vertical stack velocity.

The following two subsections detail the calculation of canopy reaction intensity ( $I_{R, c a}$ ) and canopy heat sink ( $q_{c a}$ ).

\subsection*{24.5.2 Canopy reaction intensity ( $I_{R, c a}$ )}

Reaction intensity of canopy fuels (in $B t u \cdot f t^{-2} \cdot$ min $^{-1}$ ) is estimated as:
\[
I_{R, c a}=\left(\eta_{\beta_{c a}^{\prime}}\right)^{A_{c a}} \cdot \Gamma_{\max , c a}^{\prime} \cdot w_{c a} \cdot h_{c a} \cdot \eta_{F M C, c a} \cdot \eta_{K, c a}
\]
where $A_{c a}=133 \cdot \sigma_{c a}^{-0.7913}$ is Rothermel's A coefficient, $\Gamma_{\max , c a}^{\prime}=15 \mathrm{~min}^{-1}$ is the maximum reaction velocity of the canopy, $w_{c a}$ is the loading of canopy fuels (in $l b \cdot f t^{-2}$ ), $h_{c a}$ is the heat content of the canopy fuels (in $B t u \cdot l b^{-1}$ ) and $\eta_{K, c a}=0.42$ is the mineral damping coefficient of the canopy stratum. Moisture damping coefficient for the canopy ( $\eta_{F M C, c a}$ ) is estimated as done for shrub and herb strata:
\[
\begin{aligned}
\eta_{F M C, \text { live }, c a} & =\left[1-2.59 \cdot\left(\frac{F M C_{\text {live }, c a}}{X_{\text {live }, c a}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{\text {live }, c a}}{X_{\text {live }, c a}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{\text {live }, c a}}{X_{\text {live }, c a}}\right)^{3} 24.142\right) \\
\eta_{F M C, \text { dead }, c a} & =\left[1-2.59 \cdot\left(\frac{F M C_{\text {dead }, c a}}{X_{\text {dead }, c a}}\right)\right]+\left[5.11 \cdot\left(\frac{F M C_{\text {dead }, c a}}{X_{\text {dead }, c a}}\right)^{2}\right]-\left[3.52 \cdot\left(\frac{F M C_{\text {dead }, c a}}{X_{\text {dead }, c a}}(24) \cdot 143\right)\right. \\
\eta_{F M C, c a} & =\eta_{F M C, \text { live }, c a} \cdot\left(1-P_{\text {dead }, c a}\right)+\eta_{M, \text { dead }, c a} \cdot P_{\text {dead }, c a}
\end{aligned}
\]
where moisture contents of extinctions were arbitrarily set to $X_{\text {dead }, \text { ca }}=25$ and $X_{\text {live }, \text { ca }}=180$.
The reaction efficiency in the canopy ( $\eta_{\beta_{\text {canopy }}^{\prime}}$ ) represents the damping effect of inefficiently packed fuels in the canopy:
\[
\eta_{\beta_{c a n o p y}^{\prime}}=\beta_{c a n o p y}^{\prime} \cdot e^{1-\beta_{c a n o p y}^{\prime}}
\]
where $\beta_{\text {canopy }}^{\prime}$ is the relative packing ratio in the canopy:
\[
\beta_{\text {canopy }}^{\prime}=\delta_{\text {opt }, \text { canopy }} / \delta_{\text {eff,canopy }}
\]
where the effective depth is $\delta_{\text {eff,canopy }}=\delta_{c a}$ (in $f t$ ) and the optimum canopy depth is calculated using:
\[
\delta_{o p t, c a n o p y}=0.4 \cdot F A I_{c a}+\beta_{c a} \cdot\left(\delta_{c a} \cdot C_{c a} / 100\right)
\]
where $C_{c a}$ is the percent cover of the canopy, $F A I_{c a}$ is the fuel area index of the canopy, $\beta_{c a}$ is the packing ratio of canopy fuels and $\delta_{c a}$ is the canopy depth (in $f t$ ).

\subsection*{24.5.3 Canopy heat sink ( $q_{c a}$ )}

Canopy heat sink (in $B t u \cdot f t^{-3}$ ) is estimated using:
\[
q_{c a}=\frac{0.5 \cdot F A I_{c a} \cdot R T_{c a} \cdot \rho_{p, c a} \cdot \text { Qig }_{c a}}{\left(C_{c a} / 100\right) \cdot \delta_{c a}}
\]
where $C_{c a}$ is the percent cover of the canopy, $F A I_{c a}$ is the fuel area index of the canopy, $R T_{c a}=$ $\min \left(0.0028,2 / \sigma_{c a}\right)$ is the reaction thickness of the canopy stratum (in $f t$ ), $\rho_{p, c a}$ is the particle density of the canopy (in $l b \cdot f t^{-3}$ ), $\delta_{c a}$ is the canopy depth (in $f t$ ) and Qig $g_{c a}$ is the heat of pre-ignition of the canopy stratum (in $B t u \cdot l b^{-1}$ ), which is calculated as a weighted average of live and dead fuels:
\[
\begin{aligned}
\text { Qig }_{\text {live }, c a} & =250+\left(V \cdot\left(M_{\text {live }, c a} / 100\right)\right) \\
\text { Qig }_{\text {dead }, c a} & =250 \\
\text { Qig }_{c a} & =\text { Qig }_{\text {live }, c a} \cdot\left(1-P_{\text {dead }, c a}\right)+\text { Qig }_{\text {dead }, c a} \cdot P_{\text {dead }, c a}
\end{aligned}
\]
where $250 B t u / l b$ is the heat of preignition of dry cellulose and $V=1116 B t u / l b$ is the latent heat of vaporization of water.

\subsection*{24.5.4 Fireline intensity ( $I_{B, \text { crown }}$ ) and flame length ( $F L_{\text {crown }}$ )}

Byram's fireline intensity for crown fires is estimated using:
\[
I_{B, \text { crown }}=I_{R, \text { crown }} \cdot\left(R_{\text {crown }} \cdot t_{R, \text { crown }}\right)
\]
where $I_{R, \text { crown }}$ is the crown reaction intensity (i.e. the sum of canopy and surface reaction intensities), $R_{\text {crown }}$ is the rate of crown fire spread and $t_{R, \text { crown }}$ is the flame residence time, estimated as:
\[
t_{R}=192 \cdot R T_{c a}
\]
where $R T_{c a}=\min \left(0.0028,2 / \sigma_{c a}\right.$ is the reaction thickness of the canopy. As for surface fires, flame length is calculated using:
\[
F L_{\text {crown }}=0.45 \cdot\left(I_{B, \text { crown }} / 60\right)^{0.46}
\]
where 60.0 is a factor to convert from $B t u \cdot f t^{-1} \cdot$ min $^{-1}$ to $B t u \cdot f t^{-1} \cdot s^{-1}$.

\subsection*{24.6 Fire potentials}

\subsection*{24.6.1 Surface fire behavior potentials}

The surface fire behavior potential ( $S F P$; between 0 and 9 ) is an index defined as the maximum of spread potential ( $S P$ ) and flame length ( $F L$ ) potential indices (both between 0 and 9 ):
\[
S F P=\max (S P, F P)
\]

Spread potential is derived from $R$ (in $f t \cdot$ min $^{-1}$ ), and flame length potential is derived from $F L$ (in $f t$ ), both quantities being calculated at benchmark environmental conditions:
\[
\begin{aligned}
S P & =\min \left[9, R^{1 / 2}\right] \\
F P & =\min \left[9, F L^{1 / 2}\right]
\end{aligned}
\]

\subsection*{24.6.2 Crown fire behavior potentials}

The crown fire summary potential ( $C P F$ ) combines three subpotentials into a single index value between 0 and 9. It places more emphasis on crown fire initiation ( $I C$ ) and rate of spread ( $R C$ ) than to crown-to-crown transmissivity $(T C)$ :
\[
C F P=0.4286 \cdot(I C+(T C / 3)+R C)
\]
where 0.4286 is used to limit $C P F$ between 0 and 9 .
The crown fire initiation potential (IC) represents the likelihood of a surface fire torching into single or multiple trees. $I C$ is based on the work by Van Wagner. If $F A I_{c a}=0$ then $I C=0$. Otherwise it is calculated as:
\[
I C=\min \left[9,4 \cdot\left(\frac{I_{B} / 60}{I_{c}}\right)^{0.2}\right]
\]
where $I_{B}$ is the surface fireline intensity ( 60 is used to convert it to $B t u \cdot f t^{-1} \cdot s^{-1}$ ) and $I_{c}$ is Van Wagner's critical fireline intensity (Scott \& Reinhardt 2002):
\[
I_{c}=0.288894658 \cdot\left[0.01 \cdot\left(H_{\text {gap }} / 100\right) \cdot\left(460+25.9 \cdot M_{\text {live }, c a}\right)\right]^{1.5}
\]
where $M_{\text {live,ca }}$ is the moisture content of the canopy (in percent of dry weight), 0.288894658 is used to convert from $k J \cdot m^{-1} \cdot s^{-1}$ to $B t u \cdot f t^{-1} \cdot s^{-1}$ and $H_{\text {gap }}$ is the canopy gap (in cm ) determined from the analysis of the bulk density profile.

The crown-to-crown transmittivity potential ( $T C$ ) is set to zero if $F A I_{c a}<T F A I /(3 \cdot \pi)$, where $T F A I$ is a threshold for FAI calculated as:
\[
T F A I=A_{q} \cdot e^{-0.0019 \cdot U}
\]
where $A_{q}=3.2868$ if $\sigma_{c a}>2000 f t^{2} \cdot f t^{-3}$ and $A_{q}=2.6296$ otherwise. If $F A I_{c a}>T F A I /(3 \cdot \pi)$, then $T C$ is calculated as:
\[
T C=\min \left[9,10 \cdot T C_{q}\right]
\]
where $T C_{q}$ is the efficiency of crown-to-crown heat transfer, as a proportion of maximum efficiency at 100 \% canopy cover:
\[
T C_{q}=\frac{\left(\max \left(0.0, C_{c a} \cdot W A F-40\right)\right)^{0.3}}{(100 \cdot W A F-40)^{0.3}}
\]

In this last equation 40 represents the threshold of canopy cover necessary to initiate dependent crown spread, and 0.3 is a coefficient describing the assumed effect of crown cover on transmittivity at benchmark windspeed. The canopy adjustment ratio $W A F$ is added to modulate transmittivity depending on windspeed. Finally, the crown fire rate of spread potential ( $R C$ ) is defined as:
\[
R C=\min \left[9,2.5 \cdot R_{\text {crown }}^{1 / e}\right]
\]
where $R_{\text {crown }}$ is the rate of spread (in $f t \cdot \min ^{-1}$ ) of the crown fire.

\subsection*{24.7 Unit conversion of outputs}

The following factors are used to express fire behavior outputs to metric units:
- Fire spread rates: $1 \mathrm{ft} \cdot$ min $^{-1}=0.3048 \mathrm{~m} \cdot$ min $^{-1}$
- Flame length: 1 ft $=0.3048 m$
- Reaction intensity: 1 Btu $\cdot \mathrm{ft}^{-2} \cdot$ min $^{-1}=11.3484 \mathrm{~kJ} \cdot \mathrm{~m}^{-2} \cdot \mathrm{~min}^{-1}$
- Heat sink: 1 Btu $\cdot \mathrm{ft}^{-3}=37.2589458 \mathrm{~kJ} \cdot \mathrm{~m}^{-3}$
- Fireline intensity: 1 Btu $\cdot \mathrm{ft}^{-1} \cdot$ min $^{-1}=0.0576911555 \mathrm{~kW} \cdot \mathrm{~m}^{-1}$

\section*{Appendix A}

\section*{Inbuilt parameter estimation}

\section*{A. 1 Introduction}

Package medfate has been designed to allow simulations requiring a minimum set of vegetation functional parameters. This entails that several other parameters have to be estimated automatically (via inbuilt procedures) before starting simulations. Inbuilt parameter estimation is done in functions spwbInput(), growthInput(), forest2spwbInput() and forest2growthInput(), with the user controlling the process through the species parameter table input (e.g., SpParamsMED) and the object control (see default control values in defaultControl()).

\section*{A. 2 Strict, scaled and imputable parameters}

Different kinds of vegetation functional parameters can be distinguished according to whether inbuilt parameter estimation is possible and how it is conducted:
- Strictly-required parameters are those for which there are no inbuilt estimation procedures implemented in the initialization functions. Hence, either values in the species parameter table input are non-missing or suitable values need to be specified before running simulation models. Since medfate ver. 2.3, only plant/leaf classification parameters and plant size parameters are strict. The remaining ones can be estimated from other parameters. This facilitates having a functional species parameter table, because only a set of parameters have to be strictly filled, from either soft trait databases or forest inventory data.
- Scaled parameters are functional parameters that cannot be defined at the species level, because they need to be estimated taking into account the size and structure of the plant cohort. These are not normally defined at the level of species parameter table. Specific control parameters are used to determine how scaling is performed.
- Imputable parameters parameters are those for which the initialization routines can provide default values or estimations derived from relationships with other parameters. Parameter imputation is conducted if control parameter fillMissingSpParams $=$ TRUE. Sometimes, default parameter values are also specified in the control object.

The following tables describe how the different functional parameters are dealt with, grouped by function. Links are given to the chapter subsections where scaling and/or imputation procedures are described.

\section*{Plant/leaf classification}

\begin{tabular}{|l|l|l|l|l|}
\hline Symbol & R Description & Strict & Scaled & Imputable \\
\hline $G F$ & GrowthForfarowth form, defined depending on the treatment in forest inventory plots (Tree, Shrub or Tree/Shrub) & Yes & No & No \\
\hline LF & LifeForm Raunkiaer life form & Yes & No & No \\
\hline $L_{\text {shape }}$ & LeafShap\&eaf type (Linear, Needle, Broad, Scale, Spines or Succulent) & Yes & No & No \\
\hline $L_{\text {size }}$ & LeafSize Leaf size (Small, Medium, Large) & Yes & No & No \\
\hline $L_{\text {pheno }}$ & PhenologyTeypephenology type & Yes & No & No \\
\hline
\end{tabular}

\section*{Plant size}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $H_{\text {max }}$ & Hmed & Maximum plant height & Yes & No & No \\
\hline $H_{\text {med }}$ & Hmed & Median plant height & Yes & No & No \\
\hline $Z_{50}$ & Z50 & Depth above which $50 \%$ of the fine root mass is located & No & No & A.3.1 \\
\hline $Z_{95}$ & Z95 & Depth above which $95 \%$ of the fine root mass is located & Yes & No & No \\
\hline
\end{tabular}

\section*{Allometric coefficients}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $a_{a s h}, b_{a s h}$ & a_ash, b_ash & Coefficients relating the square of shrub height with shrub area & No & No & A.3.2 \\
\hline $a_{b s h}, b_{b s h}$ & a_bsh, b_bsh & Coefficients relating crown volume with dry weight of shrub individuals & No & No & A.3.2 \\
\hline cr & cr & Ratio between crown length and total height for shrubs & No & No & A.3.2 \\
\hline $a_{f b t}, b_{f b t}$, $c_{f b t}$ & a_fbt, b_fbt, c_fbt & Coefficients to calculate foliar biomass of an individual tree & No & No & A.3.3 \\
\hline $a_{c r}, b_{1 c r}$, $b_{2 c r}, b_{3 c r}$, $c_{1 c r}, c_{2 c r}$ & b_1cr, & Coefficients to calculate crown ratio of trees & No & No & A.3.3 \\
\hline $a_{c w}, b_{c w}$ & a_cw, b_cw & Regression coefficients used to calculate the crown width of trees & No & No & A.3.3 \\
\hline $f_{H D, \text { min }}$ & fHDmin & Minimum height-to-diameter ratio & No & No & A.3.3 \\
\hline $f_{H D, \max }$ & fHDmax & Maximum height-to-diameter ratio & No & No & A.3.3 \\
\hline
\end{tabular}

\section*{Leaf phenology}

\begin{tabular}{llcccc}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline$L D$ & LeafDuratlinomage duration of leaves & No & No & A.3.9 \\
$t_{0, e c o}$ & t0gdd & Degree days corresponding to leaf budburst & No & No & A.3.9 \\
$S_{\text {eco }}^{*}$ & Sgdd & Degree days corresponding to leaf budburst & No & No & A.3.9
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $T_{\text {eco }}$ & Tbgdd & Base temperature for the calculation of degree days to leaf budburst & No & No & A.3.9 \\
\hline $S_{\text {sen }}^{*}$ & Ssen & Degree days corresponding to leaf senescence & No & No & A.3.9 \\
\hline $P h_{\text {sen }}$ & Phsen & Photoperiod corresponding to start counting senescence degree-days & No & No & A.3.9 \\
\hline $T_{\text {sen }}$ & Tbsen & Base temperature for the calculation of degree days to leaf senescence & No & No & A.3.9 \\
\hline $x_{\text {sen }}$ & xsen & Discrete values, to allow for any absent/proportional/more than proportional effects of temperature on senescence & No & No & A.3.9 \\
\hline $y_{\text {sen }}$ & ysen & Discrete values, to allow for any absent/proportional/more than proportional effects of photoperiod on senescence & No & No & A.3.9 \\
\hline
\end{tabular}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Plant anatomy}
\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $1 / H_{v}$ & Al2As & Ratio of leaf area to sapwood area & No & No & A.3.7 \\
\hline RLR & Ar2Al & Fine root area to leaf area ratio & No & No & A.3.8 \\
\hline $L W$ & \multicolumn{2}{|l|}{LeafWidtHeaf width} & No & No & A.3.4 \\
\hline SLA & SLA & Specific leaf area & No & No & A.3.4 \\
\hline $\rho_{\text {leaf }}$ & \multicolumn{2}{|l|}{LeafDensitegaf tissue density} & No & No & A.3.5 \\
\hline $\rho_{\text {wood }}$ & \multicolumn{2}{|l|}{WoodDensiltyod tissue density} & No & No & A.3.5 \\
\hline $\rho_{\text {fineroot }}$ & \multicolumn{2}{|l|}{FineRootIlènsittyot tissue density} & No & No & A.3.5 \\
\hline $f_{\text {conduits }}$ & \multicolumn{2}{|l|}{conduit2 Sapprowdion of sapwood corresponding to xylem conduits} & No & No & A.3.7 \\
\hline $S R L$ & SRL & Specific fine root length & No & No & A.3.6 \\
\hline RLD & RLD & Fine root length density & No & No & A.3.6 \\
\hline $r_{6.35}$ & r635 & Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm & No & No & A.3.4 \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Radiation balance and water interception}
\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $k_{b}$ & kDIR & Direct light extinction coefficient & No & No & A.3.11 \\
\hline $k_{P A R}$ & kPAR & PAR extinction coefficient & No & No & A.3.11 \\
\hline $\alpha_{S W R}$ & & alphaSWR Short-wave radiation leaf absorbance coefficient & No & No & A.3.11 \\
\hline $\gamma_{S W R}$ & & gammaSWR Short-wave radiation leaf reflectance (albedo) & No & No & A.3.11 \\
\hline $s_{\text {water }}$ & g & Crown water storage capacity & No & No & A.3.11 \\
\hline
\end{tabular}
\end{table}

\section*{Hydraulics, transpiration, photosynthesis}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $T_{\text {max }, \text { LAI }}$ & & Tmax_LAI Empirical coefficient relating LAI with the ratio of maximum transpiration over potential evapotranspiration & No & No & A.3.10 \\
\hline $T_{\text {max }, \text { sqLAI }}$ & & Tmax_LAI\$qmpirical coefficient relating squared LAI with the ratio of maximum transpiration over potential evapotranspiration & No & No & A.3.10 \\
\hline $W U E_{\max }$ & WUE & Water use efficiency at VPD $=1 \mathrm{kPa}$ and without light or CO2 limitations & No & No & A.3.10 \\
\hline $W U E_{P A R}$ & & WUE_par Coefficient describing the progressive decay of WUE with lower light levels & No & No & A.3.10 \\
\hline $W U E_{C O 2}$ & WUE_co2 & Coefficient for WUE dependency on atmospheric CO2 concentration & No & No & A.3.10 \\
\hline $W U E_{V P D}$ & WUE_vpd & Coefficient for WUE dependency on vapor pressure deficit & No & No & A.3.10 \\
\hline $\Psi_{\text {extract }}$ & & Psi_Extrallte water potential at which plant transpiration is $50 \%$ of its maximum & No & No & A.3.10 \\
\hline $\Psi_{\text {critic }}$ & & Psi_Critiche water potential corresponding to $50 \%$ of stem xylem cavitation & No & No & A.3.16 \\
\hline $g_{\text {swmin }}$ & Gwmin & Minimum stomatal conductance to water vapour & No & No & A.3.12 \\
\hline $g_{\text {swmax }}$ & Gwmax & Maximum stomatal conductance to water vapour & No & No & A.3.12 \\
\hline $J_{\text {max }, 298}$ & Jmax298 & Maximum rate of electron transport at 298 K & No & No & A.3.17 \\
\hline $V_{\text {max }, 298}$ & Vmax298 & Rubisco's maximum carboxylation rate at 298 K & No & No & A.3.17 \\
\hline $K_{\text {stem,max,re }}$ & conductivity per leaf area unit & Ymax_stemfy diemum stem sapwood reference & No & No & A.3.14 \\
\hline $K_{\text {root,max,re }}$ & \multicolumn{2}{|l|}{JKmax_roothymamum root sapwood reference} & No & No & A.3.14 \\
\hline $k_{\text {leaf,max }}$ & \multicolumn{2}{|l|}{VCleaf_kmalxximum leaf hydraulic conductance} & No & A.4.2 & A.3.15 \\
\hline $k_{\text {stem,max }}$ & VCstem & kmaxximum stem hydraulic conductance & No & A.4.1 & No \\
\hline $k_{\text {root }, \text { max }, s}$ & VCroot_k & each soil layer & No & A.4.3 & No \\
\hline $k_{\text {rhizo,max,s }}$ & VGrhizo_ & rhizosphere for each soil layer & No & A.4.4 & No \\
\hline $c_{\text {leaf }}$, $d_{\text {leaf }}$ & \multicolumn{2}{|l|}{VCleaf_d leaves} & No & No & A.3.16 \\
\hline $c_{\text {stem }}$, & \multicolumn{2}{|l|}{VCstem_c,Parameters of the vulnerability curve for} & No & No & A.3.16 \\
\hline $d_{\text {stem }}$ & \multicolumn{2}{|l|}{VCstem_dstem xylem} & & & \\
\hline $c_{\text {root }}$, & \multicolumn{2}{|l|}{VCroot_c,Parameters of the vulnerability curve for} & No & No & A.3.16 \\
\hline $d_{\text {root }}$ & \multicolumn{2}{|l|}{VCroot_d root xylem} & & & \\
\hline
\end{tabular}

\section*{Plant water storage}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $\epsilon_{\text {leaf }}$ & LeafEPS & Modulus of elasticity of leaves & No & No & A.3.13 \\
\hline $\epsilon_{\text {stem }}$ & StemEPS & Modulus of elasticity of symplastic xylem tissue & No & No & A.3.13 \\
\hline $\pi_{0, \text { leaf }}$ & LeafPI0 & Osmotic potential at full turgor of leaves & No & No & A.3.13 \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $\pi_{0, \text { stem }}$ & StemPI0 & Osmotic potential at full turgor of symplastic xylem tissue & No & No & A.3.13 \\
\hline $f_{\text {apo,leaf }}$ & LeafAF & Apoplastic fraction in leaf tissues & No & No & A.3.13 \\
\hline $f_{\text {apo }, \text { stem }}$ & StemAF & Apoplastic fraction in stem tissues & No & No & A.3.13 \\
\hline $V_{\text {leaf }}$ & Vleaf & Leaf water capacity per leaf area unit & No & A.4.5 & No \\
\hline $V_{\text {sapwood }}$ & Vsapwood & Sapwood water capacity per leaf area unit & No & A.4.5 & No \\
\hline
\end{tabular}

\section*{Growth and mortality}

\begin{tabular}{|l|l|l|l|l|}
\hline Symbol & R Description & Strict & Scaled & Imputable \\
\hline $N_{\text {leaf }}$ & Nleaf Leaf nitrogen concentration per dry mass & No & No & A.3.18 \\
\hline $N_{\text {sapwood }}$ & Nsapwood Sapwood nitrogen concentration per dry mass & No & No & A.3.18 \\
\hline $N_{\text {fineroot }}$ & Nfinerootine root nitrogen concentration per dry mass & No & No & A.3.18 \\
\hline $M R_{\text {leaf }}$ & RERleaf Leaf respiration rate at $20^{\circ} \mathrm{C}$ & No & No & A.3.18 \\
\hline $M R_{\text {sapwood }}$ & RERsapwoddving sapwood (parenchymatic tissue) respiration rate at $20^{\circ} \mathrm{C}$ & No & No & A.3.18 \\
\hline $M R_{\text {fineroot }}$ & RERfinerdatine root respiration rate at $20{ }^{\circ} \mathrm{C}$ & No & No & A.3.18 \\
\hline $R G R_{\text {leaf }, \text { max }}$ & RGRleafmalyaximum leaf area daily growth rate, relative to sapwood area & No & No & A.3.19 \\
\hline $R G R_{\text {cambium }}$ & RGRsapwoddmaximum tree daily sapwood growth rate relative to cambium perimeter length & No & No & A.3.19 \\
\hline $R G R_{\text {sapwood }}$ & RGRsapwoddmaimum shrub daily sapwood growth rate relative to sapwood area & No & No & A.3.19 \\
\hline $R G R_{\text {fineroot }}$ & RGRfinerddamax daily fine root relative growth rate & No & No & A.3.19 \\
\hline $S R_{\text {sapwood }}$ & SRsapwoodaily sapwood senescence rate & No & No & A.3.20 \\
\hline $S R_{\text {fineroot }}$ & SRfinerodtaily fine root senescence rate & No & No & A.3.20 \\
\hline RSSG & RSSG & No & No & A.3.21 \\
\hline $C_{\text {wood }}$ & WoodC Wood carbon content per dry weight & No & No & A.3.22 \\
\hline $P_{\text {mort,base }}$ & MortalityBafaellinleBantrainistic proportion or probability specifying the baseline reduction of cohort's density occurring in a year & No & No & A.3.23 \\
\hline
\end{tabular}

\section*{Recruitment}

\begin{tabular}{|l|l|l|l|l|}
\hline Symbol & R Description & Strict & Scaled & Imputable \\
\hline $H_{\text {seed }}$ & SeedProduldtriiommenighitght for seed production & No & No & A.3.24 \\
\hline $T C M_{\text {recr }}$ & MinTempReldinimum average temperature (Celsius) of the coldest month for successful recruitment & No & No & A.3.24 \\
\hline $M I_{\text {recr }}$ & MinMoistudferiencum value of the moisture index for successful recruitment & No & No & A.3.24 \\
\hline $F P A R_{\text {recr }}$ & MinFPARReldinimum percentage of PAR at the ground level for successful recruitment & No & No & A.3.24 \\
\hline $D B H_{\text {recr }}$ & RecrTreeIBeruitment DBH for trees & No & No & A.3.24 \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $H_{\text {tree,recr }}$ & & RecrTreeHeaighnttment height for trees & No & No & A.3.24 \\
\hline $N_{\text {tree,recr }}$ & & RecrTreeDemsittyment density for trees & No & No & A.3.24 \\
\hline Cover $_{\text {shrub }}$, & & RecrShrubCloareritment cover for shrubs & No & No & A.3.24 \\
\hline $H_{\text {shrub,recr }}$ & & RecrShrubllecighttment height for shrubs & No & No & A.3.24 \\
\hline $Z 50_{\text {recr }}$ & RecrZ50 & Soil depth corresponding to $50 \%$ of fine roots for recruitment & No & No & A.3.24 \\
\hline $Z 95_{\text {recr }}$ & RecrZ95 & Soil depth corresponding to $95 \%$ of fine roots for recruitment & No & No & A.3.24 \\
\hline
\end{tabular}

\section*{Flammability}

\begin{tabular}{|l|l|l|l|l|l|}
\hline Symbol & R & Description & Strict & Scaled & Imputable \\
\hline $\rho_{p}$ & PD & Density of fuel particles & No & No & A.3.25 \\
\hline $\sigma$ & SAV & Surface-area-to-volume ratio of the small fuel (1h) fraction (leaves and branches < 6.35 mm ) & No & No & A.3.25 \\
\hline $h$ & & HeatCont@hity fuel heat content. & No & No & A.3.25 \\
\hline LI & & PercentLignimentage of lignin in leaves & No & No & A.3.25 \\
\hline
\end{tabular}

\section*{A. 3 Imputation of missing values}

The following figure summarizes the percentage of missing values in SpParamsMED for different model parameters and the other model parameters used for the imputation of missing values:

\section*{A.3.1 Rooting depth}

Parameter $Z_{95}$ is a strict parameter, but $Z_{50}$ can be imputated when missing, using the following formula:
\[
Z_{50}=\exp \left(\log \left(Z_{95}\right) / 1.4\right)
\]

\section*{A.3.2 Shrub allometric coefficients}

Missing shrub allometric coefficients are filled using information from Raunkiaer's life form and maximum plant height ( $H_{\text {max }}$ ).

\begin{tabular}{|l|l|l|l|l|l|l|}
\hline Life form & $H_{\text {max }}$ & $a_{a s h}$ & $b_{\text {ash }}$ & $a_{b s h}$ & $b_{b s h}$ & cr \\
\hline Chamaephyte & [any] & 24.5888 & 1.1662 & 0.7963 & 0.3762 & 0.8076 \\
\hline Phanerophyte & $<300 \mathrm{~cm}$ & 1.0083 & 1.8700 & 0.7900 & 0.6942 & 0.6630 \\
\hline Phanerophyte & $>300 \mathrm{~cm}$ & 5.8458 & 1.4944 & 0.3596 & 0.7138 & 0.7190 \\
\hline (Hemi)cryptophyte & [any] & 24.5888 & 1.1662 & 0.7963 & 0.3762 & 0.9500 \\
\hline
\end{tabular}

Allometric coefficients were taken from De Cáceres et al. (2019).

\begin{figure}
\includegraphics[width=\textwidth]{https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-263.jpg?height=1207&width=1643&top_left_y=710&top_left_x=241}
\captionsetup{labelformat=empty}
\caption{Figure A.1: Representation of imputation relationships between model parameters. The percentage of missing parameter values increases from left to right. Left-most parameters are strict.}
\end{figure}

\section*{A.3.3 Tree allometric coefficients}

Missing tree allometric coefficients are replaced with values depending on whether the plant species is a gymnosperm or an angiosperm:

\begin{tabular}{|l|l|l|}
\hline Parameter & Gymnosperm & Angiosperm \\
\hline $a_{f b t}$ & 0.1300 & 0.0527 \\
\hline $b_{\text {fbt }}$ & 1.2285 & 1.5782 \\
\hline $c_{\text {fbt }}$ & -0.0147 & -0.0066 \\
\hline $a_{c w}$ & 0.747 & 0.839 \\
\hline $b_{c w}$ & 0.672 & 0.735 \\
\hline $a_{c r}$ & 1.995 & 1.506 \\
\hline $b_{1 c r}$ & -0.649 & -0.706 \\
\hline $b_{2 c r}$ & -0.020 & -0.078 \\
\hline $b_{3 c r}$ & -0.00012 & 0.00018 \\
\hline $c_{1 c r}$ & -0.004 & -0.007 \\
\hline $c_{2 c r}$ & -0.159 & 0.000 \\
\hline $f H D_{\text {min }}$ & 80 & 40 \\
\hline $f H D_{\text {max }}$ & 120 & 140 \\
\hline
\end{tabular}

\section*{A.3.4 Leaf width, specific leaf area and fine foliar ratio}

Leaf width ( $L W$ ), specific leaf area ( $S L A$ ) and the ratio between the weight of leaves plus branches and the weight of leaves alone for branches of $6.35 \mathrm{~mm}\left(r_{6.35}\right)$ are key anatomical parameters. When missing from species parameter table, default estimates for these parameters are obtained from combinations of leaf shape and leaf size:

\begin{tabular}{lcccc}
\hline Leaf shape & Leaf size & $S L A$ & $L W$ & $r_{6.35}$ \\
\hline Broad & Large & 16.039 & 6.898 & 2.278 \\
Broad & Medium & 11.499 & 3.054 & 2.359 \\
Broad & Small & 9.540 & 0.644 & 3.026 \\
Linear & Large & 5.522 & 0.639 & 3.261 \\
Linear & Medium & 4.144 & 0.639 & 3.261 \\
Linear & Small & 13.189 & 0.639 & 3.261 \\
Needle & [any] & 9.024 & 0.379 & 1.716 \\
Scale & [any] & 4.544 & 0.101 & 1.483 \\
\hline
\end{tabular}

These estimates have been obtained by averaging species-level values across combinations of the categorical variables.

\section*{A.3.5 Tissue density}

Default values for the dry weight density of leaves and wood (in $g \cdot \mathrm{~cm}^{-3}$ ) are determined from taxonomic family using an internal data set (medfate:: :trait_family_means):

If the family is not any of those in the table, default values are $\rho_{\text {leaf }}=0.7$ and $\rho_{\text {wood }}=0.652$. The default value for fine root density is always $\rho_{\text {fineroot }}=0.165$.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.15: Default leaf density and wood density values by taxonomic family.}
\begin{tabular}{|l|l|l|}
\hline & LeafDensity & WoodDensity \\
\hline Acanthaceae & 0.2959003 & 0.5684693 \\
\hline Achariaceae & 0.2552495 & 0.6052036 \\
\hline Acoraceae & 0.1000000 & NA \\
\hline Actinidiaceae & 0.4439776 & 0.4092320 \\
\hline Adoxaceae & 0.3916194 & 0.5157416 \\
\hline Aextoxicaceae & NA & 0.5666667 \\
\hline Aizoaceae & 0.0824125 & NA \\
\hline Akaniaceae & NA & 0.5547825 \\
\hline Alismataceae & 0.1914208 & NA \\
\hline Altingiaceae & 0.6833971 & 0.6010948 \\
\hline Amaranthaceae & 0.2045831 & 0.6315739 \\
\hline Amaryllidaceae & 0.1220704 & NA \\
\hline Amphorogynaceae & NA & 0.6097400 \\
\hline Anacardiaceae & 0.4568088 & 0.5685583 \\
\hline Anisophylleaceae & NA & 0.6734780 \\
\hline Annonaceae & 0.3757811 & 0.5642062 \\
\hline Aphloiaceae & 0.4627060 & 0.6205200 \\
\hline Apiaceae & 0.2874756 & 0.2561785 \\
\hline Apocynaceae & 0.2981148 & 0.5683635 \\
\hline Aptandraceae & 0.3318492 & 0.7076756 \\
\hline Aquifoliaceae & 0.4812626 & 0.5579305 \\
\hline Araceae & 0.1659746 & NA \\
\hline Araliaceae & 0.3118821 & 0.4142687 \\
\hline Araucariaceae & 0.3447902 & 0.4641456 \\
\hline Arecaceae & 0.4393589 & 0.5913967 \\
\hline Aristolochiaceae & 0.2681434 & 0.2900000 \\
\hline Asparagaceae & 0.1425099 & 0.4254258 \\
\hline Asphodelaceae & 0.5512472 & 0.3951990 \\
\hline Aspleniaceae & 0.2644557 & NA \\
\hline Asteraceae & 0.2511093 & 0.4822337 \\
\hline Asteropeiaceae & NA & 0.7554862 \\
\hline Atherospermataceae & 0.2451357 & 0.4767621 \\
\hline Athyriaceae & 0.2270615 & NA \\
\hline Austrobaileyaceae & 0.2620992 & NA \\
\hline Balanopaceae & NA & 0.7348976 \\
\hline Balsaminaceae & 0.3948094 & NA \\
\hline Begoniaceae & 0.1626789 & NA \\
\hline Berberidaceae & 0.3599453 & 0.7028850 \\
\hline Betulaceae & 0.4446528 & 0.5381493 \\
\hline Bignoniaceae & 0.3572590 & 0.6256030 \\
\hline Bixaceae & 0.4400000 & 0.3546357 \\
\hline Blechnaceae & 0.3147993 & NA \\
\hline Bonnetiaceae & 0.2797829 & 0.8400000 \\
\hline Boraginaceae & 0.2850462 & 0.4987559 \\
\hline Brassicaceae & 0.2267605 & 0.4516377 \\
\hline Bromeliaceae & 0.1677139 & NA \\
\hline Brunelliaceae & NA & 0.3112500 \\
\hline Bruniaceae & NA & 0.5636500 \\
\hline Burseraceae & 0.4226787 & 0.5205008 \\
\hline Buxaceae & 0.2706294 & 0.7314511 \\
\hline Cactaceae & 0.1819372 & 0.6187500 \\
\hline Calophyllaceae & 0.4065092 & 0.6067855 \\
\hline Calycanthaceae & 0.3204073 & 0.6500550 \\
\hline Calyceraceae & 0.1689366 & NA \\
\hline Campanulaceae & 0.2396318 & NA \\
\hline
\end{tabular}
\end{table}

\section*{A.3.6 Specific root length and root length density}

Default values for specific fine root length and fine root length density are $3870 \mathrm{~cm} \cdot g^{-1}$ and $10 \mathrm{~cm} \cdot \mathrm{~cm}^{-3}$, respectively. [JUSTIFICATION MISSING]

\section*{A.3.7 Huber value and ratio of conduits to sapwood}

Missing values for A12As, the inverse of the Huber value $(1 / H v)$ are determined from taxonomic family using an internal data set (medfate:: :trait_family_means):

If there is no information derived from taxonomic family for Al2As, a default value is given depending on leaf shape and leaf size:

\begin{tabular}{lcc}
\hline Leaf shape & Leaf size & A12As \\
\hline Broad & Large & 4768.7 \\
Broad & Medium & 2446.1 \\
Broad & Small & 2284.9 \\
Linear & Large & 2156.0 \\
Linear & Medium & 2156.0 \\
Linear & Small & 2156.0 \\
Needle & [any] & 2751.7 \\
Scale & [any] & 1696.6 \\
\hline
\end{tabular}

Missing values for $f_{\text {conduits }}$, the fraction of sapwood corresponding to conduits are derived from taxonomic family (see table above). If information from taxonomic family is missing, default values are $f_{\text {conduits }}=0.7$ (i.e. $30 \%$ of parenchyma) for angiosperms, and $f_{\text {conduits }}=0.925$ (i.e. $7.5 \%$ of parenchyma) for gymnosperms (Plavcová \& Jansen 2015).

\section*{A.3.8 Fine root to leaf area ratio}

When missing, the fine root area to leaf area ratio is given a default value of $R L R=1 \mathrm{~m}^{2} \cdot \mathrm{~m}^{-2}$.

\section*{A.3.9 Leaf phenology}

When missing, leaf duration is assigned a value of 1 year for winter-deciduous species and 2.41 years for the remaining leaf phenology types.

Default values for leaf phenological parameters are the same regardless of the leaf phenology type:

\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline Phenology type & t0gdd & Sgdd & Tbgdd & Ssen & Phsen & Tbsen & xsen & ysen \\
\hline One-flush evergreen & 50 & 200 & 0 & 8268 & 12.5 & 28.5 & 2 & 2 \\
\hline Winter deciduous & 50 & 200 & 0 & 8268 & 12.5 & 28.5 & 2 & 2 \\
\hline Winter semi-deciduous & 50 & 200 & 0 & 8268 & 12.5 & 28.5 & 2 & 2 \\
\hline Drought deciduous & 50 & 200 & 0 & 8268 & 12.5 & 28.5 & 2 & 2 \\
\hline
\end{tabular}

Leaf senescence values were derived for deciduous broad-leaved forests by Delpierre et al. (2009).

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.16: Default leaf area to sapwood area (m2/m2) / Huber value (cm2/m2) and fraction of sapwood corresponding to conduits by taxonomic family.}
\begin{tabular}{|l|l|l|l|}
\hline & Al2As & Hv & conduit2sapwood \\
\hline Acanthaceae & 3070.43202 & 3.2568707 & 0.6300000 \\
\hline Adoxaceae & 4889.57295 & 2.0451684 & NA \\
\hline Altingiaceae & 5129.90090 & 1.9493554 & 0.8226667 \\
\hline Amaranthaceae & 973.13500 & 10.2760665 & NA \\
\hline Amborellaceae & 4255.31915 & 2.3500000 & NA \\
\hline Anacardiaceae & 19581.70525 & 0.5106808 & 0.7155889 \\
\hline Annonaceae & 10266.65654 & 0.9740269 & 0.5685000 \\
\hline Apiaceae & 81.15013 & 123.2283950 & NA \\
\hline Apocynaceae & 19766.80134 & 0.5058987 & 0.7112500 \\
\hline Aquifoliaceae & 4886.36183 & 2.0465124 & 0.6528500 \\
\hline Araliaceae & 3928.39877 & 2.5455664 & 0.7785000 \\
\hline Araucariaceae & 3846.15385 & 2.6000000 & 0.9375000 \\
\hline Arecaceae & 5492.53731 & 1.8206522 & NA \\
\hline Asteraceae & 2421.76507 & 4.1292197 & 0.7219423 \\
\hline Atherospermataceae & 2435.95630 & 4.1051640 & 0.7560000 \\
\hline Austrobaileyaceae & 15384.61538 & 0.6500000 & NA \\
\hline Berberidaceae & 570.06271 & 17.5419298 & NA \\
\hline Betulaceae & 6158.73417 & 1.6237103 & 0.8444000 \\
\hline Bignoniaceae & 12439.80827 & 0.8038709 & 0.6360476 \\
\hline Bixaceae & 12274.01424 & 0.8147294 & NA \\
\hline Burseraceae & 12218.54705 & 0.8184279 & 0.8204286 \\
\hline Buxaceae & NA & NA & 0.8330000 \\
\hline Cactaceae & 2554.61304 & 3.9144872 & 0.3636905 \\
\hline Calophyllaceae & 2662.52127 & 3.7558385 & 0.7335000 \\
\hline Calycanthaceae & NA & NA & 0.6535500 \\
\hline Cannabaceae & 29406.04715 & 0.3400661 & 0.7598125 \\
\hline Capparaceae & 37525.87992 & 0.2664828 & 0.7005000 \\
\hline Caprifoliaceae & 7568.54261 & 1.3212583 & NA \\
\hline Cardiopteridaceae & NA & NA & 0.6300000 \\
\hline Caryocaraceae & 5183.13611 & 1.9293339 & NA \\
\hline Casuarinaceae & 3647.15784 & 2.7418610 & NA \\
\hline Celastraceae & 8199.20056 & 1.2196311 & NA \\
\hline Chrysobalanaceae & 10531.83851 & 0.9495018 & 0.5876000 \\
\hline Cistaceae & 2129.37624 & 4.6962109 & NA \\
\hline Clusiaceae & 6707.44573 & 1.4908805 & 0.5005000 \\
\hline Cochlospermaceae & 1757.46925 & 5.6900000 & 0.7070000 \\
\hline Combretaceae & 23650.62103 & 0.4228219 & 0.6416667 \\
\hline Cordiaceae & 10754.86431 & 0.9298118 & 0.6300000 \\
\hline Cornaceae & 7478.58356 & 1.3371516 & 0.6740000 \\
\hline Coulaceae & 10676.38668 & 0.9366465 & 0.6520000 \\
\hline Cunoniaceae & 4781.22975 & 2.0915121 & 0.7110000 \\
\hline Cupressaceae & 1793.78915 & 5.5747912 & 0.9242857 \\
\hline Dichapetalaceae & 7505.55229 & 1.3323470 & NA \\
\hline Dilleniaceae & 7707.14493 & 1.2974973 & 0.5432500 \\
\hline Dipterocarpaceae & NA & NA & 0.7043750 \\
\hline Ebenaceae & 5746.58263 & 1.7401647 & 0.6300000 \\
\hline Ehretiaceae & 3401.36054 & 2.9400000 & NA \\
\hline Elaeagnaceae & NA & NA & 0.5641000 \\
\hline Elaeocarpaceae & 8949.89085 & 1.1173321 & 0.6970000 \\
\hline Ericaceae & 2717.89086 & 3.6793236 & 0.7423400 \\
\hline Erythropalaceae & 11359.73085 & 0.8803025 & NA \\
\hline Erythroxylaceae & 16409.39633 & 0.6094069 & NA \\
\hline Escalloniaceae & NA & NA & 0.5755000 \\
\hline Euphorbiaceae & 9648.31966 & 1.0364499 & 0.6630417 \\
\hline
\end{tabular}
\end{table}

\section*{A.3.10 Basic transpiration and water-use efficiency}

When the basic soil water balance model is used, $T_{\text {max }, \text { LAI }}$ and $T_{\text {max }, \text { sqLAI }}$ are species-specific parameters that regulate the maximum transpiration of plant cohorts (see 6.1.1). When these parameters are missing from SpParams table, they are given default values $T_{\text {max }, L A I}=0.134$ and $T_{\text {max }, s q L A I}=-0.006$, according to Granier et al. (1999).

When maximum water use efficiency ( $W U E_{\max }$ ) is missing, it is given a value of $W U E_{\max }=7.55$. By default, the coefficient describing the decay of water use efficiency with lower light levels is given a default value of $W U E_{P A R}=0.2812$, and the coefficient regulating the relationship between gross photosynthesis and CO 2 concentration is given a default $W U E_{C O 2}=0.0028$.

When missing, the water potential corresponding to $50 \%$ of transpiration ( $\Psi_{\text {extract }}$ ) is estimated by calculating the water potential corresponding to the loss leaf turgor ( $\Psi_{\text {tlp }}$ ), using equation ( 10.10 ) from Bartlett et al. (2012). The parameters of the leaf pressure-volume curve needed for applying equation (10.10) may be themselves estimated (see A.3.13). Note that $\Psi_{t l p}$ has been found to be highly correlated to $\Psi_{g s 50}$, the water potential corresponding to $50 \%$ of stomatal conductance (Bartlett et al. 2016).

\section*{A.3.11 Radiation balance and water interception}

Default value for direct light extinction is $k_{b}=0.8$. Default values for diffuse radiation extinction, absorbance, reflectance and water interception parameters depend on the leaf shape:

\begin{tabular}{lcccc}
\hline Leaf shape & $k_{P A R}$ & $\alpha_{S W R}$ & $\gamma_{S W R}$ & $s_{\text {water }}$ \\
\hline Broad & 0.55 & 0.70 & 0.18 & 0.5 \\
Linear & 0.45 & 0.70 & 0.15 & 0.8 \\
Needle/Scale & 0.50 & 0.70 & 0.14 & 1.0 \\
\hline
\end{tabular}
where $k_{P A R}$ is the diffuse PAR extinction coefficient, $\alpha_{S W R}$ is the short-wave radiation leaf absorbance coefficient, $\gamma_{S W R}$ is the short-wave radiation leaf reflectance (albedo) and $s_{\text {water }}$ is the crown water storage capacity per LAI unit.

\section*{A.3.12 Stomatal conductance}

Default values for minimum and maximum conductance to water vapour ( $g_{\text {swmin }}$ and $g_{\text {swmax }}$; in mol $\mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ ) were defined depending on taxonomic family, from Duursma et al. (2018) and Hoshika et al. (2018), and stored in an internal data set (medfate:: :trait_family_means):

If there is no information derived from taxonomic family, $g_{\text {swmin }}=0.0049$ and $g_{\text {swmax }}=0.200$.

\section*{A.3.13 Pressure-volume curves}

Parameters of the pressure-volume curve (i.e. $\pi_{0, \text { stem }}$ and $\epsilon_{\text {stem }}$ ) for leaf and stem symplastic tissue are required for each species.

When parameters for stem tissue are missing, medfate estimates them from wood density following Christoffersen et al. (2016):
\[
\begin{gathered}
\pi_{0, \text { stem }}=0.52-4.16 \cdot \rho_{\text {wood }} \\
\epsilon_{\text {stem }}=\sqrt{1.02 \cdot e^{8.5 \cdot \rho_{\text {wood }}-2.89}}
\end{gathered}
\]
while the apoplastic fraction of stem is assumed $f_{\text {apo,stem }}=f_{\text {conduits }}$ (see A.3.7).

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.20: Default minimum and maximum conductance to water vapour by taxonomic family.}
\begin{tabular}{|l|l|l|}
\hline & Gswmin & Gswmax \\
\hline Acanthaceae & NA & 0.2500000 \\
\hline Altingiaceae & NA & 0.5000000 \\
\hline Amaranthaceae & NA & 0.0750000 \\
\hline Amaryllidaceae & 0.0180400 & NA \\
\hline Anacardiaceae & 0.0122299 & 0.3148333 \\
\hline Apiaceae & 0.0015873 & NA \\
\hline Aquifoliaceae & 0.0005740 & 0.2600000 \\
\hline Araliaceae & 0.0003902 & NA \\
\hline Araucariaceae & 0.0018786 & NA \\
\hline Arecaceae & 0.0004500 & NA \\
\hline Aristolochiaceae & 0.0035896 & NA \\
\hline Aspleniaceae & 0.0082000 & NA \\
\hline Asteraceae & 0.0105288 & 0.1275000 \\
\hline Balsaminaceae & 0.0126573 & NA \\
\hline Berberidaceae & 0.0016500 & NA \\
\hline Betulaceae & 0.0029731 & 0.3965000 \\
\hline Boraginaceae & 0.0057402 & NA \\
\hline Brassicaceae & 0.0106600 & NA \\
\hline Cactaceae & 0.0000243 & NA \\
\hline Calophyllaceae & NA & 0.1350000 \\
\hline Cannabaceae & NA & 0.3300000 \\
\hline Caryophyllaceae & 0.0018519 & NA \\
\hline Cephalotaxaceae & 0.0022700 & NA \\
\hline Cercidiphyllaceae & NA & 0.4000000 \\
\hline Chrysobalanaceae & NA & 0.1740000 \\
\hline Cistaceae & 0.0082820 & NA \\
\hline Clethraceae & NA & 0.2500000 \\
\hline Combretaceae & 0.0131200 & NA \\
\hline Convolvulaceae & 0.0041967 & NA \\
\hline Cordiaceae & 0.0065600 & NA \\
\hline Cornaceae & NA & 0.3000000 \\
\hline Crassulaceae & 0.0022751 & NA \\
\hline Cupressaceae & 0.0063192 & 0.0840000 \\
\hline Cyperaceae & 0.0190600 & NA \\
\hline Dipterocarpaceae & NA & 0.3874722 \\
\hline Ehretiaceae & NA & 0.2900000 \\
\hline Elaeagnaceae & NA & 0.1700000 \\
\hline Ericaceae & 0.0041455 & 0.1723333 \\
\hline Euphorbiaceae & 0.0026500 & 0.2616667 \\
\hline Fabaceae & 0.0085178 & 0.3066667 \\
\hline Fagaceae & 0.0060137 & 0.3127601 \\
\hline Geraniaceae & 0.0043050 & NA \\
\hline Hamamelidaceae & NA & 0.2600000 \\
\hline Juglandaceae & 0.0039355 & 0.4900000 \\
\hline Krameriaceae & NA & 0.1600000 \\
\hline Lamiaceae & 0.0052377 & 0.7300000 \\
\hline Lauraceae & NA & 0.2212500 \\
\hline Magnoliaceae & 0.0038800 & 0.3075000 \\
\hline Malvaceae & 0.0064056 & 0.5532500 \\
\hline Meliaceae & NA & 0.1600000 \\
\hline Moraceae & 0.0064020 & 0.3835000 \\
\hline Myristicaceae & NA & 0.0880000 \\
\hline Myrtaceae & 0.0078149 & 0.2310769 \\
\hline Oleaceae & 0.0046740 & NA \\
\hline Onagraceae & 0.0169506 & NA \\
\hline
\end{tabular}
\end{table}

Default values for leaf pressure-volume parameters, i.e. $\pi_{0, \text { leaf }}, \epsilon_{\text {leaf }}$ and $f_{\text {apo,leaf }}$, are determined from taxonomic family using an internal data set (medfate:: :trait_family_means):

If family-level values are missing, following Bartlett et al. (2012) average values for Mediterranean climate leaves are taken as defaults, i.e. $\pi_{0, \text { leaf }}=-2 \mathrm{MPa}, \epsilon_{\text {leaf }}=17$, whereas a $29 \%$ leaf apoplastic fraction is assumed (i.e. $f_{\text {apo,leaf }}=0.29$ ).

\section*{A.3.14 Stem and root maximum hydraulic conductivity}

Tissue-level maximum conductivity parameters (i.e. $K_{\text {stem,max,ref }}$ and $K_{\text {root,max,ref }}$ ) are not direct parameters to simulation functions. Instead, theay are scaled to estimate stem- and root-level hydraulic conductances (i.e. $k_{\text {stem, max }}$ and $k_{\text {root, max }}$ ) using plant size (see A.4.1 and A.4.3 for details). $K_{\text {stem, max, ref }}$ and $K_{\text {root }, \text { max }, \text { ref }}$ are supplied via species parameter table and missing values can therefore occur.

Default values for $K_{\text {stem,max,ref }}$ are determined from taxonomic family using an internal data set (medfate:::trait_family_means):

If family-level values are missing, suitable $K_{\text {stem, max, ref }}$ values are decided according to combinations of taxon group (either Angiosperm or Gymnosperm), growth form (either tree or shrub) and leaf phenology (Maherali et al. 2004):

\begin{tabular}{lllc}
\hline Group & Growth form & Leaf phenology & $K_{\text {stem,max,ref }}$ \\
\hline Angiosperm & Tree & Winter-(semi)deciduous & 1.58 \\
Angiosperm & Shrub & Winter-(semi)deciduous & 1.55 \\
Angiosperm & Tree/Shrub & Evergreen & 2.43 \\
Gymnosperm & Tree & any & 0.48 \\
Gymnosperm & Shrub & any & 0.24 \\
\hline
\end{tabular}

Following Oliveras et al. (2003), missing values for $K_{\text {root }, \text { max }, \text { ref }}$ are assumed to be four-times the values given or estimated for $K_{\text {stem,max,ref }}$.

\section*{A.3.15 Leaf maximum hydraulic conductance}

Leaf maximum hydraulic conductance ( $k_{l, \text { max }}$, in $\mathrm{mmol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1} \cdot M P a^{-1}$ ) is an input parameter that should be provided for each species. When missing, leaf maximum hydraulic conductance can be estimated from maximum stomatal conductance $\left(g_{\text {swmax }}\right)$, following Franks (2006) (original coefficients were modified for better fit):
\[
k_{l, \max }=\left(g_{\text {swmax }} / 0.015\right)^{1 / 1.3}
\]

Note that values for $g_{\text {swmax }}$ may also be imputed (see A.3.12).

\section*{A.3.16 Xylem vulnerability}

Default values for $\Psi_{50, \text { stem }}$ are determined from taxonomic family using an internal data set (medfate:: :trait_family_means
If family-level values is missing, a suitable estimate of $\Psi_{50, \text { stem }}$ the water potential corresponding to $50 \%$ of conductance loss, can be obtained from Maherali et al. (2004) according to combinations of taxon group (either Angiosperm or Gymnosperm), growth form (either tree or shrub) and leaf phenology:

\begin{tabular}{lllc}
\hline Group & Growth form & Leaf phenology & $\Psi_{50, \text { stem }}$ \\
\hline Angiosperm & Tree/Shrub & Winter-(semi)deciduous & -2.34
\end{tabular}

\begin{tabular}{lllc}
\hline Group & Growth form & Leaf phenology & $\Psi_{50, \text { stem }}$ \\
\hline Angiosperm & Tree & Evergreen & -1.51 \\
Angiosperm & Shrub & Evergreen & -5.09 \\
Gymnosperm & Tree & any & -4.17 \\
Gymnosperm & Shrub & any & -8.95 \\
\hline
\end{tabular}
$\Psi_{50, \text { stem }}$ estimates are taken for parameter $\Psi_{\text {critic }}$, in the case of the basic water balance model.
Vulnerability curves in the advanced model need to be specified for leaves, stem and root segments via the two parameters of the Weibull function (see 10.2). When any of the parameters of the stem vulnerability curve is missing, a regression equation using data from Choat et al. (2012) can be used to estimate $\Psi_{88, \text { stem }}$ from $\Psi_{50, \text { stem }}$ :
\[
\Psi_{88, \text { stem }}=-1.4264+1.2593 \cdot \Psi_{50, \text { stem }}
\]

Finally, estimates for $c_{\text {stem }}$ and $d_{\text {stem }}$ are obtained from $\Psi_{50, \text { stem }}$ and $\Psi_{88, \text { stem }}$ via function hydraulics_psi2Weibull().
Vulnerability curves for root xylem are less common than for stem xylem. If these values are missing, $\Psi_{50, \text { stem }}$ is first estimated according to its definition and the stem vulnerability curve parameters, $c_{\text {stem }}$ and $d_{\text {stem }}$. Then, a relationship from Bartlett et al. (2016) is used to estimate $\Psi_{50, \text { root }}$ from $\Psi_{50, \text { stem }}$ :
\[
\Psi_{50, \text { root }}=0.4892+0.742 \cdot \Psi_{50, \text { stem }}
\]

Finally, $\Psi_{88, \text { stem }}$ and the Weibull vulnerability parameters are obtained as explained for stems.
Vulnerability curves for leaf xylem are also less common than for stem xylem. If these values are missing, the water potential at turgor los point $\Psi_{\text {tlp }}$ is first estimated from $\pi_{\text {leaf }}$ and $\epsilon_{\text {leaf }}$ according to eq. (10.10). Then, a relationship calibrated with data from Bartlett et al. (2016) is used to estimate $\Psi_{50, \text { leaf }}$ from $\Psi_{t l p}$ :
\[
\Psi_{50, \text { leaf }}=0.2486+0.9944 \cdot \Psi_{\text {tlp }}
\]

Finally, $\Psi_{88, \text { leaf }}$ and the Weibull vulnerability parameters are obtained as explained for stems.

\section*{A.3.17 Photosynthesis rates}

Rubisco's maximum carboxylation rate at $25^{\circ} \mathrm{C}\left(V_{\text {max }, 298}\right.$, in $\left.\mu m o l C O_{2} \cdot s^{-1} \cdot m^{-2}\right)$ is a required input parameter for each species (Vmax298). When missing, the work by Walker et al. (2014) suggests that suitable estimates can be derived from $S L A$ and $N_{\text {area }}$, the latter being the nitrogen concentration per leaf area:
\[
V_{\max , 298}=e^{1.993+2.555 \cdot \log \left(N_{\text {area }}\right)-0.372 \cdot \log (S L A)+0.422 \cdot \log \left(N_{\text {area }}\right) \cdot \log (S L A)}
\]

In turn, imputation for $S L A$ is explained in A.3.4, whereas values for $N_{\text {area }}$ are determined from $N_{\text {leaf }}$ and $S L A$, being $N_{\text {leaf }}$ estimated as indicated in A.3.18. Would $N_{\text {leaf }}$ and $S L A$ values be both unavailable, a default value of $100 \mu \mathrm{~mol} C O_{2} \cdot s^{-1} \cdot m^{-2}$ is used for $V_{\max , 298}$ imputation.

When the maximum rate of electron transport at the same temperature ( $J_{\max , 298}$ ) is not provided by the user, it can be estimated from $V_{\text {max }, 298}$ using (Walker et al. 2014):
\[
J_{\max , 298}=e^{1.197+0.847 \cdot \log \left(V_{\max , 298}\right)}
\]

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.21: Default leaf pressure-volume parameters by taxonomic family.}
\begin{tabular}{|l|l|l|l|}
\hline & LeafPI0 & LeafEPS & LeafAF \\
\hline Acanthaceae & -3.395000 & 23.230000 & 0.1270000 \\
\hline Adoxaceae & -1.560000 & 12.790000 & NA \\
\hline Amaranthaceae & -2.250000 & NA & NA \\
\hline Anacardiaceae & -1.700000 & 12.760000 & NA \\
\hline Annonaceae & -2.160000 & 23.710000 & NA \\
\hline Apocynaceae & -2.390000 & 20.940000 & NA \\
\hline Aquifoliaceae & -2.300000 & 20.700000 & 0.4000000 \\
\hline Araliaceae & -1.528503 & 11.231462 & 0.4065000 \\
\hline Arecaceae & -3.400000 & 73.400000 & 0.2000000 \\
\hline Aspleniaceae & -1.240000 & 35.300000 & NA \\
\hline Asteraceae & -1.471389 & 14.491429 & 0.2435000 \\
\hline Atherospermataceae & -1.340000 & 8.380000 & NA \\
\hline Betulaceae & -1.246984 & 5.498667 & NA \\
\hline Bignoniaceae & -1.990000 & 17.610000 & 0.1770000 \\
\hline Boraginaceae & -1.140000 & NA & NA \\
\hline Brassicaceae & -1.485000 & 7.710000 & 0.2320000 \\
\hline Burseraceae & -1.435000 & 14.980000 & NA \\
\hline Cactaceae & NA & 8.700000 & NA \\
\hline Cannabaceae & -1.580000 & 5.180000 & NA \\
\hline Capparaceae & -2.840000 & 14.750000 & 0.1723333 \\
\hline Caryocaraceae & -1.710000 & 11.340000 & NA \\
\hline Celastraceae & -2.600000 & 19.060000 & NA \\
\hline Combretaceae & -2.110000 & 6.830000 & NA \\
\hline Connaraceae & -2.250000 & 18.010000 & NA \\
\hline Convolvulaceae & -1.320000 & NA & NA \\
\hline Cordiaceae & -1.647500 & 11.295938 & NA \\
\hline Cucurbitaceae & -0.980000 & NA & NA \\
\hline Cupressaceae & -1.480000 & 12.600000 & 0.2720000 \\
\hline Dipterocarpaceae & -1.131429 & 23.630000 & 0.4634286 \\
\hline Dryopteridaceae & -1.425000 & 48.950000 & NA \\
\hline Ebenaceae & -2.110000 & 14.650000 & NA \\
\hline Ericaceae & -1.670000 & 14.382000 & 0.4660000 \\
\hline Erythroxylaceae & -1.916667 & 16.993333 & NA \\
\hline Euphorbiaceae & -1.260000 & 17.570000 & 0.4745000 \\
\hline Fabaceae & -1.641724 & 13.577917 & 0.2609091 \\
\hline Fagaceae & -1.994080 & 18.132800 & 0.2206667 \\
\hline Geraniaceae & -0.730000 & 3.740000 & NA \\
\hline Goodeniaceae & -1.500000 & NA & NA \\
\hline Grossulariaceae & -1.845000 & NA & NA \\
\hline Hydrophyllaceae & -1.260000 & NA & NA \\
\hline Irvingiaceae & -1.690000 & 38.380000 & 0.4760000 \\
\hline Lamiaceae & -1.184000 & 6.120000 & 0.2200000 \\
\hline Lauraceae & -2.074728 & 16.763373 & 0.1760000 \\
\hline Lindsaeaceae & -1.970000 & 7.340000 & 0.1700000 \\
\hline Lythraceae & -1.535000 & 6.055000 & NA \\
\hline Magnoliaceae & -1.430000 & 9.140000 & 0.1560000 \\
\hline Malpighiaceae & -1.540000 & 9.450000 & NA \\
\hline Malvaceae & -2.110000 & 17.730000 & NA \\
\hline Melastomataceae & -1.754000 & 12.306667 & NA \\
\hline Moraceae & -1.353563 & 13.575000 & NA \\
\hline Myrtaceae & -1.852385 & 14.462948 & 0.4006000 \\
\hline Nothofagaceae & -1.480000 & 8.380000 & NA \\
\hline Nyctaginaceae & -1.280000 & NA & NA \\
\hline Oleaceae & -2.060557 & 14.205556 & NA \\
\hline Onagraceae & -1.200000 & NA & NA \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.22: Default maximum stem hydraulic conductivity by taxonomic family.}
\begin{tabular}{|l|l|}
\hline & Kmax_stemxylem \\
\hline Adoxaceae & 4.0535575 \\
\hline Altingiaceae & 0.5050000 \\
\hline Amaranthaceae & 0.0819000 \\
\hline Amborellaceae & 0.5400000 \\
\hline Anacardiaceae & 4.0772016 \\
\hline Annonaceae & 5.2706667 \\
\hline Apiaceae & 0.5150000 \\
\hline Apocynaceae & 2.5651667 \\
\hline Aquifoliaceae & 0.2255757 \\
\hline Araliaceae & 1.6809011 \\
\hline Araucariaceae & 0.7322500 \\
\hline Asteraceae & 0.4986571 \\
\hline Austrobaileyaceae & 2.3000000 \\
\hline Berberidaceae & 0.0873333 \\
\hline Betulaceae & 2.8733374 \\
\hline Bignoniaceae & 2.1014900 \\
\hline Bruniaceae & 0.2515000 \\
\hline Burseraceae & 3.4050000 \\
\hline Cactaceae & 1.8688095 \\
\hline Calophyllaceae & 0.8982857 \\
\hline Cannabaceae & 4.3396105 \\
\hline Capparaceae & 0.5572667 \\
\hline Caprifoliaceae & 0.2521010 \\
\hline Caryocaraceae & 1.7587273 \\
\hline Casuarinaceae & 1.8954048 \\
\hline Cistaceae & 0.3958482 \\
\hline Clusiaceae & 0.5950000 \\
\hline Cochlospermaceae & 7.7500000 \\
\hline Combretaceae & 5.7436667 \\
\hline Convolvulaceae & 2.2000000 \\
\hline Cordiaceae & 4.4607389 \\
\hline Cornaceae & 2.3439777 \\
\hline Cupressaceae & 0.9325131 \\
\hline Daphniphyllaceae & 0.4600000 \\
\hline Dennstaedtiaceae & 21.9800000 \\
\hline Dilleniaceae & 1.2500000 \\
\hline Dipterocarpaceae & 8.8857143 \\
\hline Ebenaceae & 1.5527759 \\
\hline Ehretiaceae & 0.4100000 \\
\hline Ericaceae & 0.6151806 \\
\hline Erythroxylaceae & 0.5352000 \\
\hline Euphorbiaceae & 3.3816717 \\
\hline Eupomatiaceae & 1.1239700 \\
\hline Fabaceae & 2.9075403 \\
\hline Fagaceae & 2.5306061 \\
\hline Garryaceae & 1.9333333 \\
\hline Gnetaceae & 1.2900000 \\
\hline Iteaceae & 0.4500000 \\
\hline Juglandaceae & 4.2050000 \\
\hline Lamiaceae & 4.8686077 \\
\hline Lauraceae & 1.1201255 \\
\hline Lecythidaceae & 6.5443450 \\
\hline Loranthaceae & 0.2817696 \\
\hline Lythraceae & 6.1800000 \\
\hline Malpighiaceae & 11.0500000 \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.24: Default stem P50 values by taxonomic family.}
\begin{tabular}{|l|l|}
\hline & P50 \\
\hline Adoxaceae & -3.0384833 \\
\hline Altingiaceae & -2.0370147 \\
\hline Amaranthaceae & -2.4252402 \\
\hline Amborellaceae & -3.0000000 \\
\hline Anacardiaceae & -2.6535235 \\
\hline Annonaceae & -2.5276068 \\
\hline Apiaceae & -5.7000000 \\
\hline Apocynaceae & -2.4864334 \\
\hline Aquifoliaceae & -3.6437782 \\
\hline Araliaceae & -1.6530859 \\
\hline Araucariaceae & -2.6183226 \\
\hline Arecaceae & -1.8100000 \\
\hline Asparagaceae & -1.6960000 \\
\hline Asteraceae & -3.2565860 \\
\hline Atherospermataceae & -3.0063333 \\
\hline Austrobaileyaceae & -0.4990000 \\
\hline Berberidaceae & -4.5000000 \\
\hline Betulaceae & -2.1017591 \\
\hline Bignoniaceae & -0.8616667 \\
\hline Boraginaceae & -3.5677066 \\
\hline Bruniaceae & -3.3883558 \\
\hline Burseraceae & -1.3054970 \\
\hline Buxaceae & -8.0000000 \\
\hline Cactaceae & -1.2875000 \\
\hline Calophyllaceae & -1.5400000 \\
\hline Calycanthaceae & -1.2808475 \\
\hline Canellaceae & -0.2320000 \\
\hline Cannabaceae & -1.5325304 \\
\hline Capparaceae & -2.3615234 \\
\hline Caprifoliaceae & -5.5144833 \\
\hline Caryocaraceae & -1.6766667 \\
\hline Casuarinaceae & -2.1750000 \\
\hline Celastraceae & -3.4679167 \\
\hline Chloranthaceae & -1.7228571 \\
\hline Chrysobalanaceae & -2.2000000 \\
\hline Cistaceae & -7.1951892 \\
\hline Cleomaceae & -2.1842678 \\
\hline Clusiaceae & -1.3172327 \\
\hline Cochlospermaceae & -1.4400000 \\
\hline Combretaceae & -1.8483333 \\
\hline Convolvulaceae & -1.5987102 \\
\hline Cordiaceae & -2.3307795 \\
\hline Cornaceae & -4.1378833 \\
\hline Cunoniaceae & -1.1500000 \\
\hline Cupressaceae & -8.3049767 \\
\hline Daphniphyllaceae & -0.5985705 \\
\hline Dennstaedtiaceae & -1.9900000 \\
\hline Dilleniaceae & -1.4112676 \\
\hline Dipterocarpaceae & -0.3628571 \\
\hline Dryopteridaceae & -2.5797602 \\
\hline Ebenaceae & -1.5093287 \\
\hline Ehretiaceae & -3.8200000 \\
\hline Ericaceae & -2.8142685 \\
\hline Euphorbiaceae & -1.4638127 \\
\hline Eupomatiaceae & -0.3950000 \\
\hline
\end{tabular}
\end{table}

\section*{A.3.18 Maintenance respiration rates}

When missing at the species parameter table, maintenance respiration rates for leaves, sapwood and fine roots $\left(R E R_{\text {leaf }}, R E R_{\text {sapwood }}\right.$ and $R E R_{\text {fineroot }}$; all in $\left.g g l u c \cdot g d r y^{-1} \cdot d a y^{-1}\right)$ are estimated from corresponding tissue nitrogen concentrations ( $N_{\text {leaf }}, N_{\text {sapwood }}$ and $N_{\text {fineroot }}$; all in $m g N \cdot g d r y^{-1}$ ) following the equations given by Reich et al. (2008) (after appropriate unit conversion):
\[
\begin{aligned}
R E R_{\text {leaf }} & =e^{\left.0.691+1.639 \cdot \log \left(N_{\text {leaf }}\right)\right)} \\
R E R_{\text {sapwood }} & =e^{\left.1.024+1.344 \cdot \log \left(N_{\text {sapwood }}\right)\right)} \\
R E R_{\text {fineroot }} & =e^{\left.0.980+1.352 \cdot \log \left(N_{\text {fineroot }}\right)\right)}
\end{aligned}
\]
where in the previous equations nitrogen concentrations are in $m m o l N \cdot g d r y^{-1}$ and respiration rates in nmol CO2 $\cdot g d r y^{-1} \cdot s^{-1}$.

In turn, when tissue nitrogen concentrations are missing they are estimated from taxonomic family using an internal data set (medfate:: :trait_family_means):

When family values are also missing, default tissue-averaged nitrogen concentrations are given: $N_{\text {leaf }}=$ $20.088, N_{\text {sapwood }}=3.9791$ and $N_{\text {fineroot }}=12.207$.
Default control values ( $M R_{\text {leaf }}=0.00260274$ ), sapwood ( $M R_{\text {sapwood }}=6.849315 e-05$ ) and fine roots ( $M R_{\text {fineroot }} 0.002054795$ ) were used in previous model versions, derived from Ogle \& Pacala (2009), but these are no longer used because of easier parameterization using tissue nitrogen concentration.

\section*{A.3.19 Relative growth rates}

When missing at the species parameter table, maximum relative growth rates for leaves, sapwood and fine roots are taken from control parameters. Default values are provided in 15.5.3.

\section*{A.3.20 Senescence rates}

When missing at the species parameter table, senescence rates for sapwood and fine roots are taken from control parameters.

\section*{A.3.21 Relative starch for sapwood growth}

When missing at the species parameter table, the minimum relative starch for sapwood growth is taken from control parameters. Default value is provided in 15.5.3.

\section*{A.3.22 Wood carbon}

Default values for $C_{\text {wood }}$ are determined from taxonomic family using an internal data set (medfate: : :trait_family_means): If family-level values are missing, default value of $C_{\text {wood }}=0.5 \mathrm{gC} \cdot \mathrm{gdr} y^{-1}$ is used.

\section*{A.3.23 Mortality baseline rate}

When missing at the species parameter table, the mortality baseline rate is taken from control parameters. Default value is provided in 15.5.3.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.26: Default nitrogen concentration per dry mass in different tissues by taxonomic family.}
\begin{tabular}{|l|l|l|l|}
\hline & Nleaf & Nsapwood & Nfineroot \\
\hline Acanthaceae & 27.122403 & NA & 5.580000 \\
\hline Achariaceae & 22.162815 & NA & NA \\
\hline Acoraceae & 18.000000 & NA & NA \\
\hline Actinidiaceae & 20.183321 & NA & NA \\
\hline Adoxaceae & 20.566364 & NA & 11.013750 \\
\hline Aextoxicaceae & 9.621429 & NA & NA \\
\hline Aizoaceae & 14.800000 & NA & NA \\
\hline Alismataceae & 27.287834 & NA & NA \\
\hline Alstroemeriaceae & 19.402857 & NA & NA \\
\hline Altingiaceae & 15.462547 & NA & 7.550000 \\
\hline Amaranthaceae & 23.740694 & NA & 12.411441 \\
\hline Amaryllidaceae & 28.734076 & NA & 11.440000 \\
\hline Amphorogynaceae & 25.236766 & NA & NA \\
\hline Anacardiaceae & 17.914439 & NA & 10.539737 \\
\hline Annonaceae & 23.593695 & NA & 23.830391 \\
\hline Apiaceae & 24.746891 & NA & 10.787434 \\
\hline Apocynaceae & 21.754119 & NA & 16.845575 \\
\hline Aptandraceae & 28.435524 & NA & NA \\
\hline Aquifoliaceae & 14.645818 & NA & 14.324450 \\
\hline Araceae & 22.255347 & NA & NA \\
\hline Araliaceae & 18.093569 & NA & 20.500000 \\
\hline Araucariaceae & 12.622035 & NA & 13.000000 \\
\hline Arecaceae & 18.349681 & NA & 13.216667 \\
\hline Aristolochiaceae & 31.726525 & NA & NA \\
\hline Asparagaceae & 22.875870 & NA & NA \\
\hline Asphodelaceae & 12.352222 & NA & NA \\
\hline Aspleniaceae & 28.260000 & NA & NA \\
\hline Asteraceae & 22.036543 & NA & 9.346061 \\
\hline Atherospermataceae & 17.869722 & NA & 23.200000 \\
\hline Athyriaceae & 26.901037 & NA & NA \\
\hline Aulacomniaceae & 8.000000 & NA & NA \\
\hline Balsaminaceae & 36.003950 & NA & NA \\
\hline Begoniaceae & 34.200000 & NA & NA \\
\hline Berberidaceae & 17.997372 & NA & 21.087500 \\
\hline Betulaceae & 24.194029 & 14.505149 & 13.430951 \\
\hline Bignoniaceae & 23.830902 & 6.575973 & 19.915047 \\
\hline Bixaceae & 25.531043 & NA & NA \\
\hline Blechnaceae & 11.749050 & NA & NA \\
\hline Bonnetiaceae & 9.800000 & NA & NA \\
\hline Boraginaceae & 23.032555 & NA & NA \\
\hline Brassicaceae & 34.316821 & NA & 18.501306 \\
\hline Bromeliaceae & 9.559591 & NA & NA \\
\hline Brunelliaceae & 21.006960 & NA & NA \\
\hline Bruniaceae & 7.781667 & NA & NA \\
\hline Burseraceae & 19.028712 & NA & 10.964427 \\
\hline Butomaceae & 42.600000 & NA & NA \\
\hline Buxaceae & 22.691830 & NA & NA \\
\hline Cabombaceae & 19.500000 & NA & NA \\
\hline Cactaceae & 16.988641 & NA & NA \\
\hline Calophyllaceae & 12.424790 & NA & NA \\
\hline Calycanthaceae & 17.400000 & NA & NA \\
\hline Calyceraceae & 43.000000 & NA & NA \\
\hline Campanulaceae & 27.682767 & NA & 5.721013 \\
\hline Cannabaceae & 28.941055 & NA & NA \\
\hline Cannaceae & 39.700000 & NA & NA \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table A.27: Default wood carbon content by taxonomic family.}
\begin{tabular}{|l|l|}
\hline & WoodC \\
\hline Acanthaceae & 0.4242167 \\
\hline Altingiaceae & 0.4435000 \\
\hline Amaranthaceae & 0.4197662 \\
\hline Amaryllidaceae & 0.4508400 \\
\hline Anacardiaceae & 0.4566867 \\
\hline Annonaceae & 0.4726000 \\
\hline Apiaceae & 0.4413076 \\
\hline Apocynaceae & 0.4924750 \\
\hline Aquifoliaceae & 0.4400000 \\
\hline Araliaceae & 0.4540667 \\
\hline Arecaceae & 0.4556000 \\
\hline Asparagaceae & 0.4631000 \\
\hline Asteraceae & 0.4375956 \\
\hline Betulaceae & 0.4721962 \\
\hline Bignoniaceae & 0.4618077 \\
\hline Boraginaceae & 0.4153500 \\
\hline Brassicaceae & 0.4274775 \\
\hline Burseraceae & 0.4548544 \\
\hline Calophyllaceae & 0.4663000 \\
\hline Campanulaceae & 0.4498475 \\
\hline Cannabaceae & 0.4683583 \\
\hline Caprifoliaceae & 0.4475552 \\
\hline Caryophyllaceae & 0.4147683 \\
\hline Casuarinaceae & 0.4200000 \\
\hline Celastraceae & 0.4900000 \\
\hline Chrysobalanaceae & 0.4886000 \\
\hline Cistaceae & 0.4698925 \\
\hline Clethraceae & 0.4400000 \\
\hline Combretaceae & 0.4678282 \\
\hline Convolvulaceae & 0.4200000 \\
\hline Cordiaceae & 0.4652500 \\
\hline Corynocarpaceae & 0.4520000 \\
\hline Cupressaceae & 0.5006151 \\
\hline Cyperaceae & 0.4639737 \\
\hline Dipterocarpaceae & 0.4744750 \\
\hline Ebenaceae & 0.4828000 \\
\hline Ehretiaceae & 0.4500000 \\
\hline Elaeocarpaceae & 0.4350000 \\
\hline Ericaceae & 0.4865107 \\
\hline Euphorbiaceae & 0.4715052 \\
\hline Fabaceae & 0.4559793 \\
\hline Fagaceae & 0.4642838 \\
\hline Gentianaceae & 0.4654867 \\
\hline Geraniaceae & 0.4381400 \\
\hline Haematococcaceae & 0.4400000 \\
\hline Hypericaceae & 0.4547167 \\
\hline Juglandaceae & 0.4898900 \\
\hline Juncaceae & 0.4238725 \\
\hline Juncaginaceae & 0.4056355 \\
\hline Lamiaceae & 0.4650444 \\
\hline Lauraceae & 0.4677907 \\
\hline Lecythidaceae & 0.4618750 \\
\hline Lentibulariaceae & 0.4450200 \\
\hline Loganiaceae & 0.4943000 \\
\hline Lythraceae & 0.4219000 \\
\hline
\end{tabular}
\end{table}

\section*{A.3.24 Recruitment}

Imputation of missing values for recruitment is specified via control parameters. Default values are provided in 18.4.3.

\section*{A.3.25 Flammability}

Default values for the surface-area-to-volume ratio ( $\sigma$ ), fuel heat content ( $h$ ) and lignin percent ( $L I$ ) are defined from leaf size and leaf shape as follows:

\begin{tabular}{lcccc}
\hline Leaf shape & Leaf size & $\sigma$ & $h$ & $L I$ \\
\hline Broad & Large & 5740 & 19740 & 15.50 \\
Broad & Medium & 4039 & 19825 & 20.21 \\
Broad & Small & 4386 & 20062 & 22.32 \\
Linear/Needle & Large & 3620 & 18250 & 24.52 \\
Linear/Needle & Medium & 4758 & 21182 & 24.52 \\
Linear/Needle & Small & 6697 & 21888 & 18.55 \\
Spines & [any] & 6750 & 20433 & 14.55 \\
Scale & [any] & 1120 & 20504 & 14.55 \\
\hline
\end{tabular}

Default value for the density of fuel particles ( $\rho_{p}$ ) is $400 \mathrm{~kg} \cdot \mathrm{~m}^{-3}$.

\section*{A. 4 Scaling size-related parameters}

\section*{A.4.1 Stem xylem maximum conductance}

Estimation of maximum stem conductance ( $k_{s, \max }$, in $\mathrm{mmol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1} \cdot M \mathrm{~Pa}^{-1}$ ) is done by function hydraulics_maximumStemHydraulicConductance() and follows the work by Savage et al. (2010), Olson et al. (2014) and Christoffersen et al. (2016). Calculations are based on tree height and two species-specific parameters: maximum sapwood reference conductivity ( $K_{s, \text { max }, \text { ref }}$ ) and the ratio of leaf area to sapwood area ( $A_{l} / A_{s}$; A12As in SpParamsMED), i.e. the inverse of the Huber value $H_{v}$.

The reference value for maximum sapwood conductivity $K_{s, \max , \text { ref }}$ is assumed to have been measured on a terminal branch of a plant of known height $H_{\text {ref }}$. If our target plant is very different in height, the conduits of terminal branches will have different radius and hence conductivity. We correct the reference conductivity to the target plant height using the following empirical relationship, developed by Olson et al. (2014) between tree height and diameter of conduits for angiosperms and the equation described by Christoffersen et al. (2016):
\[
\begin{aligned}
2 \cdot r_{i n t, H} & =10^{1.257+\left(0.24 \cdot \log _{10}(H)\right)} \\
2 \cdot r_{i n t, r e f} & =10^{1.257+\left(0.24 \cdot \log _{10}\left(H_{r e f}\right)\right)} \\
K_{s, \text { max }, \text { cor }} & =K_{s, \text { max }, \text { ref }} \cdot\left(r_{\text {int }, H} / r_{\text {int }, \text { ref }}\right)^{2}
\end{aligned}
\]

Where $r_{i n t, H}$ is the radius of conduits for a terminal branch of a tree of height $H$ and $r_{i n t, r e f}$ is the corresponding radius for a tree of height $H_{\text {ref }}$ ( $H$ and $H_{\text {ref }}$ are measured in m). The form of the empirical relationship by Olson et al. (2014) is:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-279.jpg?height=1012&width=1161&top_left_y=241&top_left_x=479)

Let's consider an example for a Quercus ilex target tree of 4 m height and where species-specific conductivity $K_{s, \max , \text { ref }}=0.77$ is the apical value for trees of $H_{\text {ref }}=6.6 \mathrm{~m}$ (in medfate, values of $H_{\text {ref }}$ are taken from median height values; see parameter Hmed in SpParamsMED). The corrected conductivity for a tree of height 4 m will be a bit lower than that of the reference height:
```
xylem_kmax = 0.77
H = 400 # in cm
Href = 660 # in cm
f = hydraulics_referenceConductivityHeightFactor(Href, H);
f
## [1] 0.7863352
xylem_kmax_cor = xylem_kmax * f
xylem_kmax_cor
## [1] 0.6054781
```


Once the reference conductivity is corrected, the maximum stem conductance without accounting for conduit taper is:
\[
k_{s, \max , \text { notaper }}=\frac{1000}{0.018} \frac{K_{s, \max , c o r} \cdot A_{s}}{H \cdot A_{l}}
\]
where $H$ is the tree height (here in m), $A_{s}$ is the sapwood area, $A_{l}$ is the leaf area and $1000 / 0.018$ is a factor used to go from kg to mmol. The ratio $A_{l} / A_{s}=1 / H_{v}$ is a fixed species parameter in soil water balance calculations (see parameter A12As), but becomes variable when simulating plant growth. Let's assume that Quercus ilex the leaf to sapwood area ratio is $A_{l} / A_{s}=2512$. The maximum (leaf-specific) stem conductance without taper ( $k_{s, \text { max, notaper }}$ ) for the tree of 4 m height is then:
```
Al2As = 2512
kstemmax = hydraulics_maximumStemHydraulicConductance(xylem_kmax,
    Href, Al2As, H, taper = FALSE)
kstemmax
```

```
## [1] 3.347698
```


In order to consider taper of xylem conduits we calculate the whole-tree conductance per unit leaf area ( $k_{s, \text { max }, \text { taper }}$ ) as described in Christoffersen et al. (2016):
\[
k_{s, \text { max }, \text { taper }}=\frac{1000}{0.018} \cdot \frac{K_{s, \text { max }, \text { pet }} \cdot A_{s}}{H \cdot A_{l}} \cdot \chi_{\text {tap:notap,ag }}(H)
\]
where $K_{s, \text { max,pet }}$ is the conductivity at the petiole level and $\chi_{\text {tap:notap,ag }}(H)$ is the taper factor accounting for the decrease in the xylem conduits diameter with the height, from the petiole to base of the trunk, which mitigates the negative effects of height on the hydraulic safety. The conductivity at the petiole level is obtained from $K_{s, \max , \text { ref }}$ using again:
\[
K_{s, \max , p e t}=K_{s, \max , \text { ref }} \cdot\left(r_{\text {int }, \text { pet }} / r_{\text {int }, \text { ref }}\right)^{2}
\]
where $r_{\text {int }, \text { pet }}$ is the radius of the petiole in the model of Savage et al. (2010). Christoffersen et al. (2016) use $r_{\text {int }, \text { pet }}=10 \mu \mathrm{~m}$ but we define it as the radius of apical conduits in a tree of 1 m height:
```
hydraulics_terminalConduitRadius(100.0)
## [1] 9.035871
```

$\chi_{\text {tap:notap,ag }}(H)$ is calculated as described in the Appendix 1 section of Christoffersen et al. (2016) (see also Savage et al. (2010)). The following figure shows the value of $\chi_{\text {tap:notap, ag }}$ for different heights:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-280.jpg?height=1007&width=1155&top_left_y=1501&top_left_x=485)

Note that, since $\chi_{\text {tap:notap, ag }}(1)=3.82$ (indicated using grey dashed lines in the last figure), the equation of maximum conductance with taper would give a higher conductance than the equation without taper for a tree of 1 m height, which is supposed to have a conductance equal to conductivity. To solve this issue we define the taper factor as $\chi_{\text {tap:notap, ag }}(H) / \chi_{\text {tap:notap, ag }}(1)$ :
\[
k_{s, \text { max }, \text { taper }}=\frac{1000}{0.018} \cdot \frac{K_{s, \text { max }, \text { pet }} \cdot A_{s}}{H \cdot A_{l}} \cdot \frac{\chi_{\text {tap }: \text { notap }, a g}(H)}{\chi_{\text {tap }: \text { notap }, a g}(1)}
\]

The maximum stem conductance with taper ( $k_{s, \text { max, taper }}$ ) of a $Q$. ilex tree of 4 m height, calculated with this second equation, is:
```
kstemmax_tap = hydraulics_maximumStemHydraulicConductance(xylem_kmax,
    Href, Al2As, H, taper = TRUE)
kstemmax_tap
```

```
## [1] 4.764396
```


The next two plots show the variation of $k_{s, \max }$ for $Q$. ilex depending on the tree height and with/without considering taper of conduits. The plot on the right (both axes in log) show the slope of the dependency of conductance with height in both cases:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-281.jpg?height=785&width=790&top_left_y=1235&top_left_x=243)
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-281.jpg?height=790&width=793&top_left_y=1230&top_left_x=1089)

\section*{A.4.2 Leaf maximum hydraulic conductance}

\section*{A.4.3 Root xylem maximum hydraulic conductance}

To obtain maximum root xylem conductance ( $k_{r, \max }$, in $\mathrm{mmol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1} \cdot M P a^{-1}$ ), one option taken by Christoffersen et al. (2016) is to assume that minimum stem resistance (inverse of maximum conductance) represents a fixed proportion of the minimum total tree (stem+root) resistance. A value 0.625 (i.e. $62.5 \%$ ) suggested by these authors leads to maximum total tree conductance for our Q. ilex tree being:
```
ktot = kstemmax*0.625
ktot
## [1] 2.092311
```

and the maximum root xylem conductance would be therefore:
```
krootmax = 1/((1/ktot)-(1/kstemmax))
krootmax
## [1] 5.579497
```


Now, we need to divide total maximum conductance of the root system xylem among soil layers we need weights inversely proportional to the length of transport distances (Sperry et al. 2017). Vertical transport lengths can be calculated from soil depths and radial spread can be calculated assuming cylinders with volume proportional to the proportions of fine root biomass. Let's assume a soil with three layers:
```
s = soil(defaultSoilParams(3))
d = s$dVec
d
## [1] 300 700 1000
```


The proportion of fine roots in each layer, assuming a linear dose response model, will be:
```
Z50 = 200
Z95 = 1500
v1 = root_ldrDistribution(Z50,Z95, d)
v1

\begin{tabular}{lrrrr} 
\#\# & & {$[, 1]$} & {$[, 2]$} & {$[, 3]$} \\
\#\# & {$[1]$,} & 0.6661036 & 0.2784153 & 0.05548106
\end{tabular}
```


Having this information, the calculation of root length (i.e. the sum of vertical and radial lengths) to each layer ( $L_{j}$ ) is done using function root_coarseRootLengths():
```
rfc = c(20,50,70)
Vol = root_coarseRootSoilVolumeFromConductance(1.0, 2500,krootmax,
    v1, d, rfc)
l = root_coarseRootLengthsFromVolume(Vol, v1, d, rfc)
l
## [1] 4503.445 3250.363 3085.055
```

where lengths are in mm . The proportion of total root xylem conductance corresponding to each layer ( $w_{j}$ ) is given by root_xylemConductanceProportions():
```
w1 = hydraulics_rootxylemConductanceProportions(v1, l)
w1
```

```
## [1] 0.09131268 0.15767645 0.75101087
```


Xylem conductance proportions can be quite different than the fine root biomass proportions. This is because radial lengths are largest for the first top layers and vertical lengths are largest for the bottom layers. The maximum root xylem conductances of each layer will be the product of maximum total conductance of root xylem and weights:
```
w1*krootmax
## [1] 0.5094788 0.8797553 4.1902629
```


The maximum root xylem conductances of each layer would be:
```
krootmaxvec = w1*krootmax
krootmaxvec
## [1] 0.5094788 0.8797553 4.1902629
```

and the fraction of total xylem resistance due to stem would be:
```
(1/kstemmax)/((1/kstemmax)+(1/krootmax))
## [1] 0.625
```


In contrast with the approach of Christoffersen et al. (2016), in this approach the root maximum conductance depends root length and distribution, and is not a fixed fraction of stem maximum conductance. Assuming constant root length, then the proportion of total resistance due to the stem will increase with tree height (Magnani et al. 2000):
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-283.jpg?height=936&width=1031&top_left_y=1572&top_left_x=544)
where the horizontal gray line indicates the value of $62.5 \%$. Of course rooting depth also increases with tree age, but young trees have higher root-to-shoot ratios than older ones. Hence, a root maximum conductance that is not fixed but increases with age seems a priori more realistic. Moreover, Christoffersen et al. (2016) justify the value of $62.5 \%$ from a study which quantified total aboveground and belowground resistance in tropical trees (Fisher et al. 2006) under near-saturated (wet season) conditions, but values of belowground resistance reported in this study for wet conditions and trees of 30 m height are around $13 \%$, which equals to $87 \%$ fraction of aboveground resistance. On the other hand, while rooting depths are limited by soil depth, lateral root length increases with age and, hence, the model could be made more realistic if this is taken into account and the curve above would probably saturate at lower percentages.

\section*{A.4.4 Rhizosphere maximum hydraulic conductance}

Maximum rhizosphere conductance ( $k_{r h, \max }$, in $\mathrm{mmol} \cdot \mathrm{m}^{-2} \cdot \mathrm{~s}^{-1} \cdot M P a^{-1}$ ) is difficult to measure directly, as it depends on the rhizosphere (i.e. fine root) surface in each soil layer, and will probably always be a parameter to be calibrated. Instead of trying to estimate rhizosphere surface from root architecture (Sperry et al. 1998), we follow Sperry et al. (2016) and determine the maximum rhizosphere conductance in each layer from an inputed 'average percentage rhizosphere resistance'. The percentage of continuum resistance corresponding to the rhizosphere is calculated from the vulnerability curves of stem, root and rhizosphere at the same water potential. The average resistance is found by evaluating the percentage for water potential values between 0 and $\Psi_{\text {crit }}$. The following figure illustrates how the supply function, for different soil water potentials, is affected by increasing values of the average percentage of rhizosphere resistance:
![](https://cdn.mathpix.com/cropped/2025_08_09_dc170ece8adf49163edcg-284.jpg?height=882&width=1026&top_left_y=1216&top_left_x=547)

Sperry et al. (2016) found average percentages of rhizosphere resistance around $67 \%$, but these exceptionallyhigh values were probably a consequence of using an unsegmented supply function (i.e. single vulnerability curve for roots, stem and leaves). If we specify a $15 \%$ of average resistance in the rhizosphere (see parameter averageFracRhizosphereResistance in function defaultControl()), the maximum rhizosphere conductance values for the three layers are found calling:
```
krmax = rep(0,3)
krmax[1]= hydraulics_findRhizosphereMaximumConductance(15,
```

```
    s$VG_n[1],s$VG_alpha[1],
    krootmax, rootc,rootd,
    kstemmax, stemc, stemd,
    kleafmax, leafc, leafd)
krmax[2] = hydraulics_findRhizosphereMaximumConductance(15,
    s$VG_n[2],s$VG_alpha[2],
    krootmax, rootc,rootd,
    kstemmax, stemc, stemd,
    kleafmax, leafc, leafd)
krmax[3] = hydraulics_findRhizosphereMaximumConductance(15,
    s$VG_n[3],s$VG_alpha[3],
    krootmax, rootc,rootd,
    kstemmax, stemc, stemd,
    kleafmax, leafc, leafd)
krmax
```

\#\# [1] 856367448563674485636744

The values are the same because the texture of the three layers is the same in this case. If we take into account root distribution, actual maximum rhizosphere conductance values are:
```
krmax*v1
## [,1] [,2] [,3]
## [1,] 57042945 23842581 4751218
```


\section*{A.4.5 Plant water storage capacity}

The water storage capacity of sapwood tissue per leaf area unit ( $V_{\text {sapwood }}$; in $l \cdot m^{-2}$ ) can be estimated as the product of stem height ( $H$ in m ) and Huber value ( $H_{v}$; ratio of sapwood area to leaf area in $m^{2} \cdot m^{-2}$ ) times a factor to account for the non-cylindrical shape (http://www.fao.org/forestry/17109/en/):
\[
V_{\text {sapwood }}=10^{3} \cdot 0.48 \cdot H \cdot H_{v} \cdot \Theta_{\text {sapwood }}
\]
$\Theta_{\text {sapwood }}$ is sapwood porosity ( $\mathrm{cm}^{3}$ of water per $\mathrm{cm}^{3}$ of sapwood tissue), which can be estimated from wood density ( $\rho_{\text {wood }}$; in $g \cdot \mathrm{~cm}^{-3}$ ):
\[
\Theta_{\text {sapwood }}=1-\left(\rho_{\text {wood }} / 1.54\right)
\]
where the density of wood substance can be assumed to be fixed and equal to $1.54 \mathrm{~g} \cdot \mathrm{~cm}^{-3}$ (Dunlap 1914). For example, wood densities ranging from 0.443 to $1.000 \mathrm{~g} \cdot \mathrm{~cm}^{-3}$ result in sapwood porosity values between 0.35 and 0.71.

Water storage capacity of leaf tissue per leaf area unit ( $V_{l e a f} ;$ in $l \cdot m^{-2}$ ) can be estimated as the product of specific leaf area (SLA; in $\mathrm{m}^{2} \cdot \mathrm{~kg}^{-1}$ ) and leaf density ( $\rho_{\text {leaf }}$; in $\mathrm{g} \cdot \mathrm{cm}^{-3}$ ):
\[
V_{l e a f}=\frac{1}{S L A \cdot \rho_{l e a f}} \cdot \Theta_{l e a f}
\]
$\Theta_{\text {leaf }}$ is leaf porosity ( $\mathrm{cm}^{3}$ of water per $\mathrm{cm}^{3}$ of leaf tissue), which can be estimated from leaf density:
\[
\Theta_{l e a f}=1-\left(\rho_{l e a f} / 1.54\right)
\]
where the density of wood substance can be assumed to be fixed and equal to $1.54 \mathrm{~g} \cdot \mathrm{~cm}^{-3}$ (Dunlap 1914).
For example, let's calculate the stem and leaf water capacity for a Q . ilex tree of 15 m height:
```
ld = 0.7
SLA = 5.870
moisture_leafWaterCapacity(SLA, ld)
## [1] 0.1327463
```


\section*{A.4.6 Horizontal root overlap}

\section*{A.4.6.1 Basic water balance}

A given plant cohort $i$ will have its roots in layer $s$ partitioned among different water pools. We thus need to define $f r_{i, s, j}$, the (horizontal) proportion of fine roots of cohort $i$ in layer $s$ of the water pool $j$, with the restriction that:
\[
\sum_{j} f r_{i, s, j}=1 \forall i, s
\]

It is important to realize that proper estimation of $f r_{i, s, j}$ is challenging when we do not have explicit plant coordinates, root lateral widths, etc. For this reason, an intuitive approach is followed here based on the following two premises:
- The amount of overlap between roots of different plants should monotonically increase along with the LAI of the stand (i.e. $L A I_{\text {stand }}^{\text {live }}$ ).
- The amount of overlap between roots of different plants at a given soil depth should increase/decrease with the vertical proportion of roots at that depth.

The specific formulation we chose for $f r_{i, s, j}$ is:
\[
f r_{i, s, j}=f_{\text {pool }, j} \cdot\left(1-\exp \left(-f_{\text {overlap }} \cdot L A I_{\text {stand }}^{\text {live }}\right)\right) \cdot\left(\frac{\sqrt{F R P_{i, s} \cdot F R P_{j, s}}}{\max _{s}\left(F R P_{i, s}\right)}\right)
\]
for all $j \neq i$, where $f_{\text {overlap }}$ is an overlap factor (a control parameter called poolOverlapFactor). For $j=i$ then we simply have:
\[
f r_{i, s, i}=1-\sum_{j} f r_{i, s, j}
\]

Note that if $f_{\text {overlap }}=0$ then $f r_{i, s, j}=1$ if $j=i$ and zero otherwise (i.e. plants exploit their corresponding water pools only. For very large values of $L A I_{\text {stand }}^{\text {live }}$ and/or $f_{\text {overlap }}$ we have that ( $1-\exp \left(-f_{\text {overlap }} \cdot\right.$ $\left.\left.L A I_{\text {stand }}^{\text {live }}\right)\right)=0$ and $f r_{i, s, j}=f_{\text {pool }, j}$ (neglecting vertical differences), so that plants exploit the each water pool in the same proportion as the fraction of stand occupied by the pool (i.e. overlap is maximum).

\section*{Appendix B}

\section*{Symbols}

The following tables list all symbols used in this document, along with their units and definition. When symbols are input for medfate model functions, the R name of those parameters in the package (either in data frame SpParamsMED, soil input data frame, or the output of functions such as spwbInput()) is also indicated.

\section*{B. 1 Dimensions}

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline $\Delta t_{\text {step }}$ & $s$ & 86400/ndailystepswdaily temporal step \\
\hline $\Delta t_{\text {substep }}$ & $s$ & 86400/ (ndailystempsetaidubstempsual substep \\
\hline $c$ & (count) & Number of plant cohorts \\
\hline $l$ & (count) & Number of vertical layers \\
\hline $\Delta z$ & $m$ & verticalLayerSiHädtboof vertical layers \\
\hline $S$ & (count) & Number of soil layers \\
\hline $d_{s}$ & mm & widths \\
\hline $Z_{s}$ & mm & widths \\
\hline $Z_{\text {soil }}$ & mm & Overall soil depth \\
\hline
\end{tabular}

\section*{B. 2 Soils}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $P_{\text {clay }, s}$ & \% & clay & Percent of clay in soil layer $s$ \\
\hline $P_{\text {sand, } s}$ & \% & sand & Percent of sand in soil layer $s$ \\
\hline $O M_{s}$ & \% & om & Percentage of organic mater per dry weight in soil layer $s$ \\
\hline $B D_{s}$ & $g \cdot \mathrm{~cm}^{-3}$ & bd & Bulk density in soil layer $s$ \\
\hline $P_{\text {rocks }, s}$ & \% & rfc & Percentage of rock fragment content in soil layer $s$ \\
\hline $\theta_{s}$ & $m^{3} \cdot m^{-3}$ & & Volumetric moisture in soil layer $s$ \\
\hline $\Psi_{s}$ & MPa & & Water potential in soil layer $s$ \\
\hline $\Psi_{f c}$ & MPa & & Water potential at field capacity \\
\hline $A_{s}, B_{s}$ & & & Parameters of the Saxton pedotransfer functions for soil layer $s$ \\
\hline $\theta_{\text {sat }, s}$ & $m^{3} \cdot m^{-3}$ & VG_theta_sat & Volumetric moisture at saturation for soil layer $s$ \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $\theta_{f c, s}$ & $m^{3} \cdot m^{-3}$ & & Volumetric moisture at field capacity ( -0.033 MPa ) for soil layer $s$ \\
\hline $\theta_{w p, s}$ & $m^{3} \cdot m^{-3}$ & & Volumetric moisture at wilting point ( -1.5 MPa ) for soil layer $s$ \\
\hline $\theta_{\text {res }, s}$ & $m^{3} \cdot m^{-3}$ & VG_theta_res & Residual volumetric moisture for soil layer $s$ \\
\hline $n_{s}$ & & VG_n & Parameter $n$ of the Van Genuchten (1980) model for soil layer $s$ \\
\hline $\alpha_{s}$ & & VG_alpha & Parameter $\alpha$ of the Van Genuchten (1980) model for soil layer $s$ \\
\hline $K_{s a t, s}$ & mmol • $s^{-1} \cdot m^{-1}$. & Ksat & Saturated soil conductivity for soil layer $s$. \\
\hline $K_{\text {unsat,s }}$ & $M P a^{-1}$ mmol . $s^{-1} \cdot m^{-1}$. $M P a^{-1}$ & Kunsat & Unsaturated soil conductivity for soil layer $s$. \\
\hline $P_{\text {macro,s }}$ & \% & macro & Percentage of macroporosity corresponding to soil layer $s$. \\
\hline $\gamma_{\text {soil }}$ & $m m \cdot d a y^{-1}$ & Gsoil & The maximum daily evaporation from soil \\
\hline $Z_{\text {sat }}$ & mm & & Depth to saturation \\
\hline $V_{s}$ & mm & & Water volume in soil layer $s$ \\
\hline $V_{\text {soil }}$ & mm & & Overall water volume in the soil \\
\hline $V_{f c, \text { soil }}$ & mm & & Water retention capacity of the whole soil \\
\hline $W_{s}$ & [0-1] & W & Proportion of moisture in relation to field capacity in soil layer $s$ \\
\hline $W_{i, s}$ & [0-1] & W & Proportion of moisture in relation to field capacity in soil layer $s$ within fraction of stand area covered by cohort $i$ \\
\hline $W_{\text {rhizo }, i, s}$ & [0-1] & & Proportion of moisture in relation to field capacity in soil layer $s$ within the rhizosphere of cohort $i$ \\
\hline $S_{\text {snow }}$ & mm & SWE & Snow water equivalent of the snow pack storage over the soil surface \\
\hline
\end{tabular}

\section*{B. 3 Plant/leaf classification}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline GF & Categorical & GrowthForm & "Tree", "Shrub" or "Tree/Shrub" \\
\hline LF & Categorical & LifeForm & Raunkiaer life form \\
\hline $L_{\text {shape }}$ & Categorical & LeafShape & Leaf shape: "Broad", "Needle", "Linear", "Scale", "Spines" or "Succulent" \\
\hline $L_{\text {size }}$ & Categorical & LeafSize & Leaf size: "Small" ( $<225 \mathrm{~mm}$ ), "Medium" ( $>225 \mathrm{~mm}$ \& $<2025 \mathrm{~mm})$ or "Large" ( $>2025 \mathrm{~mm}$ ) \\
\hline $L_{\text {pheno }}$ & Categorical & PhenologyType & Leaf phenology type \\
\hline
\end{tabular}

\section*{B. 4 Vegetation}

\begin{tabular}{llll}
\hline Symbol & Units & R & Description \\
\hline$S P_{i}$ & (count) & Species & Species identity of cohort $i$ \\
$A_{s h, i}$ & $\mathrm{~cm}^{2}$ & & Area occupied by an average shrub individual of cohort $i$
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $B_{s h, i}$ & kg & & Fine-fuel biomass of an average shrub individual of cohort $i$ \\
\hline $H_{i}$ & cm & Height & Average tree or shrub height of cohort $i$ \\
\hline $H_{\text {crown }, i}$ & cm & & Crown base height (i.e. the height corresponding to the first living branch) of cohort $i$ \\
\hline $C C F_{i}$ & & & Crown competition factor of cohort $i$ \\
\hline $C W_{i}$ & $m$ & & Crown width that a tree of cohort $i$ would have in open-ground conditions \\
\hline $C R_{i}$ & [0-1] & CR & Crown ratio (i.e. ratio between crown length and plant height) of cohort $i$ \\
\hline $N_{i}$ & $i n d \mathrm{u} h a^{-1}$ & N & Density of tree individuals of cohort $i$ \\
\hline $D B H_{i}$ & cm & DBH & Diameter at breast height of trees in cohort $i$ \\
\hline Cover $_{i}$ & \% & Cover & Percent cover of shrubs in cohort $i$ \\
\hline $H_{\text {herb }}$ & \% & herbHeight & Average height (in cm) of herbaceous vegetation \\
\hline Cover $_{\text {herb }}$ & \% & herbCover & Percent cover of herbaceous vegetation \\
\hline $F B_{i}$ & $\mathrm{kg} \cdot \mathrm{m}^{-2}$ & & Foliar biomass of cohort $i$ \\
\hline $F B_{\text {tree }, i}$ & $k g$ & & Foliar biomass of a single tree of cohort $i$ \\
\hline $\phi_{i}$ & [0-1] & & Fraction of maximum leaf area currently expanded for cohort $i$ \\
\hline $L A I_{i}^{\text {live }}$ & $m^{2} \cdot m^{-2}$ & LAI_live & (Maximum) leaf area index (one-side leaf area per surface area of the stand) of woody cohort $i$ \\
\hline $L A I_{i}^{\text {dead }}$ & $m^{2} \cdot m^{-2}$ & LAI_dead & Dead leaf area index (one-side dead leaf area per surface area of the stand) of woody cohort $i$ \\
\hline $L A I_{i}^{\phi}$ & $m^{2} \cdot m^{-2}$ & LAI_expanded & Current expanded leaf area index (one-side expanded leaf area per surface area of the stand) of woody cohort $i$ \\
\hline $L A I_{i}^{\text {all }}$ & $m^{2} \cdot m^{-2}$ & & Total leaf area index (live or dead) of woody cohort $i$ \\
\hline LAI ${ }_{\text {woody }}^{\text {live }}$ & $m^{2} \cdot m^{-2}$ & & Maximum leaf area index of living leaves of woody vegetation in the stand \\
\hline $L A I_{\text {woody }}^{\text {dead }}$ & $m^{2} \cdot m^{-2}$ & & Leaf area index of dead leaves of woody vegetation in the stand \\
\hline $L A I_{\text {woody }}^{\phi}$ & $m^{2} \cdot m^{-2}$ & & Current expanded leaf area index of live leaves of woody vegetation in the stand \\
\hline $L A I_{\text {woody }}$ & $m^{2} \cdot m^{-2}$ & & Total leaf area index (live or dead) of woody vegetation in the stand \\
\hline $L A I_{\text {herb }}$ & $m^{2} \cdot m^{-2}$ & & Leaf area index of herbaceous vegetation in the stand \\
\hline $L A I_{\text {stand }}$ & $m^{2} \cdot m^{-2}$ & & Total leaf area index of the stand \\
\hline $L A_{i}$ & $m^{2}$ & & Leaf area of an individual of cohort $i$ \\
\hline $F R P_{i, s}$ & [0-1] & V[i,s] & The proportion of fine roots of cohort $i$ in soil layer $s$ \\
\hline $F R A_{i, s}$ & $m^{2}$ & & Fine root area of cohort $i$ in soil layer $s$ \\
\hline $L_{\text {radial,i,s }}$ & m & & Radial length of coarse roots of cohort $i$ in soil layer $s$ \\
\hline $W_{i}$ & $\mathrm{kg} \cdot \mathrm{m}^{-2}$ & & Fine fuel biomass of cohort $i$ \\
\hline $Z_{50, i}$ & mm & Z50 & Depth above which $50 \%$ of the fine root mass of cohort $i$ is located \\
\hline $Z_{95, i}$ & mm & Z95 & Depth above which $95 \%$ of the fine root mass of cohort $i$ is located \\
\hline
\end{tabular}

\section*{B. 5 Meteorology}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline DOY & & DOY & Day of the year \\
\hline $T_{\text {mean }}$ & ${ }^{\circ} \mathrm{C}$ & \multicolumn{2}{|l|}{MeanTemperatureMean daily temperature} \\
\hline $T_{\text {min }}$ & ${ }^{\circ} \mathrm{C}$ & \multicolumn{2}{|l|}{MinTemperature Minimum daily temperature} \\
\hline $T_{\text {max }}$ & ${ }^{\circ} \mathrm{C}$ & \multicolumn{2}{|l|}{MaxTemperature Maximum daily temperature} \\
\hline $T_{\text {base }}$ & ${ }^{\circ} \mathrm{C}$ & & Base temperature for calculation of $G D D$ \\
\hline $R H_{\text {min }}$ & \% & \multicolumn{2}{|l|}{MinRelativeHumidlitigmum daily relative humidity} \\
\hline $R H_{\text {max }}$ & \% & \multicolumn{2}{|l|}{MaxRelativeHumiddiatxymum daily relative humidity} \\
\hline $P$ & $L \cdot m^{-2}=$ mm & \multicolumn{2}{|l|}{Precipitation Precipitation (including rainfall and snow)} \\
\hline Pr & $L \cdot m^{-2}=$ mm & Rainfall & Liquid water precipitation (rainfall) \\
\hline Ps & $L \cdot m^{-2}=$ mm & Snow & Snow precipitation \\
\hline PET & $L \cdot m^{-2}=$ & PET & Potential evapotranspiration, preferably calculated using \\
\hline Rad & $M J \cdot m^{-2}$ & Radiation & Solar radiation after accounting for clouds \\
\hline u & $m \cdot s^{-1}$ & WindSpeed & Wind speed \\
\hline $P_{\text {atm }}$ & kPa & & Atmospheric pressure \\
\hline $\rho_{\text {air }}$ & $\mathrm{kg} \cdot \mathrm{m}^{-3}$ & & Air density \\
\hline $T_{\text {atm }}$ & ${ }^{\circ} \mathrm{C}$ & Tatm & Atmospheric (above-canopy) air temperature \\
\hline $T_{\text {can }}$ & ${ }^{\circ} \mathrm{C}$ & Tcan & Canopy air temperature \\
\hline $T_{a i r, j}$ & ${ }^{\circ} \mathrm{C}$ & Tair & Air temperature in canopy layer $j$ \\
\hline $T_{\text {soil,s }}$ & ${ }^{\circ} \mathrm{C}$ & Tsoil.s & Temperature of soil layer $s$ \\
\hline $e_{\text {atm }}$ & kPa & & Atmospheric (above-canopy) water vapor pressure \\
\hline $e_{\text {air }, j}$ & kPa & VPair & Water vapor pressure in canopy layer $j$ \\
\hline $C_{\text {atm }}$ & kPa & Catm & Atmospheric (above-canopy) $C O_{2}$ concentration \\
\hline $C_{\text {air }, j}$ & kPa & VPair & $C O_{2}$ concentration in canopy layer $j$ \\
\hline $u_{j}$ & $m \cdot s^{-1}$ & & Wind speed at canopy layer $j$ \\
\hline
\end{tabular}

\section*{B. 6 Anatomy}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $H_{v}$ & $m^{2} \cdot m^{-2}$ & 1/Al2As & Huber value (ratio of sapwood area to leaf area) \\
\hline $L W$ & cm & LeafWidth & Leaf width \\
\hline SLA & $m^{2} \cdot k g^{-1}$ & SLA & Specific leaf area \\
\hline $\rho_{\text {leaf }}$ & $g \cdot \mathrm{~cm}^{-3}$ & LeafDensity & Leaf tissue density \\
\hline $\rho_{\text {wood }}$ & $g \cdot \mathrm{~cm}^{-3}$ & WoodDensity & Wood tissue density \\
\hline $\rho_{\text {fineroot }}$ & $g \cdot \mathrm{~cm}^{-3}$ & \multicolumn{2}{|l|}{FineRootDensityFine root tissue density} \\
\hline $\Theta_{\text {sapwood }}$ & $m^{3} \cdot m^{-3}$ & & Sapwood porosity (volume of empty spaces over total volume) \\
\hline $\Theta_{\text {leaf }}$ & $m^{3} \cdot m^{-3}$ & & Leaf porosity (volume of empty spaces over total volume) \\
\hline $S R L$ & $\mathrm{cm} \cdot g^{-1}$ & SRL & Specific root length \\
\hline RLD & $\mathrm{cm} \cdot \mathrm{cm}^{-3}$ & RLD & Fine root length density (i.e. density of root length per soil volume) \\
\hline $r_{6.35}$ & & r635 & Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm \\
\hline
\end{tabular}

\section*{B. 7 Radiation}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $k_{\text {PAR,i }}$ & (unitless) & kPAR & PAR extinction coefficient for cohort $i$ \\
\hline $k_{S W R, i}$ & (unitless) & & SWR extinction coefficient for cohort $i$ \\
\hline $k_{L W R}$ & (unitless) & & LWR extinction coefficient \\
\hline $k_{b}$ & (unitless) & & Extinction coefficient for direct light for cohort $i$ \\
\hline $k_{d, i}$ & (unitless) & & Extinction coefficient for diffuse light for cohort $i$ (equal to $k_{P A R, i}$ or $k_{S W R, i}$ ) \\
\hline $\alpha_{S W R, i}$ & [0-1] & alphaSWR & Short-wave radiation absorbance coefficient for cohort $i$ \\
\hline $\alpha_{\text {PAR }, i}$ & [0-1] & & PAR absorbance coefficient for cohort $i$ \\
\hline $\gamma_{S W R, i}$ & [0-1] & gammaSWR & Short-wave radiation leaf reflectance (albedo) for cohort $i$ \\
\hline $\gamma_{S W R, \text { soil }}$ & [0-1] & & Short-wave radiation soil reflectance \\
\hline $\gamma_{P A R, i}$ & [0-1] & & PAR leaf reflectance for cohort $i$ \\
\hline $L_{\text {groun }}^{\text {PAR }}$ & [0-1] & LgroundPAR & Fraction of PAR reaching the ground \\
\hline LSWR & [0-1] & LgroundSWR & Fraction of SWR reaching the ground \\
\hline $I_{\text {beam }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous direct shortwave irrradiance from the atmosphere \\
\hline $I_{\text {dif }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous diffuse shortwave irrradiance from the atmosphere \\
\hline $L_{\text {atm }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous longwave radiation from the atmosphere \\
\hline $I_{\text {beam }, j}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous direct shortwave irrradiance at the top of canopy layer $j$ \\
\hline $I_{\text {dif }, j}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous diffuse shortwave irrradiance at the top of canopy layer $j$ \\
\hline $I_{\text {beam,soil }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous direct shortwave irrradiance reaching the soil \\
\hline $I_{\text {dif,soil }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Instantaneous diffuse shortwave irrradiance reaching the soil \\
\hline $L A I_{i, j}^{\text {sunlit }}$ & $m^{2} \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Leaf area index of sunlit leaves of cohort $i$ in layer $j$. \\
\hline $L A I_{i, j}^{\text {shade }}$ & $m^{2} \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Leaf area index of shade leaves of cohort $i$ in layer $j$. \\
\hline $\Phi_{i, j}^{\text {sunlit }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Short-wave radiation absorbed by sunlit leaves of cohort $i$ in layer $j$, per leaf area unit. \\
\hline $\Phi_{i, j}^{\text {shade }}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Short-wave radiation absorbed by sunlit leaves of cohort $i$ in layer $j$, per leaf area unit. \\
\hline $K_{a b s, i, j}^{s u n l t}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Short-wave radiation absorbed by sunlit foliage of cohort $i$ in layer $j$, per ground area unit. \\
\hline $K_{a b s, i, j}^{s h a d e}$ & $W \stackrel{\circ}{\mathrm{u}} m^{-2}$ & & Short-wave radiation absorbed by sunlit foliage of cohort $i$ in layer $j$, per ground area unit. \\
\hline
\end{tabular}

\section*{B. 8 Water balance}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline Ps & mm & Snow & Precipitation as snow \\
\hline Pr & mm & Rain & Precipitation as rainfall \\
\hline Sm & mm & Snowmelt & Snowmelt \\
\hline $\operatorname{Pr}_{\text {net }}$ & mm & NetRain & Net rainfall \\
\hline In & mm & Interception & Interception loss \\
\hline Ru & mm & Runoff & Water exported from the stand as runoff \\
\hline Ro & mm & Runon & Water imported to the stand as runon \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|}
\hline Symbol & Units & R Description \\
\hline Dd & mm & DeepDrainage Water exported from the stand as deep drainage \\
\hline Es & mm & SoilEvaporationEvaporation from the soil surface \\
\hline $T r_{\text {woody }}$ & mm & Transpiration Woody plant transpiration \\
\hline $T r_{h e r b}$ & mm & HerbTranspiratidnarbaceous plant transpiration \\
\hline $T r_{i}$ & mm & Transpiration of woody plant cohort $i$ \\
\hline
\end{tabular}

\section*{B. 9 Energy balance}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $K_{a b s, c a n}$ & $W \cdot m^{-2}$ & SWRcan & Atmosphere shortwave radiation absorbed by the canopy \\
\hline $K_{a b s, j}$ & $W \cdot m^{-2}$ & & Atmosphere shortwave radiation absorbed by canopy layer j \\
\hline $K_{\text {abs,soil }}$ & $W \cdot m^{-2}$ & SWRsoil & Atmosphere shortwave radiation absorbed by the soil \\
\hline $L_{\text {net,can }}$ & $W \cdot m^{-2}$ & LWRcan & Canopy net longwave radiation \\
\hline $L_{\text {net }, j}$ & $W \cdot m^{-2}$ & & Net long-wave radiation of canopy layer $j$ \\
\hline $L_{\text {net,soil }}$ & $W \cdot m^{-2}$ & LWRsoil & Soil net longwave radiation \\
\hline $H_{\text {can,atm }}$ & $W \cdot m^{-2}$ & Hcan & Turbulent heat exchange between the canopy and the atmosphere \\
\hline $H_{\text {can,soil }}$ & $W \cdot m^{-2}$ & Hcansoil & Turbulent heat exchange between the canopy and the soil \\
\hline $H_{j}$ & $W \cdot m^{-2}$ & & Sensible heat flux between canopy layer $j$ and the leaves it contains \\
\hline $L E_{\text {can }}$ & $W \cdot m^{-2}$ & LEcan & Energy released as latent heat from the canopy towards the atmosphere \\
\hline $L E_{j}$ & $W \cdot m^{-2}$ & & Energy released as latent heat by canopy layer $j$ \\
\hline $L E_{\text {soil }}$ & $W \cdot m^{-2}$ & LEsoil & Energy released as latent heat from the soil \\
\hline $T C_{L A I}$ & $J \cdot m^{-2}$. $K^{-1}$ & \multicolumn{2}{|l|}{thermalcapacityCAisopy thermal capacitance per LAI unit} \\
\hline $T C_{\text {can }}$ & $J \cdot m^{-2}$. $K^{-1}$ & & Canopy thermal capacitance \\
\hline $T C_{j}$ & $J \cdot m^{-2}$. $K^{-1}$ & & Thermal capacitance of canopy layer $j$ \\
\hline $T C_{\text {soil,s }}$ & $J \cdot m^{-2}$. $K^{-1}$ & & Thermal capacitance of soil layer $s$ \\
\hline $V H C_{\text {soil,s }}$ & $J \cdot m^{-3}$. $K^{-1}$ & & Volumetric heat capacity of soil in layer $s$ \\
\hline
\end{tabular}

\section*{B. 10 Forest hydrology}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $P_{G}$ & mm & \multirow{6}{*}{Cm} & Amount of rainfall needed to saturate the canopy for a given event \\
\hline $S_{\text {canopy }}$ & mm & & Canopy water storage capacity \\
\hline $E R_{\text {ratio }}$ & (unitless) & & Ratio between evaporation rate and rainfall rate \\
\hline $C_{\text {canopy }}$ & [0-1] & & Canopy cover \\
\hline $P E_{\text {soil }}$ & mm & & Evaporation demand from the soil \\
\hline $S E_{\text {soil }}$ & mm & & Evaporation supply from the soil \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $t_{\text {soil }}$ & day & & Time needed to evaporate the current water deficit in the first soil layer \\
\hline $P E T_{\text {herb }}$ & mm & & Potential evapotranspiration in the herb layer \\
\hline
\end{tabular}

\section*{B. 11 Plant hydraulics}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $K_{\text {stem,max,ref }}$ & \begin{tabular}{l}
$\mathrm{kg} \cdot \mathrm{s}^{-1}$. $m^{-1}$. \\
$M P a^{-1}$
\end{tabular} & Kmax_stemxylem & Maximum stem sapwood reference conductivity per leaf area unit \\
\hline $K_{\text {root }, \text { max }, \text { ref }}$ & $\mathrm{kg} \cdot \mathrm{s}^{-1}$. $m^{-1}$. & Kmax_rootxylem & Maximum root sapwood reference conductivity per leaf area unit \\
\hline $k_{\text {stem,max }}$ & \begin{tabular}{l}
mmol . \\
$s^{-1} \cdot m^{-2}$.
\end{tabular} & VCstem_kmax & Maximum whole-stem conductance (per leaf area unit) \\
\hline $k_{\text {root,max }}$ & mmol . $s^{-1} \cdot m^{-2}$. $M P a^{-1}$ & VCroot_kmax & Maximum root conductance (per leaf area unit) \\
\hline $k_{\text {rhizo,max }}$ & mmol . $s^{-1} \cdot m^{-2}$. $M P a^{-1}$ & & Maximum rhizosphere conductance (per leaf area unit) \\
\hline $k_{\text {leaf, max }}$ & \begin{tabular}{l}
mmol . $s^{-1} \cdot m^{-2}$. \\
$M P a^{-1}$
\end{tabular} & VCleaf_kmax & Maximum leaf conductance (per leaf area unit) \\
\hline $c_{\text {leaf }}, d_{\text {leaf }}$ & (unitless), MPa & VCleaf_c, VCleaf_d & Parameters of the vulnerability curve for leaves \\
\hline $c_{\text {root }}, d_{\text {root }}$ & (unitless), MPa & VCroot_c, VCroot_d & Parameters of the vulnerability curve for root xylem \\
\hline $c_{\text {stem }}, d_{\text {stem }}$ & (unitless), MPa & VCstem_c, VCstem_d & Parameters of the vulnerability curve for stem xylem \\
\hline $\Psi$ & MPa & & Water potential in a given water compartment/segment \\
\hline $\Psi_{P}$ & MPa & & Turgor water potential in a given water compartment/segment \\
\hline $\Psi_{S}$ & MPa & & Osmotic (solute) water potential in a given water compartment \\
\hline $\Psi_{\text {cav }}$ & MPa & & Minimum water potential experienced by xylem in previous steps (cavitation) \\
\hline $\Psi_{\text {canopy }}$ & MPa & & Canopy water potential \\
\hline $\Psi_{\text {leaf }}$ & MPa & & Leaf water potential \\
\hline $\Psi_{\text {rootcrown }}$ & MPa & & Water potential at the root crown \\
\hline $\Psi_{\text {stem }}$ & MPa & & Water potential at the end (highest part) of the stem \\
\hline $P L C$ & [0-1] & & Proportion of conductance loss \\
\hline $P L C_{\text {stem }}$ & [0-1] & & Proportion of conductance loss in stem xylem tissue \\
\hline $p_{\text {root }}$ & [0-1] & pRootDisc & Relative root conductance leading to hydraulic disconnection from a soil layer \\
\hline $E_{i}$ & mmol . $s^{-1} \cdot m^{-2}$ & & Steady-state water flow through a hydraulic segment $i$ \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $k_{i}$ & mmol . $s^{-1} \cdot m^{-2}$. $M P a^{-1}$ & & Hydraulic conductance function for segment $i$ \\
\hline $\Psi_{u p}$ & MPa & & Upstream water potential \\
\hline $\Psi_{\text {down }}$ & MPa & & Downstream water potential \\
\hline
\end{tabular}

\section*{B. 12 Photosynthesis}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $W U E_{\max }$ & $g C \cdot \mathrm{~mm}^{-1}$ & WUE & Water use efficiency at VPD $=1 \mathrm{kPa}$ and without light or CO2 limitations \\
\hline $W U E_{P A R}$ & & WUE_par & Coefficient describing the progressive decay of WUE with lower light levels \\
\hline $W U E_{C O 2}$ & & WUE_co2 & Coefficient for WUE dependency on atmospheric CO2 concentration \\
\hline $W U E_{V P D}$ & & WUE_vpd & Coefficient for WUE dependency on vapor pressure deficit \\
\hline $J_{\text {max }}$ & umole . $m^{-2} \cdot s^{-1}$ & Jmax & Maximum rate of electron transport at current leaf temperature \\
\hline $V_{\text {max }, 298}$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & Vmax & Rubisco's maximum carboxylation rate at current leaf temperature \\
\hline $J_{\text {max }, 298}$ & umole . $m^{-2} \cdot s^{-1}$ & Jmax298 & Maximum rate of electron transport at 298 K \\
\hline $V_{\text {max }, 298}$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & Vmax298 & Rubisco's maximum carboxylation rate at 298 K \\
\hline $T_{\text {leaf }}$ & ${ }^{\circ} C$ & & Leaf temperature. \\
\hline $u_{\text {leaf }}$ & $m \cdot s^{-1}$ & & Leaf-level wind speed. \\
\hline $V P D_{\text {leaf }}$ & kPa & & Leaf vapour pressure deficit. \\
\hline $g_{w}$ & mol $\mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ & & Leaf diffusive conductance to water vapor \\
\hline $g_{c}$ & mol $C O_{2}$. $s^{-1} \cdot m^{-2}$ & & Leaf diffusive conductance to carbon dioxide \\
\hline $g_{s w}$ & mol $\mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ & & Leaf stomatal conductance to water vapour \\
\hline $g_{s w, \text { min }}$ & mol $\mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ & Gswmin & Minimum stomatal conductance to water vapour \\
\hline $g_{s w, \text { max }}$ & $\mathrm{mol} \mathrm{H}_{2} \mathrm{O}$. $s^{-1} \cdot m^{-2}$ & Gswmax & Maximum stomatal conductance to water vapour \\
\hline $\Phi_{P A R}^{\text {leaf }}$ $Q_{P A R}^{\text {leaf }}$ & & & Photosynthetically active radiation absorbed per leaf area PAR photon flux density per leaf area \\
\hline & $W \cdot m^{-2}$ $\mu \mathrm{mol}$ photon. $m^{-2} \cdot s^{-1}$ & & \\
\hline $A_{c}$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & & Rubisco-limited photosynthesis rate \\
\hline $A_{e}$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & & Electron transport-limited photosynthesis rate \\
\hline $A$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & & Leaf gross photosynthesis rate \\
\hline $A_{n}$ & $\mu \mathrm{mol} C O_{2}$. $s^{-1} \cdot m^{-2}$ & & Leaf net photosynthesis rate \\
\hline
\end{tabular}

\section*{B. 13 Plant water content}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $L F M C_{\max }$ & \% & maxFMC & Maximum live fuel moisture content, corresponding to fine fuels ( $<6.35 \mathrm{~mm}$ twigs and leaves). \\
\hline $\epsilon_{\text {leaf }}$ & MPa & LeafEPS & Modulus of elasticity of leaves \\
\hline $\epsilon_{\text {stem }}$ & MPa & StemEPS & Modulus of elasticity of symplastic xylem tissue \\
\hline $\pi_{0, \text { leaf }}$ & MPa & LeafPI0 & Osmotic potential at full turgor of leaves \\
\hline $\pi_{0, \text { stem }}$ & MPa & StemPI0 & Osmotic potential at full turgor of symplastic xylem tissue \\
\hline $R W C$ & [0-1] & & Relative water content \\
\hline $R W C_{\text {sym }}$ & [0-1] & & Relative water content in the symplasm fraction of a tissue \\
\hline $R W C_{\text {apo }}$ & [0-1] & & Relative water content in the apoplasm fraction of a tissue \\
\hline $V_{\text {segment }}$ & $l \cdot m^{-2}$ & & Water capacity of a segment (leaf or stem) \\
\hline $V_{\text {leaf }}$ & $l \cdot m^{-2}$ & Vleaf & Leaf water capacity per leaf area unit \\
\hline $V_{\text {sapwood }}$ & $l \cdot m^{-2}$ & Vsapwood & Sapwood water capacity per leaf area unit \\
\hline
\end{tabular}

\section*{B. 14 Stomatal regulation}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline \multicolumn{4}{|l|}{$\theta_{2}\left(\Psi_{\text {leaf }}\right)$} \\
\hline $\beta\left(\Psi_{\text {leaf }}\right)$ & [0-1] & & Gain function \\
\hline $\operatorname{Profit}_{1}\left(\Psi_{\text {leaf }}\right)$, & [0-1] & & Profit functions 1 and 2 \\
\hline \multicolumn{4}{|l|}{Profit $_{2}\left(\Psi_{\text {leaf }}\right)$} \\
\hline $E_{\text {sunlit }}$ & mmol $\cdot$ $s^{-1} \cdot m^{-2}$ & & Instantaneous transpiration flow rate for sunlit leaves \\
\hline $E_{\text {shade }}$ & mmol. $s^{-1} \cdot m^{-2}$ & & Instantaneous transpiration flow rate for shade leaves \\
\hline
\end{tabular}

\section*{B. 15 Carbon pools}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $V_{\text {storage,leaf }, i}$ & $V_{\text {storage,sapwood, },} L \cdot$ ind $^{-1}$ & & Leaf (carbon) storage volume for an individual of cohort $i$ \\
\hline $S S_{\text {leaf }, i}$ & molgluc $\cdot$ $L^{-1}$ & SugarLeaf & Sugar concentration in leaves of cohort $i$ \\
\hline $S S_{\text {sapwood, } i}$ & molgluc $\cdot$ $L^{-1}$ & SugarSapwood & Sugar concentration in sapwood of cohort $i$ \\
\hline $S T_{\text {leaf }, i}$ & molgluc. $L^{-1}$ & StarchLeaf & Starch concentration in leaves of cohort $i$ \\
\hline $S T_{\text {sapwood, } i}$ & molgluc. $L^{-1}$ & StarchSapwood & Starch concentration in sapwood of cohort $i$ \\
\hline $S_{\text {plant }}$ & molgluc $\cdot$ ind ${ }^{-1}$ & & Total labile carbon storage in a plant individual \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $B_{\text {leaf }}$ & gdry.ind ${ }^{-1}$ & & Leaf dry biomass in a plant individual (for respiration costs) \\
\hline $B_{\text {sapwood }}$ & gdry.ind ${ }^{-1}$ & & Sapwood dry biomass in a plant individual \\
\hline $B_{\text {living,sapwood }}$ & gdry.ind ${ }^{-1}$ & & Sapwood dry biomass corresponding to (living) parenchymatic tissues in a plant individual (for respiration costs) \\
\hline $B_{\text {fineroot }}$ & gdry.ind ${ }^{-1}$ & & Fine root dry biomass in a plant individual (for respiration costs) \\
\hline
\end{tabular}

\section*{B. 16 Carbon balance}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $M_{\text {leaf }}$ & mol gluc • $d a y^{-1}$ & & Leaf daily maintenance respiration in a plant individual \\
\hline $M_{\text {sapwood }}$ & molgluc $\cdot$ $d a y^{-1}$ & & Sapwood daily maintenance respiration in a plant individual \\
\hline $M_{\text {fineroot }}$ & molgluc • $d a y^{-1}$ & & Fine root daily maintenance respiration in a plant individual \\
\hline $M R_{\text {leaf }}$ & ggluc. g $d r y^{-1}$. $d a y^{-1}$ & RERleaf & Leaf respiration rate at $20{ }^{\circ} \mathrm{C}$ \\
\hline $M R_{\text {sapwood }}$ & ggluc. gdry ${ }^{-1}$. $d a y^{-1}$ & RERsapwood & Living sapwood (parenchymatic tissue) respiration rate at $20^{\circ} \mathrm{C}$ \\
\hline $M R_{\text {fineroot }}$ & ggluc $\cdot$ g $d r y^{-1}$. $d a y^{-1}$ & RERfineroot & Fine root respiration rate at $20{ }^{\circ} \mathrm{C}$ \\
\hline $G_{\text {leaf }}$ & molgluc • $d a y^{-1}$ & & Leaf daily growth respiration in a plant individual \\
\hline $G_{\text {sapwood }}$ & mol gluc • $d a y^{-1}$ & & Sapwood daily growth respiration in a plant individual \\
\hline $G_{\text {fineroot }}$ & molgluc $\cdot$ $d a y^{-1}$ & & Fine root daily growth respiration in a plant individual \\
\hline $F_{\text {phloem }}$ & molgluc • $d a y^{-1}$ & & Daily phloem transport of sugars from leaves to sapwood \\
\hline $S C_{\text {leaf }}$ & molgluc $\cdot$ $d a y^{-1}$ & & Daily conversion from leaf sugar to leaf starch \\
\hline $S C_{\text {sapwood }}$ & molgluc • $d a y^{-1}$ & & Daily conversion from sapwood sugar to sapwood starch \\
\hline $T S_{\text {leaf }}$ & molgluc • $d a y^{-1}$ & & Daily translocation of leaf sugars (prior to senescence) \\
\hline $T S_{\text {sapwood }}$ & molgluc $\cdot$ $d a y^{-1}$ & & Daily translocation of sapwood sugars (prior to senescence) \\
\hline $T T_{\text {leaf }}$ & molgluc $\cdot$ $d a y^{-1}$ & & Daily translocation of leaf starch (prior to senescence) \\
\hline $R E_{\text {leaf }}$ & molgluc $\cdot$ $d a y^{-1}$ & & Daily root exudation of leaf carbon \\
\hline $R E_{\text {sapwood }}$ & molgluc • $d a y^{-1}$ & & Daily root exudation of sapwood carbon \\
\hline
\end{tabular}

\section*{B. 17 Growth, senescence and mortality}

\begin{tabular}{|l|l|l|l|}
\hline Symbol & Units & R & Description \\
\hline $R G R_{\text {leaf, } \max }$ & $m^{2} \cdot c m^{-2}$. $d a y^{-1}$ & RGRleafmax & Maximum leaf area daily growth rate, relative to sapwood area \\
\hline $R G R_{\text {sapwood }, \text { max }} \mathrm{cm}^{2} \cdot \mathrm{~cm}^{-2}$. $d a y^{-1}$ & & RGRsapwoodmax & Maximum daily sapwood relative growth rate (in sapwood area basis) \\
\hline $R G R_{\text {fineroot }, m}$ & $g d r y$. $g d r y^{-1}$. $d a y^{-1}$ & RGRfinerootmax & Maximum daily fine root relative growth rate \\
\hline $L A^{\text {target }}$ & $m^{2}$ & & Leaf area allocation target \\
\hline $\Delta L A_{\text {alloc }}$ & $m^{2}$ & & Leaf area increase dictated by the difference between leaf area allocation target and current leaf area \\
\hline $\Delta L A_{\text {source }}$ & $m^{2}$ & & Leaf area increase according to leaf metabolic carbon availability \\
\hline $\Delta L A_{\text {sink }}$ & $m^{2}$ & & Leaf area increase dictated by sink limitations (leaf relative growth rate and relative cell expansion rate) \\
\hline $\Delta L A$ & $m^{2}$ & & Actual leaf area increase \\
\hline $\Delta S A_{\text {source }}$ & $\mathrm{cm}^{2}$ & & Sapwood area increase according to sapwood storage carbon availability \\
\hline $\Delta S A_{\text {sink }}$ & $\mathrm{cm}^{2}$ & & Sapwood area increase dictated by sink limitations \\
\hline $\Delta S A$ & $\mathrm{cm}^{2}$ & & Actual sapwood area increase \\
\hline $B_{\text {fineroot,target }}$ & g dry & & Fine root biomass allocation target \\
\hline $\Delta B_{\text {fineroot, alloc }}$ & gdry & & Fine root biomass increase dictated by the difference between fine root biomass allocation target and current fine root biomass \\
\hline \multicolumn{3}{|l|}{$\Delta B_{\text {fineroot,sourc }} d r y$} & Fine root biomass increase according to sapwood metabolic carbon availability \\
\hline $\Delta B_{\text {fineroot, sink }}$ & g dry & & Fine root biomass increase dictated by sink limitations (fine root relative growth rate and relative cell expansion rate) \\
\hline $\Delta B_{\text {fineroot }}$ & gdry & & Actual fine root biomass increase \\
\hline
\end{tabular}

Adams, H.D., Park Williams, A., Xu, C., Rauscher, S.A., Jiang, X. \& McDowell, N.G. (2013). Empirical and process-based approaches to climate-induced forest mortality models. Frontiers in Plant Science, 4, 1-5.
Adams, H.D., Zeppel, M.J.B., Anderegg, W.R.L., Hartmann, H., Landhäusser, S.M., Tissue, D.T., et al. (2017). A multi-species synthesis of physiological mechanisms in drought-induced tree mortality. Nature Ecology and Evolution, 1, 1285-1291.
Albini, F.A. (1976). Estimating wildfire behavior and effects. For. Serv. Gen. Tech. Rep. INT-30, 4235, 44 ST-Guidelines and sample protocol for sampli.
Albini, F. \& Baughman, R. (1979). Estimating windspeeds for predicting wildland fire behavior. USDA Forest Service, Intermountain Forest and Range Experiment Station, Research Paper, INT-RP-221.
Ameztegui, A., Cabon, A., De Caceres, M. \& Coll, L. (2017). Managing stand density to enhance the adaptability of Scots pine stands to climate change: A modelling approach. Ecological Modelling, 356, 141-150.
Anderegg, W.R.L., Wolf, A., Arango-Velez, A., Choat, B., Chmura, D.J., Jansen, S., et al. (2018). Woody plants optimise stomatal behaviour relative to hydraulic risk. Ecology Letters, 21, 968-977.
Anten, N.P.R. \& Bastiaans, L. (2016). The use of canopy models to analyze light competition among plants. In: Canopy photosynthesis: From basics to application (eds. Hikosaka, K., Niinemets, Ü. \& Anten, N.P.R.). Springer, pp. 379-398.

Bär, A., Michaletz, S.T. \& Mayr, S. (2019). Fire effects on tree physiology. New Phytologist, 223, 1728-1741. Bartlett, M.K., Klein, T., Jansen, S., Choat, B. \& Sack, L. (2016). The correlations and sequence of plant
stomatal, hydraulic, and wilting responses to drought. Proceedings of the National Academy of Sciences of the United States of America, 113, 13098-13103.
Bartlett, M.K., Scoffoni, C. \& Sack, L. (2012). The determinants of leaf turgor loss point and prediction of drought tolerance of species and biomes: A global meta-analysis. Ecology letters, 15, 393-405.
Bernacchi, C.J., Singsaas, E.L., Pimentel, C., Portis, A.R. \& Long, S.P. (2001). Improved temperature response functions for models of Rubisco-limited photosynthesis. Plant, Cell and Environment, 24, 253259.

Best, M.J., Pryor, M., Clark, D.B., Rooney, G.G., Essery, R.L.H., Ménard, C.B., et al. (2011). The Joint UK Land Environment Simulator (JULES), model description - Part 1: Energy and water fluxes. Geoscientific Model Development, 4, 677-699.
Birk, E.M. \& Simpson, R.W. (1980). Steady state and the continuous input model of litter accumulation and decompostion in Australian eucalypt forests. Ecology, 61, 481-485.
Blackman, C.J., Pfautsch, S., Choat, B., Delzon, S., Gleason, S.M. \& Duursma, R.A. (2016). Toward an index of desiccation time to tree mortality under drought. Plant Cell and Environment, 39, 2342-2345.
Bonan, G. (2019). Climate change and terrestrial ecosystem modeling. Cambridge University Press, Cambridge, UK.
Bonan, G.B., Williams, M., Fisher, R.A. \& Oleson, K.W. (2014). Modeling stomatal conductance in the earth system: Linking leaf water-use efficiency and water transport along the soil-plant-atmosphere continuum. Geoscientific Model Development, 7, 2193-2222.
Boughton, W. (1989). A review of the USDA SCS curve number method. Australian Journal of Soil Research, 27, 511-523.
Bugmann, H., Seidl, R., Hartig, F., Bohn, F., Brůna, J., Cailleret, M., et al. (2019). Tree mortality submodels drive simulated long-term forest dynamics: Assessing 15 models from the stand to global scale. Ecosphere, 10, e02616.
Bullock, J.M., Mallada González, L., Tamme, R., Götzenberger, L., White, S.M., Pärtel, M., et al. (2017). A synthesis of empirical plant dispersal kernels. Journal of Ecology, 105, 6-19.
Butler, B.W. \& Dickinson, M.B. (2010). Tree Injury and Mortality in Fires: Developing Process-Based Models. Fire Ecology, 6, 55-79.
Byram, G.M. (1959). Combustion of forest fuels. In: Forest fire: Control and use (ed. Davis, K.P.). McGraw-Hill, New York, pp. 61-89.
Cabon, A., Fernández-de-Uña, L., Gea-Izquierdo, G., Meinzer, F.C., Woodruff, D.R., Martínez-Vilalta, J., et al. (2020a). Water potential control of turgor-driven tracheid enlargement in Scots pine at its xeric distribution edge. New Phytologist, 225, 209-221.
Cabon, A., Peters, R.L., Fonti, P., Martínez-Vilalta, J. \& De Cáceres, M. (2020b). Temperature and water potential co-limit stem cambial activity along a steep elevational gradient. New Phytologist, 226, 13251340.

Campbell, G.S. \& Norman, J.M. (1998). An introduction to environmental biophysics. Springer-Verlag, New York.
Cannell, M.G.R. \& Thornley, J.H.M. (2000). Modelling the Components of Plant Respiration: Some Guiding Principles. Annals of Botany, 85, 45-54.
Carsel, R.F. \& Parrish, R.S. (1988). Developing joint probability distributions of soil water retention characteristics. Water Resources Research, 24, 755-769.
Cho, N., Kang, S., Agossou, C., Kim, E. \& Lim, J.-H. (2022). Modeling temporal variations of non-structural carbohydrate (NSC) storages across biomes. Forest Ecology and Management, 508, 120033.
Choat, B., Jansen, S., Brodribb, T.J., Cochard, H., Delzon, S., Bhaskar, R., et al. (2012). Global convergence in the vulnerability of forests to drought. Nature, 491, 752-755.
Christoffersen, B.O., Gloor, M., Fauset, S., Fyllas, N.M., Galbraith, D.R., Baker, T.R., et al. (2016). Linking hydraulic traits to tropical forest function in a size-structured and trait-driven model (TFS v.1-Hydro). Geoscientific Model Development Discussions, 9, 4227-4255.
Chuine, I., Garcia de Cortazar-Atauri, I., Kramer, K. \& Hänninen, H. (2013). Plant Development Models. In: Phenology: An Integrative Environmental Science (ed. Schwartz, M.D.). Springer Science, Dordrecht, pp. 275-293.
Clark, J.S., Macklin, E. \& Wood, L. (1998). Stages and spatial scales of recruitment limitation in Southern Appalachian forests. Ecological Monographs, 68, 213-235.

Cochard, H., Pimont, F., Ruffault, J. \& Martin-StPaul, N. (2021). SurEau: A mechanistic model of plant water relations under extreme drought. Annals of Forest Science, 78.
Collatz, G.J., Ball, J.T., Grivet, C. \& Berry, J.A. (1991). Physiological and environmental regulation of stomatal conductance, photosynthesis and transpiration: A model that includes a laminar boundary layer. Agricultural and Forest Meteorology, 54, 107-136.
Collins, D.B.G. \& Bras, R.L. (2007). Plant rooting strategies in water-limited ecosystems. Water Resources Research, 43, W06407.
Cox, P.M., Betts, R.A., Bunton, C.B., Essery, R.L.H., Rowntree, P.R. \& Smith, J. (1999). The impact of new land surface physics on the GCM simulation of climate and climate sensitivity. Climate Dynamics, 15, 183-203.
De Cáceres, M., Casals, P., Gabriel, E. \& Castro, X. (2019). Scaling-up individual-level allometric equations to predict stand-level fuel loading in Mediterranean shrublands. Annals of Forest Science, 76, 87.
De Cáceres, M., Martínez-Vilalta, J., Coll, L., Llorens, P., Casals, P., Poyatos, R., et al. (2015). Coupling a water balance model with forest inventory data to predict drought stress: The role of forest structural changes vs. Climate changes. Agricultural and Forest Meteorology, 213, 77-90.
De Cáceres, M., Martin-StPaul, N., Turco, M., Cabon, A. \& Granda, V. (2018). Estimating daily meteorological data and downscaling climate models over landscapes. Environmental Modelling \&3 Software, 108, 186-196.
De Cáceres, M., Mencuccini, M., Martin-StPaul, N., Limousin, J.-M., Coll, L., Poyatos, R., et al. (2021). Unravelling the effect of species mixing on water use and drought stress in Mediterranean forests: A modelling approach. Agricultural and Forest Meteorology, 296, 108233.
De Cáceres, M., Molowny-Horas, R., Cabon, A., Martínez-Vilalta, J., Mencuccini, M., García-Valdés, R., et al. (2023). MEDFATE 2.9.3: A trait-enabled model to simulate Mediterranean forest function and dynamics at regional scales. Geoscientific Model Development, 16, 3165-3201.
De Pury, D.G.G. \& Farquhar, G.D. (1997). Simple scaling of photosynthesis from leaves to canopies without the errors of big-leaf models. Plant, Cell and Environment, 20, 537-557.
Deguchi, A., Hattori, S. \& Park, H.-T. (2006). The influence of seasonal changes in canopy structure on interception loss: Application of the revised Gash model. Journal of Hydrology, 318, 80-102.
Delpierre, N., Dufrêne, E., Soudani, K., Ulrich, E., Cecchini, S., Boé, J., et al. (2009). Modelling interannual and spatial variability of leaf senescence for three deciduous tree species in France. Agricultural and Forest Meteorology, 149, 938-948.
Dharssi, I., Vidale, P.L., Verhoef, A., MacPherson, B., Jones, C. \& Best, M. (2009). New soil physical properties implemented in the Unified Model at PS18, 9-12.
Dietze, M.C., Sala, A., Carbone, M.S., Czimczik, C.I., Mantooth, J.A., Richardson, A.D., et al. (2014). Nonstructural Carbon in Woody Plants. Annual Review of Plant Biology, 65, 667-687.
Dunlap, F. (1914). Density of wood substance and porosity of wood. Journal of Agricultural Research, II, 423-428.
Duursma, R.A., Blackman, C.J., Lopéz, R., Martin-StPaul, N.K., Cochard, H. \& Medlyn, B.E. (2018). On the minimum leaf conductance: Its role in models of plant water use, and ecological and environmental controls. New Phytologist, 221, 693-705.
Espelta, J.M., Barbati, A., Quevedo, L., Tárrega, R., Navascués, P., Bonfil, C., et al. (2012). Post-Fire Management of Mediterranean Broadleaved Forests. In: Post-Fire Management and Restoration of Southern European Forests, Managing Forest Ecosystems (eds. Moreira, F., Arianoutsou, M., Corona, P. \& De las Heras, J.). Springer Netherlands, Dordrecht, pp. 171-194.
Espelta, J.M., Habrouk, A. \& Retana, J. (2006). Response to natural and simulated browsing of two Mediterranean oaks with contrasting leaf habit after a wildfire. Annals of Forest Science, 63, 441-447.
Espelta, J.M., Sabaté, S. \& Retana, J. (1999). Resprouting Dynamics. In: Ecology of Mediterranean Evergreen Oak Forests, Ecological Studies (eds. Rodà, F., Retana, J., Gracia, C.A. \& Bellot, J.). Springer, Berlin, Heidelberg, pp. 61-73.
Fatichi, S., Leuzinger, S. \& Körner, C. (2014). Moving beyond photosynthesis: From carbon source to sink-driven vegetation modeling. New Phytologist, 201, 1086-1095.
Federer, C. (1982). Transpirational supply and demand: Plant, soil, and atmospheric effects evaluated by simulation. Water Resources Research, 18, 355-362.
Fisher, R.A., Williams, M., Do Vale, L.R., Da Costa, A.L. \& Meir, P. (2006). Evidence from Amazonian
forests is consistent with a model of isohydric control of leaf water potential. Plant, Cell and Environment, 29, 151-165.
Flerchinger, G.N., Xiao, W., Sauer, T.J. \& Yu, Q. (2009). Simulation of within-canopy radiation exchange. NJAS - Wageningen Journal of Life Sciences, 57, 5-15.
Först, P., Werner, F. \& Delgado, A. (2002). On the pressure dependence of the viscosity of aqueous sugar solutions. Rheologica Acta, 41, 369-374.
Francés, F., Vélez, J.I. \& Vélez, J.J. (2007). Split-parameter structure for the automatic calibration of distributed hydrological models. Journal of Hydrology, 332, 226-240.
Franks, P.J. (2006). Higher rates of leaf gas exchange are associated with higher leaf hydrodynamic pressure gradients. Plant, Cell and Environment, 29, 584-592.
Friend, A.D., Eckes-Shephard, A.H., Fonti, P., Rademacher, T.T., Rathgeber, C.B.K., Richardson, A.D., et al. (2019). On the need to consider wood formation processes in global vegetation models and a suggested approach. Annals of Forest Science, 76, 49.
Friend, A.D., Stevens, A.K., Knox, R.G. \& Cannell, M.G.R. (1997). A process-based, terrestrial biosphere model of ecosystem dynamics (Hybrid v3.0). Ecological Modelling, 95, 249-287.
Fyllas, N.M. \& Troumbis, A.Y. (2009). Simulating vegetation shifts in north-eastern Mediterranean mountain forests under climatic change scenarios. Global Ecology and Biogeography, 18, 64-77.
García-Jiménez, R., Palmero-Iniesta, M. \& Espelta, J. (2017). Contrasting Effects of Fire Severity on the Regeneration of Pinus halepensis Mill. And Resprouter Species in Recently Thinned Thickets. Forests, 8, 55.
Gash, J., Lloyd, C. \& Lachaud, G. (1995). Estimating sparse forest rainfall interception with an analytical model. Journal of Hydrology, 170.
Genuchten, M.V. (1980). A closed-form equation for predicting the hydraulic conductivity of unsaturated soils. Soil science society of America journal, 44, 892-898.
Gifford, R.M. (2003). Plant respiration in productivity models: Conceptualisation, representation and issues for global terrestrial carbon-cycle research. Functional Plant Biology, 30, 171-186.
Granier, A., Bréda, N., Biron, P. \& Villette, S. (1999). A lumped water balance model to evaluate duration and intensity of drought constraints in forest stands. Ecological Modelling, 116, 269-283.
Granier, A., Reichstein, M., Bréda, N., Janssens, I.A., Falge, E., Ciais, P., et al. (2007). Evidence for soil water control on carbon and water dynamics in European forests during the extremely dry year: 2003. Agricultural and Forest Meteorology, 143, 123-145.
Green, H.W. \& Ampt, G.A. (1911). Studies on Soil Physics. The Journal of Agricultural Science, 4, 1-24.
Guillemot, J., Martin-Stpaul, N.K., Dufrêne, E., François, C., Soudani, K., Ourcival, J.M., et al. (2015). The dynamic of the annual carbon allocation to wood in European tree species is consistent with a combined source-sink limitation of growth: Implications for modelling. Biogeosciences, 12, 2773-2790.
Hammond, W.M., Yu, Kailiang.L., Wilson, L.A., Will, R.E., Anderegg, W.R.L. \& Adams, H.D. (2019). Dead or dying? Quantifying the point of no return from hydraulic failure in drought-induced tree mortality. New Phytologist.
Hasenauer, H. \& Monserud, R.A. (1996). A crown ratio model for Austrian Forests. Forest Ecology and Management, 84, 49-60.
Haverkamp, R., Vauclin, M., Touma, J., Wierenga, P.J. \& Vachaud, G. (1977). A Comparison of Numerical Simulation Models For One-Dimensional Infiltration. Soil Science Society of America Journal, 41, 285294.

Hawkes, C. (2000). Woody plant mortality algorithms: Description, problems and progress. Ecological Modelling, 126, 225-248.
Hikosaka, K., Kumagai, T. \& Ito, A. (2016). Modeling Canopy Photosynthesis. pp. 239-268.
Hölttä, T., Cochard, H., Nikinmaa, E. \& Mencuccini, M. (2009). Capacitive effect of cavitation in xylem conduits: Results from a dynamic model. Plant, Cell and Environment, 32, 10-21.
Hölttä, T., Lintunen, A., Chan, T., Mäkelä, A. \& Nikinmaa, E. (2017). A steady-state stomatal model of balanced leaf gas exchange, hydraulics and maximal source-sink flux. Tree physiology, 37, 851-868.
Hood, S.M., Varner, J.M., Van Mantgem, P. \& Cansler, C.A. (2018). Fire and tree death: Understanding and improving modeling of fire-induced tree mortality. Environmental Research Letters, 13.
Hoshika, Y., Osada, Y., Marco, A. de, Peñuelas, J. \& Paoletti, E. (2018). Global diurnal and nocturnal parameters of stomatal conductance in woody plants and major crops. Global Ecology and Biogeography,

27, 257-275.
Jarvis, N.J., Jansson, P-E., Dik, P.E. \& Messing, I. (1991). Modelling water and solute transport in macroporous soil. I. Model description and sensitivity analysis. Journal of Soil Science, 42, 59-70.
Karavani, A., De Cáceres, M., Martínez de Aragón, J., Bonet, J.A. \& de-Miguel, S. (2018). Effect of climatic and soil moisture conditions on mushroom productivity and related ecosystem services in Mediterranean pine stands facing climate change. Agricultural and Forest Meteorology, 248, 432-440.
Katul, G.G., Mahrt, L., Poggi, D. \& Sanz, C. (2004). One- and two-equation models for canopy turbulence. Boundary-Layer Meteorology, 113, 81-109.
Keane, R., Austin, M., Field, C. \& Huth, A. (2001). Tree mortality in gap models: Application to climate change. Climatic Change, 51, 509-540.
Kergoat, L. (1998). A model for hydrological equilibrium of leaf area index on a global scale. Journal of Hydrology, 212-213, 268-286.
Körner, C. (2015). Paradigm shift in plant growth control. Current Opinion in Plant Biology, 25, 107-114.
Körner, C. (2019). No need for pipes when the well is dry-a comment on hydraulic failure in trees. Tree physiology, 39, 695-700.
Krajicek, J., Brinkman, K. \& Gingrich, S. (1961). Crown competition-a measure of density. Forest Science, 7, 35-42.
Kursar, T.A., Engelbrecht, B.M.J., Burke, A., Tyree, M.T., El Omari, B. \& Giraldo, J.P. (2009). Tolerance to low leaf water status of tropical tree seedlings is related to drought performance and distribution. Functional Ecology, 23, 93-102.
Lai, C., Katul, G., Oren, R., Ellsworth, D. \& Schäfer, K. (2000). Modeling CO2 and water vapor turbulent flux distributions within a forest canopy. Journal of Geophysical Research: Atmospheres, 105, 2633326351.

Landsberg, J.J. \& Waring, R.H. (1997). A generalised model of forest productivity using simplified concepts of radiation-use efficiency, carbon balance and partitioning. Forest Ecology and Management, 95, 209228.

Larsbo, M., Roulier, S., Stenemo, F., Kasteel, R. \& Jarvis, N. (2005). An Improved Dual-Permeability Model of Water Flow and Solute Transport in the Vadose Zone. Vadose Zone Journal, 4, 398-406.
Leij, F.J., Alves, W.J., Genuchten, M.Th.V. \& Williams, J.R. (1996). The UNSODA Unsaturated Soil Hydraulic Database User's Manual Version 1.0.
Leuning, R. (2002). Temperature dependence of two parameters in a photosynthesis model. Plant, Cell and Environment, 25, 1205-1210.
Lindner, M., Sievänen, R. \& Pretzsch, H. (1997). Improving the simulation of stand structure in a forest gap model. Forest Ecology and Management, 95, 183-195.
Liu, S. (2001). Evaluation of the Liu model for predicting rainfall interception in forests world-wide. Hydrological Processes, 15, 2341-2360.
Lloret, F., Siscart, D. \& Dalmases, C. (2004). Canopy recovery after drought dieback in holm-oak Mediterranean forests of Catalonia (NE Spain). Global Change Biology, 10, 2092-2099.
Ma, Y. \& Liu, H. (2019). An Advanced Multiple-Layer Canopy Model in the WRF Model With LargeEddy Simulations to Simulate Canopy Flows and Scalar Transport Under Different Stability Conditions. Journal of Advances in Modeling Earth Systems, 11, 2330-2351.
Magnani, F., Mencuccini, M. \& Grace, J. (2000). Age-related decline in stand productivity: The role of structural acclimation under hydraulic constraints. Plant, Cell and Environment, 23, 251-263.
Maherali, H., Pockman, W. \& Jackson, R. (2004). Adaptive variation in the vulnerability of woody plants to xylem cavitation. Ecology, 85, 2184-2199.
Manoli, G., Huang, C., Bonetti, S., Domec, J., Marani, M. \& Katul, G. (2017). Competition for light and water in a coupled soil-plant system. Advances in Water Resources, 108, 216-230.
Martinez-Vilalta, J., Anderegg, W.R.L., Sapes, G. \& Sala, A. (2019). Greater focus on water pools may improve our ability to understand and anticipate drought-induced mortality in plants. New Phytologist, 223, 22-32.
Martínez-Vilalta, J., Sala, A., Asensio, D., Galiano, L., Hoch, G., Palacio, S., et al. (2016). Dynamics of non-structural carbohydrates in terrestrial plants: A global synthesis. Ecological Monographs, 86, 495-516.
Martin-StPaul, N., Delzon, S. \& Cochard, H. (2017). Plant resistance to drought depends on timely stomatal
closure. Ecology Letters, 20, 1437-1447.
Massman, W. (1987). A comparative study of some mathematical models of the mean wind structure and aerodynamic drag of plant canopies. Boundary-Layer Meteorology, 40, 179-197.
McDowell, N.G. (2011). Mechanisms linking drought, hydraulics, carbon metabolism, and vegetation mortality. Plant Physiology, 155, 1051-1059.
McDowell, N.G., Sapes, G., Pivovaroff, A., Adams, H.D., Allen, C.D., Anderegg, W.R.L., et al. (2022). Mechanisms of woody-plant mortality under rising drought, CO2 and vapour pressure deficit. Nature Reviews Earth $\varepsilon 6$ Environment, 0123456789, 294-308.
McDowell, N., Pockman, W.T., Allen, C.D., Breshears, D.D., Cobb, N., Kolb, T., et al. (2008). Mechanisms of plant survival and mortality during drought: Why do some plants survive while others succumb to drought? The New Phytologist, 178, 719-39.
McMurtrie, R.E., Rook, D.A. \& Kelliher, F.M. (1990). Modelling the yield of Pinus radiata on a site limited by water and nitrogen. Forest Ecology and Management, 30, 381-413.
Medlyn, B.E., Loustau, D. \& Delzon, S. (2002). Temperature response of parameters of a biochemically based model of photosynthesis. I. Seasonal changes in mature maritime pine (Pinus pinaster Ait.). Plant, Cell and Environment, 25, 1155-1165.
Mencuccini, M. \& Grace, J. (1995). Climate influences the leaf area/sapwood area ratio in Scots pine. Tree Physiology, 15, 1-10.
Michaletz, S.T. \& Johnson, E.A. (2006). A heat transfer model of crown scorch in forest fires. Canadian Journal of Forest Research, 36, 2839-2851.
Michaletz, S.T. \& Johnson, E.A. (2008). A biophysical process model of tree mortality in surface fires. Canadian Journal of Forest Research, 38, 2013-2029.
Miralles, D.G., Gash, J.H., Holmes, T.R.H., Jeu, R.A.M. de \& Dolman, A.J. (2010). Global canopy interception from satellite observations. Journal of Geophysical Research, 115, D16122.
Mitsopoulos, I.D. \& Dimitrakopoulos, A.P. (2007). Allometric equations for crown fuel biomass of Aleppo pine (Pinus halepensis Mill.) in Greece. International Journal of Wildland Fire, 16, 642-647.
Moreira, B., Tormo, J. \& Pausas, J.G. (2012). To resprout or not to resprout: Factors driving intraspecific variability in resprouting. Oikos, 121, 1577-1584.
Mouillot, F., Rambal, S. \& Joffre, R. (2002). Simulating climate change impacts on fire frequency and vegetation dynamics in a Mediterranean-type ecosystem. Global Change Biology, 8, 423-437.
Mouillot, F., Rambal, S. \& Lavorel, S. (2001). A generic process-based SImulator for meditERRanean landscApes (SIERRA): Design and validation exercises. Forest Ecology and Management, 147, 75-97.
Nathan, R., Klein, E., Robledo-Arnuncio, J.J. \& Revilla, E. (2012). Dispersal kernels: review. In: Dispersal Ecology and Evolution (eds. Clobert, J., Baguette, M., Benton, T.G. \& Bullock, J.M.). Oxford University Press, pp. 186-210.
Nathan, R., Safriel, U.N. \& Noy-Meir, I. (2001). Field validation and sensitivity analysis of a mechanistic model for tree seed dispersal by wind. Ecology, 82, 374-388.
Ogle, K. \& Pacala, S.W. (2009). A modeling framework for inferring tree growth and allocation from physiological, morphological and allometric traits. Tree Physiology, 29, 587-605.
Oliveras, I., Martínez-Vilalta, J., Jimenez-Ortiz, T., Lledó, M.J., Escarré, A. \& Piñol, J. (2003). Hydraulic architecture of Pinus halepensis, P . Pinea and Tetraclinis articulata in a dune ecosystem of Eastern Spain. Plant Ecology, 131-141.
Olson, M.E., Anfodillo, T., Rosell, J.A., Petit, G., Crivellaro, A., Isnard, S., et al. (2014). Universal hydraulics of the flowering plants: Vessel diameter scales with stem length across angiosperm lineages, habits and climates. Ecology Letters, 17, 988-997.
Ostendorf, B. \& Reynolds, J.F. (1993). Relationships between a terrain-based hydrologic model and patchscale vegetation patterns in an arctic tundra landscape. Landscape Ecology, 8, 229-237.
Pausas, J.G., Pratt, R.B., Keeley, J.E., Jacobsen, A.L., Ramirez, A.R., Vilagrosa, A., et al. (2016). Towards understanding resprouting at the global scale. New Phytologist, 209, 945-954.
Pimont, F., Dupuy, J.L. \& Rigolot, E. (2018). A simple model for shrub-strata-fuel dynamics in Quercus coccifera L. communities. Annals of Forest Science, 75, 1-9.
Plavcová, L. \& Jansen, S. (2015). The Role of Xylem Parenchyma in the Storage and Utilization of Nonstructural Carbohydrates. In: Functional and Ecological Xylem Anatomy. Springer International Publishing, Cham, pp. 209-234.

Prentice, I.C., Sykes, M.T. \& Cramer, W. (1993). A simulation model for the transient effects of climate change on forest landscapes. Ecological Modelling, 65, 51-70.
Prescott, C.E., Grayston, S.J., Helmisaari, H.-S., Kaštovská, E., Körner, C., Lambers, H., et al. (2020). Surplus Carbon Drives Allocation and Plant-Soil Interactions. Trends in Ecology ${ }^{69}$ Evolution, 35, 11101118.

Price, D., Zimmermann, N. \& Meer, P.V.D. (2001). Regeneration in gap models: Priority issues for studying forest responses to climate change. Climatic Change, 51, 475-508.
Prichard, S.J., Sandberg, D.V., Ottmar, R.D., Eberhardt, E., Andreu, A., Eagle, P., et al. (2013). Classification System Version 3.0: Technical Documentation.
Rahimi, A.A., Sepaskhah, A.R. \& Ahmadi, S.H. (2011). Evaluation of different methods for the prediction of saturated hydraulic conductivity in tilled and untilled soils. Archives of Agronomy and Soil Science, 57, 899-914.
Rasche, L., Fahse, L., Zingg, A. \& Bugmann, H. (2012). Enhancing gap model accuracy by modeling dynamic height growth and dynamic maximum tree height. Ecological Modelling, 232, 133-143.
Reich, P.B., Tjoelker, M.G., Pregitzer, K.S., Wright, I.J., Oleksyn, J. \& Machado, J.L. (2008). Scaling of respiration to nitrogen in leaves, stems and roots of higher land plants. Ecology Letters, 11, 793-801.
Reinhardt, E., Lutes, D. \& Scott, J. (2006). FuelCalc: A method for estimating fuel characteristics.
Retana, J., Riba, M., Castell, C. \& Espelta, J.M. (1992). Regeneration by sprouting of holm-oak (Quercus ilex) stands exploited by selection thinning. Vegetatio, 99, 355-364.
Richardson, A.D., Carbone, M.S., Keenan, T.F., Czimczik, C.I., Hollinger, D.Y., Murakami, P., et al. (2013). Seasonal dynamics and age of stemwood nonstructural carbohydrates in temperate forest trees. New Phytologist, 197, 850-861.
Ritchie, J. (1972). Model for predicting evaporation from a row crop with incomplete cover. Water resources research, 8, 1204-1213.
Rolo, V. \& Moreno, G. (2019). Shrub encroachment and climate change increase the exposure to drought of Mediterranean wood-pastures. Science of The Total Environment, 660, 550-558.
Rothermel, R.C. (1972). A mathematical model for predicting fire spread in wildland fuels. USDA Forest Service Research Paper INT USA.
Rötzer, T., Häberle, K.H., Kallenbach, C., Matyssek, R., Schütze, G. \& Pretzsch, H. (2017). Tree species and size drive water consumption of beech/spruce forests - a simulation study highlighting growth under water limitation. Plant and Soil, 418, 337-356.
Ruffault, J., Martin-StPaul, N.K., Duffet, C., Goge, F. \& Mouillot, F. (2014). Projecting future drought in Mediterranean forests: Bias correction of climate models matters! Theoretical and Applied Climatology, 117, 113-122.
Ruffault, J., Martin-StPaul, N.K., Rambal, S. \& Mouillot, F. (2013). Differential regional responses in drought length, intensity and timing to recent climate changes in a Mediterranean forested ecosystem. Climatic Change, 117, 103-117.
Ruffault, J., Pimont, F., Cochard, H., Dupuy, J.-L. \& Martin-StPaul, N. (2022). SurEau-Ecos v2.0: A trait-based plant hydraulics model for simulations of plant water status and drought-induced mortality at the ecosystem level. Geoscientific Model Development, 15, 5593-5626.
Sandberg, D.V., Riccardi, C.L. \& Schaaf, M.D. (2007). Reformulation of Rothermel's wildland fire behaviour model for heterogeneous fuelbeds. Canadian Journal of Forest Research, 37, 2438-2455.
Sando, R.W. \& Wick, C.H. (1972). A method of evaluating crown fuels in forest stands. Research Paper NC-84. USDA Forest Service Research Paper NC-84, 10 pp.
Savage, V.M., Bentley, L.P., Enquist, B.J., Sperry, J.S., Smith, D.D., Reich, P.B., et al. (2010). Hydraulic trade-offs and space filling enable better predictions of vascular structure and function in plants. Proceedings of the National Academy of Sciences of the United States of America, 107, 22722-7.
Saxton, K.E. \& Rawls, W.J. (2006). Soil water characteristic estimates by texture and organic matter for hydrologic solutions. Soil Science Society of America Journal, 70, 1569.
Saxton, K.E., Rawls, W.J., Romberger, J.S. \& Papendick, R.I. (1986). Estimating generalized soil-water characteristics from texture. Soil Science Society of America Journal, 50, 1031-1036.
Schaaf, M.D., Sandberg, D.V., Schreuder, M.D. \& Riccardi, C.L. (2007). A conceptual framework for ranking crown fire potential in wildland fuelbeds. Canadian Journal of Forest Research, 37, 2464-2478.
Schenk, H.J. \& Jackson, R.B. (2002). Rooting depths, lateral root spreads and below-ground/above-ground
allometries of plants in water-limited ecosystems. Journal of Ecology, 90, 480-494.
Schume, H., Jost, G. \& Hager, H. (2004). Soil water depletion and recharge patterns in mixed and pure forest stands of European beech and Norway spruce. Journal of Hydrology, 289, 258-274.
Scott, J.H. \& Reinhardt, E.D. (2002). Estimating canopy fuels in conifer forests. Fire Management Today, 62, 45-50.
Sellers, P.J. (1985). Canopy reflectance, photosynthesis and transpiration. International Journal of Remote Sensing, 6, 1335-1372.
Shinozaki, K., Yoda, K., Hozumi, K. \& Kira, T. (1964). A quantitative analysis of plant form - the pipe model theory. I. Basic analysis. Japanese Journal of Ecology, 14, 97-105.
Sitch, S., Smith, B., Prentice, I.C., Arneth, a., Bondeau, a., Cramer, W., et al. (2003). Evaluation of ecosystem dynamics, plant geography and terrestrial carbon cycling in the LPJ dynamic global vegetation model. Global Change Biology, 9, 161-185.
Snell, R.S. (2014). Simulating long-distance seed dispersal in a dynamic vegetation model. Global Ecology and Biogeography, 23, 89-98.
Sperry, J.S., Adler, F.R., Campbell, G.S. \& Comstock, J.P. (1998). Limitation of plant water use by rhizosphere and xylem conductance: Results from a model. Plant, Cell $\mathscr{E}$ Environment, 21, 347-359.
Sperry, J.S. \& Love, D.M. (2015). What plant hydraulics can tell us about responses to climate-change droughts. New Phytologist, 207, 14-27.
Sperry, J.S., Venturas, M.D., Anderegg, W.R.L., Mencuccini, M., Mackay, D.S., Wang, Y., et al. (2017). Predicting stomatal responses to the environment from the optimization of photosynthetic gain and hydraulic cost. Plant, Cell 86 Environment, 40, 816-830.
Sperry, J.S., Wang, Y., Wolfe, B.T., Mackay, D.S., Anderegg, W.R.L., Mcdowell, N.G., et al. (2016). Pragmatic hydraulic theory predicts stomatal responses to climatic water deficits. New Phytologist, 212, 577-589.
Spicer, R. (2005). Senescence in Secondary Xylem: Heartwood Formation as an Active Developmental Program. Vascular Transport in Plants, 457-475.
Spitters, C.J.T., Toussaint, H.A.J.M. \& Goudriaan, J. (1986). Separating the diffuse and direct components of global radiation and its implications for modeling canopy photosynthesis. I. Components of incoming radiation. Agricultural and Forest Meteorology, 38, 231-242.
Stephan, K., Miller, M. \& Dickinson, M.B. (2010). First-Order Fire Effects on Herbs and Shrubs: Present Knowledge and Process Modeling Needs. Fire Ecology, 6, 95-114.
Stolf, R., Thurler, Á., Oliveira, O., Bacchi, S. \& Reichardt, K. (2011). Method to estimate soil macroporosity and microporosity based on sand content and bulk density. Revista Brasileira de Ciencias do Solo, 35, 447-459.
Tjoelker, M.G., Oleksyn, J. \& Reich, P.B. (2001). Modelling respiration of vegetation: Evidence for a general temperature-dependent Q10. Global Change Biology, 7, 223-230.
Tóth, B., Weynants, M., Nemes, A., Makó, A., Bilas, G. \& Tóth, G. (2015). New generation of hydraulic pedotransfer functions for Europe. European Journal of Soil Science, 66, 226-238.
Tyree, M.T. \& Yang, S. (1990). Water-storage capacity of Thuja, Tsuga and Acer stems measured by dehydration isotherms - The contribution of capillary water and cavitation. Planta, 182, 420-426.
Urli, M., Porte, A.J., Cochard, H., Guengant, Y., Burlett, R. \& Delzon, S. (2013). Xylem embolism threshold for catastrophic hydraulic failure in angiosperm trees. Tree Physiology, 33, 672-683.
Van Lier, Q.D.J., Neto, D.D. \& Metselaar, K. (2009). Modeling of transpiration reduction in van genuchtenmualem type soils. Water Resources Research, 45, 1-9.
Walker, A.P., Beckerman, A.P., Gu, L., Kattge, J., Cernusak, L.A., Domingues, T.F., et al. (2014). The relationship of leaf photosynthetic traits - Vcmax and Jmax - to leaf nitrogen, leaf phosphorus, and specific leaf area: A meta-analysis and modeling study. Ecology and Evolution, 4, 3218-3235.
Watanabe, T. \& Mizutani, K. (1996). Model study on micrometeorological aspects of rainfall interception over an evergreen broad-leaved. Agricultural and Forest Meteorology, 80, 195-214.
Wehrli, A., Weisberg, P.J., Schönenberger, W., Brang, P. \& Bugmann, H. (2007). Improving the establishment submodel of a forest patch model to assess the long-term protective effect of mountain forests. European Journal of Forest Research, 126, 131-145.
Wigmosta, M.S. \& Lettenmaier, D.P. (1999). A comparison of simplified methods for routing topographically driven subsurface flow. Water Resources Research, 35, 255-264.

Wigmosta, M., Vail, L. \& Lettenmaier, D. (1994). A distributed hydrology-vegetation model for complex terrain. Water Resources Research, 30, 1665-1679.
Wolf, A., Anderegg, W.R.L. \& Pacala, S.W. (2016). Optimal stomatal behavior with competition for water and risk of hydraulic impairment. Proceedings of the National Academy of Sciences, 113, E7222-E7230.