# Stage 2.2 — T-Axis (Temperature) XGBoost Tier 1

**Date:** 2025-10-29 (Tier 1 with corrected phylo)  
**Model:** XGBoost with 10-fold CV  
**Dataset:** 1,084 species (Tier 1 hyperparameter tuning)  
**Target:** EIVEres-T (EIVE Temperature indicator)

---

## Performance Snapshot

**Optimal Configuration:**
- Learning rate: 0.03
- Trees: 1500
- Max depth: 6
- GPU: CUDA

**Cross-Validation Metrics (10-fold):**
- R²: 0.809 ± 0.043
- RMSE: 0.575 ± 0.081
- MAE: 0.380 ± 0.036
- Accuracy ±1 rank: 97.0% ± 1.2%
- Accuracy ±2 ranks: 99.4% ± 0.8%

---

## Top 15 SHAP Predictors

| Rank | Feature | SHAP | Category |
|------|---------|------|----------|
| 1 | wc2.1_30s_bio_10_q05 | 0.2791 | Climate |
| 2 | wc2.1_30s_bio_5_q05 | 0.1115 | Climate |
| 3 | wc2.1_30s_bio_1_q05 | 0.1018 | Climate |
| 4 | wc2.1_30s_bio_5.1_q05 | 0.0561 | Climate |
| 5 | EIVEres-M | 0.0508 | Cross-axis EIVE |
| 6 | BEDD.1_q05 | 0.0337 | Climate |
| 7 | nitrogen_0_5cm_q50 | 0.0327 | Soil |
| 8 | BEDD_q50 | 0.0315 | Climate |
| 9 | wc2.1_30s_bio_9_q95 | 0.0293 | Climate |
| 10 | soc_5_15cm_q50 | 0.0288 | Soil |
| 11 | wc2.1_30s_bio_10_q50 | 0.0267 | Climate |
| 12 | nitrogen_5_15cm_q50 | 0.0232 | Soil |
| 13 | EIVEres-L | 0.0210 | Cross-axis EIVE |
| 14 | TX.1_q05 | 0.0208 | Climate |
| 15 | logSM | 0.0207 | Functional trait |

---

## Phylogenetic Predictor Status

**p_phylo_T: RANK #19 (SHAP = 0.0158)**

⚠ MODERATE - Phylogenetic signal present

**Context:** This run uses Tier 1 p_phylo calculated on a tree pruned to 1,075 species (matching the modeling population). This context-appropriate phylogenetic predictor captures the phylogenetic signal relevant to the 1,084-species subset used for hyperparameter tuning.

---

## Ecological Interpretation

**Temperature indicator prediction** is dominated by:
1. **Direct climate variables** (BIO10, BIO5, BIO1 ranks 1-3): Temperature preferences directly reflect climatic conditions
2. **Weak phylogenetic signal** (p_phylo_T rank 19): Temperature adaptation is more environmentally determined than phylogenetically conserved

The low phylogenetic importance is biologically meaningful - temperature preferences show less phylogenetic conservatism than other traits, being strongly driven by current environmental conditions.

---

## Files

**Model outputs:** `model_data/outputs/stage2_xgb/T_1084_tier1_20251029/`
- `xgb_T_cv_grid.csv` - Grid search results (9 combinations)
- `xgb_T_cv_metrics.json` - Best configuration metrics  
- `xgb_T_shap_importance.csv` - Feature importance rankings
- `xgb_T_model.json` - Trained model (best config)

**Input data:** `model_data/inputs/stage2_features/T_features_1084_tier1_20251029.csv`

---

## Tier 2 Production CV (6,220 Species)

### Full Model Performance

**Configuration:** Same as Tier 1 (lr=0.03, trees=1500, depth=6)
**Dataset:** 6,220 species with observed T-axis EIVE
**Context-matched phylo:** Calculated on ~5,400-species tree (axis-specific)

**Cross-Validation Metrics (10-fold):**
- R²: 0.823 ± 0.016
- RMSE: 0.751 ± 0.031
- MAE: 0.522 ± 0.017
- Accuracy ±1 rank: 94.2% ± 0.9%
- Accuracy ±2 ranks: 98.7% ± 0.5%

**Location:** `model_data/outputs/stage2_xgb/T_11680_production_corrected_20251029/`

---

### Top 20 SHAP Predictors (Tier 2 Full Model)

| Rank | Feature | SHAP | Category |
|------|---------|------|----------|
| 1 | wc2.1_30s_bio_10_q05 | 0.3121 | Climate |
| 2 | wc2.1_30s_bio_1_q05 | 0.2846 | Climate |
| 3 | wc2.1_30s_bio_10_q50 | 0.2476 | Climate |
| 4 | EIVEres-M | 0.1103 | Cross-axis EIVE |
| 5 | p_phylo_T ✓ | 0.0774 | Phylogenetic |
| 6 | wc2.1_30s_bio_1_q50 | 0.0576 | Climate |
| 7 | wc2.1_30s_bio_9_q95 | 0.0524 | Climate |
| 8 | wc2.1_30s_bio_10.1_q05 | 0.0491 | Climate |
| 9 | EIVEres-L | 0.0429 | Cross-axis EIVE |
| 10 | EIVEres-N | 0.0400 | Cross-axis EIVE |
| 11 | logH | 0.0346 | Functional trait |
| 12 | wc2.1_30s_bio_1.1_q05 | 0.0331 | Climate |
| 13 | nitrogen_5_15cm_q50 | 0.0327 | Soil |
| 14 | wc2.1_30s_bio_5_q05 | 0.0300 | Climate |
| 15 | EIVEres-R | 0.0297 | Cross-axis EIVE |
| 16 | soc_5_15cm_q50 | 0.0283 | Soil |
| 17 | wc2.1_30s_vapr_05_q95 | 0.0260 | Climate |
| 18 | TXn.1_q05 | 0.0198 | Climate |
| 19 | CSU.1_q95 | 0.0196 | Climate |
| 20 | wc2.1_30s_bio_9.1_q95 | 0.0190 | Climate |

**Phylogenetic signal:** p_phylo_T ranks #5 with SHAP=0.0774 (moderate phylogenetic signal, climate-dominated)

---

### No-EIVE Model Performance

**Purpose:** Imputation for species with no observed EIVE on any axis
**Features excluded:** All 10 EIVE-related predictors (5 direct EIVE + 5 EIVE-based phylo)

**Cross-Validation Metrics (10-fold):**
- R²: 0.806 ± 0.016
- RMSE: 0.786 ± 0.029
- MAE: 0.548 ± 0.019
- Accuracy ±1 rank: 93.1% ± 1.1%
- Accuracy ±2 ranks: 98.5% ± 0.5%

**Performance drop:** -2.1% R² vs full model (minimal loss, climate-dominated axis)

**Location:** `model_data/outputs/stage2_xgb/T_11680_no_eive_20251029/`

---

### Tier 1 vs Tier 2 Comparison

| Metric | Tier 1 (1,084 sp) | Tier 2 Full (6,220 sp) | Δ |
|--------|------------------|----------------------|---|
| R² | 0.809 ± 0.043 | 0.823 ± 0.016 | +0.014 |
| MAE | 0.380 ± 0.036 | 0.522 ± 0.017 | +0.142 |
| Acc±1 | 97.0% ± 1.2% | 94.2% ± 0.9% | -2.8% |
| p_phylo rank | #19 (0.016) | #5 (0.077) | ✓ Improved |

**Generalization:** Tier 2 improved R² and phylo signal strength. MAE and Acc±1 differences reflect scale differences in training data.

---

## Next Steps

**Hybrid T-Axis Imputation (axis-by-axis):**

For species missing T-axis EIVE:
- **Full model:** Species with observed EIVE on any other axis (L, M, N, or R) → can leverage cross-axis features
- **No-EIVE model:** Species with no observed EIVE on any axis → no cross-axis features available

**Total T-axis imputation targets:** Species from the 5,756 needing at least one axis, specifically those missing T

**Note:** The 6,220 training species already have observed T-axis EIVE and do not need imputation.

**See:** `/home/olier/ellenberg/results/summaries/hybrid_axes/phylotraits/Stage_2/2.0_Modelling_Overview.md` Section 3.4 for complete axis-by-axis imputation strategy.

---

**Status:** ✓ TIER 1 & TIER 2 COMPLETED
**Hyperparameters:** OPTIMIZED and deployed
