# Stage 2.7 — R-Axis (Reaction/pH) XGBoost Tier 1

**Date:** 2025-10-29 (Tier 1 with corrected phylo)  
**Model:** XGBoost with 10-fold CV  
**Dataset:** 1,084 species (Tier 1 hyperparameter tuning)  
**Target:** EIVEres-R (EIVE Reaction/pH indicator)

---

## Performance Snapshot

**Optimal Configuration:**
- Learning rate: 0.05
- Trees: 1500
- Max depth: 6
- GPU: CUDA

**Cross-Validation Metrics (10-fold):**
- R²: 0.530 ± 0.109
- RMSE: 1.004 ± 0.066
- MAE: 0.737 ± 0.042
- Accuracy ±1 rank: 86.3% ± 2.2%
- Accuracy ±2 ranks: 96.6% ± 1.2%

---

## Top 15 SHAP Predictors

| Rank | Feature | SHAP | Category |
|------|---------|------|----------|
| 1 | clay_0_5cm_q50 | 0.2431 | Soil |
| 2 | EIVEres-N | 0.1715 | Cross-axis EIVE |
| 3 | clay_0_5cm_q95 | 0.0931 | Soil |
| 4 | clay_15_30cm_q50 | 0.0792 | Soil |
| 5 | phh2o_5_15cm_q05 | 0.0730 | Soil |
| 6 | p_phylo_R ✓ | 0.0649 | Phylogenetic |
| 7 | clay_5_15cm_q50 | 0.0590 | Soil |
| 8 | wc2.1_30s_bio_19_q95 | 0.0552 | Climate |
| 9 | clay_0_5cm_q05 | 0.0380 | Soil |
| 10 | clay_100_200cm_q05 | 0.0374 | Soil |
| 11 | EIVEres-M | 0.0352 | Cross-axis EIVE |
| 12 | phh2o_30_60cm_q50 | 0.0339 | Soil |
| 13 | EIVEres-L | 0.0333 | Cross-axis EIVE |
| 14 | phh2o_0_5cm_q95 | 0.0317 | Soil |
| 15 | phh2o_15_30cm_q95 | 0.0273 | Soil |

---

## Phylogenetic Predictor Status

**p_phylo_R: RANK #6 (SHAP = 0.0649)**

✓ GOOD - Strong phylogenetic signal

**Context:** This run uses Tier 1 p_phylo calculated on a tree pruned to 1,075 species (matching the modeling population). This context-appropriate phylogenetic predictor captures the phylogenetic signal relevant to the 1,084-species subset used for hyperparameter tuning.

---

## Ecological Interpretation

**Reaction/pH tolerance prediction** dominated by:
1. **Soil properties** (clay content ranks 1, 3, 4, 7): Edaphic conditions directly determine pH tolerance
2. **Measured pH** (phh2o_5_15cm_q05 rank 5): Direct environmental measurement
3. **Phylogenetic signal** (p_phylo_R rank 6): Moderate phylogenetic conservatism

pH tolerance shows weaker phylogenetic signal than moisture/nitrogen - edaphic preferences are more plastic and environmentally determined.

---

## Files

**Model outputs:** `model_data/outputs/stage2_xgb/R_1084_tier1_20251029/`
- `xgb_R_cv_grid.csv` - Grid search results (9 combinations)
- `xgb_R_cv_metrics.json` - Best configuration metrics  
- `xgb_R_shap_importance.csv` - Feature importance rankings
- `xgb_R_model.json` - Trained model (best config)

**Input data:** `model_data/inputs/stage2_features/R_features_1084_tier1_20251029.csv`

---

## Tier 2 Completion

**Tier 2 Full Models (~6,200 species):** ✓ COMPLETED
**Location:** `model_data/outputs/stage2_xgb/R_11680_production_corrected_20251029/`
**Performance:** R² = 0.506 ± 0.037, MAE = 0.825, Accuracy ±1 = 83.6%

**Tier 2 No-EIVE Models (~6,200 species):** ✓ COMPLETED
**Location:** `model_data/outputs/stage2_xgb/R_11680_no_eive_20251029/`
**Performance:** R² = 0.448 ± 0.030, MAE = 0.879, Accuracy ±1 = 81.5%
**Note:** No-EIVE models exclude all cross-axis EIVE predictors for imputation of species with no observed EIVE values.

---

## Next Steps

**Hybrid EIVE Imputation (5,756 species):**
1. Full models (with cross-axis EIVE) → 337 species with partial EIVE
2. No-EIVE models (without cross-axis EIVE) → 5,419 species with no EIVE

**See:** `/home/olier/ellenberg/results/summaries/hybrid_axes/phylotraits/Stage_2/2.0_Modelling_Overview.md` for complete two-model hybrid strategy documentation.

---

**Status:** ✓ TIER 1 & TIER 2 COMPLETED
**Hyperparameters:** OPTIMIZED and deployed
