# Stage 2.3 — N-Axis (Nitrogen) XGBoost Tier 1

**Date:** 2025-10-29 (Tier 1 with corrected phylo)  
**Model:** XGBoost with 10-fold CV  
**Dataset:** 1,084 species (Tier 1 hyperparameter tuning)  
**Target:** EIVEres-N (EIVE Nitrogen indicator)

---

## Performance Snapshot

**Optimal Configuration:**
- Learning rate: 0.03
- Trees: 1500
- Max depth: 6
- GPU: CUDA

**Cross-Validation Metrics (10-fold):**
- R²: 0.701 ± 0.030
- RMSE: 1.026 ± 0.045
- MAE: 0.792 ± 0.028
- Accuracy ±1 rank: 84.5% ± 2.8%
- Accuracy ±2 ranks: 97.9% ± 1.2%

---

## Top 15 SHAP Predictors

| Rank | Feature | SHAP | Category |
|------|---------|------|----------|
| 1 | EIVEres-M | 0.4357 | Cross-axis EIVE |
| 2 | p_phylo_N ✓ | 0.3218 | Phylogenetic |
| 3 | logLA | 0.3207 | Functional trait |
| 4 | EIVEres-R | 0.2969 | Cross-axis EIVE |
| 5 | logSLA | 0.1549 | Functional trait |
| 6 | logH | 0.1035 | Functional trait |
| 7 | logNmass | 0.0826 | Functional trait |
| 8 | wc2.1_30s_elev_q50 | 0.0754 | Climate |
| 9 | EIVEres-L | 0.0674 | Cross-axis EIVE |
| 10 | wc2.1_30s_elev_iqr | 0.0535 | Climate |
| 11 | wc2.1_30s_bio_8_q95 | 0.0532 | Climate |
| 12 | clay_15_30cm_q95 | 0.0443 | Soil |
| 13 | clay_60_100cm_q95 | 0.0303 | Soil |
| 14 | wc2.1_30s_elev_q95 | 0.0278 | Climate |
| 15 | sand_30_60cm_q05 | 0.0218 | Soil |

---

## Phylogenetic Predictor Status

**p_phylo_N: RANK #2 (SHAP = 0.3218)**

✓ EXCELLENT - Phylogenetic signal restored

**Context:** This run uses Tier 1 p_phylo calculated on a tree pruned to 1,075 species (matching the modeling population). This context-appropriate phylogenetic predictor captures the phylogenetic signal relevant to the 1,084-species subset used for hyperparameter tuning.

---

## Ecological Interpretation

**Nitrogen indicator prediction** driven by:
1. **Moisture coupling** (EIVEres-M rank 1): Strong N-M ecological correlation
2. **Phylogenetic signal** (p_phylo_N rank 2): Nitrogen acquisition strategies are phylogenetically conserved
3. **Leaf economics** (logLA rank 3, logSLA rank 5): Leaf traits capture N acquisition strategies
4. **pH coupling** (EIVEres-R rank 4): pH affects N availability

The strong phylogenetic signal indicates conserved nitrogen acquisition strategies within lineages.

---

## Files

**Model outputs:** `model_data/outputs/stage2_xgb/N_1084_tier1_20251029/`
- `xgb_N_cv_grid.csv` - Grid search results (9 combinations)
- `xgb_N_cv_metrics.json` - Best configuration metrics  
- `xgb_N_shap_importance.csv` - Feature importance rankings
- `xgb_N_model.json` - Trained model (best config)

**Input data:** `model_data/inputs/stage2_features/N_features_1084_tier1_20251029.csv`

---

## Tier 2 Completion

**Tier 2 Full Models (~6,200 species):** ✓ COMPLETED
**Location:** `model_data/outputs/stage2_xgb/N_11680_production_corrected_20251029/`
**Performance:** R² = 0.694 ± 0.026, MAE = 0.810, Accuracy ±1 = 85.3%

**Tier 2 No-EIVE Models (~6,200 species):** ✓ COMPLETED
**Location:** `model_data/outputs/stage2_xgb/N_11680_no_eive_20251029/`
**Performance:** R² = 0.618 ± 0.036, MAE = 0.910, Accuracy ±1 = 80.5%
**Note:** No-EIVE models exclude all cross-axis EIVE predictors for imputation of species with no observed EIVE values.

---

## Next Steps

**Hybrid N-Axis Imputation (axis-by-axis):**

For species missing N-axis EIVE:
- **Full model:** Species with observed EIVE on any other axis (L, T, M, or R) → can leverage cross-axis features
- **No-EIVE model:** Species with no observed EIVE on any axis → no cross-axis features available

**Total N-axis imputation targets:** Species from the 5,756 needing at least one axis, specifically those missing N

**Note:** The 6,000 training species already have observed N-axis EIVE and do not need imputation.

**See:** `/home/olier/ellenberg/results/summaries/hybrid_axes/phylotraits/Stage_2/2.0_Modelling_Overview.md` Section 3.4 for complete axis-by-axis imputation strategy.

---

**Status:** ✓ TIER 1 & TIER 2 COMPLETED
**Hyperparameters:** OPTIMIZED and deployed
