# SEM Baseline — New Bioclim Subset (654 species) vs Full Dataset (≈1000+)

This document reports fresh pwSEM baselines on the new bioclim‑eligible subset and compares them to the canonical full‑dataset baselines (from README). Exact repro commands and artifact paths are included.

## Dataset and Method

- Trait CSV (bioclim subset; ≥3 cleaned occurrences): `artifacts/model_data_bioclim_subset.csv`
- Generated by Stage‑1 bioclim‑first pipeline (duplicates preserved) which also produced:
  - Observations with climate: `data/bioclim_extractions_bioclim_first/all_occurrences_cleaned.csv`
  - Species summary: `data/bioclim_extractions_bioclim_first/summary_stats/species_bioclim_summary.csv`
- SEM runner: `src/Stage_4_SEM_Analysis/run_sem_pwsem.R` (pwSEM + mgcv from `.Rlib`)
- CV protocol: repeated, stratified 10×5 CV; fold‑internal standardization; LES and SIZE recomputed within folds
- Canonical flags (per axis) as in `bioclim_subset_baseline.md`:
  - L: nonlinear GAM (rf_plus), deconstruct size for L, `ti(logLA,logH)`, `ti(logH,logSSD)`
  - T: linear with SIZE
  - M: deconstructed SIZE
  - R: linear with SIZE
  - N: deconstructed SIZE + `LES:logSSD`

## Results — CV R² (mean ± sd)

| Axis | Full dataset (README) | New bioclim subset (this run) | Δ (abs) |
|------|------------------------|-------------------------------|---------|
| L | 0.300 ± 0.077 | 0.283 ± 0.103 (n=652) | −0.017 |
| T | 0.231 ± 0.065 | 0.216 ± 0.071 (n=654) | −0.015 |
| M | 0.408 ± 0.081 | 0.357 ± 0.121 (n=651) | −0.051 |
| R | 0.155 ± 0.060 | 0.165 ± 0.092 (n=642) | +0.010 |
| N | 0.425 ± 0.076 | 0.444 ± 0.081 (n=639) | +0.019 |

Interpretation:
- Moisture (M) shows a moderate drop on the new subset (−0.051), consistent with prior sensitivity of M to species selection.
- Light (L) and Temperature (T) exhibit small decreases (−0.017, −0.015).
- Reaction (R) and Nutrients (N) show slight gains on the new subset, indicating some noise reduction or composition effects.

## Reproduction (exact commands)

All commands run with local library path for pwSEM/mgcv.

```bash
# L (Run 7c; GAM rf_plus)
R_EXTRA_LIBS="/home/olier/ellenberg/.Rlib" \
Rscript src/Stage_4_SEM_Analysis/run_sem_pwsem.R \
  --input_csv artifacts/model_data_bioclim_subset.csv \
  --target L --repeats 5 --folds 10 --stratify true --standardize true \
  --cluster Family --group_var Myco_Group_Final \
  --les_components negLMA,Nmass --add_predictor logLA \
  --nonlinear true --nonlinear_variant rf_plus --deconstruct_size_L true \
  --add_interaction "ti(logLA,logH),ti(logH,logSSD)" \
  --out_dir artifacts/stage4_sem_pwsem_bioclim_subset

# T (linear with SIZE)
R_EXTRA_LIBS="/home/olier/ellenberg/.Rlib" \
Rscript src/Stage_4_SEM_Analysis/run_sem_pwsem.R \
  --input_csv artifacts/model_data_bioclim_subset.csv \
  --target T --repeats 5 --folds 10 --stratify true --standardize true \
  --cluster Family --group_var Myco_Group_Final \
  --les_components negLMA,Nmass --add_predictor logLA \
  --nonlinear false \
  --out_dir artifacts/stage4_sem_pwsem_bioclim_subset

# M (deconstructed SIZE)
R_EXTRA_LIBS="/home/olier/ellenberg/.Rlib" \
Rscript src/Stage_4_SEM_Analysis/run_sem_pwsem.R \
  --input_csv artifacts/model_data_bioclim_subset.csv \
  --target M --repeats 5 --folds 10 --stratify true --standardize true \
  --cluster Family --group_var Myco_Group_Final \
  --les_components negLMA,Nmass --add_predictor logLA \
  --deconstruct_size true \
  --out_dir artifacts/stage4_sem_pwsem_bioclim_subset

# R (linear with SIZE)
R_EXTRA_LIBS="/home/olier/ellenberg/.Rlib" \
Rscript src/Stage_4_SEM_Analysis/run_sem_pwsem.R \
  --input_csv artifacts/model_data_bioclim_subset.csv \
  --target R --repeats 5 --folds 10 --stratify true --standardize true \
  --cluster Family --group_var Myco_Group_Final \
  --les_components negLMA,Nmass --add_predictor logLA \
  --out_dir artifacts/stage4_sem_pwsem_bioclim_subset

# N (deconstructed SIZE + LES:logSSD)
R_EXTRA_LIBS="/home/olier/ellenberg/.Rlib" \
Rscript src/Stage_4_SEM_Analysis/run_sem_pwsem.R \
  --input_csv artifacts/model_data_bioclim_subset.csv \
  --target N --repeats 5 --folds 10 --stratify true --standardize true \
  --cluster Family --group_var Myco_Group_Final \
  --les_components negLMA,Nmass --add_predictor logLA \
  --deconstruct_size true --add_interaction LES:logSSD \
  --out_dir artifacts/stage4_sem_pwsem_bioclim_subset
```

## Artifacts (per axis)

- Metrics JSON: `artifacts/stage4_sem_pwsem_bioclim_subset/sem_pwsem_{L|T|M|R|N}_metrics.json`
- Predictions CSV: `artifacts/stage4_sem_pwsem_bioclim_subset/sem_pwsem_{L|T|M|R|N}_preds.csv`
- pwSEM exports: `_dsep_fit.csv`, `_dsep_probs.csv`, `_basis_set.csv`, `_full_model_getAIC.csv`, `_multigroup_dsep.csv`, optional phylo summaries and bootstrap coefficients.

---
Generated: 2025‑09‑12  
Contact: Stage 4 — pwSEM
