# Stage 2.1 — L-Axis (Light) XGBoost Tier 1

**Date:** 2025-10-29 (Tier 1 with corrected phylo)  
**Model:** XGBoost with 10-fold CV  
**Dataset:** 1,084 species (Tier 1 hyperparameter tuning)  
**Target:** EIVEres-L (EIVE Light indicator)

---

## Performance Snapshot

**Optimal Configuration:**
- Learning rate: 0.03
- Trees: 1500
- Max depth: 6
- GPU: CUDA

**Cross-Validation Metrics (10-fold):**
- R²: 0.621 ± 0.050
- RMSE: 0.911 ± 0.079
- MAE: 0.694 ± 0.066
- Accuracy ±1 rank: 88.0% ± 4.2%
- Accuracy ±2 ranks: 98.4% ± 1.0%

---

## Top 15 SHAP Predictors

| Rank | Feature | SHAP | Category |
|------|---------|------|----------|
| 1 | EIVEres-M | 0.2682 | Cross-axis EIVE |
| 2 | p_phylo_L ✓ | 0.1741 | Phylogenetic |
| 3 | logSLA | 0.1701 | Functional trait |
| 4 | phh2o_0_5cm_q50 | 0.1426 | Soil |
| 5 | EIVEres-N | 0.0681 | Cross-axis EIVE |
| 6 | logH | 0.0654 | Functional trait |
| 7 | soc_0_5cm_q05 | 0.0599 | Soil |
| 8 | phh2o_60_100cm_q95 | 0.0554 | Soil |
| 9 | logSM | 0.0533 | Functional trait |
| 10 | nitrogen_30_60cm_q50 | 0.0531 | Soil |
| 11 | phh2o_100_200cm_q95 | 0.0502 | Soil |
| 12 | phh2o_30_60cm_q95 | 0.0427 | Soil |
| 13 | wc2.1_30s_elev_q05 | 0.0388 | Climate |
| 14 | wc2.1_30s_vapr_06_q05 | 0.0301 | Climate |
| 15 | nitrogen_15_30cm_iqr | 0.0293 | Soil |

---

## Phylogenetic Predictor Status

**p_phylo_L: RANK #2 (SHAP = 0.1741)**

✓ EXCELLENT - Phylogenetic signal restored

**Context:** This run uses Tier 1 p_phylo calculated on a tree pruned to 1,075 species (matching the modeling population). This context-appropriate phylogenetic predictor captures the phylogenetic signal relevant to the 1,084-species subset used for hyperparameter tuning.

---

## Ecological Interpretation

**Light availability prediction** is driven by:
1. **Moisture coupling** (EIVEres-M rank 1): Moisture and light strongly linked via vegetation structure
2. **Phylogenetic signal** (p_phylo_L rank 2): Light tolerance is phylogenetically conserved
3. **Leaf economics** (logSLA rank 3): SLA captures light acquisition strategies
4. **Soil pH** (phh2o_0_5cm_q50 rank 4): pH influences vegetation structure and light penetration

The strong phylogenetic signal indicates that light tolerance is a conserved trait within plant lineages.

---

## Files

**Model outputs:** `model_data/outputs/stage2_xgb/L_1084_tier1_20251029/`
- `xgb_L_cv_grid.csv` - Grid search results (9 combinations)
- `xgb_L_cv_metrics.json` - Best configuration metrics  
- `xgb_L_shap_importance.csv` - Feature importance rankings
- `xgb_L_model.json` - Trained model (best config)

**Input data:** `model_data/inputs/stage2_features/L_features_1084_tier1_20251029.csv`

---

## Tier 2 Production CV (6,165 Species)

### Full Model Performance

**Configuration:** Same as Tier 1 (lr=0.03, trees=1500, depth=6)
**Dataset:** 6,165 species with observed L-axis EIVE
**Context-matched phylo:** Calculated on ~5,400-species tree (axis-specific)

**Cross-Validation Metrics (10-fold):**
- R²: 0.664 ± 0.024
- RMSE: 0.878 ± 0.045
- MAE: 0.654 ± 0.028
- Accuracy ±1 rank: 90.4% ± 1.0%
- Accuracy ±2 ranks: 98.3% ± 0.7%

**Location:** `model_data/outputs/stage2_xgb/L_11680_production_corrected_20251029/`

---

### Top 20 SHAP Predictors (Tier 2 Full Model)

| Rank | Feature | SHAP | Category |
|------|---------|------|----------|
| 1 | EIVEres-M | 0.3209 | Cross-axis EIVE |
| 2 | logSLA | 0.2669 | Functional trait |
| 3 | p_phylo_L ✓ | 0.2514 | Phylogenetic |
| 4 | wc2.1_30s_elev_q05 | 0.0933 | Climate |
| 5 | EIVEres-N | 0.0894 | Cross-axis EIVE |
| 6 | EIVEres-T | 0.0879 | Cross-axis EIVE |
| 7 | logLA | 0.0837 | Functional trait |
| 8 | soc_0_5cm_q05 | 0.0693 | Soil |
| 9 | logSM | 0.0554 | Functional trait |
| 10 | logH | 0.0482 | Functional trait |
| 11 | EIVEres-R | 0.0340 | Cross-axis EIVE |
| 12 | phh2o_60_100cm_q95 | 0.0336 | Soil |
| 13 | phh2o_100_200cm_q95 | 0.0262 | Soil |
| 14 | bdod_0_5cm_q95 | 0.0212 | Soil |
| 15 | nitrogen_0_5cm_q05 | 0.0192 | Soil |
| 16 | wc2.1_30s_srad_04_q95 | 0.0169 | Climate |
| 17 | phylo_ev1 | 0.0157 | Phylogenetic |
| 18 | wc2.1_30s_elev_q50 | 0.0157 | Climate |
| 19 | nitrogen_0_5cm_q50 | 0.0155 | Soil |
| 20 | phh2o_0_5cm_q50 | 0.0152 | Soil |

**Phylogenetic signal:** p_phylo_L ranks #3 with SHAP=0.2514 (strong phylogenetic conservation)

---

### No-EIVE Model Performance

**Purpose:** Imputation for species with no observed EIVE on any axis
**Features excluded:** All 10 EIVE-related predictors (5 direct EIVE + 5 EIVE-based phylo)

**Cross-Validation Metrics (10-fold):**
- R²: 0.611 ± 0.027
- RMSE: 0.945 ± 0.053
- MAE: 0.704 ± 0.031
- Accuracy ±1 rank: 88.4% ± 1.3%
- Accuracy ±2 ranks: 97.8% ± 0.8%

**Performance drop:** -8.0% R² vs full model (expected without cross-axis EIVE)

**Location:** `model_data/outputs/stage2_xgb/L_11680_no_eive_20251029/`

---

### Tier 1 vs Tier 2 Comparison

| Metric | Tier 1 (1,084 sp) | Tier 2 Full (6,165 sp) | Δ |
|--------|------------------|----------------------|---|
| R² | 0.621 ± 0.050 | 0.664 ± 0.024 | +0.043 |
| MAE | 0.694 ± 0.066 | 0.654 ± 0.028 | -0.040 |
| Acc±1 | 88.0% ± 4.2% | 90.4% ± 1.0% | +2.4% |
| p_phylo rank | #2 (0.174) | #3 (0.251) | ✓ Strong |

**Generalization:** Tier 2 performance improved with larger training set. Phylogenetic signal remains strong.

---

## Next Steps

**Hybrid L-Axis Imputation (axis-by-axis):**

For species missing L-axis EIVE:
- **Full model:** Species with observed EIVE on any other axis (T, M, N, or R) → can leverage cross-axis features
- **No-EIVE model:** Species with no observed EIVE on any axis → no cross-axis features available

**Total L-axis imputation targets:** Species from the 5,756 needing at least one axis, specifically those missing L

**Note:** The 6,165 training species already have observed L-axis EIVE and do not need imputation.

**See:** `/home/olier/ellenberg/results/summaries/phylotraits/Stage_2/2.0_Modelling_Overview.md` Section 3.4 for complete axis-by-axis imputation strategy.

---

**Status:** ✓ TIER 1 & TIER 2 COMPLETED
**Hyperparameters:** OPTIMIZED and deployed
