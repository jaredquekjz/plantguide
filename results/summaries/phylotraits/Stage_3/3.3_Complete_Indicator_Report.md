# Complete Indicator Report: Stage 3 Final Dataset

**File:** `model_data/outputs/perm2_production/perm2_11680_with_ecoservices_20251030.parquet`
**Species:** 11,680
**Total Columns:** 775
**Date:** 2025-10-30

---

## Executive Summary

The Stage 3 final dataset contains **775 indicators** across 11,680 plant species, organized into 19 major categories:

1. **Climate** (408 columns): WorldClim bioclimatic variables, solar radiation, vapor pressure, elevation, and ETCCDI extreme indices
2. **Soil** (169 columns): SoilGrids data at 6 depths (pH, organic carbon, clay, sand, CEC, nitrogen, bulk density)
3. **Functional Traits** (13 columns): TRY categorical and log-transformed continuous traits
4. **Phylogenetic** (92 columns): Eigenvectors capturing evolutionary relationships
5. **Ellenberg Indicators** (10 columns): Residualized ecological indicator values
6. **Nitrogen Fixation** (5 columns): TRY TraitID 8 evidence
7. **CSR Strategy** (3 columns): Competitor/Stress-tolerator/Ruderal percentages
8. **Ecosystem Services** (20 columns): 10 service ratings + 10 confidence levels
9. **Taxonomy & Identifiers** (4 columns)
10. **Derived Traits** (2 columns): Height and life form

---

## Detailed Indicator Breakdown

### 1. IDENTIFIERS & TAXONOMY (4 columns)

| Column | Description | Coverage |
|--------|-------------|----------|
| `wfo_taxon_id` | World Flora Online taxon ID | 100% |
| `wfo_scientific_name` | Scientific name | 100% |
| `family` | Plant family | 99.3% (11,600 species) |
| `genus` | Genus | 99.3% (11,600 species) |

---

### 2. FUNCTIONAL TRAITS (13 columns)

#### TRY Categorical Traits (7 columns)
| Column | Description | Source |
|--------|-------------|--------|
| `try_woodiness` | Woody/herbaceous/semi-woody | TRY database |
| `try_growth_form` | Growth form classification | TRY database |
| `try_habitat_adaptation` | Habitat type | TRY database |
| `try_leaf_type` | Leaf type (simple/compound) | TRY database |
| `try_leaf_phenology` | Deciduous/evergreen | TRY database |
| `try_photosynthesis_pathway` | C3/C4/CAM | TRY database |
| `try_mycorrhiza_type` | Mycorrhizal association type | TRY database |

#### Log-Transformed Continuous Traits (6 columns)
| Column | Description | Back-transformation | Units |
|--------|-------------|---------------------|-------|
| `logLDMC` | Log leaf dry matter content | `exp(logLDMC) × 100` | % |
| `logSLA` | Log specific leaf area | `exp(logSLA)` | mm²/mg |
| `logSM` | Log seed mass | `exp(logSM)` | mg |
| `logH` | Log plant height | `exp(logH)` | m |
| `logLA` | Log leaf area | `exp(logLA)` | mm² |
| `logNmass` | Log leaf nitrogen content | `exp(logNmass)` | mg/g |

**Note:** Raw traits (LA, LDMC, SLA) are also included in the final dataset for CSR calculation.

---

### 3. PHYLOGENETIC EIGENVECTORS (92 columns)

**Columns:** `phylo_ev1` through `phylo_ev92`

**Description:** Principal coordinates capturing phylogenetic relationships from a dated molecular phylogeny. Used to model trait evolution and phylogenetic signal in niche distributions.

**Coverage:** 100% (all species matched to phylogeny)

---

### 4. ELLENBERG INDICATOR VALUES (10 columns)

| Column | Description | Range |
|--------|-------------|-------|
| `EIVEres-L` | Light residual | Continuous |
| `EIVEres-T` | Temperature residual | Continuous |
| `EIVEres-M` | Moisture residual | Continuous |
| `EIVEres-N` | Nitrogen residual | Continuous |
| `EIVEres-R` | Soil reaction (pH) residual | Continuous |
| `p_phylo_L` | Phylogenetic component - Light | Continuous |
| `p_phylo_T` | Phylogenetic component - Temperature | Continuous |
| `p_phylo_M` | Phylogenetic component - Moisture | Continuous |
| `p_phylo_N` | Phylogenetic component - Nitrogen | Continuous |
| `p_phylo_R` | Phylogenetic component - Soil reaction | Continuous |

**Source:** Residualized from observed Ellenberg values after accounting for phylogeny and climate.

---

### 5. CLIMATE INDICATORS (408 columns)

#### WorldClim Bioclimatic Variables (152 columns)

**Structure:** 19 bioclim variables × 2 time periods × 4 quantiles = 152 columns

**Quantiles:** q05 (5th percentile), q50 (median), q95 (95th percentile), iqr (interquartile range)

**Time periods:**
- Current (no suffix): 1970-2000
- Future projection (.1 suffix): future scenario

**Variables:**
| Variable | Description | Units |
|----------|-------------|-------|
| bio_1 | Annual Mean Temperature | °C × 10 |
| bio_2 | Mean Diurnal Range | °C × 10 |
| bio_3 | Isothermality (bio_2/bio_7 × 100) | % |
| bio_4 | Temperature Seasonality (std × 100) | °C × 100 |
| bio_5 | Max Temperature of Warmest Month | °C × 10 |
| bio_6 | Min Temperature of Coldest Month | °C × 10 |
| bio_7 | Temperature Annual Range (bio_5-bio_6) | °C × 10 |
| bio_8 | Mean Temperature of Wettest Quarter | °C × 10 |
| bio_9 | Mean Temperature of Driest Quarter | °C × 10 |
| bio_10 | Mean Temperature of Warmest Quarter | °C × 10 |
| bio_11 | Mean Temperature of Coldest Quarter | °C × 10 |
| bio_12 | Annual Precipitation | mm |
| bio_13 | Precipitation of Wettest Month | mm |
| bio_14 | Precipitation of Driest Month | mm |
| bio_15 | Precipitation Seasonality (CV) | % |
| bio_16 | Precipitation of Wettest Quarter | mm |
| bio_17 | Precipitation of Driest Quarter | mm |
| bio_18 | Precipitation of Warmest Quarter | mm |
| bio_19 | Precipitation of Coldest Quarter | mm |

#### WorldClim Solar Radiation (48 columns)

**Structure:** 12 monthly values (Jan-Dec) × 4 quantiles = 48 columns

**Columns:** `wc2.1_30s_srad_01_q05` through `wc2.1_30s_srad_12_iqr`

**Units:** kJ m⁻² day⁻¹

#### WorldClim Vapor Pressure (48 columns)

**Structure:** 12 monthly values (Jan-Dec) × 4 quantiles = 48 columns

**Columns:** `wc2.1_30s_vapr_01_q05` through `wc2.1_30s_vapr_12_iqr`

**Units:** kPa

#### WorldClim Elevation (4 columns)

**Columns:** `wc2.1_30s_elev_q05`, `wc2.1_30s_elev_q50`, `wc2.1_30s_elev_q95`, `wc2.1_30s_elev_iqr`

**Units:** meters above sea level

#### Climate Extremes - ETCCDI Indices (204 columns)

**Structure:** 25 indices × 2 time periods × 4 quantiles + special cases = 204 columns

**Indices:**
| Index | Description | Units |
|-------|-------------|-------|
| BEDD | Biologically Effective Degree Days | °C-days |
| CDD | Consecutive Dry Days | days |
| CFD | Consecutive Frost Days | days |
| CSDI | Cold Spell Duration Index | days |
| CSU | Consecutive Summer Days | days |
| CWD | Consecutive Wet Days | days |
| DTR | Diurnal Temperature Range | °C |
| FD | Frost Days | days |
| GSL | Growing Season Length | days |
| ID | Icing Days | days |
| R10mm | Heavy Precipitation Days (≥10mm) | days |
| R20mm | Very Heavy Precipitation Days (≥20mm) | days |
| RR | Wet Days | days |
| RR1 | Days with precipitation ≥1mm | days |
| SDII | Simple Daily Intensity Index | mm/day |
| SU | Summer Days | days |
| TG | Mean Temperature | °C |
| TN | Mean Minimum Temperature | °C |
| TNn | Minimum of Minimum Temperature | °C |
| TNx | Maximum of Minimum Temperature | °C |
| TR | Tropical Nights | days |
| TX | Mean Maximum Temperature | °C |
| TXn | Minimum of Maximum Temperature | °C |
| TXx | Maximum of Maximum Temperature | °C |
| WSDI | Warm Spell Duration Index | days |
| WW | Wet-Wet Days | days |

---

### 6. SOIL INDICATORS (169 columns)

**Source:** SoilGrids global soil database

**Structure:** 7 properties × 6 depths × 4 quantiles (except nitrogen which has 25 columns)

**Depths:** 0-5cm, 5-15cm, 15-30cm, 30-60cm, 60-100cm, 100-200cm

**Quantiles:** q05, q50, q95, iqr

#### Soil pH (24 columns)
**Prefix:** `phh2o_`
**Units:** pH (water)
**Range:** 3.5 - 9.5

#### Soil Organic Carbon (24 columns)
**Prefix:** `soc_`
**Units:** g/kg
**Description:** Organic carbon content

#### Soil Clay Content (24 columns)
**Prefix:** `clay_`
**Units:** g/kg (0-100%)
**Description:** Clay particle fraction

#### Soil Sand Content (24 columns)
**Prefix:** `sand_`
**Units:** g/kg (0-100%)
**Description:** Sand particle fraction

#### Soil Cation Exchange Capacity (24 columns)
**Prefix:** `cec_`
**Units:** cmol(c)/kg
**Description:** Soil fertility indicator

#### Soil Nitrogen (25 columns)
**Prefix:** `nitrogen_`
**Units:** g/kg
**Description:** Total nitrogen content

#### Soil Bulk Density (24 columns)
**Prefix:** `bdod_`
**Units:** kg/dm³
**Description:** Soil compaction indicator

---

### 7. DERIVED TRAITS (2 columns)

| Column | Description | Derivation | Coverage |
|--------|-------------|------------|----------|
| `height_m` | Plant height | `exp(logH)` | 100% |
| `life_form_simple` | Simplified life form | Derived from `try_woodiness` | 78.8% (woody: 4,241; non-woody: 4,922; semi-woody: 41) |

---

### 8. NITROGEN FIXATION EVIDENCE (5 columns)

**Source:** TRY database TraitID 8 (nitrogen fixation capacity)

| Column | Description | Values |
|--------|-------------|--------|
| `nitrogen_fixation_rating` | Weighted evidence rating | High (603), Moderate-High (90), Moderate-Low (455), Low (10,532) |
| `nfix_n_yes` | Count of positive observations | 0-n |
| `nfix_n_no` | Count of negative observations | 0-n |
| `nfix_n_total` | Total classified observations | 0-n |
| `nfix_proportion_yes` | Proportion of positive reports | 0-1 |

**Coverage:** 40.3% (4,706 species) have TRY observations; others default to Low with Low confidence

---

### 9. CSR STRATEGY SCORES (3 columns)

**Method:** Pierce et al. (2016) StrateFy equations

| Column | Description | Range | Mean | Coverage |
|--------|-------------|-------|------|----------|
| `C` | Competitor score | 0-100% | 31.1% | 99.7% (11,650 species) |
| `S` | Stress-tolerator score | 0-100% | 38.9% | 99.7% (11,650 species) |
| `R` | Ruderal score | 0-100% | 30.0% | 99.7% (11,650 species) |

**Constraint:** C + S + R = 100 for all valid species

**Edge cases:** 30 species (0.26%) have NaN CSR due to extreme trait combinations outside calibration space (21 conifers, 8 halophytes, 1 other)

---

### 10. ECOSYSTEM SERVICES (20 columns)

**Structure:** 10 service ratings + 10 confidence levels

**Method:** Shipley (2025) framework with life form stratification

#### Service Ratings (10 columns)

| Column | Description | Rating Scale | Confidence |
|--------|-------------|--------------|------------|
| `npp_rating` | Net Primary Productivity | Very Low / Low / Moderate / High / Very High | Very High |
| `decomposition_rating` | Litter decomposition rate | Low / Moderate / High / Very High | Very High |
| `nutrient_cycling_rating` | Nutrient cycling rate | Low / Moderate / High / Very High | Very High |
| `nutrient_retention_rating` | Nutrient retention capacity | Low / Moderate / High / Very High | Very High |
| `nutrient_loss_rating` | Nutrient leaching risk | Low / Moderate / High / Very High | Very High |
| `carbon_biomass_rating` | Carbon storage in biomass | Low / Moderate / High / Very High | High |
| `carbon_recalcitrant_rating` | Recalcitrant carbon storage | Low / Moderate / High / Very High | High |
| `carbon_total_rating` | Total carbon storage | Low / Moderate / High / Very High | High |
| `erosion_protection_rating` | Soil erosion protection | Low / Moderate / High / Very High | Moderate |
| `nitrogen_fixation_rating` | Nitrogen fixation capacity | Low / Moderate-Low / Moderate-High / High | Variable (based on evidence) |

#### Confidence Levels (10 columns)

All service ratings have corresponding `*_confidence` columns:
- **Very High:** NPP, decomposition, nutrient cycling, retention, loss
- **High:** All carbon storage services
- **Moderate:** Erosion protection
- **Variable:** Nitrogen fixation (Very High: 692, High: 3,547, Moderate: 454, Low: 6,957)

#### Distribution of Ratings

| Service | Very High | High | Moderate | Low | Very Low | Unable to Classify |
|---------|-----------|------|----------|-----|----------|--------------------|
| NPP | 2,211 | 1,146 | 5,422 | 2,102 | 769 | 30 |
| Decomposition | 3,485 | 2,639 | 2,023 | 3,503 | - | 30 |
| Nutrient Cycling | 3,485 | 2,639 | 2,023 | 3,503 | - | 30 |
| Nutrient Retention | 1,619 | 1,543 | 6,622 | 1,866 | - | 30 |
| Nutrient Loss | 1,866 | 1,545 | 6,620 | 1,619 | - | 30 |
| Carbon Biomass | 1,619 | 1,543 | 6,622 | 1,866 | - | 30 |
| Carbon Recalcitrant | 3,503 | 1,456 | 4,825 | 1,866 | - | 30 |
| Carbon Total | 7,029 | 1,691 | 1,064 | 1,866 | - | 30 |
| Erosion Protection | 1,619 | 1,543 | 6,622 | 1,866 | - | 30 |
| Nitrogen Fixation | 603 | - | 545* | 10,532 | - | 0 |

*Nitrogen fixation has Moderate-High (90) and Moderate-Low (455) = 545 total

---

## Category Summary

| Category | Columns | % of Total |
|----------|---------|------------|
| Climate Extremes (ETCCDI) | 204 | 26.3% |
| WorldClim Bioclimatic | 152 | 19.6% |
| Soil Properties (SoilGrids) | 169 | 21.8% |
| Phylogenetic Eigenvectors | 92 | 11.9% |
| WorldClim Solar Radiation | 48 | 6.2% |
| WorldClim Vapor Pressure | 48 | 6.2% |
| Ecosystem Services (ratings + confidence) | 20 | 2.6% |
| Functional Traits | 13 | 1.7% |
| Ellenberg Indicators | 10 | 1.3% |
| TRY Categorical Traits | 7 | 0.9% |
| Log-Transformed Traits | 6 | 0.8% |
| Nitrogen Fixation Evidence | 5 | 0.6% |
| WorldClim Elevation | 4 | 0.5% |
| Identifiers & Taxonomy | 4 | 0.5% |
| CSR Strategy Scores | 3 | 0.4% |
| Derived Traits | 2 | 0.3% |
| **TOTAL** | **775** | **100%** |

---

## Data Quality Summary

| Metric | Value |
|--------|-------|
| Total species | 11,680 |
| Total indicators | 775 |
| CSR coverage | 99.7% (11,650 species) |
| Family/genus coverage | 99.3% (11,600 species) |
| Height coverage | 100% |
| Life form coverage | 78.8% (9,204 species) |
| TRY nitrogen fixation evidence | 40.3% (4,706 species) |
| Ecosystem services completeness | 100% (all 11,680 species rated) |

---

## Reading the Final Dataset

**Note:** Due to PyArrow compatibility issues, use one of these methods:

### Method 1: DuckDB (Recommended)
```python
import duckdb
with duckdb.connect() as con:
    df = con.execute(
        "SELECT * FROM read_parquet('model_data/outputs/perm2_production/perm2_11680_with_ecoservices_20251030.parquet')"
    ).df()
```

### Method 2: R
```r
library(arrow)
df <- read_parquet('model_data/outputs/perm2_production/perm2_11680_with_ecoservices_20251030.parquet')
```

### Method 3: Verification Script
```bash
conda run -n AI python src/Stage_3/verification/verify_csr_pipeline.py
```

---

**Date Generated:** 2025-10-31
**Document Version:** 1.0
**Dataset Version:** perm2_11680_with_ecoservices_20251030.parquet
