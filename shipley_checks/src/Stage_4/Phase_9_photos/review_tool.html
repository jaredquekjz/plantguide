<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photo Review Tool</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #333;
    }
    .header h1 { font-size: 1.5rem; font-weight: 500; }
    .header-nav { display: flex; gap: 15px; align-items: center; }
    .header-nav a {
      color: #888;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      background: #2a2a2a;
    }
    .header-nav a:hover { background: #333; }
    .header-nav a.active { background: #4ade80; color: #1a1a1a; }
    .progress { color: #888; font-size: 0.9rem; }
    .progress strong { color: #4ade80; }
    .sync-status {
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 4px;
      background: #333;
      transition: all 0.2s;
    }
    .sync-status.saving { background: #f59e0b; color: #1a1a1a; }
    .sync-status.saved { background: #22c55e; color: #1a1a1a; }
    .sync-status.error { background: #ef4444; }
    .sync-status.flash { background: #4ade80; color: #1a1a1a; transform: scale(1.1); }

    .nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .nav button {
      background: #333;
      border: none;
      color: #e0e0e0;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }
    .nav button:hover { background: #444; }
    .nav button:disabled { opacity: 0.3; cursor: not-allowed; }
    .species-name {
      font-size: 1.2rem;
      min-width: 300px;
      text-align: center;
    }
    .species-name em { color: #888; font-size: 0.85rem; }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      max-width: 900px;
      margin: 0 auto 20px;
    }
    .photo-card {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      border: 3px solid #333;
      transition: border-color 0.15s;
    }
    .photo-card:hover { border-color: #555; }
    .photo-card.flagged { border-color: #ef4444; }
    .photo-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .photo-card .overlay {
      position: absolute;
      inset: 0;
      background: rgba(239, 68, 68, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
    }
    .photo-card.flagged .overlay { display: flex; }
    .photo-card .index {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    .photo-card .crown {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #333;
      border: 2px solid #555;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      transition: all 0.2s;
    }
    .photo-card .crown:hover {
      background: #444;
      border-color: #fbbf24;
      color: #fbbf24;
    }
    .photo-card .crown.active {
      background: #fbbf24;
      border-color: #fbbf24;
      color: #1a1a1a;
      box-shadow: 0 0 10px #fbbf24;
    }
    .photo-card.missing {
      background: #2a2a2a;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #555;
      font-size: 0.8rem;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
      padding: 15px;
      background: #222;
      border-radius: 8px;
    }
    .flagged-list { color: #ef4444; }
    .flagged-list:empty::before { content: 'None flagged'; color: #555; }

    .btn {
      background: #333;
      color: #e0e0e0;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }
    .btn:hover { background: #444; }
    .btn-primary { background: #4ade80; color: #1a1a1a; }
    .btn-primary:hover { background: #22c55e; }
    .btn-danger { background: #ef4444; }
    .btn-danger:hover { background: #dc2626; }

    .jump-input {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .jump-input input {
      width: 120px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: #e0e0e0;
      text-align: center;
    }

    .keyboard-hint {
      text-align: center;
      color: #555;
      font-size: 0.8rem;
      margin-top: 15px;
    }
    kbd {
      background: #333;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }

    .loading {
      text-align: center;
      padding: 100px;
      color: #888;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #333;
      border-top-color: #4ade80;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-status { margin-top: 10px; font-size: 0.85rem; }

    .stats {
      max-width: 900px;
      margin: 20px auto 0;
      padding: 15px;
      background: #222;
      border-radius: 8px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      text-align: center;
    }
    .stat-item { color: #888; }
    .stat-item strong { display: block; font-size: 1.5rem; color: #e0e0e0; }

    /* Flagged view styles */
    .flagged-view {
      max-width: 1200px;
      margin: 0 auto;
    }
    .flagged-species {
      background: #222;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .flagged-species h3 {
      margin-bottom: 10px;
      font-weight: 500;
    }
    .flagged-species h3 em { color: #888; font-size: 0.8rem; margin-left: 10px; }
    .flagged-photos {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .flagged-photo {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #ef4444;
    }
    .flagged-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .flagged-photo .unflag-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0,0,0,0.7);
      border: none;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
    }
    .flagged-photo .unflag-btn:hover { background: #ef4444; }
    .flagged-photo .photo-num {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .empty-state {
      text-align: center;
      padding: 60px;
      color: #555;
    }
    .empty-state h2 { color: #4ade80; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="loading-spinner"></div>
      <div>Loading 10,811 species...</div>
      <div class="loading-status" id="loading-status">Downloading index</div>
    </div>
  </div>

  <script>
    const PHOTO_BASE = 'https://photos.olier.ai';
    const API_BASE = '/review/api';

    let species = [];
    let speciesMap = {};
    let currentIndex = 0;
    let flags = {};
    let reviewed = [];
    let needsPhotos = [];  // Species that need more photos
    let crowns = {};  // Best photo per species {species: photoIndex}
    let currentView = 'review'; // 'review' or 'flagged'
    let syncStatus = 'saved';

    async function init() {
      const status = document.getElementById('loading-status');

      // Load minimal species index from same origin (avoids CORS)
      status.textContent = 'Downloading species index...';
      const res = await fetch('/review/species_index.json');
      const index = await res.json();

      // Convert minimal format {s, w, n} to full format
      status.textContent = 'Building index...';
      species = index.map(item => ({
        species: item.s,
        wfo_taxon_id: item.w,
        photos: Array.from({length: item.n}, (_, i) => ({index: i + 1}))
      }));
      speciesMap = Object.fromEntries(species.map((s, i) => [s.species, i]));

      // Load flags from server
      try {
        const flagsRes = await fetch(`${API_BASE}/flags`);
        const data = await flagsRes.json();
        flags = data.flags || {};
        reviewed = data.reviewed || [];
        needsPhotos = data.needsPhotos || [];
        crowns = data.crowns || {};
      } catch (e) {
        console.warn('Server unavailable, using localStorage');
        const savedFlags = localStorage.getItem('photo_review_flags');
        if (savedFlags) flags = JSON.parse(savedFlags);
        const savedReviewed = localStorage.getItem('photo_review_progress');
        if (savedReviewed) reviewed = JSON.parse(savedReviewed);
        const savedNeeds = localStorage.getItem('photo_review_needs');
        if (savedNeeds) needsPhotos = JSON.parse(savedNeeds);
        const savedCrowns = localStorage.getItem('photo_review_crowns');
        if (savedCrowns) crowns = JSON.parse(savedCrowns);
      }

      // Resume position
      const lastIndex = localStorage.getItem('photo_review_index');
      if (lastIndex) currentIndex = parseInt(lastIndex);

      render();
      setupKeyboard();
    }

    async function saveToServer() {
      syncStatus = 'saving';
      render();

      // Always save to localStorage as backup
      localStorage.setItem('photo_review_flags', JSON.stringify(flags));
      localStorage.setItem('photo_review_progress', JSON.stringify(reviewed));
      localStorage.setItem('photo_review_needs', JSON.stringify(needsPhotos));
      localStorage.setItem('photo_review_crowns', JSON.stringify(crowns));
      localStorage.setItem('photo_review_index', currentIndex);

      // Try to save to server
      try {
        await fetch(`${API_BASE}/flags`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ flags, reviewed, needsPhotos, crowns })
        });
        syncStatus = 'saved';
        render();
        // Flash "Saved!" effect
        const statusEl = document.querySelector('.sync-status');
        if (statusEl) {
          statusEl.textContent = 'Saved!';
          statusEl.classList.add('flash');
          setTimeout(() => {
            statusEl.classList.remove('flash');
            statusEl.textContent = 'Synced';
          }, 800);
        }
      } catch (e) {
        console.warn('Failed to save to server');
        syncStatus = 'error';
        render();
      }
    }

    function toggleFlag(speciesName, photoIndex) {
      if (!flags[speciesName]) flags[speciesName] = [];
      const idx = flags[speciesName].indexOf(photoIndex);
      if (idx === -1) {
        flags[speciesName].push(photoIndex);
      } else {
        flags[speciesName].splice(idx, 1);
      }
      if (flags[speciesName].length === 0) delete flags[speciesName];
      saveToServer();
    }

    function toggleReviewed(speciesName) {
      const idx = reviewed.indexOf(speciesName);
      if (idx === -1) {
        // Trying to mark as reviewed - must have crown first
        if (!crowns[speciesName]) {
          showMessage('Please select a cover photo (crown) first');
          return;
        }
        reviewed.push(speciesName);
      } else {
        reviewed.splice(idx, 1);
      }
      saveToServer();
    }

    function showMessage(msg) {
      const el = document.createElement('div');
      el.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#ef4444;color:white;padding:12px 24px;border-radius:8px;font-weight:500;z-index:1000;';
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 2000);
    }

    function markReviewedAndNext() {
      const sp = species[currentIndex].species;
      // Must have crown to proceed
      if (!crowns[sp]) {
        showMessage('Please select a cover photo (crown) first');
        return;
      }
      if (!reviewed.includes(sp)) {
        reviewed.push(sp);
        saveToServer();
      }
      // Now can proceed to next
      if (currentIndex < species.length - 1) {
        currentIndex++;
        localStorage.setItem('photo_review_index', currentIndex);
        render();
      }
    }

    function toggleNeedsPhotos(speciesName) {
      const idx = needsPhotos.indexOf(speciesName);
      if (idx === -1) {
        needsPhotos.push(speciesName);
      } else {
        needsPhotos.splice(idx, 1);
      }
      saveToServer();
    }

    function setCrown(speciesName, photoIndex) {
      // Toggle crown - if same photo clicked, remove crown
      if (crowns[speciesName] === photoIndex) {
        delete crowns[speciesName];
      } else {
        crowns[speciesName] = photoIndex;
        // Also mark as reviewed
        if (!reviewed.includes(speciesName)) {
          reviewed.push(speciesName);
        }
      }
      saveToServer();
    }

    function prev() {
      if (currentIndex > 0) {
        currentIndex--;
        localStorage.setItem('photo_review_index', currentIndex);
        render();
      }
    }

    function next() {
      const current = species[currentIndex];
      // Block if not reviewed
      if (!reviewed.includes(current.species)) {
        showMessage('Please review this species first (select a crown)');
        return;
      }
      if (currentIndex < species.length - 1) {
        currentIndex++;
        localStorage.setItem('photo_review_index', currentIndex);
        render();
      }
    }

    function jumpTo(idx) {
      if (idx >= 0 && idx < species.length) {
        currentIndex = idx;
        localStorage.setItem('photo_review_index', currentIndex);
        render();
      }
    }

    function jumpToSpecies(speciesName) {
      const idx = speciesMap[speciesName];
      if (idx !== undefined) {
        currentIndex = idx;
        currentView = 'review';
        localStorage.setItem('photo_review_index', currentIndex);
        render();
      }
    }

    function exportFlags() {
      const totalFlagged = Object.values(flags).reduce((a, b) => a + b.length, 0);
      const data = {
        exported_at: new Date().toISOString(),
        total_species: species.length,
        total_reviewed: reviewed.length,
        total_flagged: totalFlagged,
        flags: flags
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `photo_flags_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
    }

    function setView(view) {
      currentView = view;
      render();
    }

    function setupKeyboard() {
      document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT') return;
        if (currentView !== 'review') return;

        const current = species[currentIndex];
        if (!current) return;

        if (e.key === 'ArrowLeft') prev();
        else if (e.key === 'ArrowRight') next();
        else if (e.key === ' ') { e.preventDefault(); markReviewedAndNext(); }
        else if (e.key >= '1' && e.key <= '9') {
          const photoIdx = parseInt(e.key);
          if (photoIdx <= current.photos.length) {
            toggleFlag(current.species, photoIdx);
          }
        }
        else if (e.key === '0') {
          if (current.photos.length >= 10) {
            toggleFlag(current.species, 10);
          }
        }
      });
    }

    function render() {
      const totalFlagged = Object.values(flags).reduce((a, b) => a + b.length, 0);

      if (currentView === 'flagged') {
        renderFlaggedView(totalFlagged);
      } else if (currentView === 'needs') {
        renderNeedsView(totalFlagged);
      } else {
        renderReviewView(totalFlagged);
      }
    }

    function renderReviewView(totalFlagged) {
      const current = species[currentIndex];
      if (!current) return;

      const currentFlags = flags[current.species] || [];
      const syncClass = syncStatus === 'saving' ? 'saving' : syncStatus === 'error' ? 'error' : 'saved';
      const syncText = syncStatus === 'saving' ? 'Saving...' : syncStatus === 'error' ? 'Offline' : 'Synced';

      document.getElementById('app').innerHTML = `
        <div class="header">
          <div class="header-nav">
            <h1>Photo Review</h1>
            <a href="#" class="active" onclick="setView('review'); return false;">Review</a>
            <a href="#" onclick="setView('flagged'); return false;">Flagged (${totalFlagged})</a>
            <a href="#" onclick="setView('needs'); return false;" style="${needsPhotos.length > 0 ? 'background:#f59e0b;color:#1a1a1a;' : ''}">Needs Photos (${needsPhotos.length})</a>
          </div>
          <div style="display: flex; align-items: center; gap: 15px;">
            <span class="sync-status ${syncClass}">${syncText}</span>
            <div class="progress">
              Reviewed: <strong>${reviewed.length}</strong> / ${species.length}
            </div>
          </div>
        </div>

        <div class="nav">
          <button onclick="prev()" ${currentIndex === 0 ? 'disabled' : ''}>&#9664; Prev</button>
          <div class="species-name">
            <div>${current.species.replace(/_/g, ' ')}</div>
            <em>${current.wfo_taxon_id}</em>
          </div>
          <button onclick="toggleReviewed('${current.species}')"
            style="padding: 12px 24px; font-weight: 600; ${reviewed.includes(current.species)
              ? 'background: #4ade80; color: #1a1a1a;'
              : 'background: #333; color: #888;'}">
            ${reviewed.includes(current.species) ? '&#10003; Reviewed' : 'Mark Reviewed'}
          </button>
          <button onclick="next()" ${currentIndex === species.length - 1 ? 'disabled' : ''}>Next &#9654;</button>
        </div>

        <div class="photo-grid" style="grid-template-columns: repeat(${Math.min(5, current.photos.length)}, 1fr);">
          ${current.photos.map(photo => {
            const photoNum = photo.index;
            const isFlagged = currentFlags.includes(photoNum);
            const isCrowned = crowns[current.species] === photoNum;
            const url = `${PHOTO_BASE}/${current.species}/${photoNum}.webp`;
            return `
              <div class="photo-card ${isFlagged ? 'flagged' : ''}" onclick="toggleFlag('${current.species}', ${photoNum})">
                <img src="${url}" alt="Photo ${photoNum}" loading="lazy">
                <div class="overlay">&#10005;</div>
                <button class="crown ${isCrowned ? 'active' : ''}" onclick="event.stopPropagation(); setCrown('${current.species}', ${photoNum})" title="Set as cover photo">&#9818;</button>
                <span class="index">${photoNum}</span>
              </div>
            `;
          }).join('')}
        </div>

        <div class="status-bar">
          <div>
            <span style="color: #888">Flagged:</span>
            <span class="flagged-list">${currentFlags.length ? currentFlags.sort((a,b) => a-b).join(', ') : ''}</span>
          </div>
          ${current.photos.length < 10 ? `
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 6px 12px; border-radius: 6px; background: ${needsPhotos.includes(current.species) ? '#f59e0b' : '#333'}; color: ${needsPhotos.includes(current.species) ? '#1a1a1a' : '#888'};">
              <input type="checkbox" ${needsPhotos.includes(current.species) ? 'checked' : ''}
                onchange="toggleNeedsPhotos('${current.species}')" style="cursor: pointer;">
              Needs photos (${current.photos.length}/10)
            </label>
          ` : `<span style="color: #4ade80;">(10 photos)</span>`}
          <div class="jump-input">
            <input type="number" id="jumpIdx" min="1" max="${species.length}" placeholder="Jump to #" value="${currentIndex + 1}"
              onkeydown="if(event.key==='Enter')jumpTo(parseInt(this.value)-1)">
          </div>
        </div>

        <div class="keyboard-hint">
          <kbd>&#8592;</kbd> <kbd>&#8594;</kbd> navigate &nbsp;|&nbsp;
          <kbd>1</kbd>-<kbd>0</kbd> toggle flag &nbsp;|&nbsp;
          <kbd>Space</kbd> mark reviewed & next
        </div>

        <div class="stats">
          <div class="stat-item">
            <strong>${currentIndex + 1}</strong>
            Current
          </div>
          <div class="stat-item">
            <strong>${species.length}</strong>
            Total Species
          </div>
          <div class="stat-item">
            <strong>${totalFlagged}</strong>
            Bad Photos
          </div>
          <div class="stat-item">
            <strong style="color: ${needsPhotos.length > 0 ? '#f59e0b' : '#e0e0e0'};">${needsPhotos.length}</strong>
            Needs Photos
          </div>
        </div>
      `;
    }

    function renderFlaggedView(totalFlagged) {
      const flaggedSpecies = Object.entries(flags).sort((a, b) => a[0].localeCompare(b[0]));

      let content = '';
      if (flaggedSpecies.length === 0) {
        content = `
          <div class="empty-state">
            <h2>No flagged photos</h2>
            <p>Photos you flag during review will appear here for final checking.</p>
          </div>
        `;
      } else {
        content = flaggedSpecies.map(([speciesName, photoIndices]) => {
          const sp = species.find(s => s.species === speciesName);
          const wfo = sp ? sp.wfo_taxon_id : '';

          return `
            <div class="flagged-species">
              <h3>
                <a href="#" onclick="jumpToSpecies('${speciesName}'); return false;" style="color: #e0e0e0; text-decoration: none;">
                  ${speciesName.replace(/_/g, ' ')}
                </a>
                <em>${wfo}</em>
              </h3>
              <div class="flagged-photos">
                ${photoIndices.sort((a,b) => a-b).map(idx => `
                  <div class="flagged-photo">
                    <img src="${PHOTO_BASE}/${speciesName}/${idx}.webp" alt="Photo ${idx}">
                    <button class="unflag-btn" onclick="toggleFlag('${speciesName}', ${idx})" title="Unflag">&#10005;</button>
                    <span class="photo-num">#${idx}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }).join('');
      }

      document.getElementById('app').innerHTML = `
        <div class="header">
          <div class="header-nav">
            <h1>Photo Review</h1>
            <a href="#" onclick="setView('review'); return false;">Review</a>
            <a href="#" class="active" onclick="setView('flagged'); return false;">Flagged (${totalFlagged})</a>
          </div>
          <span class="sync-status saved">Synced</span>
        </div>

        <div class="flagged-view">
          <div style="margin-bottom: 20px; color: #888;">
            ${flaggedSpecies.length} species with ${totalFlagged} flagged photos total.
            Click species name to jump to review. Click X to unflag.
          </div>
          ${content}
        </div>
      `;
    }

    function renderNeedsView(totalFlagged) {
      let content = '';
      if (needsPhotos.length === 0) {
        content = `
          <div class="empty-state">
            <h2>No species marked</h2>
            <p>Species with fewer than 10 photos that you mark as "Needs photos" will appear here.</p>
          </div>
        `;
      } else {
        content = needsPhotos.sort().map(speciesName => {
          const sp = species.find(s => s.species === speciesName);
          const photoCount = sp ? sp.photos.length : 0;
          const wfo = sp ? sp.wfo_taxon_id : '';

          return `
            <div class="flagged-species">
              <h3>
                <a href="#" onclick="jumpToSpecies('${speciesName}'); return false;" style="color: #e0e0e0; text-decoration: none;">
                  ${speciesName.replace(/_/g, ' ')}
                </a>
                <em>${wfo}</em>
                <span style="color: #f59e0b; margin-left: 10px;">(${photoCount}/10 photos)</span>
              </h3>
              <button class="btn" onclick="toggleNeedsPhotos('${speciesName}')" style="margin-top: 8px;">Remove from list</button>
            </div>
          `;
        }).join('');
      }

      document.getElementById('app').innerHTML = `
        <div class="header">
          <div class="header-nav">
            <h1>Photo Review</h1>
            <a href="#" onclick="setView('review'); return false;">Review</a>
            <a href="#" onclick="setView('flagged'); return false;">Flagged (${totalFlagged})</a>
            <a href="#" class="active" style="background:#f59e0b;color:#1a1a1a;">Needs Photos (${needsPhotos.length})</a>
          </div>
          <span class="sync-status saved">Synced</span>
        </div>

        <div class="flagged-view">
          <div style="margin-bottom: 20px; color: #888;">
            ${needsPhotos.length} species marked as needing more photos.
            Click species name to jump to review.
          </div>
          ${content}
        </div>
      `;
    }

    init();
  </script>
</body>
</html>
