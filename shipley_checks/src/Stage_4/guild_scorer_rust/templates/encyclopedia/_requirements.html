{# S2: Growing Requirements - Alpine.js collapsible sections #}
<section class="space-y-3">
    <h2 class="text-xl font-semibold flex items-center gap-2 text-base-content">
        <svg class="w-6 h-6 stroke-primary" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
            <circle cx="12" cy="12" r="3"/>
        </svg>
        Growing Requirements
    </h2>

    {# Light Requirements Card - Always visible, not collapsible #}
    <div class="card bg-base-100 shadow-sm rounded-xl">
        <div class="card-body p-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center shrink-0">
                    <svg class="w-5 h-5 stroke-amber-600 dark:stroke-amber-400" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <circle cx="12" cy="12" r="4"/>
                        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
                    </svg>
                </div>
                <div class="flex-1 min-w-0">
                    <h3 class="font-medium text-base-content">{{ data.requirements.light.category }}</h3>
                    <p class="text-sm text-base-content/60 truncate">{{ data.requirements.light.description }}</p>
                </div>
                <div class="w-20 shrink-0">
                    <div class="h-2 bg-base-200 rounded-full overflow-hidden">
                        <div class="h-full bg-amber-500 rounded-full transition-all" style="width: {{ data.requirements.light.icon_fill_percent }}%"></div>
                    </div>
                    {% if let Some(eive_str) = data.requirements.light.eive_display() %}
                    <p class="text-xs text-base-content/50 text-center mt-1">EIVE-L: {{ eive_str }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {# Temperature Card - Alpine Accordion #}
    <div x-data="{ open: true }" class="card bg-base-100 shadow-sm rounded-xl overflow-hidden">
        <button
            @click="open = !open"
            :aria-expanded="open"
            class="w-full flex items-center justify-between p-4 text-left hover:bg-base-200/50 transition-colors"
        >
            <span class="flex items-center gap-3 font-medium">
                <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center shrink-0">
                    <svg class="w-5 h-5 stroke-red-500" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>
                    </svg>
                </div>
                Temperature
            </span>
            <svg
                class="w-5 h-5 stroke-current text-base-content/50 transition-transform duration-200"
                :class="{ 'rotate-180': open }"
                viewBox="0 0 24 24" fill="none" stroke-width="2"
            >
                <path d="m6 9 6 6 6-6"/>
            </svg>
        </button>
        <div x-show="open" x-collapse class="border-t border-base-200">
            <div class="p-4 pt-3 space-y-3">
                <p class="text-base-content/70 text-sm">{{ data.requirements.temperature.summary }}</p>

                {% if !data.requirements.temperature.comparisons.is_empty() %}
                <div class="overflow-x-auto -mx-4 px-4">
                    <table class="table table-sm table-zebra">
                        <thead>
                            <tr>
                                <th class="text-xs">Parameter</th>
                                <th class="text-xs">Local</th>
                                <th class="text-xs">Plant Range</th>
                                <th class="text-xs">Fit</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data.requirements.temperature.comparisons %}
                            <tr>
                                <td class="text-base-content/70 text-sm">{{ row.parameter }}</td>
                                <td class="font-mono text-sm">{{ row.local_value }}</td>
                                <td class="font-mono text-sm text-base-content/60">{{ row.plant_range }}</td>
                                <td>
                                    <span class="badge badge-sm {{ row.fit.css_class() }}">
                                        {{ row.fit.label() }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% for detail in data.requirements.temperature.details %}
                <p class="text-xs text-base-content/50">{{ detail }}</p>
                {% endfor %}
            </div>
        </div>
    </div>

    {# Moisture Card - Alpine Accordion #}
    <div x-data="{ open: false }" class="card bg-base-100 shadow-sm rounded-xl overflow-hidden">
        <button
            @click="open = !open"
            :aria-expanded="open"
            class="w-full flex items-center justify-between p-4 text-left hover:bg-base-200/50 transition-colors"
        >
            <span class="flex items-center gap-3 font-medium">
                <div class="w-10 h-10 bg-sky-100 dark:bg-sky-900/30 rounded-lg flex items-center justify-center shrink-0">
                    <svg class="w-5 h-5 stroke-sky-500" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                    </svg>
                </div>
                Moisture
            </span>
            <svg
                class="w-5 h-5 stroke-current text-base-content/50 transition-transform duration-200"
                :class="{ 'rotate-180': open }"
                viewBox="0 0 24 24" fill="none" stroke-width="2"
            >
                <path d="m6 9 6 6 6-6"/>
            </svg>
        </button>
        <div x-show="open" x-collapse class="border-t border-base-200">
            <div class="p-4 pt-3 space-y-3">
                <p class="text-base-content/70 text-sm">{{ data.requirements.moisture.summary }}</p>

                {% if !data.requirements.moisture.comparisons.is_empty() %}
                <div class="overflow-x-auto -mx-4 px-4">
                    <table class="table table-sm table-zebra">
                        <thead>
                            <tr>
                                <th class="text-xs">Parameter</th>
                                <th class="text-xs">Local</th>
                                <th class="text-xs">Plant Range</th>
                                <th class="text-xs">Fit</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data.requirements.moisture.comparisons %}
                            <tr>
                                <td class="text-base-content/70 text-sm">{{ row.parameter }}</td>
                                <td class="font-mono text-sm">{{ row.local_value }}</td>
                                <td class="font-mono text-sm text-base-content/60">{{ row.plant_range }}</td>
                                <td>
                                    <span class="badge badge-sm {{ row.fit.css_class() }}">
                                        {{ row.fit.label() }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% for advice in data.requirements.moisture.advice %}
                <div class="alert alert-info py-2 text-sm">
                    <svg class="w-4 h-4 stroke-current shrink-0" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4M12 8h.01"/>
                    </svg>
                    <span>{{ advice }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    {# Soil Card - Alpine Accordion #}
    <div x-data="{ open: false }" class="card bg-base-100 shadow-sm rounded-xl overflow-hidden">
        <button
            @click="open = !open"
            :aria-expanded="open"
            class="w-full flex items-center justify-between p-4 text-left hover:bg-base-200/50 transition-colors"
        >
            <span class="flex items-center gap-3 font-medium">
                <div class="w-10 h-10 bg-stone-100 dark:bg-stone-900/30 rounded-lg flex items-center justify-center shrink-0">
                    <svg class="w-5 h-5 stroke-stone-500" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <path d="M2 22 16 8M3.47 12.53 5 11l1.53 1.53M7.59 8.41 9.12 6.88l1.53 1.53M11.7 4.3 14 2l1.53 1.53M17 8l3-3M9 15l-2 2M15 9l-2 2"/>
                    </svg>
                </div>
                Soil
            </span>
            <svg
                class="w-5 h-5 stroke-current text-base-content/50 transition-transform duration-200"
                :class="{ 'rotate-180': open }"
                viewBox="0 0 24 24" fill="none" stroke-width="2"
            >
                <path d="m6 9 6 6 6-6"/>
            </svg>
        </button>
        <div x-show="open" x-collapse class="border-t border-base-200">
            <div class="p-4 pt-3 space-y-3">
                <p class="text-base-content/70 text-sm">{{ data.requirements.soil.texture_summary }}</p>

                {% if let Some(ph) = data.requirements.soil.ph %}
                <div class="flex items-center gap-4 p-3 bg-base-200/50 rounded-lg">
                    <div>
                        <div class="text-xs text-base-content/50">Soil pH</div>
                        <div class="text-2xl font-bold">{{ ph.value_display() }}</div>
                    </div>
                    <div class="text-sm text-base-content/60">
                        Range: {{ ph.range }}<br>
                        <span class="text-xs">{{ ph.interpretation }}</span>
                    </div>
                </div>
                {% endif %}

                {% if !data.requirements.soil.comparisons.is_empty() %}
                <div class="overflow-x-auto -mx-4 px-4">
                    <table class="table table-sm table-zebra">
                        <thead>
                            <tr>
                                <th class="text-xs">Parameter</th>
                                <th class="text-xs">Local</th>
                                <th class="text-xs">Plant Range</th>
                                <th class="text-xs">Fit</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data.requirements.soil.comparisons %}
                            <tr>
                                <td class="text-base-content/70 text-sm">{{ row.parameter }}</td>
                                <td class="font-mono text-sm">{{ row.local_value }}</td>
                                <td class="font-mono text-sm text-base-content/60">{{ row.plant_range }}</td>
                                <td>
                                    <span class="badge badge-sm {{ row.fit.css_class() }}">
                                        {{ row.fit.label() }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% for advice in data.requirements.soil.advice %}
                <div class="alert alert-warning py-2 text-sm">
                    <svg class="w-4 h-4 stroke-current shrink-0" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01"/>
                    </svg>
                    <span>{{ advice }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    {# Overall Suitability Summary #}
    {% if let Some(overall) = data.requirements.overall_suitability %}
    <div class="card bg-gradient-to-r from-primary/10 to-secondary/10 shadow-sm rounded-xl">
        <div class="card-body p-4">
            <div class="flex items-center justify-between gap-4">
                <div class="min-w-0">
                    <h3 class="font-medium text-base-content">Suitability for {{ overall.location_name }}</h3>
                    <p class="text-base-content/70 text-sm">{{ overall.verdict }}</p>
                </div>
                <div class="text-right shrink-0">
                    <div class="text-3xl font-bold text-primary">{{ overall.score_percent }}%</div>
                    <div class="text-xs text-base-content/50">match</div>
                </div>
            </div>

            {% if !overall.key_concerns.is_empty() %}
            <div class="mt-3 pt-3 border-t border-base-content/10">
                <p class="text-xs font-medium text-base-content/60 mb-2">Key considerations:</p>
                <ul class="space-y-1">
                    {% for concern in overall.key_concerns %}
                    <li class="text-sm text-base-content/60 flex items-start gap-2">
                        <svg class="w-4 h-4 stroke-warning shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        </svg>
                        {{ concern }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</section>
