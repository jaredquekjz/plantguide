{# S5: Biological Interactions - Pollinators, herbivores, diseases, fungi #}
{% let has_any_data = data.interactions.pollinators.total_count > 0
    || data.interactions.herbivores.total_count > 0
    || !data.interactions.diseases.pathogens.is_empty()
    || !data.interactions.beneficial_fungi.mycoparasites.is_empty()
    || !data.interactions.beneficial_fungi.entomopathogens.is_empty()
    || data.interactions.mycorrhizal_type != "Not documented" %}

{% if has_any_data %}
<section class="space-y-3">
    <h2 class="text-xl font-semibold flex items-center gap-2 text-base-content">
        <svg class="w-6 h-6 stroke-primary" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 8c0 4-6 10-6 10S6 12 6 8a6 6 0 0 1 12 0"/>
            <circle cx="12" cy="8" r="2"/>
        </svg>
        Biological Interactions
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        {# Pollinators Card #}
        {% if data.interactions.pollinators.total_count > 0 %}
        <div x-data="{ expanded: false }" class="card bg-base-100 shadow-sm rounded-xl">
            <div class="card-body p-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center shrink-0">
                        <svg class="w-5 h-5 stroke-amber-600 dark:stroke-amber-400" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M12 7.5a4.5 4.5 0 1 1 4.5 4.5M12 7.5A4.5 4.5 0 1 0 7.5 12M12 7.5V3m0 9.5L16 16"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium">Pollinators</h3>
                        <p class="text-sm text-base-content/60">{{ data.interactions.pollinators.total_count }} species</p>
                    </div>
                </div>

                {% if !data.interactions.pollinators.categories.is_empty() %}
                <div class="mt-3 space-y-2">
                    {% for cat in data.interactions.pollinators.categories %}
                    <div>
                        <p class="text-xs font-medium text-base-content/50 uppercase">{{ cat.name }}</p>
                        <p class="text-sm text-base-content/70" x-show="expanded || {{ cat.organisms.len() }} <= 3">
                            {{ cat.organisms.join(", ") }}
                        </p>
                        <p class="text-sm text-base-content/70" x-show="!expanded && {{ cat.organisms.len() }} > 3">
                            {{ cat.organisms[..3.min(cat.organisms.len())].join(", ") }}...
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% if data.interactions.pollinators.total_count > 3 %}
                <button @click="expanded = !expanded" class="btn btn-ghost btn-xs mt-2" x-text="expanded ? 'Show less' : 'Show all'"></button>
                {% endif %}
                {% endif %}
            </div>
        </div>
        {% endif %}

        {# Herbivores/Pests Card #}
        {% if data.interactions.herbivores.total_count > 0 %}
        <div x-data="{ expanded: false }" class="card bg-base-100 shadow-sm rounded-xl">
            <div class="card-body p-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center shrink-0">
                        <svg class="w-5 h-5 stroke-red-600 dark:stroke-red-400" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/>
                            <path d="M8.5 8.5v.01M16 15.5v.01M12 12v.01"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium">Herbivores & Pests</h3>
                        <p class="text-sm text-base-content/60">{{ data.interactions.herbivores.total_count }} species</p>
                    </div>
                </div>

                {% if !data.interactions.herbivores.categories.is_empty() %}
                <div class="mt-3 space-y-2">
                    {% for cat in data.interactions.herbivores.categories %}
                    <div>
                        <p class="text-xs font-medium text-base-content/50 uppercase">{{ cat.name }}</p>
                        <p class="text-sm text-base-content/70" x-show="expanded || {{ cat.organisms.len() }} <= 3">
                            {{ cat.organisms.join(", ") }}
                        </p>
                        <p class="text-sm text-base-content/70" x-show="!expanded && {{ cat.organisms.len() }} > 3">
                            {{ cat.organisms[..3.min(cat.organisms.len())].join(", ") }}...
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% if data.interactions.herbivores.total_count > 3 %}
                <button @click="expanded = !expanded" class="btn btn-ghost btn-xs mt-2" x-text="expanded ? 'Show less' : 'Show all'"></button>
                {% endif %}
                {% endif %}
            </div>
        </div>
        {% endif %}

        {# Diseases Card #}
        {% if !data.interactions.diseases.pathogens.is_empty() %}
        <div class="card bg-base-100 shadow-sm rounded-xl">
            <div class="card-body p-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center shrink-0">
                        <svg class="w-5 h-5 stroke-orange-600 dark:stroke-orange-400" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <path d="M12 9v4M12 17h.01"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium">Known Diseases</h3>
                        <p class="text-sm text-base-content/60">{{ data.interactions.diseases.pathogens.len() }} pathogens</p>
                    </div>
                </div>

                <div class="mt-3 space-y-1">
                    {% for pathogen in data.interactions.diseases.pathogens %}
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-base-content/70 italic">{{ pathogen.name }}</span>
                        <span class="badge badge-ghost badge-xs">{{ pathogen.severity }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        {# Mycorrhizal & Beneficial Fungi Card #}
        {% if data.interactions.mycorrhizal_type != "Not documented" || !data.interactions.beneficial_fungi.mycoparasites.is_empty() || !data.interactions.beneficial_fungi.entomopathogens.is_empty() %}
        <div class="card bg-base-100 shadow-sm rounded-xl">
            <div class="card-body p-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-violet-100 dark:bg-violet-900/30 rounded-lg flex items-center justify-center shrink-0">
                        <svg class="w-5 h-5 stroke-violet-600 dark:stroke-violet-400" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M12 3c-1.2 0-2.4.6-3 1.7A3.6 3.6 0 0 0 4.6 9c-1 .6-1.7 1.8-1.7 3s.7 2.4 1.7 3c-.3 1.2 0 2.5 1 3.4.8.8 2.1 1.2 3.3 1 .6 1 1.8 1.6 3 1.6s2.4-.6 3-1.7c1.2.3 2.5 0 3.4-1 .8-.8 1.2-2 1-3.3 1-.6 1.6-1.8 1.6-3s-.6-2.4-1.7-3c.3-1.2 0-2.5-1-3.4a3.7 3.7 0 0 0-3.3-1c-.6-1-1.8-1.6-3-1.6z"/>
                            <circle cx="12" cy="12" r="2"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium">Fungal Partners</h3>
                        <p class="text-sm text-base-content/60">{{ data.interactions.mycorrhizal_type }}</p>
                    </div>
                </div>

                {% if !data.interactions.beneficial_fungi.mycoparasites.is_empty() || !data.interactions.beneficial_fungi.entomopathogens.is_empty() %}
                <div class="mt-3 space-y-2">
                    {% if !data.interactions.beneficial_fungi.mycoparasites.is_empty() %}
                    <div>
                        <p class="text-xs font-medium text-base-content/50 uppercase">Disease Biocontrol</p>
                        <p class="text-sm text-base-content/70">{{ data.interactions.beneficial_fungi.mycoparasites.join(", ") }}</p>
                    </div>
                    {% endif %}
                    {% if !data.interactions.beneficial_fungi.entomopathogens.is_empty() %}
                    <div>
                        <p class="text-xs font-medium text-base-content/50 uppercase">Pest Biocontrol</p>
                        <p class="text-sm text-base-content/70">{{ data.interactions.beneficial_fungi.entomopathogens.join(", ") }}</p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}
