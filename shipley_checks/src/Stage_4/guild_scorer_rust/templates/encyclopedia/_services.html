{# S4: Ecosystem Services - Visual cards for plant's ecological contributions #}
{% let has_services = !data.services.services.is_empty()
    || data.services.nitrogen_fixer
    || data.services.is_pollinator_magnet()
    || data.services.carbon_storage.is_some() %}

{% if has_services %}
<section class="space-y-3">
    <h2 class="text-xl font-semibold flex items-center gap-2 text-base-content">
        <svg class="w-6 h-6 stroke-primary" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/>
            <path d="M2 12h20"/>
        </svg>
        Ecosystem Services
    </h2>

    {# Special badges for key services #}
    <div class="flex flex-wrap gap-2">
        {% if data.services.nitrogen_fixer %}
        <div class="badge badge-lg gap-2 bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200 border-0">
            <svg class="w-4 h-4 stroke-current" viewBox="0 0 24 24" fill="none" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
            </svg>
            Nitrogen Fixer
        </div>
        {% endif %}

        {% if data.services.is_pollinator_magnet() %}
        <div class="badge badge-lg gap-2 bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200 border-0">
            <svg class="w-4 h-4 stroke-current" viewBox="0 0 24 24" fill="none" stroke-width="2">
                <path d="M12 7.5a4.5 4.5 0 1 1 4.5 4.5M12 7.5A4.5 4.5 0 1 0 7.5 12M12 7.5V3m0 9.5L16 16m-4-4-4 4"/>
            </svg>
            Pollinator Magnet
        </div>
        {% endif %}

        {% if let Some(carbon) = data.services.carbon_storage %}
        <div class="badge badge-lg gap-2 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 border-0">
            <svg class="w-4 h-4 stroke-current" viewBox="0 0 24 24" fill="none" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M8 12h8M12 8v8"/>
            </svg>
            Carbon: {{ carbon }}
        </div>
        {% endif %}
    </div>

    {% if !data.services.services.is_empty() %}
    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        {% for service in data.services.services %}
        <div class="card bg-base-100 shadow-sm rounded-xl">
            <div class="card-body p-3">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center shrink-0
                                bg-{{ service.icon.color() }}-100 dark:bg-{{ service.icon.color() }}-900/30">
                        <svg class="w-4 h-4 stroke-{{ service.icon.color() }}-600 dark:stroke-{{ service.icon.color() }}-400"
                             viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            {{ service.icon.svg_path()|safe }}
                        </svg>
                    </div>
                    <div class="min-w-0 flex-1">
                        <h3 class="font-medium text-sm text-base-content truncate">{{ service.name }}</h3>
                    </div>
                </div>
                <div class="flex items-baseline justify-between">
                    <span class="text-xl font-semibold text-primary">{{ service.value }}</span>
                    <span class="text-xs text-base-content/40">{{ service.confidence }}</span>
                </div>
                <p class="text-xs text-base-content/60 mt-1 line-clamp-2">{{ service.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</section>
{% endif %}
